メールアカウント(ボックス)を持つPost.Officeをイントラネットに置き、リレー(ゲートウェイ)用MTAとしてDMZにローカルアカウントを持たないPost.OfficeをDMZに置く場合、v3.9より前のバージョンでは、未知のアカウントに対するメールをブロックすることができませんでした。
Post.Office v4.0からLDAP経由でのアカウントチェック(実際には、アカウントの持つメールアドレスチェック)ができるようになりました。対応するLDAPサーバは、イントラネット内に設置されたPost.Office Advanced Edition (v4.0以上)のLDAPサーバになります。
イントラネット内のPost.Office
システムコンフィグレーションにある「LDAPサービス設定」でLDAPサービスを有効にします。
① 「LDAPサービスを有効にする:」を「はい」にチェックします。
② 「アクセス制限:」にイントラネットのPost.OfficeサーバのNICに設定されたIPアドレスとイントラネット内から見たDMZ上のリレー用Post.OfficeのIPアドレスを登録します。(行を分けて設定してください)
[送信]ボタンをクリックし、設定を有効にします。
※ 「LDAPの識別名:」、および「LDAPポート番号:」も任意の値に設定可能ですが、ここではデフォルト設定のままで説明します。(動作に関しては、デフォルト設定値のままで問題ありません)
DMZ内のリレーMTA用Post.Office
システムコンフィグレーションにある「メールルーティングオプションの設定」でLDAP経由での未知のアカウントに対するメールブロッキング設定をします。
① 「ローカルドメイン:」にイントラネット内のPost.Officeで設定されているローカルドメインを登録します。(ローカルドメインに登録していない場合、全メールアカウントのドメインパートを登録します)
② 「受信者がローカルメールドメイン内に存在するかを確認してからメールを受け取る」を「はい」にチェックします。
③ 「受信者の確認に LDAP を使用する:」を「はい」にチェックします。
「LDAPホスト:」にDMZから見たイントラネット内のPost.OfficeサーバのFQDN、またはIPアドレスを設定します。
「LDAP識別名:」、「LDAPポート番号:」は、イントラネット内のPost.Officeの設定に合わせます。(デフォルト値のままであれば、変更する必要はありません)
イントラネットのPost.Officeへメールを転送するためのルーティングを設定します。
④ 「SMTPメールルーティングテーブル:」にイントラネットのローカルドメイン向けのルートを登録します。
例.
opentech.co.jp:[192.168.1.10]
*.opentech.co.jp:[192.168.1.10]
⑤ 「強制ルーティングを行う:」を「はい」にチェックします。
[送信]ボタンをクリックし、設定を有効にします。
LDAP参照の確認
イントラネット内のPost.Office LDAPサーバからアカウントのメールアドレスが参照可能であることを確認します。
① システムコンフィグレーションにある「参照LDAPサーバの設定」で「LDAP参照を有効にする:」を「はい」にチェックします。
「LDAPホスト:」にDMZから見たイントラネット内のPost.OfficeサーバのFQDN、またはIPアドレスを設定します。
「LDAP識別名:」、「LDAPポート番号:」は、イントラネット内のPost.Officeの設定に合わせます。(デフォルト値のままであれば、変更する必要はありません)
※ 「LDAP参照を有効にする:」は、参照が正常に確認できれば、「いいえ」にして構いません。
② Web管理画面にログインする際に左フレームに表示される「LDAPディレクトリ」ボタンをクリックし、アカウント、メーリングリストのメールアドレスが表示されることを確認します。
表示されない場合は、上記イントラネット内Post.Office、DMZ内Post.OfficeのLDAP関連の設定に問題があるか、イントラネットからDMZへのLDAPポートが閉じられている可能性があります。
※ Post.Office v4.0では、メーリングリストアドレスも表示されますが、Post.Office v3.9までは、アカウントのメールアドレスのみ表示されていました。
※ 各アカウントの「ローカル配信情報:」にある「POP3/IMAP4ログイン名:」にログイン名が設定されていないとLDAP検索にてメールアドレスが表示されませんので、転送のみのアカウントでも必ず「POP3/IMAP4ログイン名:」にログイン名を設定してください。転送のみの場合、「POP3/IMAP4 配信:」のチェックは無効のままで構いません。
※ システムコンフィグレーションの「ログオプションの設定」にある「宛先アドレスチェックエラーログ」にチェックをすると存在しないアカウントに対し、受信した場合、次のエラーがpost.office-月日.logに出力されます。
20060314172553+0900:SMTP-Accept:Invalid recipient(LDAP): :[接続先IPアドレス]
Post.Office - 技術情報 - LDAP経由での未知のアカウントに対するメールブロッキング
