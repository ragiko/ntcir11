
ネットワークエンジニア を目指して
ようこそ「ネットワークエンジニアを目指して」へ!!
「ネットワークトラブルに恐れることなく立ち向かえるネットワークエンジニア」へと導くことを信条に、ネットワーク技術の解説とネットワークに関する情報を幅広く紹介します!
隣接ルータとのBGPピアの確立は、最終的に確立が終了するまでにいくつかの段階を経て行われます。 下図がBGPの状態遷移を表した図です。 最終的な確立状態をEstablishedといいます。    
BGP:Idle BGP接続のための最初の段階。 この状態ではBGP接続開始のタイミングを待っています。管理者がBGPの接続の開始を行うとルータはTCP接続を開始した後、 Connect状態へ移行します。もしこのときにエラーが発生するとIdleに戻ります。    BGP:Connect TCP接続の完了を待っている状態です。TCP接続が完了すると接続リトライタイマをクリアしOPENメッセージを送信して、OpenSent状態へ移行します。 もし、TCP接続に失敗すると接続リトライタイマをセットしてActive状態へ移行します。 接続リトライタイマのタイムアウトが発生すると接続リトライタイマを再スタートさせて、再度TCP接続を開始します。 その他のイベントが起きるとIdle状態に戻ります。   
BGP:Active TCP接続を開始して、ピアを張ろうとします。TCP接続が完了すると接続リトライタイマをクリアしOPENメッセージを送信して、OpenSent状態へ移行します。 また、この状態では相手のピアからのTCP接続が開始するのを待っています。 通常状態がConnectやActiveの状態のままである場合はTCP接続に問題がある場合が多いようです。  
BGP:OpenSent 相手からのOPENメッセージを待っている状態です。OPENメッセージを受信すると全てのフィールドの正常性を確認します。  そこでエラーが見つかった場合はNOTIFICATIONメッセージを送信し、Idle状態に戻ってしまいます。 エラーが無ければKEEPALIVEメッセージを送信し、KEEPALIVEタイマをリセットします。ここで互いのHOLDタイマを確認し、小さい方の値にセットされます。  もし、HOLDタイマが"0"にセットされていれば、KEEPALIVEタイマ、HOLDタイマ共に開始されません。  また相手のAS番号のフィールドを確認して自AS番号と同じであれば内部BGP、異なるAS番号であれば外部BGPと認識します。 もし、TCP接続が切断されたらActive状態に戻ります。 その他HOLDタイマの時間切れが起きたら、HOLDタイマの時間切れのエラーコードとともにNOTIFICATIONメッセージを送信し、Idle状態に戻ってしまいます。   BGP:OpenConfirm 相手からのKEEPALIVEメッセージあるいはNOTIFICATIONメッセージを待っている状態です。 相手からKEEPALIVEメッセージを受信したらEstablished状態に移行します。  もしKEEPALIVEメッセージを受信する前にHOLDタイマの時間切れが起きたら、HOLDタイマの時間切れのエラーコードとともにNOTIFICATIONメッセージを送信し、Idle状態に戻ってしまいます。 NOTIFICATIONメッセージを受信した場合も、Idle状態に戻ります。  その他何らかのエラーが発生した場合も同様に、エラーコードとともにNOTIFICATIONメッセージを送信し、Idle状態に戻ってしまいます。    BGP:Established BGPの接続が確立されている状態です。 この状態になって始めて、相手とUPDATE、KEEPALIVE、NOTIFICATIONメッセージを交換することが出来ます。  もしKEEPALIVEメッセージを受信する前にHOLDタイマの時間切れが起きたら、HOLDタイマの時間切れのエラーコードとともにNOTIFICATIONメッセージを送信し、Idle状態に戻ってしまいます。 NOTIFICATIONメッセージを受信した場合も、Idle状態に戻ります。  その他何らかのエラーが発生した場合も同様に、エラーコードとともにNOTIFICATIONメッセージを送信し、Idle状態に戻ってしまいます。 
おすすめ記事
経費削減に本領発揮!「ビデオ会議」特集
中規模システムの統合運用管理ツール選び
データ量急増の救世主「ミッドレンジNAS」
「統合ID管理ツール」シェア
おすすめ書籍紹介
マスタリングTCP/IP 応用編
入門編を卒業したらこちら。
応用編も入門編と同様に豊富な図を使用し、TCP/IPに関するさらに詳細な解説を記している。
特にパッケットの構造はかなり詳細に解説しており、初心者にはすこしつらいかもしれないが非常に読みやすいのでぜひ読んでみてほしい。 
インターネットルーティング入門 第2版
ネットワーク初心者の方にぜひおすすめしたい一冊。絵を豊富に使用し、「ルーティングとは」から始まり最後はRIP、BGP、MPLSまで深い解説ではなく、浅く満遍なく解説しています。
この本が理解できればルーティングスキルの第一歩を踏み出せるでしょう。 
関連記事
BGP −BGPとは?−
インターネット等の大規模ネットワークでは必須のプロトコルBGPについて。 
BGP −BGPの接続形態−
BGPの接続形態とルーティングの基本動作について。 
BGP −BGPメッセージの種類−
BGPで使用される様々なメッセージについて。 
BGP −BGP Path Attributes (パス属性) その1−
BGPといえばパスアトリビュートを活用した柔軟なルーティング!! 
BGP −BGP Path Attributes (パス属性) その2−
BGPといえばパスアトリビュートを活用した柔軟なルーティング!! 
BGP −BGP状態遷移−
BGPピアの確立までの状態遷移について。 
BGP −BGPの動作−
BGPの基本動作について。 
BGP −ルートマップ−
ルートマップを使ったルーティング制御について
メールマガジン
ネットワ−ク初心者のみなさま。
ネットワークの基礎知識を疎かにすることは
大変危険です!! 
「初心者にも理解できるネットワーク技術」
これを読めばネットワークの基礎が分かる!!
ネットワーク関連の仕事に就きたいとお考えの学生の方や、ネットワークに興味があって転職を考えている社会人の方、まずは登録してみてください。
もちろん無料です!!
メールマガジン購読はこちら
メールアドレス:
ネットワークエンジニアにおすすめのサイトはこちら 
Search
当サイトは、ネットワークエンジニア初心者へ送る知識の宝庫です。
いくらルータのコマンドを覚えても、基礎知識を自分ものにしていなければ、絶対に一流の技術者にはなれません。
当サイトの使命は、ネットワークトラブルに恐れることなく立ち向かえるネットワークエンジニアへと導くことです。
ネットワークの基礎をしっかりと身につけておいてこそ、応用技術のスキルが身に付くものです。
トップエンジニアへの道は、現在の自分と理想の自分とのギャップを埋める努力を続けることです。
決してあきらめず努力し続けるネットワークエンジニアを応援します。
このサイトが将来のあなたの一生の財産になることを、本気で信じています。
BGP −BGP状態遷移− - ネットワークエンジニアを目指して
