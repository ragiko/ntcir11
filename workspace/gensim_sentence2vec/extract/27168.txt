  
　しかしながら、カメラの配置が１次元に配置されている場合には、その配置に直交する方向の視差が生じないことがある。例えば、水平方向に２台のカメラが配置されている場合には、主に水平方向の視差（変位ベクトルのＸ成分）が生じる。そのような場合には、カメラの配置に直交する方向の視差を符号化することによって生成される符号（変位ベクトルのＹ成分）は冗長である。また、空間スケーラブル符号化やＳＮＲスケーラブル符号化の場合には、ベースレイヤと拡張レイヤの間に視差が生じないことから、このような視差（変位ベクトル）を符号化することによって生成される符号は冗長である。
　本発明は上記の点に鑑みてなされたものであり、符号化効率を向上させる画像復号装置及び画像符号化装置を提供する。
（１）本発明は上記の課題を解決するためになされたものであり、本発明の一態様に係る画像復号装置は、対象予測ブロックの予測パラメータを導出する予測パラメータ導出部と、前記予測パラメータ導出部が導出したベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部とを備え、前記予測パラメータ導出部は、前記対象予測ブロックに属する対象画像と、前記参照画像の一部である参照ブロックが属する参照画像が異なるレイヤに属する場合に、参照ブロックの予測パラメータを参照する座標を変換するインターレイヤ参照アドレス変換部とを備えていてもよい。
（２）また、本発明の一態様に係る画像復号装置のインターレイヤ参照アドレス変換部による座標を変換する演算は、当該座標をより大きい単位で離散化する演算を含んでもよい。
（３）また、本発明の一態様に係る画像復号装置のインターレイヤ参照アドレス変換部による座標を変換する演算は、Ｘ座標およびＹ座標を右に３ビットシフトし、さらに左に３ビットシフトする演算であってもよい。
（４）また、本発明は上記の課題を解決するためになされたものであり、本発明の一態様に係る画像符号化装置は、対象予測ブロックの予測パラメータまたは予測ベクトルを導出する予測パラメータ導出部と、前記予測パラメータ導出部が導出したベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部を備え、前記予測パラメータ導出部は、記憶された予測パラメータを参照する予測パラメータ参照部と、前記対象予測ブロックの属する対象画像および前記参照画像の一部である参照ブロックが属する参照画像が異なるレイヤに属する場合に、参照ブロックの予測パラメータを参照する座標を変換するインターレイヤ参照アドレス変換部とを備えていてもよい。
（５）また、本発明の他の態様に係る画像復号装置は、算術符号のコンテキストを導出し、符号化データからベクトル差分を復号するベクトル差分復号部と、処理済みのブロックのベクトルと前記ベクトル差分の和から、対象ブロックのベクトルを導出するベクトル導出部と、前記ベクトル導出部が生成した対象ブロックのベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部とを備え、前記ベクトル差分復号部は、前記対象ブロックのベクトル又は前記ベクトル差分が、異なるレイヤ間の予測であるか否かに基づいてコンテキストを割り当ててもよい。
（６）また、本発明の他の態様に係る画像復号装置のベクトル差分復号部は、前記対象ブロックのベクトル又は前記ベクトル差分が、異なるレイヤ間の予測である場合には、前記ベクトル差分の垂直成分を構成するシンタックス要素と前記ベクトル差分の水平成分を構成するシンタックス要素にそれぞれ異なるコンテキストを割り当ててもよい。
（７）また、本発明の他の態様に係る画像復号装置のベクトル差分復号部は、前記対象ブロックのベクトル又は前記ベクトル差分が、異なるレイヤ間の予測であるか否かの判定において、異なるレイヤ間の予測と判定した場合と、異なるレイヤ間の予測と判定しない場合とで、少なくとも前記ベクトル差分の一方の成分を構成するシンタックス要素に前記それぞれ異なるコンテキストを割り当ててもよい。
（８）また、本発明の一態様に係る画像復号装置のシンタックス要素は、前記ベクトル差分の絶対値が０を超えるか否かを示す情報であってもよい。
（９）また、本発明の他の態様に係る画像符号化装置は、算術符号のコンテキストを導出し、ベクトル差分を符号化するベクトル差分符号化部と、処理済みのブロックのベクトルと対象ブロックのベクトルから、前記ベクトル差分を導出するベクトル差分導出部と、前記ベクトル差分導出部が生成した対象ブロックのベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部とを備え、前記ベクトル差分導出部は、前記対象ブロックのベクトル又は前記ベクトル差分が、異なるレイヤ間の予測であるか否かに基づいてコンテキストを割り当ててもよい。
（１０）また、本発明の他の態様に係る画像復号装置は、第１レイヤ画像と、前記第１レイヤ画像とは異なる第２レイヤ画像との間の変位を示す符号に基づいて前記変位を示す変位ベクトルを生成する変位ベクトル生成部と、前記変位ベクトルを予め定めた範囲内の値に制限する変位ベクトル制限部と、前記変位ベクトル生成部が生成した変位ベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部とを備えていてもよい。
（１１）また、本発明の他の態様に係る画像復号装置の変位ベクトル制限部が前記変位ベクトルの値を制限する範囲において、垂直成分の範囲が水平成分の範囲よりも小さくてもよい。
（１２）また、本発明の他の態様に係る画像復号装置の変位ベクトル制限部が制限した変位ベクトルが示す領域に係る予測パラメータを参照して動きベクトルもしくは変位ベクトルの予測値である予測ベクトルを予測パラメータの少なくとも一部として導出する予測パラメータ導出部を備えていてもよい。
（１３）また、本発明の他の態様に係る画像符号化装置は、第１レイヤ画像と、前記第１レイヤ画像とは異なる第２レイヤ画像との間の変位の一部に基づいて、前記変位の一部と前記変位の他の一部を示す変位ベクトルを生成する変位ベクトル生成部と、前記変位ベクトル生成部が生成した変位ベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部とを備えていてもよい。
（１４）また、本発明の他の態様に係る画像符号化装置は、第１レイヤ画像と、前記第１レイヤ画像とは異なる第２レイヤ画像との間の変位を示す符号に基づいて前記変位を示す変位ベクトルを生成する変位ベクトル生成部と、前記変位ベクトルを予め定めた範囲内の値に制限する変位ベクトル制限部と、前記変位ベクトル生成部が生成した変位ベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部とを備えていてもよい。
（１５）また、本発明の他の態様に係る画像復号装置は、第１レイヤ画像と、前記第１レイヤ画像とは異なる第２レイヤ画像との間の変位の一部を示す符号に基づいて、前記変位の一部と前記変位の他の一部を示す変位ベクトルを生成する変位ベクトル生成部と、前記変位ベクトル生成部が生成した変位ベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部とを備えていてもよい。
（１６）また、本発明の他の態様に係る画像復号装置は、前記変位の一部は前記変位の水平成分であって、前記変位の他の一部は前記変位の垂直成分であって、前記変位ベクトル生成部は、前記垂直成分、当該垂直成分の予測値又は当該垂直成分の予測残差を予め定めた値に定めていてもよい。
（１７）また、本発明の他の態様に係る画像復号装置は、前記変位の一部は前記変位の水平成分であって、前記変位の他の一部は前記変位の垂直成分であって、前記変位ベクトル生成部は、垂直成分と水平方向との関係を示す符号に基づいて前記変位の垂直成分を算出してもよい。
　本発明によれば、予測画像生成時及び予測画像生成時のメモリを低減するとともに、符号化効率が向上する。
本発明の実施形態に係る画像伝送システムの構成を示す概略図である。 本実施形態に係る画像復号装置の構成を示す概略図である。 本実施形態に係るインター予測パラメータ復号部の構成を示す概略図である。 本実施形態に係るインター予測パラメータ抽出部の構成を示す概略図である。 本実施形態の変形例Ｄ１に係るＡＭＶＰ予測パラメータ導出部の構成を示す概略図を示す。 本実施形態の変形例Ｄ３に係るインター予測パラメータ復号部の構成を示す概略図である。 本実施形態の変形例Ｄ３に係る変位ベクトル生成部の構成を示す概略図である。 本実施形態の変形例Ｄ４に係るインター予測パラメータ復号部の構成を示す概略図である。 本実施形態の変形例Ｄ４に係る変位ベクトルクリップ部の構成を示す概略図である。 本実施形態の変形例Ｄ４におけるインター予測ピクチャ生成部が参照ピクチャブロックを読み出す構成の一例を示す概念図である。 本実施形態の変形例Ｄ５に係る拡張ベクトル候補導出部の構成を示す概略図である。 本実施形態の変形例Ｄ５において予測パラメータを読み出す構成の一例を示す概念図である。 本実施形態の変形例Ｄ５に係るマージ予測パラメータ導出部の構成を示す概略図である。 本実施形態に係る画像符号化装置の構成を示すブロック図である。 本実施形態に係るインター予測パラメータ符号化部の構成を示す概略図である。 本実施形態の変形例Ｅ３に係るインター予測パラメータ符号化部の構成を示す概略図を示す。 参照ピクチャリストの一例を示す概念図である。 ベクトル候補の一例を示す概念図である。 参照ピクチャの例を示す概念図である。 隣接ブロックの一例を示す概念図である。 符号化データ構造の一例を示す概念図である。 符号化ストリーム構造の一例を示す概念図である。 変位ベクトルを制限する必要性を説明する図である。 本実施形態に係るエントロピー復号部の構成を示すブロック図である。 本実施形態の変形例Ｄ６に係るエントロピー復号部３０１ｆの構成を示すブロック図である。 導出テーブル情報の一例を示す図である。 導出テーブル情報の他の例を示す図である。 導出テーブル情報の他の例を示す図である。 導出テーブル情報の他の例を示す図である。 導出テーブル情報の他の例を示す図である。 導出テーブル情報の他の例を示す図である。 本実施形態の変形例Ｄ７に係るエントロピー復号部の構成を示す概略図である。 本実施形態の変形例Ｄ７に係る導出テーブル情報の一例を示す図である。 本実施形態の変形例Ｅ６に係るエントロピー符号化部の構成を示すブロック図である。 本実施形態の変形例Ｅ７に係るエントロピー符号化部の構成を示すブロック図である。 本実施形態の変形例Ｄ８に係るＡＭＶＰ予測パラメータ導出部と、予測パラメータメモリの構成を示すブロック図である。 座標変換に用いられる数式の例を示す図である。 本実施形態の変形例Ｄ８に係るマージ予測パラメータ導出部と、予測パラメータメモリ３０７の構成を示すブロック図である。 本実施形態の変形例Ｄ８に係るＡＭＶＰ予測パラメータ導出部と、予測パラメータメモリの構成を示す図である。 座標変換に用いられる数式の例を示す図である。 座標変換により参照される領域の他の例を示す概念図である。 座標変換により参照される領域の他の例を示す概念図である。 本実施形態の変形例Ｅ８に係るＡＭＶＰ予測パラメータ導出部の構成を示すブロック図である。 本実施形態の変形例Ｅ８に係るマージ予測パラメータ導出部の構成を示すブロック図である。 
（第１の実施形態）
　以下、図面を参照しながら本発明の実施形態について説明する。
　図１は、本実施形態に係る画像伝送システム１の構成を示す概略図である。
　画像伝送システム１は、複数のレイヤ画像を符号化した符号を伝送し、伝送された符号を復号した画像を表示するシステムである。画像伝送システム１は、画像符号化装置１１、ネットワーク２１、画像復号装置３１及び画像表示装置４１を含んで構成される。
　画像符号化装置１１には、複数のレイヤ画像（テクスチャ画像ともいう）を示す信号Ｔが入力される。レイヤ画像とは、ある解像度及びある視点で視認もしくは撮影される画像である。複数のレイヤ画像を用いて３次元画像を符号化するビュースケーラブル符号化を行う場合、複数のレイヤ画像のそれぞれは、視点画像と呼ばれる。ここで、視点は撮影装置の位置又は観測点に相当する。例えば、複数の視点画像は、被写体に向かって左右の撮影装置のそれぞれが撮影した画像である。画像符号化装置１１は、この信号のそれぞれを符号化して符号化ストリームＴｅを生成する。符号化ストリームＴｅの詳細については、後述する。視点画像とは、ある視点において観測される２次元画像（平面画像）である。
視点画像は、例えば２次元平面内に配置された画素毎の輝度値、又は色信号値で示される。以下では、１枚の視点画像又は、その視点画像を示す信号をピクチャ（ｐｉｃｔｕｒｅ）と呼ぶ。また、複数のレイヤ画像を用いて空間スケーラブル符号化を行う場合、その複数のレイヤ画像は、解像度の低いベースレイヤ画像と、解像度の高い拡張レイヤ画像からなる。複数のレイヤ画像を用いてＳＮＲスケーラブル符号化を行う場合、その複数のレイヤ画像は、画質の低いベースレイヤ画像と、画質の高い拡張レイヤ画像からなる。なお、ビュースケーラブル符号化、空間スケーラブル符号化、ＳＮＲスケーラブル符号化を任意に組み合わせて行っても良い。
　ネットワーク２１は、画像符号化装置１１が生成した符号化ストリームＴｅを画像復号装置３１に伝送する。ネットワーク２１は、インターネット（ｉｎｔｅｒｎｅｔ）、広域ネットワーク（ＷＡＮ：Ｗｉｄｅ　Ａｒｅａ　Ｎｅｔｗｏｒｋ）、小規模ネットワーク（ＬＡＮ：Ｌｏｃａｌ　Ａｒｅａ　Ｎｅｔｗｏｒｋ）又はこれらの組み合わせである。ネットワーク２１は、必ずしも双方向の通信網に限らず、地上波ディジタル放送、衛星放送等の放送波を伝送する一方向又は双方向の通信網であっても良い。また、ネットワーク２１は、ＤＶＤ（Ｄｉｇｉｔａｌ　Ｖｅｒｓａｔｉｌｅ　Ｄｉｓｃ）、ＢＤ（Ｂｌｕｅ－ｒａｙ　Ｄｉｓｃ）等の符号化ストリームＴｅを記録した記憶媒体で代替されても良い。
　画像復号装置３１は、ネットワーク２１が伝送した符号化ストリームＴｅのそれぞれを復号し、それぞれ復号した複数の復号レイヤ画像Ｔｄ（復号視点画像Ｔｄ）を生成する。
　画像表示装置４１は、画像復号装置３１が生成した複数の復号レイヤ画像Ｔｄの全部又は一部を表示する。例えば、ビュースケーラブル符号化においては、全部の場合、３次元画像（立体画像）や自由視点画像が表示され、一部の場合、２次元画像が表示される。画像表示装置４１は、例えば、液晶ディスプレイ、有機ＥＬ（Ｅｌｅｃｔｒｏ－ｌｕｍｉｎｅｓｃｅｎｃｅ）ディスプレイ等の表示デバイスを備える。また、空間スケーラブル符号化、ＳＮＲスケーラブル符号化では、画像復号装置３１、画像表示装置４１が高い処理能力を有する場合には、画質の高い拡張レイヤ画像を表示し、より低い処理能力しか有しない場合には、拡張レイヤほど高い処理能力、表示能力を必要としないベースレイヤ画像を表示する。
（画像復号装置の構成）
　次に、本実施形態に係る画像復号装置３１の構成について説明する。
　図２は、本実施形態に係る画像復号装置３１の構成を示す概略図である。
　画像復号装置３１は、エントロピー復号部３０１、予測パラメータ復号部３０２、参照ピクチャメモリ（参照画像記憶部）３０６、予測パラメータメモリ（予測パラメータ記憶部）３０７、予測ピクチャ生成部（予測画像生成部）３０８、逆量子化・逆ＤＣＴ部３１１、及び加算部３１２を含んで構成される。
　また、予測パラメータ復号部３０２は、インター予測パラメータ復号部（変位ベクトル生成部）３０３及びイントラ予測パラメータ復号部３０４を含んで構成される。予測ピクチャ生成部３０８は、インター予測ピクチャ生成部３０９及びイントラ予測ピクチャ生成部３１０を含んで構成される。
　エントロピー復号部３０１は、外部から入力された符号化ストリームＴｅに対してエントロピー復号を行って符号列を生成し、生成した符号列から個々の符号に分離する。分離された符号には、予測画像を生成するための予測情報および、差分画像を生成するための残差情報などがある。予測情報には、例えば、マージフラグ（ｍｅｒｇｅ＿ｆｌａｇ）、インター予測フラグ、参照ピクチャインデックスｒｅｆＩｄｘ（ｒｅｆＩｄｘＬＸ）、予測ベクトルインデックスｉｄｘ（ｍｖｐ＿ＬＸ＿ｉｄｘ）、差分ベクトルｍｖｄ（ｍｖｄＬＸ）、予測モードｐｒｅｄＭｏｄｅ、マージインデックスｍｅｒｇｅ＿ｉｄｘがあり、残差情報には、量子化パラメータ及び量子化係数がある。
　これらの符号は、ピクチャブロック毎に得られる。ピクチャブロックとは、１個のピクチャが分割された複数の部分のうちの１つの部分、又はその部分を示す信号である。１個のブロックには、複数の画素、例えば、水平方向８画素、垂直方向８画素（計６４画素）が含まれる。以下の説明では、ピクチャブロックを単にブロックと呼ぶことがある。また、復号処理の対象となるブロックを復号対象ブロック、参照ピクチャに係るブロックを参照ブロックと呼ぶ。なお、符号化処理の対象となるブロックを符号化対象ブロックと呼ぶ。
　なお、後述のように、予測画像を生成する単位であるピクチャブロックと、量子化係数を導出する単位であるピクチャブロックは異なるサイズでも良い。予測画像を生成する単位であるピクチャブロックは、予測ユニット（ＰＵ：Ｐｒｅｄｉｃｔｉｏｎ　Ｕｎｉｔ）と呼ばれる。量子化係数を導出する単位であるピクチャブロックは、変換ユニット（ＴＵ：Ｔｒａｎｓｆｏｒｍ　Ｕｎｉｔ）と呼ばれる。
　インター予測フラグは、後述するインター予測で用いる参照ピクチャの種類および数を示すデータであり、Ｐｒｅｄ＿Ｌ０、Ｐｒｅｄ＿Ｌ１、Ｐｒｅｄ＿Ｂｉの何れかの値をとる。Ｐｒｅｄ＿Ｌ０、Ｐｒｅｄ＿Ｌ１は、共に１枚の参照ピクチャを用いること（単予測）を示す。Ｐｒｅｄ＿Ｌ０、Ｐｒｅｄ＿Ｌ１は、各々Ｌ０リスト、Ｌ１リストと呼ばれる参照ピクチャリストに記憶された参照ピクチャが用いられることを示す。Ｐｒｅｄ＿Ｂｉは２枚の参照ピクチャを用いること（双予測）を示し、Ｌ０リストに記憶された参照ピクチャと、Ｌ１リストに記憶された参照ピクチャが、いずれも用いられることを示す。なお、単予測のうち、Ｌ０リストに記憶された参照ピクチャ、つまり復号（又は符号化）対象ピクチャを基準として過去の参照ピクチャを用いる予測をＬ０予測と呼ぶ。Ｌ１リストに記憶された参照ピクチャ、つまり復号（又は符号化）対象ピクチャを基準として未来の参照ピクチャを用いる予測をＬ１予測と呼ぶ。予測ベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘは予測ベクトルを示すインデックスであり、参照ピクチャインデックスｒｅｆＩｄｘは、参照ピクチャリストに記憶された参照ピクチャを示すインデックスである。また、Ｌ０予測に用いる参照ピクチャインデックスをｒｅｆＩｄｘＬ０と示し、Ｌ１予測に用いる参照ピクチャインデックスをｒｅｆＩｄｘＬ１と示す。つまり、ｒｅｆＩｄｘ（ｒｅｆＩｄｘＬＸ）は、ｒｅｆＩｄｘＬ０とｒｅｆＩｄｘＬ１を区別しない場合に用いられる表記である。
　差分ベクトルｍｖｄ（ｍｖｄＬＸ）についても同様にして、ＬＸの代わりにＬ０又はＬ１を表記することで、Ｌ０予測に用いるものとＬ１予測に用いるものとを区別する。
　マージインデックスｍｅｒｇｅ＿ｉｄｘは、復号処理が完了したブロックから導出される動き補償パラメータ候補（マージ候補）のうち、いずれかの動き補償パラメータを復号対象ブロックの動き補償パラメータとして用いるかを示すインデックスである。後述するように、マージインデックスｍｅｒｇｅ＿ｉｄｘは、予測パラメータメモリ３０７において予測パラメータを参照する際の参照ブロックを示すインデックスである。マージインデックスｍｅｒｇｅ＿ｉｄｘは、マージ符号化によって得られる符号である。動き補償パラメータ、つまり、参照される予測パラメータは、例えば、参照ピクチャインデックスｒｅｆＩｄｘＬＸ、ベクトルｍｖＬＸである。ベクトルｍｖＬＸについては、後述する。
　エントロピー復号部３０１は、分離した符号の一部を予測パラメータ復号部３０２に出力する。分離した符号の一部とは、例えば、参照ピクチャインデックスｒｅｆＩｄｘ、ベクトルインデックスｉｄｘ、差分ベクトルｍｖｄ、予測モードｐｒｅｄＭｏｄｅ及びマージインデックスｍｅｒｇｅ＿ｉｄｘである。エントロピー復号部３０１は、予測モードｐｒｅｄＭｏｄｅを、予測ピクチャ生成部３０８に出力するとともに、予測パラメータメモリ３０７に記憶する。エントロピー復号部３０１は、量子化係数を逆量子化・逆ＤＣＴ部３１１に出力する。この量子化係数は、符号化処理において、残差信号に対してＤＣＴ（Ｄｉｓｃｒｅｔｅ　Ｃｏｓｉｎｅ　Ｔｒａｎｓｆｏｒｍ、離散コサイン変換）を行い量子化して得られる係数である。
　インター予測パラメータ復号部３０３は、エントロピー復号部３０１から入力された符号に基づいて、予測パラメータメモリ３０７に記憶された予測パラメータを参照してインター予測パラメータを復号する。インター予測とは、互いに異なるピクチャ間（例えば、時刻間、レイヤ画像間）で行われる予測処理を指す。インター予測パラメータとは、ピクチャブロックをインター予測で用いるパラメータ、例えば、ベクトルｍｖＬＸ、及び参照ピクチャインデックスｒｅｆＩｄｘＬＸである。
　ベクトルｍｖＬＸには、動きベクトルと変位ベクトル（ｄｉｓｐａｒｉｔｙ　ｖｅｃｔｏｒ、視差ベクトル）がある。動きベクトルとは、あるレイヤのある時刻でのピクチャにおけるブロックの位置と、異なる時刻（例えば、隣接する離散時刻）における同一のレイヤのピクチャにおける対応するブロックの位置との間の位置のずれを示すベクトルである。変位ベクトルとは、あるレイヤのある時刻でのピクチャにおけるブロックの位置と、同一の時刻における異なるレイヤのピクチャにおける対応するブロックの位置との間の位置のずれを示すベクトルである。異なるレイヤのピクチャとしては、異なる視点のピクチャである場合、もしくは、異なる解像度のピクチャである場合などがある。特に、異なる視点のピクチャに対応する変位ベクトルを視差ベクトルと呼ぶ。以下の説明では、動きベクトルと変位ベクトルを区別しない場合には、単にベクトルｍｖＬＸと呼ぶ。ベクトルｍｖＬＸに関する予測ベクトル、差分ベクトルを、それぞれ予測ベクトルｍｖｐＬＸ、差分ベクトルｍｖｄＬＸと呼ぶ。予測ベクトルｍｖｐＬＸとは、ベクトルｍｖＬＸについて予測処理を行って得られるベクトルである。
　以下の説明では、ベクトルｍｖＬＸは、特に断らない限り、水平方向（Ｘ方向）への成分値（Ｘ成分）と垂直方向（Ｙ方向）への成分値（Ｙ成分）を含む２次元のベクトルである場合を例にとる。つまり、ベクトルｍｖＬＸが変位ベクトル（視差ベクトル）である場合、そのＸ成分は変位（視差）を示す情報のうちの一部であり、Ｙ成分は変位（視差）を示す情報のうち他の一部を示す。なお、差分ベクトルｍｖｄＬＸについても、動きベクトルと変位ベクトルを区別する。ベクトルｍｖＬＸおよび差分ベクトルｍｖｄＬＸのベクトルの種別の判定は、後述するようにベクトルに付随する参照ピクチャインデックスｒｅｆＩｄｘＬＸを用いて行われる。
　ベクトルｍｖＬＸが変位ベクトルであることを明示する場合には、以下、このベクトルを変位ベクトルｄｖＬＸと呼ぶ。変位ベクトルｄｖＬＸに関する予測ベクトル、差分ベクトルを、それぞれ予測ベクトルｄｖｐＬＸ、差分ベクトルｄｖｄＬＸと呼ぶ。また、ベクトルｍｖＬＸが動きベクトルである場合には、そのベクトルも動きベクトルｍｖＬＸと呼ぶことがある。動きベクトルｍｖＬＸに関する予測ベクトル、差分ベクトルを、それぞれ単に予測ベクトルｍｖｐＬＸ、差分ベクトルｍｖｄＬＸと呼ぶことがある。
　インター予測パラメータ復号部３０３は、復号したインター予測パラメータを予測ピクチャ生成部３０８に出力し、また予測パラメータメモリ３０７に記憶する。インター予測パラメータ復号部３０３の詳細については後述する。
　イントラ予測パラメータ復号部３０４は、エントロピー復号部３０１から入力された符号、例えば予測モードＰｒｅｄＭｏｄｅに基づいて、予測パラメータメモリ３０７に記憶された予測パラメータを参照してイントラ予測パラメータを復号する。イントラ予測パラメータとは、ピクチャブロックを１つのピクチャ内で予測する処理で用いるパラメータ、例えば、イントラ予測モードＩｎｔｒａＰｒｅｄＭｏｄｅである。イントラ予測パラメータ復号部３０４は、復号したイントラ予測パラメータを予測ピクチャ生成部３０８に出力し、また予測パラメータメモリ３０７に記憶する。
　参照ピクチャメモリ３０６は、加算部３１２が生成した参照ピクチャのブロック（参照ピクチャブロック）を、復号対象のピクチャ及びブロック毎に予め定めた位置に記憶する。
　予測パラメータメモリ３０７は、予測パラメータを、復号対象のピクチャ及びブロック毎に予め定めた位置に記憶する。具体的には、予測パラメータメモリ３０７は、インター予測パラメータ復号部３０３が復号したインター予測パラメータ、イントラ予測パラメータ復号部３０４が復号したイントラ予測パラメータ及びエントロピー復号部３０１が分離した予測モードｐｒｅｄＭｏｄｅを記憶する。記憶されるインター予測パラメータには、例えば、インター予測フラグ、参照ピクチャインデックスｒｅｆＩｄｘＬＸ、ベクトルｍｖＬＸがある。
　予測ピクチャ生成部３０８には、エントロピー復号部３０１から入力された予測モードｐｒｅｄＭｏｄｅが入力され、また予測パラメータ復号部３０２から予測パラメータが入力される。また、予測ピクチャ生成部３０８は、参照ピクチャメモリ３０６から参照ピクチャを読み出す。予測ピクチャ生成部３０８は、予測モードｐｒｅｄＭｏｄｅが示す予測モードで、入力された予測パラメータと読み出した参照ピクチャを用いて予測ピクチャブロックＰを生成する。
　ここで、予測モードｐｒｅｄＭｏｄｅがインター予測モードを示す場合、インター予測ピクチャ生成部３０９は、インター予測パラメータ復号部３０３から入力されたインター予測パラメータと読み出した参照ピクチャを用いてインター予測を行う。インター予測は、ＰＵ毎に行われる。ＰＵは、上述したように予測処理を行う単位となる複数の画素からなるピクチャの一部分、つまり１度に予測処理が行われる復号対象ブロックに相当する。インター予測には、マージ予測（ｍｅｒｇｅ　ｍｏｔｉｏｎ）モードとＡＭＶＰ（Ａｄａｐｔｉｖｅ　Ｍｏｔｉｏｎ　Ｖｅｃｔｏｒ　Ｐｒｅｄｉｃｔｉｏｎ、適応動きベクトル予測）モードがある。マージ予測モードでも、ＡＭＶＰモードでも、既に処理済みのブロックの予測パラメータを用いて予測パラメータが導出される。マージ予測モードは、差分ベクトルを符号化データから復号せずに予測パラメータのベクトルをそのまま復号対象ブロックのベクトルとして用いるモードであり、ＡＭＶＰモードは、差分ベクトルを符号化データから復号して、予測パラメータのベクトルとの和を復号対象ブロックのベクトルとして用いるモードである。予測モードがマージ予測モードであるか、もしくはＡＭＶＰモードであるかは、マージフラグの値で識別される。これらの予測モードについては後述する。
　インター予測ピクチャ生成部３０９は、参照ピクチャインデックスｒｅｆＩｄｘＬＸで示される参照ピクチャから、復号対象ブロックを基準としてベクトルｍｖＬＸが示す位置にある参照ピクチャブロックを参照ピクチャメモリ３０６から読み出す。インター予測ピクチャ生成部３０９は、読み出した参照ピクチャブロックについて予測を行って予測ピクチャブロックＰを生成する。インター予測ピクチャ生成部３０９は、生成した予測ピクチャブロックＰを加算部３１２に出力する。
　予測モードｐｒｅｄＭｏｄｅがイントラ予測モードを示す場合、イントラ予測ピクチャ生成部３１０は、イントラ予測パラメータ復号部３０４から入力されたイントラ予測パラメータと読み出した参照ピクチャを用いてイントラ予測を行う。具体的には、イントラ予測ピクチャ生成部３１０は、復号対象のピクチャであって、既に復号されたブロックのうち復号対象ブロックから予め定めた範囲にある参照ピクチャブロックを参照ピクチャメモリ３０６から読み出す。予め定めた範囲とは、復号対象ブロックがいわゆるラスタースキャンの順序で順次移動する場合、例えば、左、左上、上、右上の隣接ブロックのうちのいずれかであり、イントラ予測モードによって異なる。ラスタースキャンの順序とは、各ピクチャにおいて、上端から下端まで各行について、順次左端から右端まで移動させる順序である。
　イントラ予測ピクチャ生成部３１０は、読み出した参照ピクチャブロックについてイントラ予測モードＩｎｔｒａＰｒｅｄＭｏｄｅが示す予測モードで予測を行って予測ピクチャブロックを生成する。イントラ予測ピクチャ生成部３１０は、生成した予測ピクチャブロックＰを加算部３１２に出力する。
　逆量子化・逆ＤＣＴ部３１１は、エントロピー復号部３０１から入力された量子化係数を逆量子化してＤＣＴ係数を求める。逆量子化・逆ＤＣＴ部３１１は、求めたＤＣＴ係数について逆ＤＣＴ（Ｉｎｖｅｒｓｅ　Ｄｉｓｃｒｅｔｅ　Ｃｏｓｉｎｅ　Ｔｒａｎｓｆｏｒｍ、逆離散コサイン変換）を行い、復号残差信号を算出する。逆量子化・逆ＤＣＴ部３１１は、算出した復号残差信号を加算部３１２に出力する。
　加算部３１２は、インター予測ピクチャ生成部３０９及びイントラ予測ピクチャ生成部３１０から入力された予測ピクチャブロックＰと逆量子化・逆ＤＣＴ部３１１から入力された復号残差信号の信号値を画素毎に加算して、参照ピクチャブロックを生成する。加算部３１２は、生成した参照ピクチャブロックを参照ピクチャメモリ３０６に記憶し、生成した参照ピクチャブロックをピクチャ毎に統合した復号レイヤ画像Ｔｄを外部に出力する。
（インター予測復号部の構成）
　次に、インター予測パラメータ復号部３０３の構成について説明する。
　図３は、本実施形態に係るインター予測パラメータ復号部３０３の構成を示す概略図である。
　インター予測パラメータ復号部３０３は、インター予測パラメータ抽出部３０３１、ＡＭＶＰ予測パラメータ導出部３０３２、加算部３０３５及びマージ予測パラメータ導出部３０３６を含んで構成される。
　インター予測パラメータ抽出部３０３１は、エントロピー復号部３０１から入力されたマージフラグに基づいて、入力されたインター予測パラメータのうち各予測モードに係る予測パラメータを抽出する。
　ここで、マージフラグが示す値が１、すなわち、マージ予測モードを示す場合、インター予測パラメータ抽出部３０３１は、マージ予測に係る予測パラメータとして、例えばマージインデックスｍｅｒｇｅ＿ｉｄｘを抽出する。インター予測パラメータ抽出部３０３１は、抽出したマージインデックスｍｅｒｇｅ＿ｉｄｘをマージ予測パラメータ導出部３０３６に出力する。
　マージフラグが示す値が０、すなわち、ＡＭＶＰ予測モードを示す場合、インター予測パラメータ抽出部３０３１は、ＡＭＶＰ予測パラメータを抽出する。
　ＡＭＶＰ予測パラメータとして、例えば、インター予測フラグ、参照ピクチャインデックスｒｅｆＩｄｘＬＸ、ベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘ、差分ベクトルｍｖｄＬＸがある。インター予測パラメータ抽出部３０３１は、抽出した参照ピクチャインデックスｒｅｆＩｄｘＬＸをＡＭＶＰ予測パラメータ導出部３０３２及び予測ピクチャ生成部３０８（図２）に出力し、また予測パラメータメモリ３０７（図２）に記憶する。インター予測パラメータ抽出部３０３１は、抽出したベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘをＡＭＶＰ予測パラメータ導出部３０３２に出力する。インター予測パラメータ抽出部３０３１は、抽出した差分ベクトルｍｖｄＬＸを加算部３０３５に出力する。インター予測パラメータ抽出部３０３１の構成については後述する。
　ＡＭＶＰ予測パラメータ導出部３０３２は、ベクトル候補導出部３０３３と予測ベクトル選択部３０３４を備える。
　ベクトル候補導出部３０３３は、参照ピクチャインデックスｒｅｆＩｄｘに基づいて予測パラメータメモリ３０７（図２）が記憶するベクトル（動きベクトル又は変位ベクトル）をベクトル候補として読み出す。
　読み出されるベクトルは、復号対象ブロックから予め定めた範囲内にあるブロック（例えば、復号対象ブロックの左下端、左上端、右上端にそれぞれ接するブロックの全部又は一部）のそれぞれに係るベクトルである。
　予測ベクトル選択部３０３４は、ベクトル候補導出部３０３３が読み出したベクトル候補のうち、インター予測パラメータ抽出部３０３１から入力されたベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘが示すベクトル候補を予測ベクトルｍｖｐＬＸとして選択する。予測ベクトル選択部３０３４は、選択した予測ベクトルｍｖｐＬＸを加算部３０３５に出力する。
　加算部３０３５は、予測ベクトル選択部３０３４から入力された予測ベクトルｍｖｐＬＸとインター予測パラメータ抽出部から入力された差分ベクトルｍｖｄＬＸを加算してベクトルｍｖＬＸを算出する。加算部３０３５は、算出したベクトルｍｖＬＸを予測ピクチャ生成部３０８（図２）に出力する。
　マージ予測パラメータ導出部３０３６は、図示しないマージ候補導出部とマージ候補選択部を備える。マージ候補導出部は、所定の規則に従って、予測パラメータメモリ３０７が記憶している予測パラメータ（ベクトルｍｖＬＸと参照ピクチャインデックスｒｅｆＩｄｘＬＸ）を読み出し、読み出した予測パラメータをマージ候補として導出する。マージ予測パラメータ導出部３０３６が備えるマージ候補選択部は、導出したマージ候補のうち、インター予測パラメータ抽出部３０３１から入力されたマージインデックスｍｅｒｇｅ＿ｉｄｘが示すマージ候補（ベクトルｍｖＬＸと、参照ピクチャインデックスｒｅｆＩｄｘＬＸ）を選択する。マージ予測パラメータ導出部３０３６は選択したマージ候補を予測パラメータメモリ３０７（図２）に記憶するとともに、予測ピクチャ生成部３０８（図２）に出力する。
（インター予測パラメータ抽出部の構成）
　次に、インター予測パラメータ抽出部３０３１の構成について説明する。
　図４は、本実施形態に係るインター予測パラメータ抽出部３０３１の構成、特に差分ベクトルｍｖｄＬＸの復号に関する構成を示す概略図である。
　インター予測パラメータ抽出部３０３１は、リファレンスレイヤ判定部３０３１１及びベクトル差分復号部３０３１２を含んで構成される。リファレンスレイヤ判定部３０３１１は、インターレイヤ予測判定部、インタービュー予測判定部、変位ベクトル判定部と呼ばれる。
　リファレンスレイヤ判定部３０３１１は、エントロピー復号部３０１から入力された参照ピクチャインデックスｒｅｆＩｄｘＬＸに基づいて、参照ピクチャインデックスｒｅｆＩｄｘＬＸが指す参照ピクチャと、対象ピクチャの関係を示すリファレンスレイヤ情報ｒｅｆｅｒｅｎｃｅ＿ｌａｙｅｒ＿ｉｎｆｏを定める。参照ピクチャインデックスｒｅｆＩｄｘＬＸがベクトルｍｖＬＸに付随する場合には、ベクトルｍｖＬＸのリファレンスレイヤ情報、参照ピクチャインデックスｒｅｆＩｄｘＬＸが差分ベクトルｍｖｄＬＸに付随する場合には、差分ベクトルのリファレンスレイヤ情報が導出される。リファレンスレイヤ情報ｒｅｆｅｒｅｎｃｅ＿ｌａｙｅｒ＿ｉｎｆｏは、対象ピクチャのレイヤと、参照ピクチャのレイヤが異なるレイヤである場合の予測であるか否かを示す情報である。なお、対象ピクチャのレイヤがある視点画像、参照ピクチャのレイヤがある視点画像とは異なる視点画像の場合には、インターレイヤ予測は視差ベクトルに対応する。よって、リファレンスレイヤ情報ｒｅｆｅｒｅｎｃｅ＿ｌａｙｅｒ＿ｉｎｆｏは、参照ピクチャへのベクトルｍｖＬＸが変位ベクトルであるか動きベクトルであるかを示す情報でもある。
　対象ピクチャのレイヤと参照ピクチャのレイヤが同じレイヤである場合の予測を、同一レイヤ予測と呼び、この場合に得られるベクトルは動きベクトルである。対象ピクチャのレイヤと、参照ピクチャのレイヤが異なるレイヤである場合の予測をインターレイヤ予測と呼び、この場合に得られるベクトルは変位ベクトルである。リファレンスレイヤ情報ｒｅｆｅｒｅｎｃｅ＿ｌａｙｅｒ＿ｉｎｆｏは、例えば、ベクトルｍｖＬＸがインターレイヤ予測のベクトル（変位ベクトル、視差ベクトル）である場合、その値が１であり、ベクトルｍｖＬＸが同一レイヤ予測のベクトル（動きベクトル）である場合、その値が０である変数で示される。リファレンスレイヤ判定部３０３１１は、生成したリファレンスレイヤ情報ｒｅｆｅｒｅｎｃｅ＿ｌａｙｅｒ＿ｉｎｆｏをベクトル差分復号部３０３１２に出力する。なお、リファレンスレイヤ判定部３０３１１は、参照ピクチャインデックスｒｅｆＩｄｘＬＸの代わりに、後述のＰＯＣもしくはビュー識別子（ｖｉｅｗ＿ｉｄ）、長時間参照ピクチャであるか否かを示すフラグを用いても良い。
　ここで、リファレンスレイヤ判定部３０３１１の判定処理の例について、第１の判定方法から第４の判定方法を説明する。リファレンスレイヤ判定部３０３１１は、第１の判定方法から第４の判定方法のいずれか、又は、それらの方法のうち任意の組み合わせを用いてもよい。
　＜第１の判定方法＞
　リファレンスレイヤ判定部３０３１１は、参照ピクチャインデックスｒｅｆＩｄｘＬＸが示す参照ピクチャに係る時刻（ＰＯＣ：Ｐｉｃｔｕｒｅ　Ｏｒｄｅｒ　Ｃｏｕｎｔ、ピクチャ順序番号）が復号対象ピクチャに係る時刻（ＰＯＣ）と等しい場合に、ベクトルｍｖＬＸが変位ベクトルであると判定する。ＰＯＣは、ピクチャを表示する順序を示す番号であって、そのピクチャが取得された時刻を示す整数（離散時刻）である。変位ベクトルと判定しなかった場合には、リファレンスレイヤ判定部３０３１１は、ベクトルｍｖＬＸが動きベクトルであると判定する。
　具体的には、参照ピクチャインデックスｒｅｆＩｄｘＬＸが示す参照ピクチャのピクチャ順序番号ＰＯＣ（Ｐｉｃｔｕｒｅ　Ｏｒｄｅｒ　Ｃｏｕｎｔ）が復号対象ピクチャのＰＯＣと等しい場合、リファレンスレイヤ判定部３０３１１は、ベクトルｍｖＬＸが変位ベクトルであると、例えば以下の式により判定する。
　POC=eflayerPOCrefIdxLX,istX)
　ここで、POCは復号対象ピクチャのPOC、RefPOC（X,）は参照ピクチャインデックスＸ、参照ピクチャリストＹで指定される参照ピクチャのＰＯＣである。
　なお、復号対象ピクチャのＰＯＣと等しいＰＯＣの参照ピクチャを参照することができる、ということは、その参照ピクチャのレイヤは、復号対象ピクチャのレイヤと異なることを意味する。従って、復号対象ピクチャのＰＯＣと参照ピクチャのＰＯＣが等しい場合には、インターレイヤ予測が行われた（変位ベクトル）、それ以外は同一レイヤ予測が行われた（動きベクトル）と判定する。
　＜第２の判定方法＞
　また、リファレンスレイヤ判定部３０３１１は、参照ピクチャインデックスｒｅｆＩｄｘＬＸが示す参照ピクチャに係る視点と復号対象ピクチャに係る視点が異なる場合に、ベクトルｍｖＬＸを変位ベクトル（視差ベクトル、インターレイヤ予測が行われた）であると判定しても良い。具体的には、参照ピクチャインデックスｒｅｆＩｄｘＬＸが示す参照ピクチャのビュー識別子ｖｉｅｗ＿ｉｄが復号対象ピクチャのビュー識別子ｖｉｅｗ＿ｉｄと異なる場合に、リファレンスレイヤ判定部３０３１１は、ベクトルｍｖＬＸが変位ベクトルであると例えば以下の式により判定する。
　ViewID=eflayerViewIDrefIdxLX,istX)
　ここで、ViewIDは復号対象ピクチャのビューＩＤ、RefViewID（X,）は参照ピクチャインデックスＸ、参照ピクチャリストＹで指定される参照ピクチャのビューＩＤである。
　ビュー識別子ｖｉｅｗ＿ｉｄは、それぞれの視点画像を識別する情報である。変位ベクトルに係る差分ベクトルｄｖｄＬＸは、異なる視点のピクチャ間で得られ、同一の視点のピクチャ間からは得られないことに基づく。なお、変位ベクトルと判定しなかった場合には、リファレンスレイヤ判定部３０３１１は、ベクトルｍｖＬＸが動きベクトルであると判定する。
　なお、個々の視点画像はレイヤの一種であるから、ビュー識別子ｖｉｅｗ＿ｉｄが異なると判定された場合には、リファレンスレイヤ判定部３０３１１は、ベクトルｍｖＬＸを変位ベクトル（インターレイヤ予測が行われた）、それ以外は動きベクトル（同一レイヤ予測が行われた）と判定する。
　＜第３の判定方法＞
　また、リファレンスレイヤ判定部３０３１１は、参照ピクチャインデックスｒｅｆＩｄｘＬＸが示す参照ピクチャに係るレイヤ識別子ｌａｙｅｒ＿ｉｄと復号対象ピクチャに係るレイヤ識別子ｌａｙｅｒ＿ｉｄが異なる場合に、ベクトルｍｖＬＸが変位ベクトルであると例えば以下の式により判定しても良い。
　layerID=eflayerIDrefIdxLX,istX)
　ここで、layerIDは復号対象ピクチャのレイヤＩＤ、ReflayerID（X,）は参照ピクチャインデックスＸ、参照ピクチャリストＹで指定される参照ピクチャのレイヤＩＤである。
　レイヤ識別子ｌａｙｅｒ＿ｉｄは、１枚のピクチャが複数の階層（レイヤ）のデータを含んで構成される場合において、それぞれのレイヤを識別するデータである。異なる視点のピクチャが符号化された符号化データにおいて、レイヤ識別子は、視点によって異なる値を有することに基づく。すなわち、変位ベクトルに係る差分ベクトルｄｖｄＬＸは、対象ピクチャと、異なるレイヤに係るピクチャとの間で得られるベクトルである。なお、変位ベクトルと判定しなかった場合には、リファレンスレイヤ判定部３０３１１は、ベクトルｍｖＬＸが動きベクトルであると判定する。
　なお、レイヤ識別子ｌａｙｅｒ＿ｉｄが異なる場合には、リファレンスレイヤ判定部３０３１１は、ベクトルｍｖＬＸを変位ベクトル（インターレイヤ予測が行われた）、それ以外は動きベクトル（同一レイヤ予測が行われた）と判定する。
　＜第４の判定方法＞
　また、参照ピクチャインデックスｒｅｆＩｄｘＬＸが示す参照ピクチャが長時間参照ピクチャである場合に、リファレンスレイヤ判定部３０３１１は、ベクトルｍｖＬＸが変位ベクトルであると例えば以下の式で判定しても良い。
　LongTermPicRefIdxLX,istX)
　ここで、LongTermPic（X,）は参照ピクチャインデックスＸ、参照ピクチャリストＹで指定される参照ピクチャが長時間参照ピクチャである場合に真となる関数である。
　なお、変位ベクトルと判定しなかった場合には、リファレンスレイヤ判定部３０３１１は、ベクトルｍｖＬＸが動きベクトルであると判定する。長時間参照ピクチャとは、短時間ピクチャとは別途、参照ピクチャリストとして管理されるピクチャである。長時間参照ピクチャは、主に、短時間ピクチャよりも長い時間だけ参照ピクチャメモリ３０６に保持される参照ピクチャであり、後述するベースビューピクチャが長時間参照ピクチャとして用いられる。その場合には、対象ピクチャが参照ピクチャと同じ時刻のノンベースビュー（後述）であるためである。また、変位ベクトルに係る参照ピクチャは、長時間参照ピクチャとして扱われる。すなわち、変位ベクトルに係る差分ベクトルｄｖｄＬＸは、対象ピクチャと長時間参照ピクチャとの間で得られるベクトルである。
　なお、参照ピクチャが長時間参照ピクチャである場合にも、参照ピクチャが復号対象ピクチャと同じレイヤであることがある。そのため、リファレンスレイヤ判定部３０３１１は、参照ピクチャが長時間参照ピクチャである場合に、ベクトルｍｖＬＸを変位ベクトル（インターレイヤ予測が行われた）、それ以外は動きベクトル（同一レイヤ予測が行われた）と判定する。この手法では、インターレイヤ予測であるか同一レイヤ予測であるかを厳密に判定することはできないが、符号化効率を向上させるためのツール制御の目的では判定の厳密性は重要ではないためである。
　ベクトル差分復号部３０３１２は、リファレンスレイヤ判定部３０３１１からリファレンスレイヤ情報ｒｅｆｅｒｅｎｃｅ＿ｌａｙｅｒ＿ｉｎｆｏが入力され、そしてエントロピー復号部３０１を用いて差分ベクトルｍｖｄＬＸを導出するためのシンタックス要素を復号し、差分ベクトルｍｖｄＬＸを出力する。シンタックス要素とは、符号化パラメータの構成要素である。ここで、差分ベクトルｍｖｄＬＸを導出するためのシンタックス要素はａｂｓ＿ｍｖｄ＿ｇｒｅａｔｅｒ０＿ｆｌａｇ［ＸＹ］、ａｂｓ＿ｍｖｄ＿ｇｒｅａｔｅｒ１＿ｆｌａｇ［ＸＹ］、ａｂｓ＿ｍｖｄ＿ｍｉｎｕｓ２＿ｆｌａｇ［ＸＹ］である。ここでＸＹは、その値として０もしくは１をとる変数であり、ＸＹ＝０の場合はＸ成分（水平方向成分）、ＸＹ＝１の場合はＹ成分（垂直方向成分）を示す情報である。
　リファレンスレイヤ情報ｒｅｆｅｒｅｎｃｅ＿ｌａｙｅｒ＿ｉｎｆｏが１、即ちベクトルｍｖＬＸが変位ベクトル（インターレイヤ予測が行われた）である場合、ベクトル差分復号部３０３１２は、水平方向（Ｘ方向）への成分値（Ｘ成分）ｄｖｄ＿ｘを符号化ストリームＴｅより復号し、垂直方向（Ｙ方向）への成分値（Ｙ成分）ｄｖｄ＿ｙを予め定めた値、例えばゼロと定める。ベクトル差分復号部３０３１２は、Ｘ成分ｄｖｄ＿ｘとＹ成分ｄｖｄ＿ｙを統合して、差分ベクトルｄｖｄＬＸを構成することで差分ベクトルｄｖｄＬＸを復号する。
　これに対して、ベクトルｍｖＬＸが、動きベクトルである場合、ベクトル差分復号部３０３１２は、符号化ストリームＴｅよりＸ成分ｍｖｄ＿ｘとＹ成分ｍｖｄ＿ｙとを復号し差分ベクトルｍｖｄＬＸとして出力する。
　ベクトル差分復号部３０３１２は、復号した差分ベクトルｍｖｄＬＸ（又はｄｖｄＬＸ）を加算部３０３５に出力する。
　これにより、上述した例では、変位ベクトルに係る差分ベクトルｄｖｄＬＸのＹ成分ｄｖｄ＿ｙが符号化ストリームＴｅの符号として符号化されなくとも、そのＹ成分の値としては、画像復号装置３１側で予め定めた値が用いられる。他方、変位ベクトルにおいてＸ成分が主であり、Ｙ成分が無視できる値、例えばゼロである場合には、上述した例でも変位予測における精度の劣化が生じない。従って、上述した例では、復号した画像の品質が劣化せずに符号化効率が向上する効果を奏する。
　ここで、インター予測パラメータ抽出部３０３１が実行対象とする符号化データ構造（シンタックステーブル）、の例について説明する。
　図２１は、符号化データ構造の一例を示す図である。
　図２１（ａ）～（ｃ）は、エントロピー復号部３０１から入力された符号のうち、視点配置フラグ（カメラ配置１Ｄフラグ）ｃａｍｅｒａ＿ａｒｒａｎｇｅｍｅｎｔ＿１Ｄ＿ｆｌａｇを抽出することを示す構文６０３を示す。視点配置フラグｃａｍｅｒａ＿ａｒｒａｎｇｅｍｅｎｔ＿１Ｄ＿ｆｌａｇは、視点が一次元に配置されているか否かを示す符号である。例えば、視点配置フラグｃａｍｅｒａ＿ａｒｒａｎｇｅｍｅｎｔ＿１Ｄ＿ｆｌａｇの値が１である場合、視点が一次元に配置されていることを示す。視点配置フラグｃａｍｅｒａ＿ａｒｒａｎｇｅｍｅｎｔ＿１Ｄ＿ｆｌａｇの値が０である場合、視点が一次元に配置されていないことを示す。そこで、ベクトル差分復号部３０３１２は、構文６０３から視点配置フラグｃａｍｅｒａ＿ａｒｒａｎｇｅｍｅｎｔ＿１Ｄ＿ｆｌａｇを抽出する。
　図２１（ａ）は、ビデオパラメータセットｖｉｄｅｏ＿ｐａｒａｍｅｔｅｒ＿ｓｅｔ＿ｒｂｓｐ（）における例、（ｂ）はピクチャパラメータセットｐｉｃ＿ｐａｒａｍｅｔｅｒ＿ｓｅｔ＿ｒｂｓｐにおける例、（ｃ）は、スライスヘッダｓｌｉｃｅ＿ｈｅａｄｅｒ（）における例である。本例では、ビュー識別子ｖｉｅｗ＿ｉｄが０以外の場合（ベースビュー以外の場合）に、視点配置フラグｃａｍｅｒａ＿ａｒｒａｎｇｅｍｅｎｔ＿１Ｄ＿ｆｌａｇが抽出されるが、ビュー識別子ｖｉｅｗ＿ｉｄを参照せずに抽出されるようにしても良い。
　図２２は、符号化ストリーム構造の一例を示す図である。
　図２２において、構文６０４は、視点配置フラグｃａｍｅｒａ＿ａｒｒａｎｇｅｍｅｎｔ＿１Ｄ＿ｆｌａｇの値が１、かつ、リファレンスレイヤ情報ｒｅｆｅｒｅｎｃｅ＿ｌａｙｅｒ＿ｉｎｆｏの値がＩＮＴＥＲ＿ＶＩＥＷの値（即ち１）に等しい場合、構文ｍｖｄ＿ｃｏｄｉｎｇ１Ｄが符号化ストリームに含まれることを示す。また、構文６０４は、それ以外の場合に、構文ｍｖｄ＿ｃｏｄｉｎｇが符号化ストリームに含まれることを示す。
即ち、構文６０４により視点が一次元に配置されていること（camera_arrangement_1D_flag）が示される場合には、ベクトル差分復号部３０３１２は、ベクトルｍｖＬＸが変位ベクトルであるか動きベクトルであるかに応じて、それぞれ異なる符号を抽出する構文を実行させることを示す。
　構文ｍｖｄ＿ｃｏｄｉｎｇ１Ｄおよび構文ｍｖｄ＿ｃｏｄｉｎｇは、図２２において構文６０５、構文６０６として、各々示されている。シンタックス要素ａｂｓ＿ｍｖｄ＿ｇｒｅａｔｅｒ０＿ｆｌａｇ［ＸＹ］、ａｂｓ＿ｍｖｄ＿ｇｒｅａｔｅｒ１＿ｆｌａｇ［ＸＹ］、ａｂｓ＿ｍｖｄ＿ｍｉｎｕｓ２＿ｆｌａｇ［ＸＹ］、ａｂｓ＿ｍｖｄ＿ｓｉｇｎ＿ｆｌａｇ［ＸＹ］、の意味の概要は既に説明した通りである。構文６０５および構文６０６を比較すると、視点が一次元に配置されていることを示すフラグが１（肯定）の場合には、各シンタックス要素の添え字ＸＹが０（否定）の場合、すなわち差分ベクトルのＸ成分のみが符号化ストリームＴｅに含まれる。すなわち、ベクトル差分復号部３０３１２は差分ベクトルのＸ成分のみを抽出（復号）する。それ以外の場合、視点が一次元に配置されていることを示すフラグが０の場合には、各シンタックス要素の添え字ＸＹが０の場合と１の場合の両方を復号する。すなわちベクトル差分復号部３０３１２はＸ成分とＹ成分の両者を抽出（復号する）。なお、構文ｍｖｄ＿ｃｏｄｉｎｇ１Ｄの詳細を説明すると以下の通りである。
　構文ｍｖｄ＿ｃｏｄｉｎｇ１Ｄは、変位ベクトルに係る差分ベクトルのＸ成分ｍｖｄＬＸ［０］を示す３種類の符号、ａｂｓ＿ｍｖｄ＿ｇｒｅａｔｅｒ０＿ｆｌａｇ［０］、ａｂｓ＿ｍｖｄ＿ｍｉｎｕｓ２［０］、ｍｖｄ＿ｓｉｇｎ＿ｆｌａｇ［０］を抽出することを示す構文である。ａｂｓ＿ｍｖｄ＿ｇｒｅａｔｅｒ０＿ｆｌａｇ［０］は、Ｘ成分ｍｖｄＬＸ［０］の絶対値が０よりも大きいか否かを示す符号である。Ｘ成分ｍｖｄＬＸ［０］の絶対値が０よりも大きい場合、ａｂｓ＿ｍｖｄ＿ｇｒｅａｔｅｒ０＿ｆｌａｇ［０］の値は１である。Ｘ成分ｍｖｄＬＸ［０］の絶対値が０である場合、ａｂｓ＿ｍｖｄ＿ｇｒｅａｔｅｒ０＿ｆｌａｇ［０］の値は０である。
　ａｂｓ＿ｍｖｄ＿ｍｉｎｕｓ２［０］は、Ｘ成分ｍｖｄＬＸ［０］の絶対値が１より大きい場合に、その絶対値から２だけ少ない値を示す符号である。ｍｖｄ＿ｓｉｇｎ＿ｆｌａｇ［０］は、Ｘ成分ｍｖｄＬＸ［０］の正負を示す符号である。Ｘ成分ｍｖｄＬＸ［０］が正の値をとる場合、ｍｖｄ＿ｓｉｇｎ＿ｆｌａｇ［０］の値は１である。Ｘ成分ｍｖｄＬＸ［０］が負の値をとる場合、ｍｖｄ＿ｓｉｇｎ＿ｆｌａｇ［１］の値は０である。
そこで、ベクトル差分復号部３０３１２は、構文６０５を実行し、これらの３種類の符号、ａｂｓ＿ｍｖｄ＿ｇｒｅａｔｅｒ０＿ｆｌａｇ［０］、ａｂｓ＿ｍｖｄ＿ｍｉｎｕｓ２［０］、ｍｖｄ＿ｓｉｇｎ＿ｆｌａｇ［０］を抽出する。その後、ベクトル差分復号部３０３１２は、次の数式を用いて差分ベクトルのＸ成分ｍｖｄＬＸ［０］を算出する。
　if！abs_greater0_flag[0])bs_mvd_minus2[0]2
　if！abs_greater1_flag[0])bs_mvd_minus2[0]1
　mvdLX[0]abs_mvd_minus2[0])1－2vd_sign_flag[0])
　即ち、はじめの２つの式は、ａｂｓ＿ｇｒｅａｔｅｒ０＿ｆｌａｇ［０］が０である場合、ａｂｓ＿ｍｖｄ＿ｍｉｎｕｓ２［ＸＹ］を－２と定め、ａｂｓ＿ｇｒｅａｔｅｒ１＿ｆｌａｇ［０］が０である場合、ａｂｓ＿ｍｖｄ＿ｍｉｎｕｓ２［０］を－１と定めることを示す。その後の式は、ａｂｓ＿ｍｖｄ＿ｍｉｎｕｓ２［０］に２を加えた値に、ｍｖｄ＿ｓｉｇｎ＿ｆｌａｇ［０］に応じて正負のいずれかを定めることで差分ベクトルのＸ成分の値ｍｖｄＬＸ［０］を定めることを示す。また、ベクトル差分復号部３０３１２は、差分ベクトルのＹ成分ｍｖｄＬＸ［１］を０と定める。
　なお、符号化ストリーム構造は、構文６０４により視点が一次元に配置されていること（camera_arrangement_1D_flag）によって、構文ｍｖｄ＿ｃｏｄｉｎｇ１Ｄと構文ｍｖｄ＿ｃｏｄｉｎｇを切り替える構造ではなく、構文ｍｖｄ＿ｃｏｄｉｎｇのみを用いる構造でも良い。この場合には、以下の式のように、差分ベクトルのＹ成分（abs_mvd_greater0_flag[1]）は、camera_arrangement_1D_flag=かつreference_layer_info(ref_idx_lX[x0][y0])==INTER_VIEWの場合にのみ符号化ストリームに含まれる。
　if(camera_arrangement_1D_flag=#65286;＆!eference_layer_info(ref_idx_lX[x0][y0])==INTER_VIEW)
　ａｂｓ＿ｍｖｄ＿ｇｒｅａｔｅｒ０＿ｆｌａｇ［１］
　上記、符号化ストリーム構造の場合、符号化データベクトル差分復号部３０３１２は、camera_arrangement_1D_flag=かつreference_layer_info(ref_idx_lX[x0][y0])==INTER_VIEWの場合にのみ差分ベクトルのＹ成分（abs_mvd_greater0_flag[1]）を復号する。
また、符号化データベクトル差分復号部３０３１２は、差分ベクトルのＹ成分の絶対値が０を超えるか否かのフラグ（abs_mvd_greater0_flag[1]）の復号が行われない場合には、上記フラグに０を設定する（abs_mvd_greater0_flag[1]＝０）。
（参照ピクチャリストの一例）
　次に、参照ピクチャリストの一例について説明する。参照ピクチャリストとは、参照ピクチャメモリ３０６（図２）に記憶された参照ピクチャからなる列である。
　図１７は、参照ピクチャリストの一例を示す概念図である。
　参照ピクチャリスト６０１において、左右に一列に配列された５個の長方形は、それぞれ参照ピクチャを示す。左端から右へ順に示されている符号、Ｐ１、Ｐ２、Ｑ０、Ｐ３、Ｐ４は、それぞれの参照ピクチャを示す符号である。Ｐ１等のＰとは、視点Ｐを示し、そしてＱ０のＱとは、視点Ｐとは異なる視点Ｑを示す。Ｐ及びＱの添字は、ピクチャ順序番号ＰＯＣを示す。ｒｅｆＩｄｘＬＸの真下の下向きの矢印は、参照ピクチャインデックスｒｅｆＩｄｘＬＸが、参照ピクチャメモリ３０６において参照ピクチャＱ０を参照するインデックスであることを示す。
（ベクトル候補の一例）
　次に、上述のベクトル候補の一例について説明する。
　図１８は、ベクトル候補の一例を示す概念図である。
　図１８に示す予測ベクトルリスト６０２は、ベクトル候補導出部３０３３において導出される複数のベクトル候補からなるリストである。
　予測ベクトルリスト６０２において、左右に一列に配列された５個の長方形は、それぞれ予測ベクトルを示す領域を示す。左端から２番目のｍｖｐ＿ＬＸ＿ｉｄｘの真下の下向きの矢印とその下のｐｍｖは、ベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘが、予測パラメータメモリ３０７においてベクトルｐｍｖを参照するインデックスであることを示す。
（候補ベクトルの取得）
　次に、候補ベクトルを取得する方法の一例について説明する。候補ベクトルは、復号処理が完了したブロックであって、復号対象ブロックから予め定めた範囲のブロック（例えば、隣接ブロック）を参照し、参照したブロックに係るベクトルに基づいて生成される。
　図２０は、隣接ブロックの一例を示す概念図である。
　図２０において四角形で示されているＰＵは、復号対象ブロックである。ＰＵの左側に隣接する２個の四角形ＮＢａ０、ＮＢａ１、ＰＵの上側に接する３個の四角形ＮＢｂ２、ＮＢｂ１、ＮＢｂ０は、それぞれ隣接ブロックを示す。
　ベクトル候補導出部３０３３（図３）は、ＰＵの左側に隣接する２個のブロックＮＢａ０、ＮＢａ１それぞれから順に、ベクトルを予測パラメータメモリ３０７から読み出し、読み出したベクトルに基づいて１個の候補ベクトルを導出する。ベクトル候補導出部３０３３は、ＰＵの上側に隣接する３個のブロックＮＢｂ２、ＮＢｂ１、ＮＢｂ０それぞれから順にベクトルを予測パラメータメモリ３０７から読み出し、読み出したベクトルに基づいて１個の候補ベクトルを導出する。
　候補ベクトルの導出に際して、ベクトル候補導出部３０３３は、以下に説明する処理を、(１)、(２)の順序で優先して行う。
（１）隣接ブロックの参照ピクチャが、復号対象ブロックの参照ピクチャインデックスｒｅｆＩｄｘと予測方向ＬＸが示す参照ピクチャと同一である場合、その隣接ブロックに係るベクトルを読み出す。これにより、参照ピクチャインデックスｒｅｆＩｄｘと予測方向ＬＸが示すベクトルが変位ベクトルである場合、隣接ブロックで参照されるベクトルが変位ベクトルであると判断される。
　但し、隣接ブロックで参照される予測パラメータには、ＬＸが示す予測方向に係る予測パラメータと、ＬＸが示す予測方向とは異なる予測方向（ＬＹ）に係る予測パラメータがある。ここでは、ＬＸが示す予測方向に係るベクトル、ＬＹが示す予測方向に係るベクトルの順で参照する。
　ＬＸが示す予測方向に係るベクトルが読み出された場合には、参照対象の参照ピクチャインデックスｒｅｆＩｄｘと復号対象ピクチャの参照ピクチャインデックスが等しいか否かを判定する。これにより、復号対象のピクチャがベクトルを読み出したピクチャと同一であるか否かを判定することができる。
　ＬＹが示す予測方向に係るベクトルが読み出された場合には、ベクトルを読み出したピクチャのピクチャ順序番号ＰＯＣと復号対象ピクチャのＰＯＣが等しいか否かを判定する。これにより、復号対象のピクチャがベクトルを読み出したピクチャと同一であるか否かを判定することができる。これは、参照ピクチャインデックスが同一であっても予測方向によって参照されるピクチャが異なるためである。
（２）（１）により、復号対象のピクチャと同一のピクチャからベクトルを読み出せなかったと判定された場合には、次の処理を行う。
　隣接ブロックで参照される参照ピクチャと、復号対象ブロックの参照ピクチャインデックスｒｅｆＩｄｘＬＸが示す参照ピクチャが、ともに長時間参照ピクチャである場合、ＬＸが示す予測方向に係るベクトル、ＬＹが示す予測方向に係るベクトルの順でベクトルを参照する。これは、ベースビューに係る参照ピクチャが長時間参照ピクチャとして参照ピクチャメモリ３０６に記憶されることによる。つまり、参照ピクチャインデックスｒｅｆＩｄｘＬＸが示す参照ピクチャが長時間参照ピクチャである場合には、その参照ピクチャのブロックに係るベクトルは変位ベクトルである。そのため、隣接ブロックの変位ベクトルが参照されることになる。
　隣接ブロックで参照される参照ピクチャと、復号対象ブロックの参照ピクチャインデックスｒｅｆＩｄｘＬＸが示す参照ピクチャが、ともに短時間参照ピクチャである場合、隣接ブロックから読み出したベクトルについて、スケーリング処理を行う。スケーリング処理によって、読み出したベクトルの値が予め定めた範囲内の値をとる。なお、短時間参照ピクチャとは、長時間参照ピクチャ以外の参照ピクチャであって、参照ピクチャメモリ３０６に予め定めた時間だけ記憶され、その時間を経過すると消去される参照ピクチャである。
　（１）、（２）の他、被写体の奥行方向の距離を示す奥行情報（デプスマップ）が入力される場合には、ベクトル候補導出部３０３３は、復号対象ブロックにおける奥行情報を抽出し、抽出した奥行情報に対応した大きさの変位を示す変位ベクトルを候補ベクトルとして算出しても良い。
（参照ピクチャの例）
　次に、ベクトルを導出する際に用いる参照ピクチャの例について説明する。
　図１９は、参照ピクチャの例を示す概念図である。
　図１９において、横軸は時刻を示し、縦軸は視点を示す。
　図１９に示されている、縦２行、横３列（計６個）の長方形は、それぞれピクチャを示す。６個の長方形のうち、下行の左から２列目の長方形は復号対象のピクチャ（対象ピクチャ）を示し、残りの５個の長方形がそれぞれ参照ピクチャを示す。対象ピクチャから上向きの矢印で示される参照ピクチャＱ０は対象ピクチャと同時刻であって視点が異なるピクチャである。対象ピクチャを基準とする変位予測においては、参照ピクチャＱ０が用いられる。対象ピクチャから左向きの矢印で示される参照ピクチャＰ１は、対象ピクチャと同じ視点であって、過去のピクチャである。対象ピクチャから右向きの矢印で示される参照ピクチャＰ２は、対象ピクチャと同じ視点であって、未来のピクチャである。対象ピクチャを基準とする動き予測においては、参照ピクチャＰ１又はＰ２が用いられる。
（変形例Ｄ１）
　次に、本実施形態に係る変形例Ｄ１について説明する。同一の構成については同一の符号を付して上述の説明を援用する。
　本変形例に係る画像復号装置３１ａは、画像復号装置３１のインター予測パラメータ復号部３０３（図３）においてＡＭＶＰ予測パラメータ導出部３０３２の代わりにＡＭＶＰ予測パラメータ導出部３０３２ａを備える。本変形例Ｄ１に係る画像復号装置３１ａは、その他の構成において、画像復号装置３１（図２）の構成と同じである。
　図５は、本変形例に係るＡＭＶＰ予測パラメータ導出部３０３２ａの構成を示す概略図を示す。
　ＡＭＶＰ予測パラメータ導出部３０３２ａは、ベクトル候補導出部３０３３、予測ベクトル選択部３０３４に加えて、変位予測ベクトルクリップ部３０３２１ａを備える。
　ベクトル候補導出部３０３３は、拡張ベクトル候補導出部３０３３５及びベクトル候補格納部３０３３９、図示しない基本ベクトル候補導出部（後述）を含んで構成される。
　拡張ベクトル候補導出部３０３３５は、変位ベクトル取得部３０３３６及びインターレイヤベクトル候補導出部３０３３７（インタービューベクトル候補導出部）を含んで構成される。
　変位ベクトル取得部３０３３６には、インター予測パラメータ抽出部３０３１（図３）から参照ピクチャインデックスｒｅｆＩｄｘ及びリファレンスレイヤ情報reference_layer_infoが入力される。ベクトルｍｖＬＸが変位ベクトルであることをリファレンスレイヤ情報reference_layer_infoが示す場合、変位ベクトル取得部３０３３６は、参照ピクチャインデックスｒｅｆＩｄｘが示す参照ピクチャに係る変位ベクトルｄｖＬＸを予測パラメータメモリ３０７から読み出す。読み出される変位ベクトルは、復号対象ブロックから予め定めた範囲にあるブロックそれぞれの変位ベクトルｄｖＬＸである。変位ベクトル取得部３０３３６は、読み出した変位ベクトルｄｖＬＸをインターレイヤベクトル候補導出部３０３３７に出力する。
　インターレイヤベクトル候補導出部３０３３７には、インター予測パラメータ抽出部３０３１（図４）から参照ピクチャインデックスｒｅｆＩｄｘＬＸが入力され、変位ベクトル取得部３０３３６から各ブロックの変位ベクトルｄｖＬＸが入力される。
　インターレイヤベクトル候補導出部３０３３７は、参照ピクチャインデックスｒｅｆＩｄｘに係る参照ピクチャ（レイヤ画像）を特定する。参照ピクチャが対象ピクチャと異なるレイヤ画像の場合には、インターレイヤベクトル候補導出部３０３３７は、変位ベクトル取得部３０３３６の導出する変位ベクトルを出力する。参照ピクチャが対象ピクチャと異なるレイヤ画像とは、例えば、参照ピクチャが非基準視点ノンベースビュー（ｎｏｎ－ｂａｓｅ　ｖｉｅｗ）ともいう）であり、対象ピクチャが基準視点（ベースビュー（ｂａｓｅ　ｖｉｅｗ）ともいう）の場合がある。
　参照ピクチャが対象ピクチャと同じレイヤ画像の場合は、インターレイヤベクトル候補導出部３０３３７は、対象ピクチャと異なるパラメータ参照レイヤ画像（ここでは、基準視点のレイヤ画像）を特定し、その特定したピクチャに対する変位ベクトルを、変位ベクトル取得部３０３３６から導出し、その変位ベクトルに対応する位置にある、パラメータ参照レイヤ画像（基準視点のレイヤ画像）のベクトルを予測パラメータメモリ３０７から読み出す。
　より具体的には、参照ピクチャが対象ピクチャと同じレイヤ画像の場合、インターレイヤベクトル候補導出部３０３３７は、特定したピクチャ（レイヤ画像）について復号対象ブロックを起点として、その起点から変位ベクトル取得部３０３３６から入力された変位ベクトルｄｖＬＸだけ、ずれた位置にあるブロックの位置を以下の式を用いて特定する。
　xRefPPSW－1gt;>vLX[0]gt;>
　yRefPPSH－1gt;>vLX[1]gt;>
　この特定されたブロックを対応ブロックと呼ぶ。ここで、xRef、yRefは対応ブロックの座標、xP、yPは、各々復号対象ブロックの左上座標の座標、nPSW、nPSHは各々復号対象ブロックの幅と高さ、dvLX[0]、dvLX[1]は、変位ベクトル取得部３０３３６から入力された変位ベクトルのＸ成分とＹ成分である。#65310;＞～は、#12434;～ビットだけ右にシフトすることを示す。すなわち、#12398;ビット値を、～ビットだけ下位の桁にシフトする演算を示すビットシフト演算子である。インターレイヤベクトル候補導出部３０３３７は、対応ブロックに係るベクトルｍｖＬＸを予測パラメータメモリ３０７から読み出す。
　インターレイヤベクトル候補導出部３０３３７は、読み出したベクトルｍｖＬＸをベクトル候補としてベクトル候補格納部３０３３９に格納する。
　変位予測ベクトルクリップ部３０３２１ａには、予測ベクトル選択部３０３４から予測ベクトルｍｖｐＬＸと参照ピクチャインデックスｒｅｆＩｄｘが入力される。予測ベクトルｍｖｐＬＸは、Ｘ方向への成分値ｍｖｐ＿ｘとＹ方向への成分値ｍｖｐ＿ｙを要素として含む２次元のベクトルである。
　ここで、予測ベクトルｍｖｐＬＸが変位ベクトルに基づく予測ベクトルｄｖｐＬＸである場合、すなわち、参照ピクチャインデックスｒｅｆＩｄｘを入力として、リファレンスレイヤ判定部３０３１１が、インターレイヤ予測が行われたと判定した場合、変位予測ベクトルクリップ部３０３２１ａは、Ｙ成分ｄｖｐ＿ｙを予め定めた範囲内の値に制限する。予め定めた範囲内の値とは、例えば、１つの値（ゼロ、等）である。Ｙ成分ｄｖｐ＿ｙが予め定めた下限値（－６４画素、等）よりも小さい場合、その下限値である。Ｙ成分ｄｖｐ＿ｙが予め定めた上限値（６４画素、等）よりも大きい場合、その上限値である。
　変位予測ベクトルクリップ部３０３２１ａは、Ｘ方向への成分値ｄｖｐ＿ｘと、値を制限したＹ方向への成分値ｄｖｐ＿ｙとから、変位ベクトルｄｖｐＬＸを再構成し、再構成した変位ベクトルｄｖｐＬＸを加算部３０３５（図３）に出力する。
　予測ベクトルｍｖｐＬＸが動き予測ベクトルである場合、変位予測ベクトルクリップ部３０３２１ａは、すなわち、参照ピクチャインデックスｒｅｆＩｄｘを入力として、リファレンスレイヤ判定部３０３１１が、インターレイヤ予測が行われたと判定しない場合、入力された動き予測ベクトルｍｖｐＬＸを加算部３０３５に出力する。
　なお、変位予測ベクトルクリップ部３０３２１ａは、リファレンスレイヤ判定部３０３１１から入力されたリファレンスレイヤ情報reference_layer_infoを入力しても良い。変位予測ベクトルクリップ部３０３２１ａは、入力されたリファレンスレイヤ情報reference_layer_infoが、ベクトルｍｖＬＸが変位ベクトルであることを示す場合に、予測ベクトルｍｖｐＬＸが変位予測ベクトルであると判定する。
　なお、ベクトル候補導出部３０３３において予測ベクトルの候補（候補ベクトル）を導出する処理については後述する。
　以上の画像復号装置３１ａは、復号対象ブロックの予測ベクトルを導出するＡＭＶＰ予測パラメータ導出部３０３２ａを備え、対象ブロックのベクトルもしくはベクトル差分が、異なるレイヤ間の予測であるインターレイヤ予測であるか否かを判定するリファレンスレイヤ判定部３０３１１を備え、リファレンスレイヤ判定部３０３１１が、インターレイヤ予測が行われたと判定した場合に、前記復号対象ブロックの予測ベクトルの少なくとも一方の成分を、予め定めた値に制限する。
　一般に変位ベクトルのｄｖＬＸのＹ成分ｄｖ＿ｙは、予め定めた値、例えばゼロの周辺に集中して分布する傾向があるにもかかわらず、符号化において、その範囲から離れた値をとることがある。その場合には、変位予測における精度が劣化する。
　これに対し、本変形例Ｄ１では、変位ベクトルに係る予測ベクトルのＹ成分ｄｖｐ＿ｙが予め定めた範囲の値に制限されるため、変位予測における精度の劣化を抑制することができるため、符号化効率が向上する。
（変形例Ｄ２）
　次に、本実施形態に係る他の変形例Ｄ２について説明する。同一の構成については同一の符号を付して上述の説明を援用する。
　変形例Ｄ２に係る画像復号装置３１ｂの構成の大要は、変形例Ｄ１の画像復号装置３１ａ構成と同じである。すなわち、画像復号装置３１ｂは、変形例Ｄ１の画像復号装置３１ａ同様に変位予測ベクトルクリップ部３０３２１ａ（図５参照）を備える。主に、両者の相違点を以下に説明する。
　ベクトルｍｖＬＸが変位ベクトルである場合、画像復号装置３１ｂでは、エントロピー復号部３０１（図２参照）に入力される符号化ストリームＴｅに変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎが含まれる。
　変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎは、予測ベクトルのＹ成分ｄｖｐ＿ｙを予め定めた範囲の値に制限するか否か、及び差分ベクトルのＹ成分ｄｖｄ＿ｙを予め定めた値に制限するか否かを示す情報である。例えば、変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎの値がゼロとは、予測ベクトルのＹ成分ｄｖｐ＿ｙ、差分ベクトルのＹ成分ｄｖｄ＿ｙともに値を制限しないことを示す。変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎの値が１とは、予測ベクトルのＹ成分ｄｖｐ＿ｙを予め定めた範囲の値に制限し、差分ベクトルのＹ成分ｄｖｄ＿ｙの値を制限しないことを示す。変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎの値が２とは、予測ベクトルのＹ成分ｄｖｐ＿ｙを制限せず、差分ベクトルのＹ成分ｄｖｄ＿ｙの値を予め定めた範囲の値に制限することを示す。変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎの値が３とは、予測ベクトルのＹ成分ｄｖｐ＿ｙの値を予め定めた範囲の値に制限し、かつ、差分ベクトルのＹ成分ｄｖｄ＿ｙの値を予め定めた範囲の値に制限することを示す。
　特に、差分ベクトルのＹ成分の制限に関して、前記の予め定めた範囲の値をゼロとする場合においては、変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎの値がゼロ又は１である場合、差分ベクトルｄｖｄＬＸは、Ｘ成分ｄｖｄ＿ｘとＹ成分ｄｖｄ＿ｙを要素として含む２次元のベクトルである。変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎの値が２又は３である場合、差分ベクトルｄｖｄＬＸは、Ｘ成分ｄｖｄ＿ｘを要素として含み、Ｙ成分ｄｖｄ＿ｙを要素として含まないスカラー値である。
　画像復号装置３１ｂに係るエントロピー復号部３０１は、符号化ストリームＴｅから変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎを分離し、分離した変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎをインター予測パラメータ抽出部３０３１（図３、４参照）に出力する。また、インター予測パラメータ抽出部３０３１は、変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎを変位予測ベクトルクリップ部３０３２１ａ（図５）に出力する。
　インター予測パラメータ抽出部３０３１（図３）のベクトル差分復号部３０３１２（図４）には、エントロピー復号部３０１から入力された変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎが入力される。
　変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎの値がゼロ又は１である場合、エントロピー復号部３０１から入力された差分ベクトルｍｖｄＬＸを加算部３０３５に出力する。
　変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎの値が２又は３である場合、ベクトル差分復号部３０３１２は、Ｙ成分ｄｖｄ＿ｙを予め定めた範囲の値に制限する。ベクトル差分復号部３０３１２は、入力された差分ベクトルｄｖｄＬＸのＸ成分ｄｖｄ＿ｘと、値を予め定めた範囲の値に制限したＹ成分ｄｖｄ＿ｙを統合して、差分ベクトルｄｖｄＬＸを再構成する。ベクトル差分復号部３０３１２は、再構成した差分ベクトルｄｖｄＬＸを加算部３０３５（図３）に出力する。
　変位予測ベクトルクリップ部３０３２１ａ（図５）には、インター予測パラメータ抽出部３０３１から変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎが入力される。変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎの値がゼロ又は２である場合、変位予測ベクトルクリップ部３０３２１ａは、予測ベクトル選択部３０３４から入力された予測ベクトルｄｖｐＬＸを加算部３０３５に出力する。変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎの値が１又は３である場合、変位予測ベクトルクリップ部３０３２１ａは、Ｙ成分ｄｖｐ＿ｙを予め定めた範囲の値に制限する。変位予測ベクトルクリップ部３０３２１ａは、Ｘ成分ｄｖｐ＿ｘと、値を予め定めた範囲の値に制限したＹ成分ｄｖｐ＿ｙから、予測ベクトルｄｖｐＬＸを再構成し、再構成した予測ベクトルｄｖｐＬＸを加算部３０３５に出力する。
　なお、本変形例Ｄ２では、インター予測パラメータ抽出部３０３１において、リファレンスレイヤ判定部３０３１１（図４参照）を省略しても良い。
　また、変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎは、符号化ストリームＴｅにおいて、レイヤ画像（視差画像）毎に含まれるようにしても良いし、シーケンス毎に含まれるようにしても良い。あるストリームに含まれる全てのレイヤ（視点）のシーケンスに対する符号化パラメータをビューパラメータセット（ＶＰＳ：Ｖｉｅｗ　Ｐａｒａｍｅｔｅｒ　Ｓｅｔ）という。シーケンス毎の符号化パラメータの組をシーケンスパラメータセット（ＳＰＳ：Ｓｅｑｕｅｎｃｅ　Ｐａｒａｍｅｔｅｒ　Ｓｅｔ）という。シーケンスとは、復号処理において、一度行われたリセット（再設定）から次のリセットまでの間の複数のピクチャの組である。
　以上の画像復号装置３１ｂは、対象ブロックのベクトルもしくはベクトル差分が、異なるレイヤ間の予測であるインターレイヤ予測であるか否かを判定するリファレンスレイヤ判定部３０３１１を備え、前記対象ブロックよりも上位のパラメータにおいて、変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎを復号し、リファレンスレイヤ判定部３０３１１がインターレイヤ予測と判定した場合、かつ、変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎが所定の値の場合に、前記対象ブロックのベクトルの少なくとも一方の成分を、符号化データから復号せず、所定の値（例えば０）として導出する。また、リファレンスレイヤ判定部３０３１１がインターレイヤ予測と判定した場合に、前記対象ブロックの差分ベクトルの少なくとも一方の成分を符号化データから復号せず、所定の値（例えば０）として導出する。
　これにより、本変形例Ｄ２では、画像を取得した視点（カメラ）等の配置や撮影された画像の情景（シーン）に応じて、Ｙ方向の変位を利用するか否かを切り替えることができる。例えば、垂直方向のエッジが主に現れる画像（例えば、垂直方向に延びる鉄格子の画像）については、Ｙ方向の変位（視差）が知覚されないことがある。そこで、水平方向に延びる直線から離れた位置に配置された複数のカメラが撮影した画像について、垂直方向のエッジが主に現れるシーンであるか否かによって、Ｙ方向の変位を利用しないか否かを切り替えることができる。よって、シーン全体として画質の劣化の抑制と符号化ストリームＴｅの情報量の低減を両立することができる。
（変形例Ｄ３）
　次に、本実施形態に係る他の変形例Ｄ３について説明する。
　本変形例Ｄ３に係る画像復号装置３１ｃは、画像復号装置３１（図１、図２）のインター予測パラメータ復号部３０３（図３）の代わりにインター予測パラメータ復号部３０３ｃを備える。本変形例Ｄ３に係る画像復号装置３１ｃの構成の大要は、インター予測パラメータ復号部３０３ｃを除いて画像復号装置３１の構成と同じである。したがって、同一の構成については同一の符号を付して上述の説明を援用する。
　リファレンスレイヤ情報reference_layer_infoが１、即ちベクトルｍｖＬＸが変位ベクトル（インターレイヤ予測が行われた）である場合、ベクトル差分復号部３０３１２は、水平方向（Ｘ方向）への成分値（Ｘ成分）ｄｖｄ＿ｘを符号化ストリームＴｅより復号し、垂直方向（Ｙ方向）への成分値（Ｙ成分）ｄｖｄ＿ｙを予め定めた値、例えばゼロと定める。ベクトル差分復号部３０３１２は、Ｘ成分ｄｖｄ＿ｘとＹ成分ｄｖｄ＿ｙを統合して、差分ベクトルｄｖｄＬＸを構成することで差分ベクトルｄｖｄＬＸを復号する。
　これに対して、ベクトルｍｖＬＸが、動きベクトルである場合、ベクトル差分復号部３０３１２は、符号化ストリームＴｅよりＸ成分ｍｖｄ＿ｘとＹ成分ｍｖｄ＿ｙとを復号し差分ベクトルｍｖｄＬＸとして出力する。ベクトル差分復号部３０３１２は、復号した差分ベクトルｍｖｄＬＸ（又はｄｖｄＬＸ）を加算部３０３５に出力する。
　本変形例Ｄ３のインター予測パラメータ復号部３０３は、差分ベクトルｍｖｄＬＸが、変位ベクトルに係る差分ベクトルである場合、Ｘ成分ｄｖｄ＿ｘを符号化ストリームＴｅより復号し、Ｙ成分ｄｖｄ＿ｙを予め定めた所定の規則により導出する。
　これに対して、ベクトルｍｖＬＸが、動きベクトルである場合、ベクトル差分復号部３０３１２は、符号化ストリームＴｅよりＸ成分ｍｖｄ＿ｘとＹ成分ｍｖｄ＿ｙとを復号し差分ベクトルｍｖｄＬＸとして出力する。ベクトル差分復号部３０３１２は、復号した差分ベクトルｍｖｄＬＸ（又はｄｖｄＬＸ）を加算部３０３５に出力する。
　なお、差分ベクトルｍｖｄＬＸが、変位ベクトルに係る差分ベクトルである場合も、差分ベクトルｍｖｄＬＸは、例えばＹ成分ｍｖｄ＿ｙの値が常にゼロである２次元ベクトルであっても良い。
　また、エントロピー復号部３０１（図２参照）に入力される符号化ストリームＴｅには、変位ベクトルのＸ成分ｄｖｄ＿ｘとＹ成分ｄｖｄＬＸ＿ｙとの関係を示す係数が含まれる。そのような係数には、傾き係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄと切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔがある。傾き係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄは、Ｘ成分ｄｖｄ＿ｘの変化に対するＹ成分ｄｖｄ＿ｙの変化量を示す係数である。切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔは、Ｘ成分ｄｖｄ＿ｘがゼロである場合のＹ成分ｄｖｄＬＸ＿ｙの値を示す係数である。
　図６は、本変形例に係るインター予測パラメータ復号部３０３ｃの構成を示す概略図である。インター予測パラメータ復号部３０３ｃは、画像復号装置３１（図２）のインター予測パラメータ復号部３０３（図３）に更に変位ベクトル生成部３０３８を備える。本変形例Ｄ３に係るインター予測パラメータ復号部３０３ｃの構成の大要は、変位ベクトル生成部３０３８を除いてインター予測パラメータ復号部３０３（図３）の構成と同じである。したがって、同一の構成については同一の符号を付して上述の説明を援用する。
　ここで、インター予測パラメータ抽出部３０３１は、符号ストリームＴｅから傾き係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄと切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔを分離する。インター予測パラメータ抽出部３０３１は、分離した傾き係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄと切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔを変位ベクトル生成部３０３８に出力する。なお、符号ストリームＴｅが傾き係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄを含まず、切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔを含む場合でも、インター予測パラメータ抽出部３０３１は適用できる。この場合、インター予測パラメータ抽出部３０３１は符号ストリームＴｅから切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔを分離し変位ベクトル生成部３０３８に出力する。
　加算部３０３５が変位ベクトル生成部３０３８に出力する変位ベクトルｄｖＬＸは、そのＸ成分ｄｖ＿ｘを要素として含み、Ｙ成分ｄｖ＿ｙを含まないスカラー値である。変位ベクトルｄｖＬＸは、Ｙ成分ｄｖ＿ｙの値がゼロである固定値（もしくは不定値）であるベクトルでも良い。
　次に、変位ベクトル生成部３０３８の構成について説明する。
　図７は、本変形例に係る変位ベクトル生成部３０３８の構成を示す概略図である。
　変位ベクトル生成部３０３８は、リファレンスレイヤ判定部３０３８１と変位ベクトル設定部３０３８２を含んで構成される。
　リファレンスレイヤ判定部３０３８１は、リファレンスレイヤ判定部３０３１１（図４参照）と同様に、インター予測パラメータ抽出部３０３１から入力された参照ピクチャインデックスｒｅｆＩｄｘＬＸに基づいて、ベクトルｍｖＬＸがインターレイヤ予測（変位ベクトル）であるのか、または動きベクトルであるのかを判定する。リファレンスレイヤ判定部３０３８１は、ベクトルｍｖＬＸがリファレンスレイヤ情報reference_layer_infoを生成する。リファレンスレイヤ判定部３０３８１は、生成したリファレンスレイヤ情報reference_layer_infoを変位ベクトル設定部３０３８２に出力する。
　変位ベクトル設定部３０３８２には、加算部３０３５からベクトルｍｖＬＸが入力され、インター予測パラメータ抽出部３０３１から傾き係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄと切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔが入力される。
　ベクトルｍｖＬＸがインターレイヤ予測（変位ベクトル）であることをリファレンスレイヤ情報reference_layer_infoが示す場合、変位ベクトル設定部３０３８２は、そのＸ成分ｄｖ＿ｘ、傾き係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄ及び切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔに基づいて、そのＹ成分ｄｖ＿ｙを算出する。ここで、変位ベクトル設定部３０３８２は、ｄｖ＿ｙ＝ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄ・ｄｖ＿ｘ＋ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔという数式を用いる。符号ストリームＴｅが傾き係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄを含まず切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔを含む場合には、変位ベクトル設定部３０３８２は、ｄｖ＿ｙ＝ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔという数式を用いる。なお、変位ベクトル設定部３０３８２は、Ｘ成分ｄｖ＿ｘの絶対値と傾き係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄの積と切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔの和により、Ｙ成分ｄｖ＿ｙの中間値を導出し、さらに、Ｘ成分ｄｖ＿ｘの符号に合うように、Ｙ成分ｄｖ＿ｙの中間値の符号を変更する処理を行っても良い。
　変位ベクトル設定部３０３８２は、入力されたＸ成分ｄｖ＿ｘと算出したＹ成分ｄｖ＿ｙを統合して、２次元の変位ベクトルｄｖＬＸを構成し、構成した変位ベクトルｄｖＬＸを予測パラメータメモリ３０７に記憶し、また予測ピクチャ生成部３０８に出力する。なお、ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄ及びｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔはいずれも整数である。
　Ｙ成分ｄｖ＿ｙを所定の量子化ステップＧＲＡＤで量子化する場合には、変位ベクトル設定部３０３８２は、次の式を用いてＹ成分ｄｖ＿ｙを算出しても良い。
　ｄｖ＿ｙ＝ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄ・ｄｖ＿ｘ／ＧＲＡＤ＋ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔ
　また、量子化ステップＧＲＡＤの値が２のＧＳＨＩＦＴ乗（ＧＲＡＤ＝１＜＜ＧＳＨＩＦＴ）である場合には、変位ベクトル設定部３０３８２は、次の式を用いても良い。
　ｄｖ＿ｙ＝ｆｌｏｏｒ｛（ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄ＋ＲＯＵＮＤ＋ｄｖ＿ｘ＞＞ＧＳＨＩＦＴ）＋ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔ｝
　ここで、ＧＳＨＩＦＴ値は、１よりも大きい所定のシフト値（整数）である。１＜＜ＧＳＨＩＦＴは、２のＧＳＨＩＦＴ乗である整数を示す。ｆｌｏｏｒ｛#65373;は、実数#12398;整数部分を与える床関数を示す。#65310;＞～は、#12398;ビット値を、～ビットだけ下位の桁にシフトする演算を示すビットシフト演算子である。つまり、#65310;＞ＧＳＨＩＦＴは、#12434;２のＧＳＨＩＦＴ乗で除算することを示す。ＲＯＵＮＤは、丸め除算を実現するために用いる定数である。ＲＯＵＮＤの値は、１＜＜（ＧＳＨＩＦＴ－１）、つまり、除数である２のＧＳＨＩＦＴ乗の半分の値である。
　ベクトルｍｖＬＸが動きベクトルであることをリファレンスレイヤ情報reference_layer_infoが示す場合、変位ベクトル設定部３０３８２は、加算部３０３５から入力された動きベクトルｍｖＬＸをそのまま予測パラメータメモリ３０７に記憶し、また予測ピクチャ生成部３０８に出力する。
　なお、傾き係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄと切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔは、符号化ストリームＴｅにおいて、シーケンス毎に含まれるようにしても良いし、ピクチャ毎に含まれるようにしても良い。すなわち、シーケンス毎の符号化パラメータの組であるシーケンスパラメータセット、ピクチャ毎の符号化パラメータの組をピクチャパラメータセット（ＰＰＳ：Ｐｉｃｔｕｒｅ　Ｐａｒａｍｅｔｅｒ　Ｓｅｔ）という。スライス単位のパラメータの組であるスライスヘッダに含めるようにしても良い。特に、これらの係数がピクチャ毎に含まれるようにすることで、シーンのピクチャ単位でのきめ細やかな変化に追従することができる。
　以上の画像復号装置３１ｃは、対象ブロックのベクトルもしくはベクトル差分が、異なるレイヤ間の予測であるインターレイヤ予測であるか否かを判定するリファレンスレイヤ判定部３０３８１を備え、リファレンスレイヤ判定部３０３８１が、インターレイヤ予測が行われたと判定した場合に、前記対象ブロックのベクトルの少なくとも一方の成分を、前記対象ブロックのもう一方の成分、と、前記対象ブロックよりも上位のパラメータから復号された値に基づいて、もしくは、前記対象ブロックよりも上位のパラメータから復号された値に基づいて導出する。また、リファレンスレイヤ判定部３０３８１が、インターレイヤ予測が行われたと判定した場合に、前記対象ブロックの差分ベクトルの少なくとも一方の成分を符号化データから復号せず、所定の値（例えば０）として導出する。
　これにより、本変形例Ｄ３では、画像を取得した視点（カメラ）等の配置や向きが厳密に一方向に平行に配置されていない場合に完全にＹ方向の変位が予め定めた値（例えば、ゼロ）にならない場合でもＹ方向の変位を再現することができる。また、本変形例では、撮影された画像のシーンに応じて、Ｘ方向の変位とＹ方向の変位との関係を切り替えることができる。シーン全体として画質の劣化の抑制と符号化ストリームＴｅの情報量の低減を両立することができる。
（変形例Ｄ４）
　次に、本実施形態に係る他の変形例Ｄ４について説明する。同一の構成については同一の符号を付して上述の説明を援用する。
　本変形例に係る画像復号装置３１ｄは、画像復号装置３１のインター予測パラメータ復号部３０３（図３）の代わりにインター予測パラメータ復号部３０３ｄを備える。本変形例Ｄ４に係るインター予測パラメータ復号部３０３ｄのその他の構成の大要は、インター予測パラメータ復号部３０３（図３）の構成と同じである。したがって、同一の構成については同一の符号を付して上述の説明を援用する。
　図８は、本変形例に係るインター予測パラメータ復号部３０３ｄの構成を示す概略図である。
　インター予測パラメータ復号部３０３ｄは、インター予測パラメータ抽出部３０３１、ＡＭＶＰ予測パラメータ導出部３０３２、加算部３０３５、マージ予測パラメータ導出部３０３６、及び変位ベクトルクリップ部（変位ベクトル制限部）３０３７を含んで構成される。
　変位ベクトルクリップ部３０３７は、インター予測パラメータ抽出部３０３１から入力された参照ピクチャインデックスｒｅｆＩｄｘＬＸを予測パラメータメモリ３０７に記憶し、また予測ピクチャ生成部３０８に出力する。また、変位ベクトルクリップ部３０３７は、加算部３０３５から入力されたベクトルｍｖＬＸがインターレイヤ予測（変位ベクトル）である場合、すなわち、参照ピクチャインデックスｒｅｆＩｄｘを入力として、リファレンスレイヤ判定部３０３７１がインターレイヤ予測と判定する場合、そのベクトルの値の範囲を予め定めた範囲内の値に制限し、値が制限された変位ベクトルｄｖＬＸを予測ピクチャ生成部３０８に出力する。
　なお、変位ベクトルクリップ部３０３７は、マージ予測パラメータ導出部３０３６から入力された変位ベクトルｄｖＬＸについても、加算部３０３５から入力された変位ベクトルｄｖＬＸと同様に、そのベクトルの値の範囲を予め定めた範囲内の値に制限しても良い。
　図９は、本変形例Ｄ４に係る変位ベクトルクリップ部３０３７の構成を示す概略図である。
　変位ベクトルクリップ部３０３７は、リファレンスレイヤ判定部３０３７１とベクトルクリップ部３０３７２とを含んで構成される。
　リファレンスレイヤ判定部３０３７１は、リファレンスレイヤ判定部３０３１１（図４参照）と同様にエントロピー復号部３０１から入力された参照ピクチャインデックスｒｅｆＩｄｘＬＸに基づいて、ベクトルｍｖＬＸが変位ベクトル（視差ベクトル、インターレイヤ予測が行われた）であるか動きベクトルであるかを判定する。
　ベクトルクリップ部３０３７２には、加算部３０３５又はマージ予測パラメータ導出部３０３６からベクトルｍｖＬＸから入力され、リファレンスレイヤ判定部３０３７１からリファレンスレイヤ情報reference_layer_infoが入力される。
　ベクトルｍｖＬＸが変位ベクトル（インターレイヤ予測が行われた）であることをリファレンスレイヤ情報reference_layer_infoが示す場合、ベクトルクリップ部３０３７２は、変位ベクトルｄｖＬＸの値を予め定めた範囲内の値に制限する。変位ベクトルの制限は、Ｘ成分、Ｙ成分のいずれか一方、もしくは、Ｘ成分、Ｙ成分の両者について行われても構わない。
　例えば、変位ベクトルｄｖＬＸのＸ成分ｄｖ＿ｘの値が予め定めたＸ成分の上限値よりも大きい場合、ベクトルクリップ部３０３７２は、Ｘ成分ｄｖ＿ｘの値をそのＸ成分の上限値と定める。Ｘ成分ｄｖ＿ｘの値が予め定めたＸ成分の下限値よりも小さい場合、ベクトルクリップ部３０３７２は、Ｘ成分ｄｖ＿ｘの値をそのＸ成分の下限値と定める。
　Ｙ成分ｄｖ＿ｙの値が予め定めたＹ成分の上限値よりも大きい場合、ベクトルクリップ部３０３７２は、Ｙ成分ｄｖ＿ｙの値をそのＹ成分の上限値と定める。Ｙ成分ｄｖ＿ｙの値が予め定めたＹ成分の下限値よりも小さい場合、ベクトルクリップ部３０３７２は、Ｙ成分ｄｖ＿ｙの値をそのＹ成分の下限値と定める。
　なお、Ｙ成分の上限値は、後述のように複数のレイヤ画像が並列に処理されることを考慮すれば、例えば２８、５６などの値が有効である。また、変位ベクトルのとりうる範囲は、例えば、画面の幅の１０％程度である。Ｘ成分の上限値は、例えば、画面の幅の１０％、もしくは８分の１である。また、Ｘ成分の上限値は、画面幅の１６分の１であっても良い。
　上述の例では、Ｘ成分ｄｖ＿ｘ、Ｙ成分ｄｖ＿ｙの値が、予め定めた値を超えた場合にその上限値又は下限値に定める場合であるが、本実施形態ではこれには限られない。例えば、ベクトルクリップ部３０３７２は、Ｘ成分ｄｖ＿ｘ、Ｙ成分ｄｖ＿ｙ、それぞれについての変域幅（つまり、上限値と下限値との差分）との剰余値に基づいて、値を制限しても良い。例えば、Ｘ成分の変域幅が２ｋ（ｋは、０より大きい整数、例えば７）である場合、ｄｖ＿ｘをｄｖ＿ｘ％２ｋ－２ｋ（ｄｖ＿ｘ≧２ｋ－１の場合）、ｄｖ＿ｘ％２ｋ（０≦ｄｖ＿ｘ＜２ｋ－１の場合）、と制限しても良い。ここで、#65285;～とは、変数#12434;変数～で、除算して得られる剰余値を示す。これにより、Ｘ成分ｄｖ＿ｘの値は、最小値－２ｋ－１から最大値２ｋ－１－１の間に制限される。
　また、変位ベクトルｄｖＬＸに対する差分ベクトルｄｖｄＬＸの値も制限されるため、差分ベクトルｄｖｄＬＸを符号化する際の符号量を低減することができる。
　また、上述した例のそれぞれについて、Ｙ成分の変域幅をＸ成分の変域幅よりも小さくしても良い。例えば、Ｘ成分の変域幅が２０４８である場合に、Ｙ成分の変域幅を６４とする。つまり、Ｙ成分の値の範囲をＸ成分の値の範囲よりも狭くすることで、Ｙ成分に係る情報量を減少させることができる。
　ベクトルクリップ部３０３７２は、値を制限した変位ベクトルｄｖＬＸを予測ピクチャ生成部３０８に出力する。
　なお、リファレンスレイヤ情報reference_layer_infoが、ベクトルｍｖＬＸがインターレイヤ予測でないこと（動きベクトル）を示す場合、ベクトルクリップ部３０３７２は、入力されたベクトルｍｖＬＸをそのまま予測ピクチャ生成部３０８に出力する。
　また、本変形例では、内部メモリ３０６１（キャッシュメモリ）を備え、インター予測ピクチャ生成部３０９から内部メモリ３０６１を介して参照ピクチャブロックを読み出すようにしても良い。内部メモリ３０６１は、参照ピクチャメモリ３０６よりも記憶容量が小さくアクセス速度が速い記憶媒体であっても良い。
　図１０は、本変形例Ｄ４におけるインター予測ピクチャ生成部３０９が参照ピクチャブロックを読み出す構成の一例を示す概念図である。
　図１０の参照ピクチャメモリ３０６を示す長方形の領域に参照領域１が含まれる。参照領域１は、本変形例Ｄ４において取りうる値が制限される前の変位ベクトルの参照領域である。参照領域１には、参照領域２が含まれる。参照領域２は、本変形例Ｄ４において取りうる値が制限された変位ベクトルの参照領域である。
　内部メモリ３０６１には、参照領域３が含まれる。参照領域３は、参照ピクチャメモリ３０６の参照領域２に記憶された参照ピクチャが一時的に記憶される領域である。インター予測ピクチャ生成部３０９は、変位予測ピクチャ生成部３０９１を備える。
　変位予測ピクチャ生成部３０９１は、復号対象ブロックを基準として変位ベクトルｍｖＬＸが示す位置にある参照ピクチャブロックを内部メモリ３０６１から読み出す。ここで、参照ピクチャブロックが読み出される領域が参照領域３となる。参照領域３は、変位ベクトルｍｖＬＸが取りうる値の範囲が網羅されれば足りるため、本変形例Ｄ４において内部メモリ３０６１の記憶容量を小さくすることができ、画像復号装置を経済的に実現することができる。なお、変位予測ピクチャ生成部３０９１は、読み出した参照ピクチャブロックについて予測処理を行って変位補償予測ピクチャを、予測ピクチャブロックＰとして生成する。
　図２３は、変位ベクトルを制限する必要性を説明する図である。
　図２３（ａ）に示す通り、複数のレイヤ画像から構成される動画像を復号する際、限られた復号速度の装置を用いて、所定の時間（この例では16ms）内に復号を完了させるためには、複数のレイヤ画像（ここではレイヤ０とレイヤ１）を並列で復号することがある。
スケーラブル符号化では、レイヤ０に依存してレイヤ１が符号化されているため、完全には並列に復号することができないが、例えば、ブロック単位で復号する場合に、レイヤ０より所定のブロックラインだけ遅れてレイヤ１を復号することは可能である。
　図２３（ｂ）は、レイヤ１をレイヤ０から１符号化ブロックライン（１ＣＴＢ［Ｃｏｄｉｎｇ　Ｔｒｅｅ　Ｂｌｏｃｋ］ライン）だけ遅れて（図２３（ｂ）では上方に表示）復号する例を示す。図２３（ｂ）において矢印は、それぞれのレイヤ画像が復号された領域（ｄｅｃｏｄｉｎｇ　ｔｈｒｅａｄ）を示す。矢印の先端は、現在復号処理が行われているブロックの右端を示す。網掛けの部分は復号処理において、復号処理が行われた領域のうち、レイヤ画像１の復号において現在参照ピクチャとしてレイヤ画像１を利用できる（Ａｖａｉｌａｂｌｅ）領域を示す。縦縞の部分は復号処理において、復号処理が行われた領域のうち、レイヤ画像０の復号において現在参照ピクチャとしてレイヤ画像１を利用できない（Ｎｏ　Ａｖａｉｌａｂｌｅ）領域を示す。利用できないのは、復号処理における処理遅延、例えば、デブロッキングフィルタ処理（ＤＦ：Ｄｅｂｌｏｃｋｉｎｇ　Ｆｉｌｔｅｒｉｎｇ）とサンプル適応オフセットフィルタ処理（ＳＡＯ：Ｓａｍｐｌｅ　Ａｄａｐｔｉｖｅ　Ｏｆｆｓｅｔ　Ｆｉｌｔｅｒｉｎｇ）のため（ｄｕｅ　ｔｏ　ＤＦ＋ＳＡＯ）である。
　ここではレイヤ１から参照できるレイヤ０の画像の領域を示す変位ベクトルの範囲として、例えば以下の式に示す制限を課してもよい。
　変位ベクトルのＹ座標の上限＝符号化ブロックの高さ#65326;－ＬＦＨ―ＭＣＨ
　変位ベクトルのＸ座標の上限＝符号化ブロックの幅ラＭ－ＬＦＷ―ＭＣＷここで、Ｎは、遅延させる符号化ブロックライン（行）数、Ｍは、遅延させる符号化コラム（列）数であり、ＬＦＷ、ＬＦＨはループフィルタの係る範囲の幅と高さ、ＭＣＷとＭＣＨは、動き補償フィルタの係る範囲の幅と高さである。通常、ＬＦＷとＬＦＨは、デブロッキングフィルタのかかる範囲の３と、適応オフセットフィルタのかかる範囲の１を加えた４となるが、この限りではない。例えば、参照レイヤに適応オフセットフィルタを適用しない場合には、デブロッキングフィルタのみの３（ＬＦＨ＝ＬＦＷ＝３）としても良いし、参照レイヤにループフィルタを適用しない場合には０（ＬＦＨ＝ＬＦＷ＝０）としても良い。また、ＭＣＷとＭＣＨは、動き補償フィルタのタップ数が８の場合には４、タップ数が６の場合は３である。
　例えば、符号化ブロックの大きさを３２とすると、１ラインの遅延とすれば、変位ベクトルの範囲は次の通りとなる。
　変位ベクトルのＹ座標の上限＝３２ラ１－４－４＝２８ここで、変位ベクトルのＹ座標の上限は２８以上の値でも良い。また、例えば、符号化ブロックの大きさを６４とすると、１ラインの遅延とすれば、以下の値を変位ベクトルの範囲と定めておいてもよい。
　変位ベクトルのＹ座標の上限＝６４ラ１－４－４＝５６ここで、変位ベクトルのＹ座標の上限は５６以上の値でも良い。
　以上の画像復号装置３１ｄは、符号化データから復号したベクトル差分と予測ベクトルの和から、対象ブロックのベクトルを導出する予測パラメータ復号部（インター予測パラメータ復号部３０３ｄ）を備え、前記参照画像記憶部から、前記ベクトル導出部が導出したベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部（インター予測ピクチャ生成部３０９）を備え、対象ブロックのベクトルが、異なるレイヤ間の予測であるインターレイヤ予測であるか否かを判定するリファレンスレイヤ判定部３０３７１を備え、リファレンスレイヤ判定部３０３７１がインターレイヤ予測と判定した場合に、前記対象ブロックのベクトルの少なくとも一方の成分を、所定の範囲に制限するベクトルクリップ手段（ベクトルクリップ部３０３７２）を備える。
　このように、本変形例Ｄ４では、変位ベクトルの値のとりうる範囲を小さくすることができる。この範囲は、ある復号対象ブロックについて、インター予測ピクチャ生成部３０９が参照ピクチャメモリ３０６から復号対象（対象レイヤ画像）とは別のレイヤの参照ピクチャを参照する際の参照する範囲である参照領域に相当する。つまり、本変形例では、復号対象レイヤと別のレイヤ画像の参照ピクチャメモリ３０６における参照領域を小さくすることにより、小容量の記憶媒体でも参照ピクチャメモリ３０６として使用することが許容され、処理の高速化を図ることができる。
　また、図２３を用いて説明したように、復号対象ピクチャとは別のレイヤ画像（例えばベースビュー）の復号と、復号対象ピクチャの復号を並列で行う場合、復号対象ピクチャから参照される復号対象ピクチャとは別のレイヤ画像の参照範囲が制限されるため、復号対象ピクチャとは別のレイヤ画像が完全に復号される前に同時に、復号対象ピクチャの復号を行うことができる。
（変形例Ｄ５）
　次に、本実施形態に係る他の変形例Ｄ５について説明する。同一の構成については同一の符号を付して上述の説明を援用する。
　本変形例Ｄ５に係る画像復号装置３１eは、画像復号装置３１ｃの拡張ベクトル候補導出部３０３３５（図５参照）の代わりに拡張ベクトル候補導出部３０３３５ｅを備える。
画像復号装置３１ｅは、インター予測パラメータ復号部３０３において変位ベクトルクリップ部３０３７（図８）を備えても良いし、備えなくても良い。
　図１１は、本変形例Ｄ５に係る拡張ベクトル候補導出部３０３３５ｅの構成を示す概略図である。
　拡張ベクトル候補導出部３０３３５ｅは、変位ベクトル取得部３０３３６及びインターレイヤベクトル候補導出部３０３３７の他、変位ベクトルクリップ部（変位ベクトル制限部）３０３３８を含んで構成される。
　インターレイヤベクトル候補導出部３０３３７は、既に説明した通り、参照ピクチャが対象ピクチャと異なるレイヤ画像の場合には、変位ベクトル取得部３０３３６が導出した変位ベクトルを出力し、参照ピクチャが対象ピクチャと同じレイヤ画像の場合は、対象ピクチャと異なるレイヤ画像（ここでは、基準視点のレイヤ画像）を特定し、その特定したピクチャに対する変位ベクトルを、変位ベクトル取得部３０３３６から導出し、その変位ベクトルに対応する位置にあるレイヤ画像（基準視点のレイヤ画像）のベクトルを予測パラメータメモリ３０７から読み出す。
　本変形例Ｄ５に係る変位ベクトルクリップ部３０３３８は、インターレイヤベクトル候補導出部３０３３７において、対象ピクチャと異なるレイヤ画像の予測パラメータを予測パラメータメモリ３０７から読み出す際に、その参照領域を制限する。変位ベクトル取得部３０３３６から入力された変位ベクトルｄｖＬＸの値の範囲を予め定めた範囲内の値に制限する。変位ベクトルクリップ部３０３３８が変位ベクトルｄｖＬＸの値を制限する処理は、変位ベクトルクリップ部３０３７２と同様であっても良い。
　変位ベクトルクリップ部３０３３８は、例えば、以下の式により参照領域を制限する。
　dvLX[0]エ澆lip3(-DataRangeX,潺ataRangeX-1,濺vLX[0])
　dvLX[1]エ澆lip3(-DataRangeY,潺ataRangeY-1,濺vLX[1])ここで、dvLX[0]、dvLX[1]は、変位ベクトル取得部３０３３６から入力された変位ベクトル、dvLX[0]エ、dvLX[1]は、出力の変位ベクトル。DataRangeX、DataRangeYは制限範囲を示す所定の定数である。Clip3(x,,)はzをx以上、y以下に制限する関数である。
また変位ベクトルクリップ部３０３３８は、以下の式を用いて参照領域を制限しても良い。
　dvLX[0]=lip3(-DataRangeX,ataRangeX,vLX[0])
　dvLX[1]=lip3(-DataRangeY,ataRangeY,vLX[1])
　変位ベクトルクリップ部３０３３８は、値が制限された変位ベクトルｄｖＬＸの各々をインターレイヤベクトル候補導出部３０３３７に出力する。
　この場合、例えば、インターレイヤベクトル候補導出部３０３３７は、特定したピクチャについて復号対象ブロックを起点として、その起点から変位ベクトルクリップ部３０３３８により制限された変位ベクトルｄｖＬＸだけ、ずれた位置にあるブロックの位置を以下の式を用いて特定する。
　xRef炬P瀟PSW－1gt;>濺vLX[0]エgt;>
　yRef炸P瀟PSH－1gt;>濺vLX[1]エgt;>
　ここで、xRef、yRefは対応ブロックの座標、xP、yPは、各々復号対象ブロックの左上座標の座標、nPSW、nPSHは各々復号対象ブロックの幅と高さ、dvLX[0]エ、dvLX[1]は、変位ベクトル取得部３０３３８から入力された変位ベクトルのＸ成分とＹ成分である。また、xPPSW－1gt;>、yPPSH－1gt;>は、復号対象ブロックの起点として、復号対象ブロックの中心を用いることを示しているが、復号対象ブロックの左上や右下など他の位置を用いても良い。
　なお、変位ベクトルのＹ成分が０に制限されている場合には、インターレイヤベクトル候補導出部３０３３７は、以下の式を用いて、Ｙ成分に関わる変位ベクトルを０として対応ブロックの位置を特定してもよい。
　xRefPPSW－1gt;>vLX[0]+gt;>
　yRefPPSH－1gt;>
　この場合、対応ブロックのＸ成分は、復号対象ブロックを起点のＸ成分に変位ベクトルだけずれた位置に対応するが、対応ブロックのＹ成分は、復号対象ブロックを起点のＹ成分と一致する。
　これにより、インターレイヤベクトル候補導出部３０３３７が、対象レイヤ画像とは別のレイヤ画像（例えば、対象レイヤ画像が非基準視点画像を、参照レイヤ画像が基準視点画像）のうち既に処理されたブロックにおけるベクトルｍｖＬＸ等の予測パラメータを予測パラメータメモリ３０７から読み出す参照領域が制限される。参照領域は、復号対象ブロックを起点として変位ベクトルｄｖＬＸとして取りうる値の範囲に相当するためである。
　つまり、本変形例Ｄ５では、予測パラメータメモリ３０７における参照領域を小さくすることにより、小容量の記憶媒体でも予測パラメータメモリ３０７として使用することが許容され、処理の高速化を図ることができる。ここで、本変形例Ｄ５では、内部メモリ３０７６を備え、インターレイヤベクトル候補導出部３０３３７が内部メモリ３０７６を介して予測パラメータを読み出すようにしても良い。内部メモリ３０７６は、予測パラメータメモリ３０７よりも記憶容量が小さくアクセス速度が速い記憶媒体であっても良い。
　図１２は、本変形例Ｄ５において予測パラメータを読み出す構成の一例を示す概念図である。
　図１２の予測パラメータメモリ３０７を示す長方形の領域には、参照領域４と参照領域５が含まれる。参照領域５は、復号対象ピクチャ（対象レイヤ画像）の予測パラメータの参照領域、即ち、変位ベクトル取得部３０３３６が読み出そうとする予測パラメータが格納されている領域である。変位ベクトル取得部３０３３６が読み出す予測パラメータは、復号対象ピクチャと同じピクチャ上の復号対象ブロックから予め定めた範囲のブロックに係るものに限定されているため、参照領域５はそのブロックの個数に応じた範囲に制限されている。参照領域４は、復号対象とは別のレイヤ画像（例えば、ベースビューの画像）の予測パラメータの参照領域、即ち、インターレイヤベクトル候補導出部３０３３７が読み出そうとする予測パラメータが格納されている領域である。参照領域４は、復号対象ブロックを起点として変位ベクトルｄｖＬＸがとり得る値の範囲である。本変形例Ｄ５では、変位ベクトルクリップ部３０３３８により、変位ベクトルがとり得る値の範囲が制限されるため、これに応じて参照領域４が制限される。
　以上の画像復号装置３１ｅでは、対象ブロックの変位ベクトルを導出する変位ベクトル導出部（変位ベクトル取得部３０３３６）と、対象ブロックの予測ベクトルを、既に復号された予測パラメータ記憶部に備えるベクトルの対象ブロックからみて変位ベクトルだけずれた位置から導出する予測パラメータ復号部（拡張ベクトル候補導出部３０３３５ｅ）を備え、前記参照画像記憶部から、前記ベクトル導出部が導出したベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部（インター予測ピクチャ生成部３０９）を備え対象ブロックのベクトルが、異なるレイヤ間の予測であるインターレイヤ予測であるか否かを判定するリファレンスレイヤ判定部３０３７１を備え、リファレンスレイヤ判定部３０３７１がインターレイヤ予測と判定した場合に、前記変位ブロックのベクトルの少なくとも一方の成分を、所定の範囲に制限するベクトルクリップ手段（変位ベクトルクリップ部３０３３８）を備える。
　内部メモリ３０７６には、予測パラメータメモリ３０７の参照領域４に記憶された復号対象ピクチャとは別のレイヤ画像における動きベクトルｍｖＬＸ等の予測パラメータが一時的に記憶され、インターレイヤベクトル候補導出部３０３３７は、内部メモリ３０７６から予測パラメータを読み出す。参照領域４は、変位ベクトルｄｖＬＸが取りうる値の範囲が網羅されれば足りるため、本変形例Ｄ５において内部メモリ３０７６の記憶容量を小さくすることができ、画像復号装置を経済的に実現することができる。
　なお、本変形例Ｄ５に係る画像復号装置３１eは、画像復号装置３１ｃのマージ予測パラメータ導出部３０３６（図６参照）の代わりに以下に説明するマージ予測パラメータ導出部３０３６ｅを更に備える。
　図１３は、本変形例Ｄ５に係るマージ予測パラメータ導出部３０３６ｅの構成を示す概略図である。
　マージ予測パラメータ導出部３０３６ｅは、図示しないマージ候補導出部とマージ候補選択部を備える。マージ候補導出部は、複数のマージ候補から構成されるマージ候補リストを導出する。マージ候補選択部は、マージインデックスｍｅｒｇｅ＿ｉｄｘが示すマージ候補をマージ候補リストから選択する。マージ候補導出部は、図示しない基本マージ候補導出部及び拡張マージ候補導出部３０３６０を備える。基本マージ候補導出部は、復号対象ブロックから予め定められた範囲にある参照ブロックの予測パラメータをマージ候補として導出する。参照ブロックとは、例えば、復号対象ブロックの左下端、左上端、右上端の少なくともいずれかに接するブロックである。拡張マージ候補は、復号対象ピクチャ（対象レイヤ画像）とは別のレイヤの参照レイヤ画像の予測パラメータを用いて導出したマージ候補である。マージ予測パラメータ導出部３０３６ｅの備える拡張マージ候補導出部３０３６０は、変位ベクトル取得部３０３６１、変位ベクトルクリップ部３０３３８及びインターレイヤマージ候補導出部３０３６３を含んで構成される。
　変位ベクトル取得部３０３６１には、対象ブロックに隣接するブロックから、変位ベクトルｄｖＬＸを予測パラメータメモリ３０７から読み出す。変位ベクトル取得部３０３６１は、読み出した変位ベクトルｄｖＬＸを変位ベクトルクリップ部３０３３８に出力する。
　変位ベクトルクリップ部３０３３８は、変位ベクトル取得部３０３６１から入力された変位ベクトルｄｖＬＸのそれぞれの値の範囲を予め定めた範囲内の値に制限する。変位ベクトルクリップ部３０３３８が変位ベクトルｄｖＬＸの値を制限する処理については、上述の説明を援用する。
　インタービューレイヤ候補導出部３０３６３は、復号対象ピクチャのレイヤ画像とは別のレイヤ画像（例えばベースビュー）に対応する参照ピクチャインデックスｒｅｆＩｄｘを特定する。
　インターレイヤマージ候補導出部３０３６３は、読み出した参照ピクチャインデックスｒｅｆＩｄｘに係るレイヤ画像（例えば、ベースビュー）のピクチャを特定する。インターレイヤマージ候補導出部３０３６３は、特定したピクチャについて復号対象ブロックを起点として、その起点から変位ベクトルクリップ部３０３３８から入力された変位ベクトルｄｖＬＸだけ、それぞれずれた位置にある対応ブロックを特定する。インターレイヤマージ候補導出部３０３６３は、対応ブロックに係る予測パラメータを読み出し、読み出した予測パラメータを予測パラメータメモリ３０７に記憶し、予測ピクチャ生成部３０８に出力する。
　これにより、インターレイヤマージ候補導出部３０３６３が、予測パラメータを読み出すブロックの範囲であって、復号対象ブロックを起点とした変位ベクトルｄｖＬＸとして取りうる値の範囲である参照領域が制限される。
　つまり、本変形例Ｄ５では、復号対象ピクチャとは別のレイヤ画像における予測パラメータメモリ３０７における参照領域を小さくすることにより、小容量の記憶媒体でも予測パラメータメモリ３０７として使用することが許容され、処理の高速化を図ることができる。また、本変形例Ｄ５では、内部メモリ３０７２（図示せず）を備え、インターレイヤマージ候補導出部３０３６３が内部メモリ３０７２を介して予測パラメータを読み出すようにしても良い。内部メモリ３０７２は、予測パラメータメモリ３０７よりも記憶容量が小さくアクセス速度が速い記憶媒体であっても良い。これにより、画像復号装置を経済的に実現することができる。
　また、本変形例Ｄ５の拡張ベクトル候補導出部３０３３５ｅおよびインターレイヤマージ候補導出部３０３６３においては、図２３を用いて説明したように、復号対象ピクチャとは別のレイヤ画像（例えばベースビュー）の復号と、復号対象ピクチャの復号を並列で動作させる場合、復号対象ピクチャから参照される復号対象ピクチャとは別のレイヤ画像の予測パラメータメモリ３０７における予測パラメータの参照領域が制限されるため、復号対象ピクチャとは別のレイヤ画像（例えばベースビュー）が完全に復号される前に（別のレイヤ画像の予測パラメータメモリ３０７における予測パラメータが全て参照できない場合にも）、復号対象ピクチャの復号を行うことができる。
（変形例Ｄ６）
　次に、本実施形態に係る他の変形例Ｄ６について説明する。
　本変形例Ｄ６に係る画像復号装置３１ｆは、画像復号装置３１（図１、図２）のエントロピー復号部３０１（図３）の代わりにエントロピー復号部３０１ｆを備える。本変形例Ｄ６に係る画像復号装置３１ｆの構成の大要は、エントロピー復号部３０１ｆを除いて画像復号装置３１の構成と同じである。したがって、同一の構成については同一の符号を付して上述の説明を援用する。
　本変形例Ｄ６について説明する前に、前述のエントロピー復号部３０１の構成について説明する。
　図２４は、前述のエントロピー復号部３０１の構成を示すブロック図である。
　エントロピー復号部３０１は、算術符号復号部３０１１及びベクトル差分シンタックス復号部３０１３を含んで構成される。
　算術符号復号部３０１１は、符号化ストリームＴｅに含まれる各ビットを、コンテキスト変数ＤＶを参照して復号する。算術符号復号部３０１１は、コンテキスト記録更新部３０１１１及びビット復号部３０１１２を含んで構成される。
　コンテキスト記録更新部３０１１１は、各コンテキストインデックスctxIdxIncに対応付けて管理されるコンテキスト変数ＣＶを記録及び更新する。ここで、コンテキスト変数ＣＶには、（１）発生確率が高い優勢シンボルＭＰＳ（mostrobableymbol）と、（２）その優勢シンボルＭＰＳの発生確率を指定する確率状態インデックスpStateIdxとが含まれている。
　コンテキスト記録更新部３０１１１は、逆量子化・逆ＤＣＴ３１１で得られた変換係数に基づいて定められたコンテキストインデックスctxIdxInc及びビット復号部３０１１２によって復号されたＢｉｎの値を参照することによってコンテキスト変数ＣＶを更新すると共に、更新されたコンテキスト変数ＣＶを次回更新されるまで記録する。Ｂｉｎとは、その情報を構成するビット列の各ビットを示す。なお、優勢シンボルＭＰＳの値は０か１である。また、優勢シンボルＭＰＳと確率状態インデックスpStateIdxは、ビット復号部３０１１２がＢｉｎを１つ復号する毎に更新される。
　また、コンテキストインデックスctxIdxIncは、コンテキストを直接指定する値であってもよいし、ベース値からの増分値であってもよい。
　ビット復号部３０１１２は、コンテキスト記録更新部３０１１１に記録されているコンテキスト変数ＣＶを参照し、差分ベクトルに係る符号化ストリームＴｅに含まれる各ビットＢｉｎを復号する。ビット復号部３０１１２は、復号においてＣＡＢＡＣ（Ｃｏｎｔｅｘｔ－ｂａｓｅｄ　Ａｄａｐｔｉｖｅ　Ｂｉｎａｒｙ　Ａｒｉｔｈｍｅｔｉｃ　Ｃｏｄｉｎｇ、コンテキスト適応算術符号化）に対応する復号方式を用いても良い。ビット復号部３０１１２は、復号して得られたＢｉｎの値をベクトル差分シンタックス復号部３０１３に供給する。また、復号して得られたＢｉｎの値は、コンテキスト記録更新部３０１１１にも供給され、コンテキスト変数ＣＶを更新するために参照される。
　ベクトル差分シンタックス復号部３０１３は、ベクトル差分を構成するシンタックス要素であるabs_mvd_greater0_flag[XY]、abs_mvd_greater1_flag[XY]、abs_mvd_minus2[XY]、mvd_sign_flagの各Ｂｉｎを復号するためのコンテキストインデックスctxIdxIncを導出し、算術符号復号部３０１１に出力する。算術符号復号部３０１１では、これらのシンタックス要素が復号される。abs_mvd_greater0_flag[XY]、abs_mvd_greater1_flag[XY]、abs_mvd_minus2[XY]、mvd_sign_flag[XY]は各々、差分ベクトルの絶対値が０を超えるか否かを示すフラグ（差分ベクトルが０であるか否かを示すフラグに相当）、差分ベクトルの絶対値が１を超えるかを示すフラグ、差分ベクトルの絶対値から２を引いた値を示すフラグ、mvd_sign_mvdは、差分ベクトルの符号を示すフラグである。なお、添え字のXYは、X成分である場合に0、Y成分である場合に1となる値をとる変数である。
　ベクトル差分シンタックス復号部３０１３は、復号されたリファレンスレイヤ情報reference_layer_infoに基づいてコンテキストインデックスctxIdxIncを導出する。ここで、ベクトル差分シンタックス復号部３０１３には、reference_layer_infoとコンテキストインデックスctxIdxIncを対応付けた導出テーブル情報を記憶しておき、これをコンテキストインデックスctxIdxIncの導出に用いても良い。次に、導出テーブル情報の例について説明する。
　図２６は、導出テーブル情報の一例を示す図である。
　図２６（ａ）は、シンタックス要素として（Ｓｙｎｔａｘ　ｅｌｅｍｅｎｔ）差分ベクトルの絶対値が０を超えるか否かを示すabs_mvd_greater0_flag[]の各Ｂｉｎのコンテキストインデックスの値を示す。図２６（ａ）は、ＢｉｎＩｄｘ＝０すなわち１ビット目のコンテキストインデックスが常に０であることを示す。また、abs_mvd_greater0_flag[XY]#12398;コンテキストインデックスctxIdxIncは、その他のビットが該当する値を有しない１ビットの情報である。
　図２６（ｂ）には、シンタックス要素としてabs_mvd_greater0_flag[XY]について、リファレンスレイヤ情報reference_layer_info、Ｘ成分、Ｙ成分毎のコンテキストインデックスctxIdxIncを示す。図２６（ｂ）に示す例では、リファレンスレイヤ情報reference_layer_info、Ｘ成分、Ｙ成分に関わらずコンテキストインデックスctxIdxIncの値は常に０である。この例では、シンタックス要素abs_mvd_greater0_flag[XY]は、シンタックス要素の対応するベクトルの指す参照ピクチャのレイヤ（リファレンスレイヤ）がベースレイヤ（ベースビュー）であるかインターレイヤ（インタービュー）であるかに、もしくは対象となる差分ベクトルのシンタックス要素がＸ成分であるかＹ成分であるかに依存せず、同じコンテキストが復号に用いられることを示す。
　上述のＣＡＢＡＣでは、条件に応じてＢｉｎが１になる確率（又は０になる確率）が異なる場合に条件付き確率を有効に利用し符号量を低減するためにコンテキスト変数ＣＶが使用される。この例では、差分ベクトルがＸ成分であるか、Ｙ成分であるかに依存せずにコンテキストを導出しているが、これはこの成分により、差分ベクトルのシンタックス要素の値が０であるかの確率が大きく異なることはないことが仮定されている。
　なお、図２６に示す例に限らず、後述する例においても対象とするシンタックス要素は、abs_mvd_greater0_flag[XY]に限られず、他のシンタックス要素についてもabs_mvd_greater1_flag[XY]に同様にリファレンスレイヤ情報reference_layer_infoとコンテキストインデックスctxIdxIncが対応付けられていても良い。
　次に、本変形例Ｄ６に係るエントロピー復号部３０１ｆの構成について説明する。
　図２５は、本変形例Ｄ６に係るエントロピー復号部３０１ｆの構成を示すブロック図である。
　変形例Ｄ６のエントロピー復号部３０１ｆは、図２５に示すように、エントロピー復号部３０１（図２４）において、リファレンスインデックス復号部３０１２、リファレンスレイヤ判定部３０３７１を備える。また、ベクトル差分シンタックス復号部３０１３の代わりにベクトル差分シンタックス復号部３０１３ｆを備える。リファレンスインデックス復号部３０１２は、符号化ストリームＴｅから参照ピクチャインデックスｒｅｆＩｄｘＬＸを復号し、リファレンスレイヤ判定部３０３７１に出力する。リファレンスレイヤ判定部３０３７１は既に説明したように、参照ピクチャインデックスｒｅｆＩｄｘＬＸに基づいてリファレンスレイヤ情報reference_layer_infoを定める。
　ベクトル差分シンタックス復号部３０１３ｆは、リファレンスレイヤ判定部３０３７１が定めたリファレンスレイヤ情報reference_layer_infoに基づいて、次に説明する導出テーブルのいずれかを用いてコンテキストインデックスctxIdxIncを定める。
　図２７は、導出テーブル情報の他の例を示す図である。
　図２７（ａ）は、シンタックス要素abs_mvd_greater0_flag[]について与えられるコンテキストインデックスctxIdxIncの値の範囲として０又は１をとることを示す。
　図２７（ｂ）は、シンタックス要素abs_mvd_greater0_flag[XY]についてのコンテキストインデックスctxIdxIncを示す導出テーブル情報である。この例も、図２６（ｂ）と同様、リファレンスレイヤ情報reference_layer_infoと、復号対象のシンタックス成分abs_mvd_greater0_flag[XY]がＸ成分であるかＹ成分であるかを区別するＸＹの値、を条件として、コンテキストインデックスctxIdxIncを定める方法を示す。この例では、リファレンスレイヤ情報reference_layer_infoが０すなわち同一レイヤ予測（ｓａｍｅ　ｌａｙｅｒ　ｐｒｅｄｉｃｔｉｏｎ、参照ピクチャが対象ピクチャと同一のレイヤもしくは同一の視点画像、差分ベクトルが動きベクトル）の場合には、差分ベクトルのシンタックス要素のＸ成分とＹ成分の両者に対して、同じコンテキストインデックス(ctxIdx=0)が対応付けられている。リファレンスレイヤ情報reference_layer_infoが１すなわちインターレイヤ予測（ｉｎｔｅｒ　ｌａｙｅｒ　ｐｒｅｄｉｃｔｉｏｎ、参照ピクチャが対象ピクチャと異なるレイヤもしくは異なる視点画像、差分ベクトルが変位ベクトル）の場合には、差分ベクトルのシンタックス要素のＸ成分とＹ成分にそれぞれ異なる値をとるコンテキストインデックスctxIdxが対応付けられている。
　図２７（ｂ）の例では、変位ベクトルのＸ成分には動きベクトルと同じコンテキストになるようctxIdx=０を用い、変位ベクトルのＹ成分には、それとは異なるコンテキストになるようctxIdx=1を用いる。
　一般に、参照ピクチャが、対象ピクチャとは異なる視点画像である場合（インターレイヤ予測のうちインタービュー予測の場合）、参照ピクチャとの変位を示す変位ベクトルのＹ成分は０に集中する。この場合、変位ベクトルの差分ベクトルのＹ成分もまた０に集中する傾向がある。すなわち、インターレイヤ予測の場合に差分ベクトルの絶対値が０を超えるか否かを示すフラグabs_mvd_greater0_flag[XY]のＹ成分abs_mvd_greater0_flag[1]が１である確率は、それ以外の場合、すなわち、同一レイヤ予測（動きベクトル）の場合に差分ベクトルの絶対値が０を超えるか否かを示すフラグabs_mvd_greater0_flag[XY]および、インターレイヤ予測（変位ベクトル）場合に差分ベクトルのＸ成分が０であるか否かを示すフラグabs_mvd_greater0_flag[0]が１である確率よりも著しく低い。このように参照ピクチャおよびベクトル成分により、Ｂｉｎの値の発生確率が大きく異なることを考慮し、同一レイヤ予測およびインターレイヤ予測の差分ベクトルのＸ成分と、インターレイヤ予測の差分ベクトルのＹ成分のコンテキストに異なるコンテキストを割り当てることにより、差分ベクトルの符号量を低減する効果が得られる。
　図２８は、導出テーブル情報の他の例を示す図である。
　図２８（ａ）は、シンタックス要素abs_mvd_greater0_flag[]について与えられるコンテキストインデックスctxIdxIncの値の範囲として０又は１をとることを示す。
　図２８（ｂ）は、シンタックス要素abs_mvd_greater0_flag[XY]についてのコンテキストインデックスctxIdxIncを示す導出テーブル情報である。
　この例では、リファレンスレイヤ情報reference_layer_infoが０の場合と、リファレンスレイヤ情報reference_layer_infoが１の場合とで異なるコンテキストインデックスctxIdxIncが対応付けられている。具体的には、同一レイヤ予測の場合（動きベクトルの場合）、Ｘ成分とＹ成分の両者に同じコンテキスト（ctxIdxInc=0）が対応付けられ、インターレイヤ予測の場合（変位ベクトルの場合）には、Ｘ成分とＹ成分の両者に、同一レイヤ予測とは別のコンテキスト（ctxIdxInc=1）が対応付けられる。
　一般に、参照ピクチャが、対象ピクチャと同じ視点画像である他の画像（例えば、空間スケーラブルにおける低解像度ピクチャ）である場合、参照ピクチャとの変位を示す変位ベクトルのＸ成分とＹ成分は共に０に集中する。この場合、変位ベクトルの差分ベクトルもまた０に集中する傾向がある。これは、インターレイヤ予測の場合に差分ベクトルの絶対値が０を超えるか否かを示すフラグabs_mvd_greater0_flag[XY]が１である確率は、それ以外の場合の同一レイヤ予測（動きベクトル）の場合に差分ベクトルの絶対値が０を超えるか否かを示すフラグabs_mvd_greater0_flag[XY]および、インタービュー（変位ベクトル）場合に差分ベクトルのＸ成分が０であるか否かを示すフラグabs_mvd_greater0_flag[0]が１である確率よりも著しく低いことを意味する。このように、条件により異なる発生確率が異なることを考慮し、同一レイヤ予測の差分ベクトル（動きベクトル）と、インターレイヤ予測の差分ベクトル（変位ベクトル、変位ベクトル）にコンテキストに異なるコンテキストを割り当てることにより、差分ベクトルの符号量を低減する効果が得られる。
　図２９は、導出テーブル情報の他の例を示す図である。
　図２９（ａ）は、シンタックス要素abs_mvd_greater0_flag[]について与えられるコンテキストインデックスctxIdxIncの値の範囲として０又は１をとることを示す。
　図２９（ｂ）は、シンタックス要素abs_mvd_greater0_flag[XY]についてのコンテキストインデックスctxIdxIncを示す導出テーブル情報である。
　この例では、リファレンスレイヤ情報reference_layer_infoが０の場合は、図２７、図２８と同じようにフラグabs_mvd_greater0_flag[XY]の差分ベクトルのＸ成分、Ｙ成分に共通して、同じコンテキストインデックス（ctxIdxInc=0）を割り当てる。リファレンスレイヤ情報が１の場合には、インターレイヤ予測が、異なる視点画像の間の予測である（ｉｎｔｅｒ＿ｖｉｅｗ）か、同じ視点画像の間の予測である（ｎｏｎ　ｉｎｔｅｒ＿ｖｉｅｗ）か、によってコンテキストインデックスctxIdxIncを切り替える。異なる視点画像の間の予測である場合には、図２７と同じく、フラグabs_mvd_greater0_flag[XY]の差分ベクトルのＹ成分に、Ｘ成分とは異なるコンテキストインデックス（ctxIdxInc=1）を割り当てる。同じ視点画像の間の予測である場合には、図２８と同じく、フラグabs_mvd_greater0_flag[XY]の差分ベクトルのＸ成分およびＹ成分に、同一レイヤ予測の場合とは異なるコンテキストインデックス（ctxIdxInc=1）を割り当てる。
　以上により、変位ベクトルが異なる視点画像間のベクトルの変位ベクトルである場合には、差分ベクトルのＹ成分が０になる確率が高く、変位ベクトルが同じ視点画像間のベクトルである場合には、差分ベクトルのＸ成分とＹ成分が０になる確率が高いことを利用して、動きベクトルの場合と異なるコンテキストを割り当てることにより、差分ベクトルの符号量を低減する効果が得られる。
　図３０は、導出テーブル情報の他の例を示す図である。
　図３０（ａ）は、シンタックス要素abs_mvd_greater0_flag[]について与えられるコンテキストインデックスctxIdxIncの値の範囲として０から２のうちいずれかの値をとることを示す。すなわち３個のコンテキストが復号において用いられる。
　図３０（ｂ）は、シンタックス要素abs_mvd_greater0_flag[XY]についてのコンテキストインデックスctxIdxIncを示す導出テーブル情報である。
　この例では、リファレンスレイヤ情報reference_layer_infoが０、同一レイヤ予測の場合にはabs_mvd_greater0_flag[XY]のＸ成分とＹ成分に同じコンテキストインデックスctxIdxIncが対応付けられる（ctxIdxInc=0）。リファレンスレイヤ情報reference_layer_infoが１、インターレイヤ予測の場合には、フラグabs_mvd_greater0_flag[]のＸ成分とＹ成分に、同一レイヤ予測の場合とは異なるコンテキストかつ、Ｘ成分とＹ成分に異なるコンテキストインデックスctxIdxIncが対応付けられる。ここではＸ成分にctxIdxInc=1、Ｙ成分の場合、ctxIdxInc=2が対応付けられる。
　以上により、変位ベクトルが異なる視点画像間のベクトルの変位ベクトルである場合であるか、変位ベクトルが同じ視点画像間のベクトルであるかによらず、同じコンテキストインデックス導出方法を用いながら、変位ベクトルと動きベクトルの条件に応じて異なるコンテキストを割り当てることにより、差分ベクトルの符号量を低減する効果が得られる。
　図３１は、導出テーブル情報の他の例を示す図である。
　図３１（ａ）は、シンタックス要素abs_mvd_greater0_flag[]について与えられるコンテキストインデックスctxIdxIncの値の範囲として０から２のうちいずれかの値をとることを示す。
　図３１（ｂ）は、シンタックス要素abs_mvd_greater0_flag[XY]についてのコンテキストインデックスctxIdxIncを示す導出テーブル情報である。
　この例では、リファレンスレイヤ情報reference_layer_infoが１、つまりインターレイヤ予測の場合には、フラグabs_mvd_greater0_flag[]のＸ成分とＹ成分に異なるコンテキストインデックスctxIdxIncであって、同一レイヤ予測のＹ成分と、インターレイヤ予測のＸ成分に同じコンテキストインデックスctxIdxIncが対応付けられる。具体的には、リファレンスレイヤ情報reference_layer_infoが０、つまり同一レイヤ予測の場合には、差分ベクトルのＸ成分にctxIdxInc=0、Ｙ成分にctxIdxInc=1が対応付けられる。リファレンスレイヤ情報reference_layer_infoが１、つまりインターレイヤ予測の場合には、差分ベクトルのＸ成分にctxIdxInc=1、Ｙ成分にctxIdxInc=2が対応付けられる。
　これは、インターレイヤ予測の差分ベクトルのＹ成分は０になる確率が高く、同一レイヤ予測の差分ベクトルのＸ成分は０になる確率が相対的に低く、それ以外のインターレイヤ予測の差分ベクトルのＸ成分と同一レイヤ予測の差分ベクトルのＹ成分は同程度の確率で０になることを利用している。これにより、差分ベクトルの符号量を低減する効果が得られる。
（変形例Ｄ７）
　次に、本実施形態に係る他の変形例Ｄ７について説明する。
　本変形例Ｄ７に係る画像復号装置３１ｇ（図示せず）は、画像復号装置３１ｆのエントロピー復号部３０１ｆの代わりにエントロピー復号部３０１ｇを備える。本変形例Ｄ７に係る画像復号装置３１ｇの構成の大要は、エントロピー復号部３０１ｇを除いて画像復号装置３１ｆの構成と同じである。したがって、同一の構成については同一の符号を付して上述の説明を援用する。
　図３２は、本変形例Ｄ７に係るエントロピー復号部３０１ｇの構成を示すブロック図である。
　本変形例Ｄ７のエントロピー復号部３０１ｇは、図３２に示すように、エントロピー復号部３０１（図２４参照）の構成の他、レイヤＩＤ復号部３０１４、ターゲットレイヤ判定部３０１７１を備え、ベクトル差分シンタックス復号部３０１３の代わりに、ベクトル差分シンタックス復号部３０１３ｇを備える。レイヤＩＤ復号部３０１４は符号化ストリームＴｅに含まれているＮＡＬ（Ｎｅｔｗｏｒｋ　Ａｂｓｔｒａｃｔｉｏｎ　Ｌａｙｅｒ、ネットワーク抽象レイヤ）ユニットヘッダからレイヤＩＤを復号する。ＮＡＬユニットヘッダは、符号化ストリームＴｅの１つの構成単位であるＮＡＬユニットのそれぞれの先頭に含まれる情報である。ＮＡＬユニットヘッダには、上述のレイヤＩＤをはじめとする復号パラメータが含まれている。
　ターゲットレイヤ判定部３０１７１は、復号したレイヤＩＤに基づいて、復号対象ピクチャが、ベースレイヤ画像であるか、非ベースレイヤ画像であるかを識別しターゲットレイヤ情報target_layer_infoを導出する。ターゲットレイヤ情報target_layer_infoがとる値は、例えば、復号対象ピクチャがベースレイヤであれば０、非ベースレイヤ画像であれば１である。なお、レイヤＩＤ復号部３０１４は、ベースレイヤ画像であるか非ベースレイヤ画像の識別するのではなく、ベースビュー画像であるか非ベースビュー画像を識別しても良い。この場合、レイヤＩＤ復号部３０１４は、復号対象ピクチャのビューＩＤが０である場合に復号対象ピクチャのビューがベースビューであり、０以外の場合に非ベースビューと判定する。ここでは、ターゲットレイヤ情報target_layer_infoがとる値は、例えば、そのビューがベースビューであれば０、非ベースビューであれば１である。なお、ビューＩＤは、レイヤＩＤとビューＩＤの対応関係を示す予め記憶したテーブルを用いてレイヤＩＤから導出する。ターゲットレイヤ判定部３０１７１は、この対応関係を示すテーブルを、符号化ストリームに含まれるＶＰＳから抽出する。
　変形例Ｄ７のベクトル差分シンタックス復号部３０１３ｇは、定めたターゲットレイヤ情報target_layer_infoから図３３に示す導出テーブルを用いてコンテキストインデックスctxIdxIncを導出する。
　図３３は、本変形例Ｄ７に係る導出テーブル情報の一例を示す図である。
　図３３（ａ）は、シンタックス要素abs_mvd_greater0_flag[]について与えられるコンテキストインデックスctxIdxIncの値の範囲として０又は１の値をとることを示す。
　図３３（ｂ）は、シンタックス要素abs_mvd_greater0_flag[XY]についてのコンテキストインデックスctxIdxIncを示す導出テーブル情報である。
　この例では、ターゲットレイヤ情報target_layer_infoが０、ベースレイヤ（ｂａｓｅｌａｙｅｒ、もしくはベースビュー）の場合にはシンタックス要素abs_mvd_greater0_flag[]のＸ成分とＹ成分に同じコンテキストを用い、非ベースレイヤ（もしくは非ベースビュー）の場合には、フラグabs_mvd_greater0_flag[]のＸ成分とＹ成分に異なるコンテキストインデックスctxIdxIncが対応付けられる。ターゲットレイヤ情報target_layer_infoが１、非ベースレイヤ（ｉｎｔｅｒ　ｌａｙｅｒ、非ベースビュー）の場合には、Ｘ成分についてコンテキストインデックスctxIdxInc=0が対応付けられ、Ｙ成分についてコンテキストインデックスctxIdxInc=1が対応付けられている。これにより、ベースレイヤ（ベースビュー）の差分ベクトルのＸ成分にはこれと同じコンテキストになるようコンテキストインデックス０を用いられ、非ベースレイヤの差分ベクトルのＹ成分には、それとは異なるコンテキストになるようコンテキストインデックス１が用いられる。
　つまり、復号対象ピクチャがベースレイヤの場合には、原則として参照ピクチャとして同じレイヤのピクチャのみを用いるため、ベースレイヤ画像の復号で用いられるベクトルは、同一レイヤで予測されたベクトルである動きベクトルである。非ベースレイヤでは参照ピクチャとして同じレイヤのピクチャと異なるレイヤのピクチャも用いるため、復号で用いられるベクトルは、同一レイヤ予測のベクトルである動きベクトルである場合と、インターレイヤ予測のベクトルである変位ベクトルである場合とがある。インターレイヤ予測のベクトルは変位ベクトルになることがあり、この場合において差分ベクトルの絶対値が０を超えるか否かを示すフラグ（シンタックス要素abs_mvd_greater0_flag[XY]）のＸ成分とＹ成分にそれぞれ異なるコンテキストを割り当てることにより、差分ベクトルの符号量を低減する効果が得られる。上述の変形例Ｄ６では参照ピクチャインデックスを用いた参照レイヤの識別を必要とするが、本変形例Ｄ７は、参照レイヤの識別を必要とせず対象レイヤを識別することで実現できる。対象レイヤは参照レイヤと異なり、通例、予測ユニットによらず固定である（参照ピクチャインデックスを必要としない）ため参照レイヤの識別が可能である。そのため、本変形例Ｄ７では、上述の変形例Ｄ６に比べ、容易に復号処理が容易になる。
（変形例Ｄ８）
　次に、本実施形態に係る他の変形例Ｄ８について説明する。変形例Ｄ８は、画像復号装置３１におけるAMVP予測パラメータ導出部３０３２およびマージ予測パラメータ導出部３０３６において、予測パラメータメモリ３０７に格納される予測パラメータ（ベクトル、参照リストインデックス）を参照する際に、参照座標を制限することにより、予測パラメータメモリ３０７に必要なメモリを低減する。より具体的には、復号対象ピクチャのレイヤ画像と異なるレイヤのレイヤ画像の既に処理済みのブロックの予測パラメータを参照する際に、その参照画像を制限する。
　本変形例Ｄ８に係る画像復号装置３２ｈは、インター予測パラメータ復号部３０３（図３）において、AMVP予測パラメータ導出部３０３２の代わりにAMVP予測パラメータ導出部３０３２ｈを備える。
　図３６は、本変形例Ｄ８に係るAMVP予測パラメータ導出部３０３２ｈと、予測パラメータメモリ３０７の構成を示すブロック図である。
　AMVP予測パラメータ導出部３０３２ｈは、既に説明したようにベクトル候補導出部３０３３と、予測ベクトル選択部３０３４を備える。さらに、AMVP予測パラメータ導出部３０３２ｈは、予測パラメータ参照部３０３９を備える。予測パラメータ参照部３０３９は、空間予測参照アドレス変換部３０３９１、時間予測参照アドレス変換部３０３９２及びインターレイヤ参照アドレス変換部３０３９３（レイヤ間参照アドレス変換部）を備える。
AMVP予測パラメータ導出部３０３２ｈの備えるベクトル候補導出部３０３３は、既に復号済みの予測ユニットＰＵの予測パラメータを参照し、ベクトル候補を導出する。
　この際、復号対象ブロック、すなわち対象ＣＴＢ内の予測ユニットの予測パラメータ（対象CTB予測パラメータ）、対象ＣＴＢの左に位置するＣＴＢの予測ユニットの予測パラメータ（左CTBコラム予測パラメータ）、対象ＣＴＢの上に位置するＣＴＢの予測ユニットの予測パラメータ（上CTBライン予測パラメータ）を復号順（例えば、ラスタスキャンの順序）で前のピクチャの予測ユニットの予測パラメータ、対象レイヤとは別のレイヤの予測ユニットの予測パラメータ（インターレイヤー予測パラメータ）を参照する。予測パラメータ参照部３０３９は、これらを予測パラメータメモリ３０７が備える、対象CTB予測パラメータメモリ３０７１、左CTBコラム予測パラメータメモリ３０７２、上CTBライン予測パラメータメモリ３０７３、時間予測パラメータメモリ３０７４、インターレイヤ予測パラメータメモリ３０７５から各々参照する。このとき、空間予測参照アドレス変換部３０３９１、時間予測参照アドレス変換部３０３９２は、参照先の座標の変換を行う。インターレイヤ参照アドレス変換部３０３９３の動作については後述する。
　なお、AMVP予測パラメータ導出部３０３２ｈにおいてベクトル候補導出部３０３３がベクトル候補を導出する際、復号対象ピクチャのレイヤとは異なるレイヤのレイヤ画像の予測パラメータを参照する場合における処理は、マージ候補が拡張ベクトル候補である場合に、インターレイヤベクトル候補導出部３０３３７においてベクトル候補を導出する場合の処理と同様であってもよい（図１１参照）である。また、マージ候補導出部３０３６４においてマージ候補を導出する際、復号対象ピクチャのレイヤとは異なるレイヤのレイヤ画像の予測パラメータを参照する場合における処理は、マージ候補が拡張マージ候補である場合に、インターレイヤマージ候補導出部３０３６３においてマージ候補を導出する場合の処理と同様であってもよい（図１３参照）である。
　図３７は、座標変換に用いられる数式の例を示す図である。
　図３７（ａ）の式に示すように、空間予測参照アドレス変換部３０３９１は、参照する予測ユニットが、対象予測ユニットのピクチャとピクチャ（同一レイヤかつ同一表示時刻のピクチャ）に存在する場合において、参照する座標（ｘＰ―１、ｙＰ）が、対象ＣＴＢより上に位置する場合（Ｗｈｅｎ　ｙＰ－１　ｉｓ　ｌｅｓｓ　ｔｈａｎ　（（ｙＣ＞＞Ｌｏｇ２ＣｔｂＳｉｚｅＹ）＜＜Ｌｏｇ２ＣｔｂＳｉｚｅＹ））には、以下の式により、Ｘ座標ｘＰをｘＰ#12395;変換する。
　xP犇xP>>3)<<3)+((xP>>3)&1)*7この場合、ｘＰが０～７の場合０になり、ｘＰが８～１５の場合１５となるような変換がなされる。予測パラメータ参照部３０３９は、変換後の座標を用いて予測パラメータを参照する。
　図３７（ｂ）の式に示すように、時間予測参照アドレス変換部３０３９２は、ベクトル候補導出部３０３３におけるベクトル候補導出において、参照する予測ユニットが、対象予測ユニットと同じレイヤの異なる表示時刻のピクチャに存在する場合において、参照する座標（ｘＰ、ｙＰ）を（ｘＰエ、ｙＰエ）に変換する。
　xPエxP>>4)<<4
　yPyP>>4)<<4予測パラメータ参照部３０３９は、変換された後の座標を用いて参照する。上記変換により、参照される座標はＸ座標、Ｙ座標ともに１６の倍数となる。
　次に上述の座標変換を行って、予測パラメータメモリ３０７上で予測パラメータが参照される領域の例について説明する。
　図３８は、座標変換により参照される領域の例を示す概念図である。
　図３８は、上段にレイヤ１のピクチャに係る参照領域を、下段にレイヤ０のピクチャに係る参照領域を示す。左右は復号順を示す。
　図３８は、現在の時刻（POC_curr）における対象予測ユニットのピクチャ（レイヤ１（POC_curr））、既に復号された予測ユニットであって、過去の時刻（POC_ref）における対象ピクチャのレイヤと同一レイヤ（レイヤ１）の予測ユニットのピクチャ（レイヤ０(POC_ref)）及び現在の時刻（POC_curr）における対象予測ユニットの異なるレイヤ（レイヤ０）のピクチャ（レイヤ０（POC_curr））を示す。この例では、２つのピクチャ（レイヤ０(POC_ref)、（レイヤ０（POC_curr））の領域が参照されていることが示されている。
　図３８に示すように、対象ＣＴＢより上のＣＴＢの予測パラメータ参照では、空間予測参照アドレス変換部３０３９１で参照アドレスが変換（制限）されることにより、８#65300;単位で予測パラメータが参照される。対象ピクチャのレイヤと同一レイヤ（レイヤ１）の対象ピクチャと異なる表示時刻の予測ユニットの予測パラメータは、時間予測参照アドレス変換部３０３９２により１６ラ１６単位で参照される。それに対し、対象ピクチャと異なるレイヤの予測パラメータは、最小ＰＵ単位（８ラ４、４ラ８）で参照される。この場合、インターレイヤ予測パラメータメモリ３０７７では最小ＰＵ単位の最大公約数である４ラ４単位で予測パラメータを格納する必要があり、非常に大きな予測パラメータメモリを必要とする。
　図３６に戻り、予測パラメータ参照部３０３９は、後述するマージ候補導出部３０３６４においてマージ候補を導出する際、予測パラメータメモリ３９１に記憶された予測パラメータを参照する。
　ここで、インターレイヤ参照アドレス変換部３０３９３は、AMVP予測パラメータ導出部３０３２ｈにおいてベクトル候補を導出する際、および、マージ候補導出部３０３６１においてマージ候補を導出する際、復号対象ピクチャのレイヤとは異なるレイヤのレイヤ画像の予測パラメータを参照する際に、その異なるレイヤのレイヤ画像の予測パラメータを記憶する予測パラメータメモリ３０７内のインターレイヤ予測パラメータメモリ３０７５を参照する際に、参照するアドレスを変換する。
　次に、本変形例に係るマージ予測パラメータ導出部３０３６ｈと、予測パラメータメモリ３０７の構成を示すブロック図である。
　図３９は、本変形例Ｄ８に係るマージ予測パラメータ導出部３０３６ｈと、予測パラメータメモリ３０７の構成を示すブロック図である。
　マージ予測パラメータ導出部３０３６ｈは、マージ候補導出部３０３６４と、マージ候補選択部３０３６５を備える。さらに、マージ予測パラメータ導出部３０３６ｈは、予測パラメータ参照部３０３９（図３６参照）を備える。
　マージ候補導出部３０３６４は、予測パラメータ参照部３０３９が参照した予測パラメータをマージ候補として導出し、導出したマージ候補をマージ候補選択部３０３６５に出力する。
　マージ候補選択部３０３６５は、導出したマージ候補のうち、入力されたマージインデックスｍｅｒｇｅ＿ｉｄｘが示すマージ候補として予測パラメータ（例えば、ベクトルｍｖＬＸと参照ピクチャインデックスｒｅｆＩｄｘＬＸ）を選択する。マージ候補選択部３０３６５は選択したマージ候補を出力する。
　図４０は、座標変換に用いられる数式の他の例を示す図である。
　図４０（ａ）の式は、インターレイヤ参照アドレス変換部３０３９３が、ベクトル候補導出部３０３３におけるベクトル候補導出において、リファレンスレイヤ情報reference_layer_infoが１、すなわち、インターレイヤ予測がなされる場合に、参照する座標（ｘＰ、ｙＰ）を（ｘＰエ、ｙＰエ）に変換する際に用いられる。
　xPエxP>>3)<<3
　yPyP>>3)<<3
　なお、上記演算は、下位３ビットを０に落とす演算であり論理演算積＆を用いて以下の式でも導出できる。
　xP=xP＆~3)
　yPyP＆~3)
　ここで、～は、論理否定を示す演算である。
　マージ候補導出部３０３６４におけるマージ候補導出における座標変換もこれと同様であってもよい。
　図４１は、座標変換により参照される領域の他の例を示す概念図である。
　図４１は、図４０に示す対象予測ユニット及び参照予測ユニットについて、インターレイヤ参照アドレス変換部３０３９３が変換した座標に基づく参照領域を示す。
　上述の座標変換により、インターレイヤ予測において、８#65304;単位で予測パラメータメモリが参照される（レイヤ０（POC_curr））。この例では、これよりも小さい領域の単位、例えば４ラ４単位（もしくは４ラ８および８ラ４単位）で、予測パラメータメモリが参照される場合よりも、広い領域毎に参照されることで予測パラメータメモリのメモリ量を低減する効果がある。すなわち、あるレイヤ画像の予測パラメータが、他のレイヤ画像の復号において参照される場合（予測パラメータのインターレイヤ予測が行われる）においても、あるレイヤ画像の予測パラメータの参照アドレスが所定のアドレスに制限されているため、その所定のアドレス以外の予測パラメータを消去するような圧縮を行うことができる。
　図４０に戻り、図４０（ｂ）の式は、インターレイヤ参照アドレス変換部３０３９３では、ベクトル候補導出部３０３３におけるベクトル候補導出において、リファレンスレイヤ情報reference_layer_infoが１、すなわち、インターレイヤ予測がなされる場合には、参照する座標（ｘＰ、ｙＰ）を（ｘＰエ、ｙＰエ）に変換する際に用いられる。
　xP犇xP>>3)<<3)+((xP>>3)&1)*7
　yP犇yP>>3)<<3)+((yP>>3)&1)*7
　図４２は、座標変換により参照される領域の他の例を示す概念図である。
　図４２は、図４０に示す対象予測ユニット及び参照予測ユニットについて、インターレイヤ参照アドレス変換部３０３９３が変換した座標に基づく参照領域を示す。
図４２に示す例は、レイヤ０（POC_curr）において１６ラ１６単位の大きさを示す、それぞれのブロックの隅の領域から予測パラメータメモリが参照されることを示す。この場合も、インターレイヤ予測において、より小さい単位４ラ４単位（もしくは４ラ８および８ラ４単位）で、予測パラメータメモリが参照されないため、予測パラメータメモリのメモリ量を低減する効果がある。
（画像符号化装置の構成）
　次に、本実施形態に係る画像符号化装置１１の構成について説明する。
　図１４は、本実施形態に係る画像符号化装置１１の構成を示すブロック図である。
　画像符号化装置１１は、予測ピクチャ生成部（予測画像生成部）１０１、減算部１０２、ＤＣＴ・量子化部１０３、エントロピー符号化部１０４、逆量子化・逆ＤＣＴ部１０５、加算部１０６、予測パラメータメモリ１０８、参照ピクチャメモリ（参照画像記憶部）１０９、符号化パラメータ決定部１１０、及び予測パラメータ符号化部１１１を含んで構成される。予測パラメータ符号化部１１１は、インター予測パラメータ符号化部１１２及びイントラ予測パラメータ符号化部１１３を含んで構成される。
　予測ピクチャ生成部１０１は、外部から入力されたレイヤ画像Ｔの視点毎の各ピクチャについて、そのピクチャを分割した領域であるブロック毎に予測ピクチャブロックＰを生成する。ここで、予測ピクチャ生成部１０１は、予測パラメータ符号化部１１１から入力された予測パラメータに基づいて参照ピクチャメモリ１０９から参照ピクチャブロックを読み出す。予測パラメータ符号化部１１１から入力された予測パラメータとは、例えば、動きベクトルｍｖＬＸ又は変位ベクトルｄｖＬＸである。予測ピクチャ生成部１０１は、符号化対象ブロックを起点として予測された動きベクトル又は変位ベクトルが示す位置にあるブロックの参照ピクチャブロックを読み出す。予測ピクチャ生成部１０１は、読み出した参照ピクチャブロックについて複数の予測方式のうちの１つの予測方式を用いて予測ピクチャブロックＰを生成する。予測ピクチャ生成部１０１は、生成した予測ピクチャブロックＰを減算部１０２に出力する。
　予測ピクチャ生成部１０１は、予測方式を選択するために、例えば、レイヤ画像に含まれるブロックの画素毎の信号値と予測ピクチャブロックＰの対応する画素毎の信号値との差分に基づく誤差値を最小にする予測方式を選択する。予測方式を選択する方法は、これには限られない。
　符号化対象のピクチャがベースビューピクチャである場合には、複数の予測方式とは、イントラ予測、動き予測及びマージ予測である。動き予測とは、上述のインター予測のうち、時刻間の予測である。マージ予測とは、既に符号化されたブロックであって、符号化対象ブロックから予め定めた範囲内にあるブロックと同一の参照ピクチャブロック及び予測パラメータを用いる予測である。符号化対象のピクチャがノンベースビューピクチャである場合には、複数の予測方式とは、イントラ予測、動き予測、マージ予測、及び変位予測である。変位予測（視差予測）とは、上述のインター予測のうち、別レイヤ画像（別視点画像）間の予測である。
　予測ピクチャ生成部１０１は、イントラ予測を選択した場合、予測ピクチャブロックＰを生成する際に用いたイントラ予測モードを示す予測モードｐｒｅｄＭｏｄｅを予測パラメータ符号化部１１１に出力する。
　予測ピクチャ生成部１０１は、動き予測を選択した場合、予測ピクチャブロックＰを生成する際に用いた動きベクトルｍｖＬＸを予測パラメータメモリ１０８に記憶し、インター予測パラメータ符号化部１１２に出力する。動きベクトルｍｖＬＸは、符号化対象ブロックの位置から予測ピクチャブロックＰを生成する際の参照ピクチャブロックの位置までのベクトルを示す。動きベクトルｍｖＬＸを示す情報には、参照ピクチャを示す情報（例えば、参照ピクチャインデックスｒｅｆＩｄｘＬＸ、ピクチャ順序番号ＰＯＣ）を含み、予測パラメータを表すものであっても良い。また、予測ピクチャ生成部１０１は、インター予測モードを示す予測モードｐｒｅｄＭｏｄｅを予測パラメータ符号化部１１１に出力する。
　予測ピクチャ生成部１０１は、変位予測を選択した場合、予測ピクチャブロックＰを生成する際に用いた変位ベクトルｄｖＬＸを予測パラメータメモリ１０８に記憶し、インター予測パラメータ符号化部１１２に出力する。変位ベクトルｄｖＬＸは、符号化対象ブロックの位置から予測ピクチャブロックＰを生成する際の参照ピクチャブロックの位置までのベクトルを示す。変位ベクトルｄｖＬＸを示す情報には、参照ピクチャを示す情報（例えば、参照ピクチャインデックスｒｅｆＩｄｘＬＸ、ビュー識別子ｖｉｅｗ＿ｉｄ）を含み、予測パラメータを表すものであっても良い。また、予測ピクチャ生成部１０１は、インター予測モードを示す予測モードｐｒｅｄＭｏｄｅを予測パラメータ符号化部１１１に出力する。
　予測ピクチャ生成部１０１は、マージ予測を選択した場合、選択した参照ピクチャブロックを示すマージインデックスｍｅｒｇｅ＿ｉｄｘをインター予測パラメータ符号化部１１２に出力する。また、予測ピクチャ生成部１０１は、マージ予測モードを示す予測モードｐｒｅｄＭｏｄｅを予測パラメータ符号化部１１１に出力する。
　減算部１０２は、予測ピクチャ生成部１０１から入力された予測ピクチャブロックＰの信号値を、外部から入力されたレイヤ画像Ｔの対応するブロックの信号値から画素毎に減算して、残差信号を生成する。減算部１０２は、生成した残差信号をＤＣＴ・量子化部１０３と符号化パラメータ決定部１１０に出力する。
　ＤＣＴ・量子化部１０３は、減算部１０２から入力された残差信号についてＤＣＴを行い、ＤＣＴ係数を算出する。ＤＣＴ・量子化部１０３は、算出したＤＣＴ係数を量子化して量子化係数を求める。ＤＣＴ・量子化部１０３は、求めた量子化係数をエントロピー符号化部１０４及び逆量子化・逆ＤＣＴ部１０５に出力する。
　エントロピー符号化部１０４には、ＤＣＴ・量子化部１０３から量子化係数が入力され、符号化パラメータ決定部１１０から符号化パラメータが入力される。入力される符号化パラメータには、例えば、参照ピクチャインデックスｒｅｆＩｄｘＬＸ、ベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘ、差分ベクトルｍｖｄＬＸ、予測モードｐｒｅｄＭｏｄｅ、及びマージインデックスｍｅｒｇｅ＿ｉｄｘ等の符号がある。
　エントロピー符号化部１０４は、入力された量子化係数と符号化パラメータをエントロピー符号化して符号化ストリームＴｅを生成し、生成した符号化ストリームＴｅを外部に出力する。
　逆量子化・逆ＤＣＴ部１０５は、ＤＣＴ・量子化部１０３から入力された量子化係数を逆量子化してＤＣＴ係数を求める。逆量子化・逆ＤＣＴ部１０５は、求めたＤＣＴ係数について逆ＤＣＴを行い、復号残差信号を算出する。逆量子化・逆ＤＣＴ部１０５は、算出した復号残差信号を加算部１０６に出力する。
　加算部１０６は、予測ピクチャ生成部１０１から入力された予測ピクチャブロックＰの信号値と逆量子化・逆ＤＣＴ部１０５から入力された復号残差信号の信号値を画素毎に加算して、参照ピクチャブロックを生成する。加算部１０６は、生成した参照ピクチャブロックを参照ピクチャメモリ１０９に記憶する。
　予測パラメータメモリ１０８は、予測パラメータ符号化部１１１が生成した予測パラメータを、符号化対象のピクチャ及びブロック毎に予め定めた位置に記憶する。
　参照ピクチャメモリ１０９は、加算部１０６が生成した参照ピクチャブロックを、符号化対象のピクチャ及びブロック毎に予め定めた位置に記憶する。
　符号化パラメータ決定部１１０は、符号化パラメータの複数のセットのうち、１つのセットを選択する。符号化パラメータとは、上述した予測パラメータやこの予測パラメータに関連して生成される符号化の対象となるパラメータである。予測ピクチャ生成部１０１は、これらの符号化パラメータのセットの各々を用いて予測ピクチャブロックＰを生成する。
　符号化パラメータ決定部１１０は、複数のセットの各々について情報量の大きさと符号化誤差を示すコスト値を算出する。コスト値は、例えば、符号量と二乗誤差に係数λを乗じた値との和である。符号量は、量子化誤差と符号化パラメータをエントロピー符号化して得られる符号化ストリームＴｅの情報量である。二乗誤差は、減算部１０２において算出された残差信号の残差値の二乗値についての画素間の総和である。係数λは、予め設定されたゼロよりも大きい実数である。符号化パラメータ決定部１１０は、算出したコスト値が最小となる符号化パラメータのセットを選択する。これにより、エントロピー符号化部１０４は、選択した符号化パラメータのセットを符号化ストリームＴｅとして外部に出力し、選択されなかった符号化パラメータのセットを出力しない。
　予測パラメータ符号化部１１１は、予測ピクチャ生成部１０１から入力されたパラメータに基づいて予測ピクチャを生成する際に用いる予測パラメータを導出し、導出した予測パラメータを符号化して符号化パラメータのセットを生成する。予測パラメータ符号化部１１１は、生成した符号化パラメータのセットをエントロピー符号化部１０４に出力する。
　予測パラメータ符号化部１１１は、生成した符号化パラメータのセットのうち符号化パラメータ決定部１１０が選択したものに対応する予測パラメータを予測パラメータメモリ１０８に記憶する。
　予測パラメータ符号化部１１１は、予測ピクチャ生成部１０１から入力された予測モードｐｒｅｄＭｏｄｅがインター予測モードを示す場合、インター予測パラメータ符号化部１１２を動作させる。予測パラメータ符号化部１１１は、予測モードｐｒｅｄＭｏｄｅがイントラ予測モードを示す場合、イントラ予測パラメータ符号化部１１３を動作させる。
　インター予測パラメータ符号化部１１２は、符号化パラメータ決定部１１０から入力された予測パラメータに基づいてインター予測パラメータを導出する。インター予測パラメータ符号化部１１２は、インター予測パラメータを導出する構成として、インター予測パラメータ復号部３０３（図２等、参照）がインター予測パラメータを導出する構成と同一の構成を含む。インター予測パラメータ符号化部１１２の構成については、後述する。
　イントラ予測パラメータ符号化部１１３は、符号化パラメータ決定部１１０から入力された予測モードｐｒｅｄＭｏｄｅが示すイントラ予測モードＩｎｔｒａＰｒｅｄＭｏｄｅをインター予測パラメータのセットとして定める。
（インター予測パラメータ符号化部の構成）
　次に、インター予測パラメータ符号化部１１２の構成について説明する。
　図１５は、本実施形態に係るインター予測パラメータ符号化部１１２の構成を示す概略図である。
　インター予測パラメータ符号化部１１２は、マージ予測パラメータ導出部（変位ベクトル生成部、予測パラメータ導出部）１１２１、ＡＭＶＰ予測パラメータ導出部（変位ベクトル生成部、予測パラメータ導出部）１１２２、減算部１１２３、変位ベクトルクリップ部（変位ベクトル制限部）１１２４、及び予測パラメータ統合部１１２６を含んで構成される。
　マージ予測パラメータ導出部１１２１は、上述のマージ予測パラメータ導出部３０３６（図３参照）と同様な構成を有する。
　マージ予測パラメータ導出部１１２１には、予測ピクチャ生成部１０１から入力された予測モードｐｒｅｄＭｏｄｅがマージ予測モードを示す場合、符号化パラメータ決定部１１０からマージインデックスｍｅｒｇｅ＿ｉｄｘが入力される。マージインデックスｍｅｒｇｅ＿ｉｄｘは、予測パラメータ統合部１１２６に出力される。マージ予測パラメータ導出部１１２１は、マージ候補のうちマージインデックスｍｅｒｇｅ＿ｉｄｘが示す参照ブロックの参照ピクチャインデックスｒｅｆＩｄｘＬＸ、ベクトルｍｖＬＸを予測パラメータメモリ１０８から読み出す。マージ候補とは、符号化対象となる符号化対象ブロックから予め定めた範囲にある参照ブロック（例えば、符号化対象ブロックの左下端、左上端、右上端に接する参照ブロックのうち）であって、符号化処理が完了した参照ブロックである。マージ予測パラメータ導出部１１２１は、読み出した予測ベクトルｍｖｐＬＸ、参照ピクチャインデックスｒｅｆＩｄｘＬＸを対応付けて変位ベクトルクリップ部１１２４に出力する。
　ＡＭＶＰ予測パラメータ導出部１１２２は、上述のＡＭＶＰ予測パラメータ導出部３０３２（図３参照）と同様な構成を有する。
　ＡＭＶＰ予測パラメータ導出部１１２２には、予測ピクチャ生成部１０１から入力された予測モードｐｒｅｄＭｏｄｅがインター予測モードを示す場合、符号化パラメータ決定部１１０からベクトルｍｖＬＸが入力される。ＡＭＶＰ予測パラメータ導出部１１２２は、入力されたベクトルｍｖＬＸに基づいて予測ベクトルｍｖｐＬＸを導出する。ＡＭＶＰ予測パラメータ導出部１１２２は、導出した予測ベクトルｍｖｐＬＸを減算部１１２３に出力する。なお、参照ピクチャインデックスｒｅｆＩｄｘ及びベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘは、予測パラメータ統合部１１２６に出力される。
　減算部１１２３は、符号化パラメータ決定部１１０から入力されたベクトルｍｖＬＸからＡＭＶＰ予測パラメータ導出部１１２２から入力された予測ベクトルｍｖｐＬＸを減算して差分ベクトルｍｖｄＬＸを生成する。減算部１１２３は、ベクトルｍｖＬＸがインターレイヤ予測（変位ベクトル）である場合、差分ベクトルｍｖｄＬＸに含まれるＹ成分ｍｖｄ＿ｙを省略し、Ｘ成分ｍｖｄ＿ｘを残して１次元の差分ベクトル（スカラー値）ｍｖｄＬＸを生成する。ベクトルｍｖＬＸが変位ベクトルであるか動きベクトルであるか否かの判定は、リファレンスレイヤ判定部３０３１１（図４参照）と同様に参照ピクチャインデックスｒｅｆＩｄｘに基づいて行う。減算部１１２３は、生成した１次元の差分ベクトルｍｖｄＬＸを予測パラメータ統合部１１２６に出力する。減算部１１２３は、ベクトルｍｖＬＸが動きベクトルである場合、差分ベクトルｍｖｄＬＸに含まれるＹ成分ｍｖｄ＿ｙを省略せず、そのまま予測パラメータ統合部１１２６に出力する。
　変位ベクトルクリップ部１１２４は、マージ予測パラメータ導出部１１２１又は符号化パラメータ決定部１１０からベクトルｍｖＬＸ、参照ピクチャインデックスｒｅｆＩｄｘ及びベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘが入力される。変位ベクトルクリップ部１１２４は、ベクトルｍｖＬＸが変位ベクトルである場合、入力された変位ベクトルｄｖＬＸの要素であるＹ成分ｄｖ＿ｙの値を予め定めた値（例えば、ゼロ）に定める。変位ベクトルクリップ部１１２４は、変位ベクトルｄｖＬＸのＸ成分ｄｖ＿ｘの値を、そのまま維持する。変位ベクトルクリップ部１１２４は、Ｙ成分ｄｖ＿ｙの値を予め定めた値に定めた変位ベクトルｄｖＬＸを参照ピクチャインデックスｒｅｆＩｄｘ及びベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘと対応付けて予測ピクチャ生成部１０１に出力し、予測パラメータメモリ１０８に記憶する。
　ベクトルｍｖＬＸが変位ベクトルであるか動きベクトルであるか否かの判定は、リファレンスレイヤ判定部３０３１１（図４参照）と同様に入力された参照ピクチャインデックスｒｅｆＩｄｘに基づいて行う。
　ベクトルｍｖＬＸが動きベクトルである場合、変位ベクトルクリップ部１１２４は、入力されたベクトルｍｖＬＸを、そのまま参照ピクチャインデックスｒｅｆＩｄｘ及びベクトルインデックスｍｖ＿ＬＸ＿ｉｄｘと対応付けて予測ピクチャ生成部１０１に出力し、予測パラメータメモリ１０８に記憶する。
　予測ピクチャ生成部１０１から入力された予測モードｐｒｅｄＭｏｄｅがマージ予測モードを示す場合には、予測パラメータ統合部１１２６は、符号化パラメータ決定部１１０から入力されたマージインデックスｍｅｒｇｅ＿ｉｄｘをエントロピー符号化部１０４に出力する。
　予測ピクチャ生成部１０１から入力された予測モードｐｒｅｄＭｏｄｅがインター予測モードを示す場合には、予測パラメータ統合部１１２６は、次の処理を行う。
　予測パラメータ統合部１１２６は、減算部１１２３から入力された差分ベクトルｍｖｄＬＸが変位ベクトルに係る差分ベクトルであるか、動きベクトルに係る差分ベクトルであるかを判断する。変位ベクトルに係る差分ベクトルであるか動きベクトルに係る差分ベクトルであるか否かの判定は、リファレンスレイヤ判定部３０３１１（図４参照）と同様に入力された参照ピクチャインデックスｒｅｆＩｄｘに基づいて行う。
　予測パラメータ統合部１１２６は、入力された差分ベクトルｍｖｄＬＸが変位ベクトルに係る差分ベクトルであると判定した場合、予測パラメータ統合部１１２６は、視点配置フラグｃａｍｅｒａ＿ａｒｒａｎｇｅｍｅｎｔ＿１Ｄ＿ｆｌａｇの値を１と定める。また、予測パラメータ統合部１１２６は、差分ベクトルｍｖｄＬＸが示すＸ成分ｍｖｄ＿ｘに基づいて、上述の３種類の符号、ａｂｓ＿ｍｖｄ＿ｇｒｅａｔｅｒ０＿ｆｌａｇ［０］、ａｂｓ＿ｍｖｄ＿ｍｉｎｕｓ２［０］、ｍｖｄ＿ｓｉｇｎ＿ｆｌａｇ［０］を算出する。
Ｙ成分ｍｖｄ＿ｙについては、予測パラメータ統合部１１２６は、これらの符号を算出しない。
　予測パラメータ統合部１１２６は、入力された差分ベクトルｍｖｄＬＸが動きベクトルに係る差分ベクトルであると判定した場合、予測パラメータ統合部１１２６は、視点配置フラグｃａｍｅｒａ＿ａｒｒａｎｇｅｍｅｎｔ＿１Ｄ＿ｆｌａｇの値を０と定める。
　また、予測パラメータ統合部１１２６は、差分ベクトルｍｖｄＬＸが示すＸ成分ｍｖｄ＿ｘに基づいて、上述の３種類の符号、ａｂｓ＿ｍｖｄ＿ｇｒｅａｔｅｒ０＿ｆｌａｇ［０］、ａｂｓ＿ｍｖｄ＿ｍｉｎｕｓ２［０］、ｍｖｄ＿ｓｉｇｎ＿ｆｌａｇ［０］を算出する。予測パラメータ統合部１１２６は、差分ベクトルｍｖｄＬＸが示すＹ成分ｍｖｄ＿ｙについても、３種類の符号、ａｂｓ＿ｍｖｄ＿ｇｒｅａｔｅｒ０＿ｆｌａｇ［１］、ａｂｓ＿ｍｖｄ＿ｍｉｎｕｓ２［１］、ｍｖｄ＿ｓｉｇｎ＿ｆｌａｇ［１］を算出する。
　予測パラメータ統合部１１２６は、値を定めた視点配置フラグｃａｍｅｒａ＿ａｒｒａｎｇｅｍｅｎｔ＿１Ｄ＿ｆｌａｇ及び成分毎に算出した３種類の符号と、符号化パラメータ決定部１１０から入力された参照ピクチャインデックスｒｅｆＩｄｘ及びベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘを統合する。予測パラメータ統合部１１２６は、統合した符号をエントロピー符号化部１０４に出力する。
　これにより、上述した例では、変位ベクトルに係る差分ベクトルｄｖｄＬＸのＹ成分ｄｖｄ＿ｙを符号化しなくとも、その値を予め定めた値に定める。他方、変位においてＸ成分が主であり、Ｙ成分が無視できる値である場合には、上述した例でも変位予測における精度の劣化が生じない。従って、上述した例では、復号した画像の品質が劣化せずに符号化効率が向上する。
（変形例Ｅ１）
　次に、変形例Ｅ１に係る画像符号化装置１１ａについて説明する。本変形例Ｅ１は、上述の変形例Ｄ１に対応する変形例である。上述の同一の構成については同一の符号を付して上述の説明を援用する。
　本変形例Ｅ１に係る画像符号化装置１１ａは、ＡＭＶＰ予測パラメータ導出部１１２２（図１５参照）の代わりに、ＡＭＶＰ予測パラメータ導出部１１２２ａを備える。また、減算部１１２３の代わりに後述する減算部１１２３ａを備えても良いし、備えなくても良い。減算部１１２３ａを備えない場合には、変位ベクトルクリップ部１１２４（図１５参照）を省略しても良い。
　ＡＭＶＰ予測パラメータ導出部１１２２ａは、ＡＭＶＰ予測パラメータ導出部１１２２（図１５参照）と同様な構成を備える。但し、ＡＭＶＰ予測パラメータ導出部１１２２ａは、算出した予測ベクトルｍｖｐＬＸが変位ベクトルに係る予測ベクトルである場合、変位予測ベクトルクリップ部３０３２１ａ（図５参照）と同様に、予測ベクトルのＹ成分ｄｖｐ＿ｙを予め定めた範囲内の値に制限する。予測ベクトルｍｖｐＬＸに係るベクトルが変位ベクトルであるか動きベクトルであるか否かの判定は、リファレンスレイヤ判定部３０３１１（変形例Ｄ１、図４参照）と同様に入力された参照ピクチャインデックスｒｅｆＩｄｘに基づいて行う。
　ＡＭＶＰ予測パラメータ導出部１１２２ａは、Ｘ成分ｄｖｐ＿ｘと値を制限したＹ成分ｄｖｐ＿ｙから、予測ベクトルｄｖｐＬＸを再構成し、再構成した予測ベクトルｄｖｐＬＸを減算部１１２３に出力する。
　予測ベクトルｍｖｐＬＸが動きベクトルに係る予測ベクトルである場合、ＡＭＶＰ予測パラメータ導出部１１２２ａは、算出した予測ベクトルｍｖｐＬＸをそのまま減算部１１２３に出力する。
　減算部１１２３ａは、予測ピクチャ生成部１０１から入力されたベクトルｍｖＬＸからＡＭＶＰ予測パラメータ導出部１１２２ａから入力された予測ベクトルｍｖｐＬＸを減算して差分ベクトルｍｖｄＬＸを算出する。減算部１１２３ａは、ベクトルｍｖＬＸが変位ベクトルであるか否かに関わらず、算出した差分ベクトルｍｖｄＬＸをエントロピー符号化部１０４に出力する。
　これにより、変位ベクトルに係る予測ベクトルのＹ成分ｄｖｐ＿ｙが予め定めた範囲の値に制限されるため、変位予測における精度の劣化を抑制することができる。従って、本変形例Ｅ１によれば符号化効率が向上する。
（変形例Ｅ２）
　次に、変形例Ｅ２に係る画像符号化装置１１ｂについて説明する。本変形例Ｅ２は、上述の変形例Ｄ２に対応する変形例である。同一の構成については同一の符号を付して上述の説明を援用する。
　本変形例Ｅ２に係る画像符号化装置１１ｂは、変形例Ｅ１と同様にＡＭＶＰ予測パラメータ導出部１１２２及び変位ベクトルクリップ部１１２４（図１５参照）の代わりに、ＡＭＶＰ予測パラメータ導出部１１２２ａ及び変位ベクトルクリップ部１１２４ａを備える。
　本変形例Ｅ２において、インター予測パラメータ符号化部１１２（図１５参照）には、上述の変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎが外部から入力されている。ベクトルｍｖＬＸが変位ベクトルである場合、変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎの値に応じて、ＡＭＶＰ予測パラメータ導出部１１２２ａ、減算部１１２３及び変位ベクトルクリップ部１１２４ａは、次の処理を行う。
　ＡＭＶＰ予測パラメータ導出部１１２２ａは、変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎの値がゼロ又は２である場合、算出した予測ベクトルｄｖｐＬＸを、そのまま減算部１１２３及び変位ベクトルクリップ部１１２４ａに出力する。
　ＡＭＶＰ予測パラメータ導出部１１２２ａは、変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎの値が１又は３である場合、算出した予測ベクトルｄｖｐＬＸのＹ成分ｄｖｐ＿ｙを予め定めた範囲の値に制限する。ＡＭＶＰ予測パラメータ導出部１１２２ａは、予測ベクトルｄｖｐＬＸのＸ成分ｄｖｐ＿ｘと値の範囲を制限したＹ成分ｄｖｐ＿ｙとから予測ベクトルｄｖｐＬＸを再構成し、再構成した予測ベクトルｄｖｐＬＸを減算部１１２３及び変位ベクトルクリップ部１１２４ａに出力する。
　減算部１１２３は、変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎの値がゼロ又は１である場合、算出した差分ベクトルｄｖｄＬＸ（２次元ベクトル）をそのまま予測パラメータ統合部１１２６及び変位ベクトルクリップ部１１２４ａに出力する。減算部１１２３は、変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎの値が２又は３である場合、算出した差分ベクトルｄｖｄＬＸのＹ成分ｄｖｄ＿ｙを省略し、Ｘ成分ｄｖｄ＿ｘを残して１次元の差分ベクトル（スカラー値）ｄｖｄＬＸを生成する。減算部１１２３は、Ｘ成分ｄｖｄ＿ｘを残した１次元の差分ベクトルｄｖｄＬＸを予測パラメータ統合部１１２６及び変位ベクトルクリップ部１１２４ａに出力する。
　変位ベクトルクリップ部１１２４ａは、ＡＭＶＰ予測パラメータ導出部１１２２ａから入力された予測ベクトルｄｖｐＬＸ及び減算部１１２３から入力された差分ベクトルｄｖｄＬＸを加算して変位ベクトルｄｖＬＸを新たに算出する。ここで、減算部１１２３から入力された差分ベクトルｄｖｄＬＸが１次元の差分ベクトルである場合には、差分ベクトルｄｖｄＬＸのＹ成分ｄｖｄ＿ｙとして予め定めた範囲の値（例えば、ゼロ）が加算される。変位ベクトルクリップ部１１２４ａは、新たに算出した変位ベクトルｄｖＬＸを参照ピクチャインデックスｒｅｆＩｄｘ及びベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘと対応付けて予測ピクチャ生成部１０１に出力し、予測パラメータメモリ１０８に記憶する。
ここで、変位ベクトルクリップ部１１２４ａには、参照ピクチャインデックスｒｅｆＩｄｘ及びベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘが符号化パラメータ決定部１１０から入力される。
　しかし、変位ベクトルクリップ部１１２４とは異なり、変位ベクトルクリップ部１１２４ａには符号化パラメータ決定部１１０からベクトルｍｖＬＸ（変位ベクトルｄｖＬＸ）は入力されない。そのため、変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎの値が１、２、３のうちいずれかである場合、出力される変位ベクトルｄｖＬＸのＹ成分ｄｖ＿ｙの値の範囲が制限される。
　予測パラメータ統合部１１２６には、変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎが入力される。予測パラメータ統合部１１２６は、入力された上述の他の符号と統合し、統合した符号をエントロピー符号化部１０４に出力する。これにより、変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎもエントロピー符号化の対象となる。
　なお、本変形例Ｅ２では、減算部１１２３、変位ベクトルクリップ部１１２４ａにおいて、ベクトルｍｖＬＸが変位ベクトルであるか動きベクトルであるかの判定を省略しても良い。
　本変形例Ｅ２では、変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎは、符号化ストリームＴｅにおいて、変位毎に含まれるようにしても良いし、シーケンス毎に含まれるようにしても良い。
　これにより、本変形例Ｅ２では、画像を取得した視点等の配置や撮影された画像のシーンに応じて、Ｙ方向の変位（視点）の差分もしくは予測値を利用するか否かを切り替えることができる。シーン全体として画質の劣化の抑制と符号化ストリームＴｅの情報量の低減を両立することができる。
（変形例Ｅ３）
　次に、変形例Ｅ３に係る画像符号化装置１１ｃについて説明する。本変形例Ｅ３は、上述の変形例Ｄ３に対応する変形例である。同一の構成については同一の符号を付して上述の説明を援用する。
　本変形例Ｅ３に係る画像符号化装置１１ｃは、インター予測パラメータ符号化部１１２（図１５参照）の代わりに、インター予測パラメータ符号化部１１２ｃを備える。
　図１６は、本変形例Ｅ３に係るインター予測パラメータ符号化部１１２ｃの構成を示す概略図を示す。
　インター予測パラメータ符号化部１１２ｃは、インター予測パラメータ符号化部１１２において変位ベクトルクリップ部１１２４の代わりに変位ベクトル生成部１１２５を備える。
　本変形例Ｅ３において、変位ベクトル生成部１１２５には、上述の傾き係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄと切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔが外部から入力されている。
　変位ベクトル生成部１１２５は、ベクトルｍｖＬＸが変位ベクトルである場合、マージ予測パラメータ導出部１１２１又は符号化パラメータ決定部から変位ベクトルｄｖＬＸ、参照ピクチャインデックスｒｅｆＩｄｘ及びベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘが入力される。変位ベクトル生成部１１２５は、変位ベクトルｄｖＬＸのＸ成分ｄｖ＿ｘと傾き係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄと切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔに基づいて、そのＹ成分ｄｖ＿ｙを算出する。Ｙ成分ｄｖ＿ｙを算出する処理は、変位ベクトル設定部３０３８２（変形例Ｄ３、図７参照）と同様であってよい。ベクトルｍｖＬＸが変位ベクトルであるか動きベクトルであるか否かの判定は、リファレンスレイヤ判定部３０３１１（図４参照）と同様に入力された参照ピクチャインデックスｒｅｆＩｄｘに基づいて行う。変位ベクトル生成部１１２５は、Ｘ成分ｄｖ＿ｘと算出したＹ成分ｄｖ＿ｙから、変位ベクトルｍｖＬＸを再構成する。なお、変位ベクトル生成部１１２５は、変位ベクトルｄｖＬＸのＸ成分ｄｖ＿ｘを用いずに、切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔに基づいてＹ成分ｄｖ＿ｙを算出しても良い。すなわち、ｄｖ＿ｙ＝ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔとしても良い。この場合、傾き係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄは常に０であることを意味するため、この成分を符号化する必要はない。
　変位ベクトル生成部１１２５は、再構成した変位ベクトルｄｖＬＸを参照ピクチャインデックスｒｅｆＩｄｘ及びベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘと対応付けて予測ピクチャ生成部１０１に出力し、予測パラメータメモリ１０８に記憶する。
　ベクトルｍｖＬＸが動きベクトルである場合、変位ベクトル生成部１１２５は、入力された動きベクトルｍｖＬＸを、そのまま参照ピクチャインデックスｒｅｆＩｄｘ及びベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘと対応付けて予測ピクチャ生成部１０１に出力し、予測パラメータメモリ１０８に記憶する。
　変位ベクトル生成部１１２５は、傾き係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄと切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔを予測パラメータ統合部１１２６に出力する。予測パラメータ統合部１１２６は、変位ベクトル生成部１１２５から入力された変位ベクトル制限情報ｄｉｓｐａｒｉｔｙ＿ｒｅｓｔｒｉｃｔｉｏｎと上述の入力された他の符号と統合し、統合した符号をエントロピー符号化部１０４に出力する。これにより、傾き係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄと切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔもエントロピー符号化の対象となる。
　傾き係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｇｒａｄと切片係数ｉｎｔｅｒ＿ｖｉｅｗ＿ｏｆｆｓｅｔは、符号化ストリームＴｅにおいて、シーケンス毎に含まれるようにしても良いし、ピクチャ毎に含まれるようにしても良い。特に、これらの係数がピクチャ毎に含まれるようにすることで、シーンのピクチャ単位でのきめ細やかな変化に追従することができる。
　これにより、本変形例Ｅ３では、画像を取得した視点等の配置や向きが厳密に一方向に平行に配置されていない場合に完全にＹ方向の変位（視差）が予め定めた値にならない場合でも、Ｘ方向の変位（視差）に基づいて、Ｙ方向の変位を再現することができる。また、本変形例Ｅ３では、撮影された画像のシーンに応じて、Ｘ方向の変位とＹ方向の変位との関係を切り替えることで、全体として画質の劣化の抑制と符号化ストリームＴｅの情報量の低減を両立することができる。
（変形例Ｅ４）
　次に、変形例Ｅ４に係る画像符号化装置１１ｄについて説明する。本変形例Ｅ４は、上述の変形例Ｄ４に対応する変形例である。同一の構成については同一の符号を付して上述の説明を援用する。
　本変形例Ｅ４に係る画像符号化装置１１ｄは、変位ベクトルクリップ部１１２４（図１５参照）の代わりに、変位ベクトルクリップ部１１２４ｄを備える。
　また、画像符号化装置１１ｄは、減算部１１２３（図１５参照）の代わりに減算部１１２３ａ（変形例Ｅ１参照）を備えても良い。
　変位ベクトルクリップ部１１２４ｄは、変位ベクトルクリップ部１１２４と同様な処理を行う。変位ベクトルクリップ部１１２４ｄは、マージ予測パラメータ導出部１１２１又は符号化パラメータ決定部１１０からベクトルｍｖＬＸ、参照ピクチャインデックスｒｅｆＩｄｘ及びベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘが入力される。ベクトルｍｖＬＸが変位ベクトルである場合、変位ベクトルクリップ部１１２４ｄは、変位ベクトルクリップ部１１２４ｄは入力された変位ベクトルｄｖＬＸの値を、ベクトルクリップ部３０３７２と同様に予め定めた範囲内の値に制限する。変位ベクトルクリップ部１１２４ｄは、値を制限した変位ベクトルｄｖＬＸを参照ピクチャインデックスｒｅｆＩｄｘ及びベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘと対応付けて予測ピクチャ生成部１０１に出力し、予測パラメータメモリ１０８に記憶する。
　変位ベクトルクリップ部１１２４ｄは、ベクトルｍｖＬＸが変位ベクトルであるか否かの判定をリファレンスレイヤ判定部３０３１１（変形例Ｄ４、図９参照）と同様に参照ピクチャインデックスｒｅｆＩｄｘに基づいて行う。ベクトルｍｖＬＸが動きベクトルである場合、変位ベクトルクリップ部１１２４ｄは、入力された動きベクトルｍｖＬＸを参照ピクチャインデックスｒｅｆＩｄｘ及びベクトルインデックスｍｖｐ＿ＬＸ＿ｉｄｘと対応付けて予測ピクチャ生成部１０１（図１４参照）に出力し、予測パラメータメモリ１０８に記憶する。
　本変形例Ｅ４では、参照ピクチャメモリ１０９と予測ピクチャ生成部１０１との間に内部メモリ１０９１（図示せず）を備えても良い。内部メモリ１０９１には、予測パラメータメモリ１０８から参照領域に相当する予測パラメータを記憶させ、予測ピクチャ生成部１０１が内部メモリ１０９１から変位ベクトルで指示される位置にある参照ピクチャブロックを読み出すようにする。例えば、内部メモリ１０９１として、参照ピクチャメモリ１０９よりも記憶容量が小さくアクセス速度が速い記憶媒体（キャッシュメモリ）を用いることで、処理の高速化及び経済化を図ることができる。
　これにより、本変形例Ｅ４では、予測ピクチャ生成部１０１に出力される変位ベクトルの値のとりうる範囲を小さくすることができる。この範囲は、ある符号化対象ブロックについて、予測ピクチャ生成部１０１が参照ピクチャメモリ１０９から参照ピクチャを参照する際の参照する範囲である参照領域に相当する。つまり、本変形例Ｅ４では、参照ピクチャメモリ１０９における参照領域を小さくすることにより、小容量の記憶媒体でも参照ピクチャメモリ１０９として使用することが許容され、処理の高速化を図ることができる。
（変形例Ｅ５）
　次に、変形例Ｅ５に係る画像符号化装置１１ｅについて説明する。本変形例Ｅ５は、上述の変形例Ｄ５に対応する変形例である。同一の構成については同一の符号を付して上述の説明を援用する。
　本変形例Ｅ５に係る画像符号化装置１１ｅは、ＡＭＶＰ予測パラメータ導出部１１２２（図１５参照）の代わりに、ＡＭＶＰ予測パラメータ導出部１１２２ｅを備える。また、減算部１１２３の代わりに後述する減算部１１２３ａ（変形例Ｅ１参照）を備えても良いし、備えなくても良い。減算部１１２３ａを備えない場合には、変位ベクトルクリップ部１１２４（図１５参照）を省略しても良い。
　ＡＭＶＰ予測パラメータ導出部１１２２ｅは、ＡＭＶＰ予測パラメータ導出部１１２２（図１５参照）と同様な構成を備える。ここで、ＡＭＶＰ予測パラメータ導出部１１２２は、符号化パラメータ決定部１１０から入力されたベクトルｍｖＬＸがインターレイヤ予測（変位ベクトル）である場合、入力された変位ベクトルｄｖＬＸを変位ベクトルクリップ部３０３３８（図１１参照）と同様に、予め定めた範囲内の値に制限する。ベクトルｍｖＬＸが変位ベクトルであるか動きベクトルであるか否かの判定は、リファレンスレイヤ判定部３０３１１（変形例Ｄ１、図４参照）と同様に参照ピクチャインデックスｒｅｆＩｄｘに基づいて行う。
　これにより、ＡＭＶＰ予測パラメータ導出部１１２２ｅが、予測パラメータを予測パラメータメモリ１０８から読み出す参照領域が制限される。参照領域は、符号化対象ブロックを起点として変位ベクトルｄｖＬＸとして取りうる値の範囲に相当するためである。
　つまり、本変形例Ｅ５では、予測パラメータメモリ１０８における参照領域を小さくすることにより、小容量の記憶媒体でも予測パラメータメモリ１０８として使用することが許容され、処理の高速化を図ることができる。本変形例Ｅ５では、内部メモリ１０８１（図示せず）を備え、予測パラメータメモリ１０８から参照領域における予測パラメータを記憶させても良い。そして、ＡＭＶＰ予測パラメータ導出部１１２２ｅは内部メモリ１０８１を介して予測パラメータを読み出す。内部メモリ１０８１は、予測パラメータメモリ１０８よりも記憶容量が小さくアクセス速度が速い記憶媒体であっても良い。
　なお、本変形例Ｅ５に係る画像符号化装置１１ｅは、マージ予測パラメータ導出部１１２１（図１５参照）の代わりに、マージ予測パラメータ導出部１１２１ｅを備える。
　マージ予測パラメータ導出部１１２１ｅは、マージ予測パラメータ導出部１１２１（図１５参照）と同様な構成を備える。ここで、マージ予測パラメータ導出部１１２１ｅは、変位ベクトルを用いて、対象レイヤ画像とは別のレイヤのレイヤ画像（例えばベースビュー）の予測パラメータを読み出す際、その変位ベクトルｄｖＬＸを変位ベクトルクリップ部３０３３８（図１３参照）において、予め定めた範囲内の値に制限する。
　これにより、マージ予測パラメータ導出部１１２１ｅが、対象レイヤ画像とは別のレイヤ画像の予測パラメータを予測パラメータメモリ１０８から更に読み出す参照領域が制限され処理の高速化が図られる。また、本変形例Ｅ５では、内部メモリ１０８２（図示せず）を備え、予測パラメータメモリ１０８から参照領域における予測パラメータを記憶させても良い。そして、マージ予測パラメータ導出部１１２１ｅは内部メモリ１０８２を介して予測パラメータを読み出す。内部メモリ１０８２は、予測パラメータメモリ１０８よりも記憶容量が小さくアクセス速度が速い記憶媒体であっても良い。
　上述した実施形態では、画像伝送システム１（図１参照）は、画像符号化装置１１及び画像復号装置３１の代わりに、上述した画像符号化装置１１ａ－１１ｅのいずれかと、それに対応する画像復号装置３１ａ－３１ｅを備えていても良い。
　また、上述した実施形態では、画像伝送システム１は、画像表示装置４１を省略しても良い。また、上述した実施形態では、画像復号装置３１－３１ｅのいずれかと画像表示装置４１を備えた画像表示システムが構成されていても良い。
　このように上述した実施形態では、第１レイヤ画像と、第１レイヤ画像とは異なる第２レイヤ画像との間の変位の一部を示す符号に基づいて、変位の一部と変位の他の一部を示す変位ベクトルを生成する。また、参照画像を記憶する参照画像記憶部から、生成した変位ベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する。
　そのため、視差の他の一部、例えはＹ成分を符号化する必要がなくなる。また、視差において視差の一部、例えばＸ成分が主である場合には、視差の他の一部が符号化されなくても視差予測における精度の劣化が生じない。よって、生成された画像の品質の劣化が抑制されつつ符号化効率が向上する。
　また、上述した実施形態では、第１レイヤ画像と、第１レイヤ画像とは異なる第２レイヤ画像との間の変位を示す符号に基づいて前記変位を示す変位ベクトルを生成し、変位ベクトルを予め定めた範囲内の値に制限する。また、参照画像を記憶する参照画像記憶部から、生成した変位ベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する。
　そのため、生成された画像の品質の劣化が抑制されつつ参照画像が読み出される領域が制限されるため、参照画像を参照する際の処理が高速化することができる。また、予測画像自体の符号量も減少するため符号化効率が向上する。
（変形例Ｅ６）
　次に、変形例Ｅ６に係る画像符号化装置１１ｆ（図示せず）について説明する。本変形例Ｅ６は、上述の変形例Ｄ６に対応する変形例である。同一の構成については同一の符号を付して上述の説明を援用する。
　本変形例Ｅ６に係る画像符号化装置１１ｆは、エントロピー符号化部１０４の代わりに、エントロピー符号化部１０４ｆを備える。
　図３４は、本変形例Ｅ６に係るエントロピー符号化部１０４ｆの構成を示すブロック図である。
　エントロピー符号化部１０４ｆは、算術符号化部１０４１、リファレンスレイヤ判定部１０４２ｆ及びベクトル差分シンタックス符号化部１０４３ｆを含んで構成される。リファレンスレイヤ判定部１０４２ｆ及びベクトル差分シンタックス符号化部１０４３ｆの構成は、リファレンスレイヤ判定部３０３７１及びベクトル差分シンタックス復号部３０１３ｆ（図２５参照）の構成と同様であってもよい。
　算術符号化部１０４１は、コンテキスト記録更新部１０４１１及びビット符号化部１０４１２を含んで構成される。コンテキスト記録更新部１０４１１の構成は、コンテキスト記録更新部３０１１１（図２５参照）の構成と同様であってもよい。
　ビット符号化部１０４１２は、コンテキスト記録更新部１０４１１に記録されているコンテキスト変数ＣＶを参照し、インター予測パラメータ符号化部１１２から供給される差分ベクトルｍｖｄＬＸを構成する各Ｂｉｎを符号化する。また、符号化したＢｉｎの値はコンテキスト記録更新部１０４１１にも供給され、コンテキスト変数ＣＶを更新するために参照される。
　ベクトル差分シンタックス符号化部１０４３ｆは、インター予測パラメータ符号化部１１２から供給される差分ベクトルｍｖｄＬＸから、差分ベクトルmvdLXを構成するシンタックス要素であるabs_mvd_greater0_flag[XY]、abs_mvd_greater1_flag[XY]、abs_mvd_minus2[XY]の各Ｂｉｎを符号化するためのコンテキストインデックスctxIdxを導出し、導出したコンテキストインデックスctxIdxをコンテキスト記録更新部１０４１１に記録する。従って、この記憶されたコンテキストインデックスctxIdxを用いて、ビット符号化部１０４１２は、各シンタックス要素を符号化する。ベクトル差分シンタックス符号化部１０４３ｆは、コンテキストインデックスctxIdxを導出する際に、図２７－３１のいずれかに示す導出テーブル情報を用いても良い。
　上述した実施形態では、参照ピクチャインデックスｒｅｆＩｄｘ、および、対象とする成分がＸ成分であるかＹ成分であるかに応じて、差分ベクトルの絶対値が０を超えるか否かを示すシンタックス要素abs_mvd_greater0_flag[XY]のコンテキストを導出することにより、符号化対象のシンタックス要素の情報量が低減し、符号化効率が向上する。
（変形例Ｅ７）
　次に、変形例Ｅ７に係る画像符号化装置１１ｇ（図示せず）について説明する。本変形例Ｅ７は、上述の変形例Ｄ７に対応する変形例である。同一の構成については同一の符号を付して上述の説明を援用する。
　本変形例Ｅ７に係る画像符号化装置１１ｇは、エントロピー符号化部１０４の代わりに、エントロピー符号化部１０４ｇを備える。
　図３５は、本変形例Ｅ７に係るエントロピー符号化部１０４ｇの構成を示すブロック図である。
　エントロピー符号化部１０４ｇは、算術符号化部１０４１、ベクトル差分シンタックス符号化部１０４３ｇ及びターゲットレイヤ判定部１０４４ｇを含んで構成される。
　算術符号化部１０４１、ベクトル差分シンタックス符号化部１０４３ｇ及びターゲットレイヤ判定部１０４４ｇの構成は、算術符号化部１０４１（図３４参照）、ベクトル差分シンタックス復号部３０１３ｇ（図３２参照）及びターゲットレイヤ判定部３０１７１（図３２）の構成とそれぞれ同様であってもよい。
　ここで、ベクトル差分シンタックス符号化部１０４３ｇは、インター予測パラメータ符号化部１１２から供給される差分ベクトルmvdLXから、これを構成するシンタックス要素であるabs_mvd_greater0_flag[XY]、abs_mvd_greater1_flag[XY]、abs_mvd_minus2[XY]の各Ｂｉｎを符号化するためのコンテキストインデックスctxIdxIncを導出する。ベクトル差分シンタックス符号化部１０４３ｇは、導出したコンテキストインデックスctxIdxIncをコンテキスト記録更新部１０４１１に記憶する。ビット符号化部１０４１２は、コンテキスト記録更新部１０４１１に記憶されたコンテキストインデックスctxIdxIncを用いて差分ベクトルmvdLXを構成する各シンタックス要素を符号化する。ビット符号化部１０４１２は、符号化された各シンタックス要素を符号化ストリームＴｅの一部として出力する。
　これにより本変形例では、参照ピクチャインデックスｒｅｆＩｄｘ、および、対象とする成分がＸ成分であるかＹ成分であるかに応じて、差分ベクトルの絶対値が０を超えるか否かを示すフラグabs_mvd_greater0_flag[XY]のコンテキストを導出することにより、符号化されたシンタックス要素の情報量が低減し、符号化効率が向上する。
（変形例Ｅ８）
　次に、変形例Ｅ８に係る画像符号化装置１１ｈ（図示せず）について説明する。本変形例Ｅ８は、上述の変形例Ｄ８に対応する変形例である。同一の構成については同一の符号を付して上述の説明を援用する。
　本変形例Ｅ８に係る画像符号化装置１１ｈは、マージ予測パラメータ導出部１１２１及びＡＭＶＰ予測パラメータ導出部１１２２（図１５参照）の代わりに、それぞれマージ予測パラメータ導出部１１２１ｈ及びＡＭＶＰ予測パラメータ導出部１１２２ｈを備える。
　図４３は、本変形例Ｅ８に係るＡＭＶＰ予測パラメータ導出部１１２２ｈの構成を示すブロック図である。
　ＡＭＶＰ予測パラメータ導出部１１２２ｈは、ベクトル候補導出部１１２７、予測ベクトル選択部１１２８及び予測パラメータ参照部１１２９を含んで構成される。ベクトル候補導出部１１２７の構成は、それぞれベクトル候補導出部３０３３、予測ベクトル選択部３０３４及び予測パラメータ参照部３０３９の構成（図３６参照）とそれぞれ同様であってもよい。予測パラメータ参照部１１２９は、予測パラメータ参照部３０３９が予測パラメータメモリ３０７（図３６参照）から予測パラメータを参照するのと同様に、予測パラメータメモリ１０８から予測パラメータを参照する。
　図４４は、本変形例Ｅ８に係るマージ予測パラメータ導出部１１２１ｈの構成を示すブロック図である。
　マージ予測パラメータ導出部１１２１ｈは、マージ候補導出部１１２１１、マージ候補選択部１１２１２及び予測パラメータ参照部１１２１３を含んで構成される。マージ候補導出部１１２１１、マージ候補選択部１１２１２及び予測パラメータ参照部１１２１３の構成は、それぞれマージ候補導出部３０３６４、マージ候補選択部３０３６５及び予測パラメータ参照部３０３９の構成（図３９参照）とそれぞれ同様であってもよい。予測パラメータ参照部１１２１３は、予測パラメータ参照部３０３９が予測パラメータメモリ３０７（図３９参照）から予測パラメータを参照するのと同様に、予測パラメータメモリ１０８から予測パラメータを参照する。
　本変形例において、予測パラメータ参照部１１２１３、１１２９によるインターレイヤ予測において、所定の大きさを有する単位のブロック毎に予測パラメータメモリから予測パラメータを参照する。これにより小さい単位４ラ４単位（もしくは４ラ８および８ラ４単位）で、予測パラメータメモリが参照されないため、予測パラメータメモリのメモリ量を低減する効果を奏する。
　また、本発明は以下のように表現することもできる。
（１）本発明の一態様は、第１レイヤ画像と、前記第１レイヤ画像とは異なる第２レイヤ画像との間の変位の一部を示す符号に基づいて、前記変位の一部と前記変位の他の一部を示す変位ベクトルを生成する変位ベクトル生成部と、参照画像を記憶する参照画像記憶部と、前記参照画像記憶部から、前記変位ベクトル生成部が生成した変位ベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部、を備える画像復号装置である。
（２）本発明のその他の態様は、上述の画像復号装置であって、前記変位の一部は前記変位の水平成分であって、前記変位の他の一部は前記変位の垂直成分であってもよい。また、前記変位ベクトル生成部は、前記垂直成分、当該垂直成分の予測値もしくは当該垂直成分の予測残差を予め定めた値に定めるように構成されていてもよい。
（３）本発明のその他の態様は、上述の画像復号装置であって、前記変位の一部は前記変位の水平成分であって、前記変位の他の一部は前記変位の垂直成分であってもよい。また、前記変位ベクトル生成部は、垂直成分と水平方向との関係を示す符号に基づいて前記変位の垂直成分を算出するように構成されていてもよい。
（４）本発明のその他の態様は、第１レイヤ画像と、前記第１レイヤ画像とは異なる第２レイヤ画像との間の変位を示す符号に基づいて前記変位を示す変位ベクトルを生成する変位ベクトル生成部と、前記変位ベクトルを予め定めた範囲内の値に制限する変位ベクトル制限部と、参照画像を記憶する参照画像記憶部と、前記参照画像記憶部から、前記変位ベクトル生成部が生成した変位ベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部、を備える画像復号装置である。
（５）本発明のその他の態様は、上述の画像復号装置であって、前記変位ベクトル制限部が前記変位ベクトルの値を制限する範囲において、垂直成分の範囲が水平成分の範囲よりも小さくてもよい。
（６）本発明のその他の態様は、上述の画像復号装置であって、導出済みの予測パラメータを画像の領域毎に記憶する予測パラメータ記憶部と、前記予測パラメータ記憶部に記憶された予測パラメータのうち、前記変位ベクトル制限部が制限した変位ベクトルが示す領域に係る予測パラメータを参照して当該動きベクトルもしくは変位ベクトルの予測値である予測ベクトルを予測パラメータの少なくとも一部として導出する予測パラメータ導出部とを備えてもよい。
（７）本発明のその他の態様は、第１レイヤ画像と、前記第１レイヤ画像とは異なる第２レイヤ画像との間の変位の一部に基づいて、前記変位の一部と前記変位の他の一部を示す変位ベクトルを生成する変位ベクトル生成部と、参照画像を記憶する参照画像記憶部と、前記参照画像記憶部から、前記変位ベクトル生成部が生成した変位ベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部、を備える画像符号化装置である。
（８）本発明のその他の態様は、上述の画像符号化装置であって、前記変位の一部は前記変位の水平成分であって、前記変位の他の一部は前記変位の垂直成分であってもよい。また、前記変位ベクトル生成部は、前記垂直成分、当該垂直成分の予測値もしくは当該垂直成分の予測残差を予め定めた値に定めるように構成されていてもよい。
（９）本発明のその他の態様は、上述の画像符号化装置であって、前記変位の一部は前記変位の水平成分であって、前記変位の他の一部は前記変位の垂直成分であってもよい。また、前記変位ベクトル生成部は、垂直成分と水平方向との関係に基づいて前記変位の垂直成分を算出し、前記垂直成分と水平方向との関係を符号化する符号化部を備えてもよい。
（１０）本発明のその他の態様は、第１レイヤ画像と、前記第１レイヤ画像とは異なる第２レイヤ画像との間の変位を示す符号に基づいて前記変位を示す変位ベクトルを生成する変位ベクトル生成部と、前記変位ベクトルを予め定めた範囲内の値に制限する変位ベクトル制限部と、参照画像を記憶する参照画像記憶部と、前記参照画像記憶部から、前記変位ベクトル生成部が生成した変位ベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部、を備える画像符号化装置である。
（１１）本発明のその他の態様は、上述の画像符号化装置であって、前記変位ベクトル制限部が前記変位ベクトルの値を制限する範囲において、垂直成分の範囲が水平成分の範囲よりも小さくてもよい。
（１２）本発明のその他の態様は、上述の画像符号化装置であって、導出済みの予測パラメータを画像の領域毎に記憶する予測パラメータ記憶部と、前記予測パラメータ記憶部に記憶された予測パラメータのうち、前記変位ベクトル制限部が制限した変位ベクトルが示す領域に係る予測パラメータを参照して当該変位ベクトルの予測値である予測ベクトルを予測パラメータの少なくとも一部として導出する予測パラメータ導出部とを備えてもよい。
（１３）本発明のその他の態様は、算術符号のコンテキストを導出し、符号化データからベクトル差分を復号するベクトル差分復号部と、処理済みのブロックのベクトルと前記ベクトル差分の和から、対象ブロックのベクトルを導出するベクトル導出部と参照画像を記憶する参照画像記憶部と、前記参照画像記憶部から、前記ベクトル導出部が生成した対象ブロックのベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部と、前記対象ブロックのベクトルもしくは前記ベクトル差分が、異なるレイヤ間の予測であるか否かを判定するリファレンスレイヤ判定部を備え、前記ベクトル差分復号部は、前記リファレンスレイヤ判定部が異なるレイヤ間の予測と判定したか否かに基づいてコンテキストを割り当てる画像復号装置である。
　（１４）本発明のその他の態様は、上述の画像復号装置であって、前記ベクトル差分復号部は、前記リファレンスレイヤ判定部が異なるレイヤ間の予測と判定した場合には、前記ベクトル差分の垂直成分を構成するシンタックス要素と前記ベクトル差分の水平成分を構成するシンタックス要素にそれぞれ異なるコンテキストを割り当てるように構成されていてもよい。
　（１５）本発明のその他の態様は、上述の画像復号装置であって、前記ベクトル差分復号部は、前記リファレンスレイヤ判定部が異なるレイヤ間の予測と判定した場合と、異なるレイヤ間の予測と判定しない場合とで、少なくとも前記ベクトル差分の一方の成分を構成するシンタックス要素に前記それぞれ異なるコンテキストを割り当てるように構成されていてもよい。
　（１６）本発明のその他の態様は、上述の画像復号装置であって、前記シンタックス要素は、前記ベクトル差分の絶対値が０を超えるか否かを示す情報であってもよい。
　（１７）本発明のその他の態様は、上述の画像復号装置であって、前記リファレンスレイヤ判定部は、対象ブロックが属する対象画像と参照画像とが属する参照画像に係る時刻、ビュー識別子又は長時間参照画像が互いに異なるか否かを用いて、異なるレイヤ間の予測であることを判定するように構成されていてもよい。
（１８）本発明のその他の態様は、上述の画像復号装置であって、前記リファレンスレイヤ判定部は、対象画像が属する対象画像が、基準レイヤに係る画像ではないこと、又は基準ビューに係る画像でないことに基づいて、異なるレイヤ間の予測であることを判定するように構成されていてもよい。
（１９）本発明のその他の態様は、算術符号のコンテキストを導出し、ベクトル差分を符号化するベクトル差分符号化部と、処理済みのブロックのベクトルと対象ブロックのベクトルから、前記ベクトル差分を導出するベクトル差分導出部と、参照画像を記憶する参照画像記憶部と、前記参照画像記憶部から、対象ブロックのベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部と、ベクトルもしくはベクトル差分が、異なるレイヤ間の予測であるか否かを判定するリファレンスレイヤ判定部を備え、前記ベクトル差分符号化部は、前記リファレンスレイヤ判定部が異なるレイヤ間の予測と判定したか否かに基づいてコンテキストを割り当てる画像符号化装置である。
（２０）本発明のその他の態様は、導出済みの予測パラメータを画像の予め定めた領域毎に記憶する予測パラメータ記憶部と、対象予測ブロックの予測パラメータもしくは予測ベクトルを導出する予測パラメータ導出部と、参照画像を記憶する参照画像記憶部と、前記参照画像記憶部から、前記予測パラメータ導出部が導出したベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部を備え、前記予測パラメータ導出部は、前記予測パラメータ記憶部に記憶された予測パラメータを参照する予測パラメータ参照部を備え、前記予測パラメータ参照部は、前記対象予測ブロックに属する対象画像と、前記参照画像の一部である参照ブロックが属する参照画像が異なるレイヤに属する場合には、参照ブロックの予測パラメータを参照する座標を変換するインターレイヤ参照アドレス変換部を備える画像復号装置である。
（２１）本発明のその他の態様は、上述の画像復号装置であって、前記インターレイヤ参照アドレス変換部は、座標を変換する演算は、当該座標をより大きい単位で離散化する演算を含むように構成されていてもよい。
（２２）本発明のその他の態様は、導出済みの予測パラメータを画像の予め定めた領域毎に記憶する予測パラメータ記憶部と、対象予測ブロックの予測パラメータもしくは予測ベクトルを導出する予測パラメータ導出部と、参照画像を記憶する参照画像記憶部と、前記参照画像記憶部から、前記予測パラメータ導出部が導出したベクトルが示す領域の参照画像を読み出し、読み出した参照画像に基づいて予測画像を生成する予測画像生成部を備え、前記予測パラメータ導出部は、前記予測パラメータ記憶部に記憶された予測パラメータを参照する予測パラメータ参照部を備え、さらに、前記予測パラメータ参照部は、前記対象予測ブロックの属する対象画像と、前記参照画像の一部である参照ブロックが属する参照画像が異なるレイヤに属する場合には、参照ブロックの予測パラメータを参照する座標を変換するインターレイヤ参照アドレス変換部を備える画像符号化装置である。　
　なお、上述した実施形態における画像符号化装置１１－１１ｈ、画像復号装置３１－３１ｈの一部、例えば、エントロピー復号部３０１、予測パラメータ復号部３０２、予測ピクチャ生成部１０１、ＤＣＴ・量子化部１０３、エントロピー符号化部１０４、逆量子化・逆ＤＣＴ部１０５、符号化パラメータ決定部１１０、予測パラメータ符号化部１１１、エントロピー復号部３０１、予測パラメータ復号部３０２、予測ピクチャ生成部３０８、逆量子化・逆ＤＣＴ部３１１をコンピュータで実現するようにしても良い。その場合、この制御機能を実現するためのプログラムをコンピュータ読み取り可能な記録媒体に記録して、この記録媒体に記録されたプログラムをコンピュータシステムに読み込ませ、実行することによって実現しても良い。なお、ここでいう「コンピュータシステム」とは、画像符号化装置１１－１１ｈ、画像復号装置３１－３１ｈのいずれかに内蔵されたコンピュータシステムであって、ＯＳや周辺機器等のハードウェアを含むものとする。また、「コンピュータ読み取り可能な記録媒体」とは、フレキシブルディスク、光磁気ディスク、ＲＯＭ、ＣＤ－ＲＯＭ等の可搬媒体、コンピュータシステムに内蔵されるハードディスク等の記憶装置のことをいう。さらに「コンピュータ読み取り可能な記録媒体」とは、インターネット等のネットワークや電話回線等の通信回線を介してプログラムを送信する場合の通信線のように、短時間、動的にプログラムを保持するもの、その場合のサーバやクライアントとなるコンピュータシステム内部の揮発性メモリのように、一定時間プログラムを保持しているものも含んでも良い。また上記プログラムは、前述した機能の一部を実現するためのものであっても良く、さらに前述した機能をコンピュータシステムにすでに記録されているプログラムとの組み合わせで実現できるものであっても良い。
　また、上述した実施形態における画像符号化装置１１－１１ｅ、画像復号装置３１－３１ｅの一部、または全部を、ＬＳＩ（Ｌａｒｇｅ　Ｓｃａｌｅ　Ｉｎｔｅｇｒａｔｉｏｎ）等の集積回路として実現しても良い。画像符号化装置１１－１１ｅ、画像復号装置３１－３１ｅの各機能ブロックは個別にプロセッサ化しても良いし、一部、または全部を集積してプロセッサ化しても良い。また、集積回路化の手法はＬＳＩに限らず専用回路、または汎用プロセッサで実現しても良い。また、半導体技術の進歩によりＬＳＩに代替する集積回路化の技術が出現した場合、当該技術による集積回路を用いても良い。
　以上、図面を参照してこの発明の一実施形態について詳しく説明してきたが、具体的な構成は上述のものに限られることはなく、この発明の要旨を逸脱しない範囲内において様々な設計変更等をすることが可能である。
　本発明は、複数の視点の画像を符号化する装置や、符号化された画像を復号する装置などに適用できる。
　１　　画像伝送システム
　１１、１１ａ－１１ｈ　　画像符号化装置
　１０１　　予測ピクチャ生成部
　１０２　　減算部
　１０３　　ＤＣＴ・量子化部
　１０４、１０４ｆ、１０４ｇ　　エントロピー符号化部
　１０４１　　算術符号化部
　１０４１１　　コンテキスト記録更新部
　１０４１２　　ビット符号化部
　１０４２ｆ　　リファレンスレイヤ判定部
　１０４３ｆ、１０４３ｇ　　ベクトル差分シンタックス符号化部
　１０４４ｇ　　ターゲットレイヤ判定部
　１０５　　逆量子化・逆ＤＣＴ部
　１０６　　加算部
　１０８　　予測パラメータメモリ
　１０９　　参照ピクチャメモリ
　１１０　　符号化パラメータ決定部
　１１１　　予測パラメータ符号化部
　１１２、１１２ｃ　　インター予測パラメータ符号化部
　１１２１、１１２１ｅ、１１２２ｈ　　マージ予測パラメータ導出部
　１１２１３　　予測パラメータ参照部
　１１２１１　　マージ候補導出部
　１１２１２　　マージ候補選択部
　１１２２、１１２２ｈ　　ＡＭＶＰ予測パラメータ導出部
　１１２３、１１２３ａ　　減算部
　１１２４、１１２４ａ、１１２４ｄ　　変位ベクトルクリップ部
　１１２５　　変位ベクトル生成部
　１１２６　　予測パラメータ統合部
　１１２７　　ベクトル候補導出部
　１１２８　　予測ベクトル選択部
　１１２９　　予測パラメータ参照部
　１１３　　イントラ予測パラメータ符号化部
　２１　　ネットワーク
　３１、３１ａ－３１ｈ　　画像復号装置
　３０１、３０１ｆ、３０１ｇ　　エントロピー復号部
　３０１１　　算術符号復号部
　３０１１１　　コンテキスト記録更新部
　３０１１２　　ビット復号部
　３０１２　　リファレンスインデックス復号部
　３０１３、３０１３ｆ、３０１３ｇ　　ベクトル差分シンタックス復号部
　３０１４　　レイヤＩＤ復号部
　３０１７１　　ターゲットレイヤ判定部
　３０２　　予測パラメータ復号部
　３０３、３０３ｃ、３０３ｄ　　インター予測パラメータ復号部
　３０３１　　インター予測パラメータ抽出部
　３０３１１　　リファレンスレイヤ判定部
　３０３１２　　ベクトル差分復号部
　３０３２、３０３２ａ、３０３２ｈ　　ＡＭＶＰ予測パラメータ導出部
　３０３２１ａ　　視差予測ベクトルクリップ部
　３０３３　　ベクトル候補導出部
　３０３３５、３０３３５ｅ　　拡張ベクトル候補導出部
　３０３３６　　変位ベクトル取得部
　３０３３７　　インターレイヤベクトル候補導出部
　３０３３８　　変位ベクトルクリップ部
　３０３３９　　ベクトル候補格納部
　３０３４　　予測ベクトル選択部
　３０３５　　加算部
　３０３６、３０３６ｅ、３０３６ｈ　　マージ予測パラメータ導出部
　３０３６０　　拡張マージ候補導出部
　３０３６１　　変位ベクトル取得部
　３０３６３　　インターレイヤマージ候補導出部
　３０３６４　　マージ候補導出部
　３０３６５　　マージ候補選択部
　３０３７　　変位ベクトルクリップ部
　３０３７１　　リファレンスレイヤ判定部
　３０３７２　　ベクトルクリップ部
　３０３８　　変位ベクトル生成部
　３０３８１　　リファレンスレイヤ判定部
　３０３８２　　変位ベクトル設定部
　３０３９　　予測パラメータ参照部
　３０３９１　　空間予測参照アドレス変換部
　３０３９２　　時間予測参照アドレス変換部
　３０３９３　　インターレイヤ参照アドレス変換部
　３０４　　イントラ予測パラメータ復号部
　３０６　　参照ピクチャメモリ
　３０６１　　内部メモリ
　３０７　　予測パラメータメモリ
　３０７１　　対象ＣＴＢ予測パラメータメモリ
　３０７２　　左ＣＴＢコラム予測パラメータメモリ
　３０７３　　上ＣＴＢライン予測パラメータメモリ
　３０７４　　時間予測パラメータメモリ
　３０７５　　インターレイヤ予測パラメータメモリ
　３０７６　　内部メモリ
　３０８　　予測ピクチャ生成部
　３０９　　インター予測ピクチャ生成部
　３０９１　　変位予測ピクチャ生成部
　３１０　　イントラ予測ピクチャ生成部
　３１１　　逆量子化・逆ＤＣＴ部
　３１２　　加算部
　４１　　画像表示装置
Patent WO2014050948A1 - 画像復号装置及び画像符号化装置 - Google Patents
