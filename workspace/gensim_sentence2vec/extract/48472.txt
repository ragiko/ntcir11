
Access Tips by pPoy
Top    Query  Form  Report  Sub  Function  Excel  Etc.  Word
Query
グループ毎のTOP5を表示するクエリ《グループ毎の順位付け、サブクエリ》(Ac97,Ac2000,Ac2002)
Access で、全体の TOP5 を表示するのは簡単です。
クエリのデザイン画面で、ツールバーの 「TOP値」 を、「 5 」 に変更するだけで済みます。ところがこれでは、全体の中の TOP5 しか表示できません。
以下は、グループ毎の TOP 値を表示する方法です。
グループ毎の順位を取得するために、サブクエリを使用します。
≪準備≫
「tbl_参加住所」 には、75 件のデータがあります。
この中の、「県名」 毎に参加人数の上位5位までを表示させようと思います。
まず、表示順を設定するクエリを作成します。
同時に、一番先頭に順位設定用のフィールドを追加します。ここにサブクエリを入力します。
順位用のフィールドで、「Shift+F2」 を押して、ズームウィンドウを表示させます。
その中に以下のように入力します。
順位: (SELECT Count(*) FROM tbl_参加住所 AS tbl_a1 
WHERE (tbl_a1!県No = tbl_参加住所!県No) 
and (tbl_a1!参加人数 > tbl_参加住所!参加人数)) +1
≪注意≫
これは、見やすいように改行していますが、クエリの中では全て1行に入力します。
勿論ズームウィンドウの中でも改行はしません。
このサブクエリでは、「tbl_参加住所」 の別名として、「tbl_a1」 を指定しています。
サブクエリの意味は、
同一の県Noのデータの中から、現在のレコードよりも参加人数の大きな数値を持つレコードの数を数え、且つそれに 「1」 プラスしています。
結果的に同一県名の順位が振られることになります。
Access #Q013 ≪グループ毎のTOP5を表示するクエリ《グループ毎の順位付け、サブクエリ》≫
