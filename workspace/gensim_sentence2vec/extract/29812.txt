電圧均等化装置および方法  
　本発明は、複数の電池セルを接続して構成される組電池の電圧の均等化を制御する電圧均等化装置および方法に関する。
　いわゆるハイブリッドカー、プラグインハイブリッドカー、あるいはハイブリッドビークル、ハイブリッドエレクトリックビークルなどと呼ばれる、エンジンに加えてモータ（電動機）を動力源として備えた車両または輸送機械（以下、「車両」と称する）が実用化されている。さらには、エンジンを備えずモータのみで車両を駆動する電気自動車も実用化されつつある。それらのモータを駆動する電源として、小型、大容量の特徴を有するリチウムイオン電池が使用されるようになってきている。そして、このような用途においては、複数の電池セルが例えば直列に接続されて電池ブロック（以下、単に「ブロック」と呼ぶ）が構成され、さらにこのブロックを組み合わせて接続される組電池として構成される場合がある。電池セルの直列接続により車両のモータを駆動するのに必要な高電圧が得られ、ブロックをさらに直列や並列に組み合わして接続することにより必要な電流容量やさらなる高電圧が得られる。
　この場合、リチウムイオン電池は温度による特性の変化が大きく、電池が使用される環境の温度によって電池の残存容量や充電効率も大きく変化する。自動車のような使用環境ではなおさらである。
　この結果、ブロックを構成する電池セルにおいて、各電池セルの残存容量および出力電圧にばらつきが生じる。各電池セルが発生する電圧にばらつきが発生すると、１つのセルの電圧が駆動可能な閾値を下回ったような場合に、全体の電源供給を止めたり抑制したりする必要が生じ、電力効率が低下してしまう。このため、各電池セルの電圧の均等化を行う電圧均等化制御が必要となる。さらには、ブロック間でも電圧の均等化を行う必要も生じる。
　電圧均等化制御の従来技術として、放電が必要な電池セルからの放電電力を、インダクタとトランスを組み合わせて構成されるバランス回路によって、充電が必要な電池セルに充電させる、いわゆるアクティブ方式の電圧均等化制御技術が知られている（例えば、特許文献１に記載の技術）。
　この従来技術では、ブロック内の電池セル間では、放電が必要な電池セルから充電が必要な電池セルにオン、オフを繰り返すスイッチ素子とインダクタを使って電力を移動させることで、電池セル間のセルバランスを実行する。また、ブロック間では、オン、オフを繰り返すスイッチ素子とトランスを用いることにより、組電池全体から放電される電力をトランスの一次巻線から二次巻線を介して各ブロックに移動させることにより、ブロック間のセルバランスを実行する。
　この従来技術は、ある電池セルからの放電電力を他の電池セルへの充電電力として使用することで電力損失を少なくし、また、直列接続数の多い多直列蓄電セルにおいて全電池セルの電圧バランス補正を迅速かつ円滑に行わせることを目的にしている。
　しかし、この従来技術では、トランスの二次巻線を介して各ブロックに均等に電力が供給されてしまうため、例えば特に電圧が低いブロックに対して効率的にセルバランスを実行することが難しいという問題点を有している。
　本発明は、各ブロックに対して効率的かつ高精度にセルバランスを実行することを目的とする。
　態様の一例は、複数の電池セルが直列に接続されて構成されるブロックがさらに複数直列に接続された構成を含む組電池における複数の電池セルの電圧を均等化させる電圧均等化装置であって、各ブロックに接続される巻線を含むトランスを有し、各巻線を介して各ブロック間でエネルギーの授受を行うことにより、前記各ブロックの電圧を個別または一括に均等化するバランス回路と、目標電圧から所定の閾値以上離れているブロックの電圧が個別に均等化された後に、全てのブロックの電圧が一括して均等化されるように、バランス回路の動作を制御する制御部と、を備える。
　本発明によれば、トランスの各二次巻線から各ブロックに対する均等化を各ブロックの個別のスイッチングにより個別に行うとともに、均等化の追い込み（均等化の最後の調整）は全ブロックに対する一括したスイッチングにより行うことが可能となるため、各ブロックに対して時間を短縮しながら効率的かつ高精度にセルバランスを実行することが可能となる。
電圧均等化装置を示す図である。 電圧均等化制御を説明するための図である。 制御部の動作を説明するためのフローチャート（その１）である。 制御部の動作を説明するためのフローチャート（その２）である。 制御部の動作を説明するためのフローチャート（その３）である。 制御部の動作を説明するためのフローチャート（その４）である。 他の実施形態の電圧均等化装置を示す図である。 
　以下、本発明を実施するための形態について図面を参照しながら詳細に説明する。
　図１は、本発明の実施形態の電圧均等化装置を示す図である。なお、本実施形態の電圧均等化装置は、例えば、ハイブリッドカー、プラグインハイブリッドカー、又は電気自動車などの車両に搭載されるものであって、その車両に搭載される組電池（バッテリ）を構成する複数の電池セルの各電圧を均等化させるものとする。
　複数の電池セルが直列に接続されてブロック１０２が構成され、さらにそのブロック１０２が複数直列に接続されて組電池１０１が構成される。図１では、＃１～＃ＮのＮ個（Ｎは１以上の自然数）のブロック１０２が直列に接続されて組電池１０１が構成される。
　各ブロック１０２内の各電池セル間のセルバランスは、特には図示しないバランス回路によって行われる。このバランス回路は例えば、ブロック１０２内の各電池セルから放電される電力を、スイッチ素子およびインダクタを含む回路を介して、そのブロック１０２内の隣接する電池セルに充電させる回路である。
　トランスバランス回路１０３（バランス回路）は、スイッチ素子１０９、トランス１０８、＃１～＃Ｎのダイオード１１３、＃１～＃Ｎのスイッチ素子１１４を備える。これらのスイッチ素子１１４は、スイッチ素子１０９とともに、スイッチング部を構成する。トランス１０８は、＃１～＃Ｎの二次巻線１１１、一次巻線１１０、鉄心１１２、補助巻線１１８、電圧センサ１１５を備える。一次巻線１１０は、組電池１０１の両出力端子１０６、１０７に接続される。＃１～＃Ｎの各二次巻線１１１は、一次巻線１１０に対して逆巻で所定の巻数比を有し、＃１～＃Ｎ各ダイオード１１３および＃１～＃Ｎの各スイッチ素子１１４を介して＃１～＃Ｎの各ブロック１０２の両極に接続される。
　スイッチ素子１０９は、例えばＦＥＴ（電界効果トランジスタ）であり、制御部１０５からのパルス信号によりオン、オフを繰り返すスイッチング動作を行う。スイッチ素子１１４も例えばＦＥＴ（電界効果トランジスタ）であるが、制御部１０５から制御線１１６を介した指示により、オンまたはオフのスイッチ動作を行う。
　トランス１０８の補助巻線１１８は、各二次巻線１１１と同じ巻数比を備え、各二次巻線１１１に発生している電圧と同等の電圧を電圧センサ１１５を介して検出する。
　＃１～＃Ｎの各電圧センサ１０４は、＃１～＃Ｎの各ブロック１０２の出力電圧を監視し、制御線１１７を介して制御部１０５に通知する。
　制御部１０５は、例えばデジタルシグナルプロセッサ（ＤＳＰ：Ｄｉｇｉｔａｌ　Ｓｉｇｎａｌ　Ｐｒｏｃｅｓｓｏｒ）によって構成される。
　制御部１０５は、個別のバランス制御（均等化制御）時には、＃１～＃Ｎの各電圧センサ１０４を介して＃１～＃Ｎの各ブロック１０２のブロック電圧を検出しながら、ブロック電圧が目標電圧から所定の閾値以上離れているブロックを、制御対象のブロックとして検出する。そして、制御部１０５は、その制御対象のブロック１０２に対応するスイッチ素子１１４をオンするとともに、制御対象のブロック１０２のブロック電圧と目標電圧との差に応じて、スイッチ素子１０９を動作させるパルス信号の周波数とデューティー比を決定し、そのパルス信号をスイッチ素子１０９に供給する。この結果、そのパルス信号に基づくスイッチ素子１０９のスイッチング動作により制御対象のブロック１０２に接続されている二次巻線１１１の側に発生した電圧に基づいて、その二次巻線１１１に接続されるダイオード１１３およびスイッチ素子１１４を介して、制御対象のブロック１０２に個別のバランス制御の充電が行われる。なお、個別のバランス制御とは、全てのブロック１０２の電圧のうち、制御対象となったブロックの電圧のみを均等化させることである。
　制御部１０５は、各ブロック１０２に対する個別のバランス制御後の一括のバランス制御時には、＃１～＃Ｎの全てのブロック１０２に対応する＃１～＃Ｎの全てのスイッチ素子１１４をオンする。そして、制御部１０５は、トランス１０８の補助巻線１１８および電圧センサ１１５を介して各二次巻線１１１側の電圧と同等の電圧を検出しながらその電圧を目標電圧と比較しながら、一括のバランス制御を行う。このとき、制御部１０５は、上述の電圧センサ１１５の電圧と目標電圧との差に応じて、スイッチ素子１０９を動作させるパルス信号の周波数とデューティー比を決定し、そのパルス信号をスイッチ素子１０９に供給する。この結果、そのパルス信号に基づくスイッチ素子１０９のスイッチング動作により＃１～＃Ｎの全ての二次巻線１１１の側に発生した電圧に基づいて、各二次巻線１１１に接続されるダイオード１１３およびスイッチ素子１１４を介して、＃１～＃Ｎの全てのブロック１０２に一括のバランス制御の充電が行われる。なお、一括のバランス制御とは、全てのブロック１０２の電圧を均等化させることである。
　例えば、車両のイグニッションオフ時に実行されるセルバランス開始後の時間経過において、図２に示すような電圧均等化制御が行われる。まず、複数のブロック１０２のうち電圧が低くセルバランス制御の対象となるブロック１０２の電圧２０２と、全てのブロック１０２の電圧の平均値（目標電圧）との電圧差が大きい範囲２０４では、制御対象のブロック１０２に接続されるスイッチ素子１１４のみがオンされることにより、そのブロック１０２に対してのみ個別のバランス制御が実施される。これにより、各ブロック１０２の電圧を、従来より短い時間で均等化させることが可能となる。これとともに、各ブロック１０２の電圧と全てのブロック１０２の電圧の平均値（目標電圧）との差が、ある一定の閾値１内の範囲２０３に入る期間２０５になったら、＃１～＃Ｎの全てのブロック１０２に接続される＃１～＃Ｎの全てのスイッチ素子１１４がオンされることにより、全てのブロック１０２に対して一括のバランス制御が実施される。
　以上の個別制御と一括制御を組み合わせたバランス制御により、目標電圧への追込みでは、補助巻線１１８と電圧センサ１１５を介して検出される各ブロック１０２の平均電圧で電圧均等化制御を行うので、トランス１０８の二次巻線１１１の巻線間の電圧精度で、全てのブロック１０２に対して一括で目標電圧に到達するような制御を行うことが可能となる。この結果、各ブロック１０２に対して時間を短縮しながら効率的かつ高精度にセルバランス制御を実施することが可能となる。
　図３～図５は、図１に示される制御部の動作を示すフローチャートである。この動作例は、図１の制御部１０５内の特には図示しないプロセッサが特には図示しないメモリに記憶された制御プログラムを実行する動作として実現される。以下の説明では、随時図１の各部分を参照するものとする。
　まず、制御部１０５は、＃１～＃Ｎの電圧センサ１０４が検出する各ブロック１０２の電圧（ブロック電圧）＃１～＃Ｎの平均値を算出して、その平均値を個別のバランス制御の目標値（目標電圧）として設定する（図３のステップＳ３０１）。
　次に、制御部１０５は、個別のバランス制御を実施すべきか否かを判定すべきブロック１０２の番号＃ｉとして＃ｉ＝１を設定した後（図３のステップＳ３０２）、＃ｉを＋１ずつしながら（図３のステップＳ３０６）、＃ｉ番目のブロック１０２のブロック電圧＃ｉが、ステップＳ３０１で算出した目標値から閾値１を減算した電圧値よりも高くないと判定されるまで（図３のステップＳ３０３：Ｎｏ）、又は、＃ｉ＝Ｎであると判定されるまで（図３のステップＳ３０５：ＹＥＳ）、ステップＳ３０３、Ｓ３０５、及びＳ３０６の処理を繰り返し実行する。
　制御部１０５は、＃ｉ番目のブロック１０２のブロック電圧＃ｉが、ステップＳ３０１で算出した目標値から閾値１を減算した電圧値よりも高くなったか否かを判定する（ステップＳ３０３）。
　制御部１０５は、ブロック電圧＃ｉが（目標値－閾値１）よりも高くステップＳ３０３の判定がＹＥＳならば、＃ｉのブロック１０２については個別のセルバランス制御を行う必要はないため、ステップＳ３０５からステップＳ３０６に進んで、＃ｉを＋１する。
　制御部１０５は、ブロック電圧＃ｉが（目標値－閾値１）よりも高くなくステップＳ３０３の判定がＮＯならば、＃ｉのブロック１０２については個別のセルバランス制御を行う必要があると判定する。
　この場合、制御部１０５は、制御対象となるブロック＃ｉのブロック電圧を制御対象とし、＃ｉのスイッチ素子１１４のみをオンする（図３のステップＳ３０４）。その後、制御部１０５は、図４のステップＳ４０１に移行し、＃ｉのブロック１０２に対して、個別のバランス制御を実施する。制御対象となるブロック電圧は制御線１１７を介して制御部１０５へフィードバックされる。
　まず、制御部１０５は、＃１～＃Ｎの電圧センサ１０４が検出する各ブロック１０２の電圧（ブロック電圧）＃１～＃Ｎの平均値を算出して、その平均値を＃ｉのブロック１０２に対する個別のバランス制御の目標値として設定する（図４のステップＳ４０１）。
　次に、制御部１０５は、＃ｉのブロック１０２の内部抵抗の値（もしくは温度）からスイッチ素子１０９をスイッチング制御するパルス信号の周波数とデューティー比を計算し、設定する（図４のステップＳ４０２）。
　具体的には、制御部１０５は例えば、車両のアイドリング時等で、組電池１０１に電流が流れていると判定したときには、＃１の電圧センサ１０４から検出されるブロック電圧＃ｉを、別途算出した組電池１０１を流れる電流値で除算することにより、＃ｉのブロック１０２の内部抵抗を算出する。また、制御部１０５は例えば、車両のイグニッションオフ時等で、組電池１０１に電流が流れていないと判定したときには、特には図示しない温度センサから組電池１０１の温度値を取得する。そして、制御部１０５は、ブロック電圧＃ｉと上記温度値とで、内部に保持している温度毎の電圧・温度対内部抵抗マップを参照して、内部抵抗を推定する。
　次に、制御部１０５は、上述のようにして算出した内部抵抗の値から、例えば以下の計算に基づいて、パルス信号の周波数とデューティー比を計算する。
　まず、トランス１０８の一次巻線１１０の巻数をＮ１、二次巻線１１１の巻数をＮ２とする。また、パルス信号の周波数をｆｒｅｑ、周期をＴ、パルスオン時間をｔon、デューティー比をＤ、一次巻線１１０側の電圧をＶin、二次巻線１１１側の電圧をＶo#12392;すれば、次式が成り立つ。
　上記数１式および数２式に基づいて、算出された内部抵抗の値に対応して設定した電流許容値、出力したい電力、パルス周波数ｆｒｅｑから、スイッチ素子１０９に与えられるパルス信号のデューティー比Ｄを計算することができる。または、逆にデューティー比Ｄを任意で決定しておき、パルス周波数ｆｒｅｑを決定してもよい。
　なお、パルス信号の周波数ｆｒｅｑとデューティー比Ｄは簡易的に任意の値に設定されてもよい。
　制御部１０５は、以上のようして決定したパルス周波数ｆｒｅｑおよびデューティー比Ｄを有するパルス信号をスイッチ素子１０９に供給する（ＰＷＭ出力を行う）ことにより、スイッチング制御を実行する（図４のステップＳ４０３）。
　次に、制御部１０５は、一定時間のスイッチング制御の後に、ステップＳ４０１で算出した目標値と、制御対象である＃ｉのブロック１０２から制御線１１７を介して通知されるブロック電圧＃ｉ（図３のステップＳ３０４参照）との差を誤差として算出する（図４のステップＳ４０４）。制御対象とは、制御部１０５に電圧をフィードバックする対象である。
　そして、制御部１０５は、上記誤差が、閾値１よりも小さな所定の閾値２よりも小さくなったか否かを判定する（ステップＳ４０５）。個別のバランス制御では、閾値２は閾値１以下であればよく、閾値１より小さい値が好ましい。
　誤差が閾値２よりも小さくなっておらずステップＳ４０５の判定がＮＯならば、制御部１０５は、ステップＳ４０１の処理に戻って目標値を算出し直し、＃ｉのブロック１０２に対する個別のバランス制御を繰り返し実行する。
　以上の図４のステップＳ４０１からステップＳ４０５までの一連の繰返し処理により誤差が閾値２よりも小さくなってステップＳ４０５の判定がＹＥＳになると、制御部１０５は、スイッチ素子１０９に対するスイッチング制御（ＰＷＭ出力）を停止する（図４のステップＳ４０６）。これにより、＃ｉのブロック１０２に対する個別のバランス制御が終了する。
　次に、制御部１０５は、図３のステップＳ３０１の処理に戻り、図３のステップＳ３０１からＳ３０６の、個別のバランス制御を行うべきブロック１０２が存在するか否かを再び判定する一連の処理に戻る。
　＃１～＃Ｎのどのブロック電圧も（目標値－閾値１）よりも高くなって個別のバランス制御を行うべきブロック１０２が存在しなくなり、図３のステップＳ３０５の判定がＹＥＳになると、制御部１０５は、図５のステップＳ５０１の処理に移行する。これ以降、一括のバランス制御が実施される。
　まず、制御部１０５は、＃１～＃Ｎの電圧センサ１０４から検出されるブロック電圧＃１～＃Ｎのいずれかが、現在の目標値（図３のステップＳ３０１で設定された値）から、閾値２以上離れているか否かを判定する（図５のステップＳ５０１）。
　ブロック電圧＃１～＃Ｎのいずれかが目標値から閾値２以上離れておりステップＳ５０１の判定がＹＥＳならば、制御部１０５は、トランス１０８の補助巻線１１８および電圧センサ１１５を介して出力される電圧を制御対象とする。また、制御部１０５は、＃１～＃Ｎの全てのスイッチ素子１１４をオンする（図５ステップＳ５０２）。この結果これ以降、制御部１０５は、一括のバランス制御を実行することになる。
　まず、制御部１０５は、＃１～＃Ｎの電圧センサ１０４が検出する各ブロック１０２の電圧（ブロック電圧）＃１～＃Ｎの平均値を算出して、その平均値を一括のバランス制御の目標値として設定する（図５のステップＳ５０３）。
　次に、制御部１０５は、組電池１０１全体の内部抵抗の値（もしくは温度）からスイッチ素子１０９をスイッチング制御するパルス信号の周波数とデューティー比を計算し、設定する（図５のステップＳ５０４）。
　次に、制御部１０５は、上述のようにして算出した内部抵抗の値から、個別のバランス制御時の図４のステップＳ４０４の説明で前述した数１式、数２式の計算等に基づいて、パルス信号の周波数とデューティー比を計算する。
　制御部１０５は、以上のようして決定したパルス周波数ｆｒｅｑおよびデューティー比Ｄを有するパルス信号をスイッチ素子１０９に供給する（ＰＷＭ出力を行う）ことにより、スイッチング制御を実行する（図５のステップＳ５０５）。
　次に、制御部１０５は、一定時間のスイッチング制御の後に、ステップＳ４０３で算出した目標値と、最も低いブロック電圧（図５のステップＳ５０２参照）との差を誤差として算出する（図５のステップＳ５０６）。
　そして、制御部１０５は、上記誤差が、閾値１よりも小さな所定の閾値２よりも小さくなったか否かを判定する（図５のステップＳ５０７）。
　誤差が閾値２よりも小さくなっておらずステップＳ５０７の判定がＮＯならば、制御部１０５は、ステップＳ５０３の処理に戻って目標値を算出し直し、＃１～＃Ｎの全てのブロック１０２に対する一括のバランス制御を繰り返し実行する。
　以上の図５のステップＳ５０３からステップＳ５０７までの一連の繰返し処理により誤差が閾値２よりも小さくなってステップＳ５０７の判定がＹＥＳになると、制御部１０５は、スイッチ素子１０９に対するスイッチング制御（ＰＷＭ出力）を停止する（図５のステップＳ５０８）。これにより、＃１～＃Ｎの全てのブロック１０２に対する一括のバランス制御が終了する。
　なお、上述の一括のバランス制御を行う前に、＃１～＃Ｎの電圧センサ１０４から検出されるブロック電圧＃１～＃Ｎのいずれもが目標値から閾値２よりも小さい範囲に収まっており、図５のステップＳ５０１の判定がＮＯならば、制御部１０５は、一括のバランス制御は行う必要はなく、セルバランス制御の動作を終了する。
　図６は、図３の制御動作例に変わる他の制御動作例のフローチャートを示す図である。
　図６の制御動作例では、図３のステップＳ３０２からＳ３０６の処理が、図５のステップＳ５０１とＳ５０２の処理に置き換えられている。ステップＳ３０１の処理は、図３の場合と同様である。
　制御部１０５は、ステップＳ３０１の処理の後、＃１～＃Ｎの電圧センサ１０４から検出されるブロック電圧＃１～＃Ｎのいずれかが、ステップＳ３０１で算出した目標値から閾値１以上離れているか否かを判定する（ステップＳ６０１）。
　ブロック電圧＃１～＃Ｎのいずれかが目標値から閾値１以上離れておりステップＳ６０１の判定がＹＥＳならば、制御部１０５は、ブロック電圧が一番低いブロック１０２について個別のセルバランス制御を行う必要があると判定する。
　この場合、制御部１０５は、制御電圧として一番低いブロック電圧を使用すると共に、そのブロック１０２に接続されているスイッチ素子１１４をオンする（図６のステップＳ６０２）。その後、制御部１０５は、図４のステップＳ４０１に移行し、そのブロック１０２に対して、個別のバランス制御を実施する。図４での処理は、前述したものと同様である。
　ブロック電圧＃１～＃Ｎのいずれもが目標値から閾値１以上離れておらずステップＳ６０１の判定がＮＯならば、制御部１０５は、図５のステップＳ５０１の処理に移行する。これ以降、前述した一括のバランス制御が実施される。
　以上の第１の実施形態の制御動作例により、個別制御と一括制御を組み合わせたバランス制御が可能となる。
　以上説明した図１の実施形態では、トランスバランス回路１０３として、トランス１０８を用いた回路構成例について説明したが、この回路部分は上記回路構成例に限られるものではない。
　トランスバランス回路としては例えば、図７（ａ）のような、２つのトランスＴ１、Ｔ２とそれらを駆動する２つのスイッチ素子ＳＷ１、ＳＷ２と、各ブロック１０２に接続される整流用のダイオードＤとを備えるフライバック型の回路によって実現できる。ブロック１０２の部分は、図１の場合と同じである。この場合、個別のバランス制御時には、スイッチ素子ＳＷ１またはＳＷ２のいずれかが個別に動作し、一括のバランス制御時には、両方が同期動作する。
　あるいは、トランスバランス回路としては例えば、図７（ｂ）のような、図１のトランス１０８と同様のトランスＴと、図１のスイッチ素子１１４と同様のスイッチ素子ＳＷ１、ＳＷ２と、図１のスイッチ素子１０９と同様のスイッチ素子ＳＷ３を備える構成に、ブロック１０２ごとに２つずつのダイオードＤと１つずつのインダクタＬを備えるフォワード型の回路によっても実現できる。この場合、個別のバランス制御時には、図１の実施形態の場合と同様に、スイッチ素子ＳＷ１またはＳＷ２のいずれかが個別にオンされた上で、スイッチ素子ＳＷ３がスイッチング動作させられる。また、一括のバランス制御時には、スイッチ素子ＳＷ１とＳＷ２の両方がオンされた上で、スイッチ素子ＳＷ３がスイッチング動作させられる。
Patent WO2013187316A1 - 電圧均等化装置および方法 - Google Patents
