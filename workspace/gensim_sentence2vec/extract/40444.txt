
最小二乗平面の求め方
発行:エスオーエル株式会社
http://www.sol-j.co.jp/
連載「知って得する干渉計測定技術!」
2009年2月10日号 VOL.001
平素は格別のお引き立てを賜り、厚く御礼申し上げます。
干渉計による精密測定やアプリケーション開発情報などをテーマに、
無料にてメールマガジンを配信いたしております。
今回は、お問い合わせが比較的多く、平面度測定の基本にもなる、
「最小二乗平面の求め方」について解説いたします。
平面度と一言に言いましても、その測り方はいろいろ考えられます。
測定対象面から得たデータから、如何にして平面度という指標を取り出すか
を考えなければなりません。
基準となる平面からどれだけズレているかを計算すればよいのですが、
その基準平面をどう計算するかという問題が出てきます。
干渉計から数十万ポイントものデータを得られるわけですから、
できるだけ、その全データを反映させた良い基準平面を計算したいのです。
そこで、選ばれるのが最小二乗平面です。
最小二乗平面とは、最小二乗法によって計算される平面ですが、
測定対象面の全データが計算に反映されます。
また、数学的な話になりますが、ガウス・マルコフの定理というものがあり、
このような測定を行った場合には、最小二乗法が最適であることが分かります。
それでは、最小二乗平面の計算方法に移りましょう。
平面の方程式は、高さをz、面の縦横方向をx,yとすると、
z = a + bx + cy
と書けます。
最小二乗平面は、最小二乗法から求めたa,b,cを
上記平面の方程式に代入してできる平面です。
測定で得られた表面形状データを(x_i,y_i,z_i)とします。
x_i,y_iは各ピクセルの位置で、z_iがその高さデータです。
求めたいa,b,cを未知数として、基準平面と各高さデータの差をE_iとします。
E_i = (a + bx_i + cy_i) - z_i
E_iの二乗の和をFとします。
F = (E_1)^2 + (E_2)^2 + ... + (E_n)^2
= Σ(E_i)^2
このFが最小になるa,b,cを求めることが最小二乗法の目的です。
Fはa,b,cについて2次の式なので、最小値を求めることは、
a,b,cについて偏微分して0となる極値を求めることになります。
実際に偏微分すると、3元連立方程式ができます。
∂F/∂a = 2Σ(a + bx_i + cy_i - z_i) = 0
∂F/∂b = 2Σ(a + bx_i + cy_i - z_i)x_i = 0
∂F/∂c = 2Σ(a + bx_i + cy_i - z_i)y_i = 0
この連立方程式を何とか解いて、a,b,cを求めればよいのです。
コンピュータで計算させるために、これを行列に書き直します。
M[1,1] = Σ1  , M[1,2] = Σx_i    , M[1,3] = Σy_i    ,
M[2,1] = Σx_i, M[2,2] = Σx_i*x_i, M[2,3] = Σx_i*y_i,
M[3,1] = Σy_i, M[3,2] = Σx_i*y_i, M[3,3] = Σy_i*y_i,
v[1] = a, v[2] = b, v[3] = c,
u[1] = Σz_i, u[2] = Σx_i*z_i, u[3] = Σy_i*z_i
としておくと、
Mv = u
という式になります。
後は、コンピュータにガウスの消去法でもLU分解でも方法は何でもいいので、
ベクトル v つまり、a,b,cを計算させます。
(計算効率から、LU分解の方が良いと考えられます。答えは同じですが。)
行列の式 Mv = u の解を書いておくと、
両辺に行列 M の逆行列 M^-1 を左から掛けて、
v = (M^-1)u
となります。(成分を全部書くと長くなるので略。)
これで、a,b,cが計算でき、最小二乗平面が求まります。
あとは、各ピクセルのデータ z_i から、
最小二乗平面の対応する値を引き算することで、
最小二乗平面を基準面としたデータに変換します。
つまり、リチルトされたデータ Z_i ができます。
Z_i = z_i - (a + bx_i + cy_i)
この Z_i の中から、
最小二乗平面の上側に最も離れた点 Z_H(最高点)と
最小二乗平面の下側に最も離れた点 Z_L(最低点)を
コンピュータに検索させます。
こうして、平面度の指標の一つであるTIR
(Total Indicator Reading または Total Indicated Reading)
は、最高点の絶対値と最低点の絶対値の和として計算されます。
TIR = |Z_H| + |Z_L|
このように、平面度を測定するという技術のほんの一部を見るだけでも
いろいろな要素が含まれています。
今後も測定技術や干渉計といったものを中心に紹介していきたいと思います。
--
高野智暢
連 絡 先 
エスオーエル株式会社
〒335-0012 埼玉県戸田市中町1-34-1
Tel: 048-441-1133 Fax: 048-445-1678
Email: sales@sol-j.co.jp Web: http://www.sol-j.co.jp
--デモ測定を承ります-- 詳細は上記Webサイトまで
D.0001. 最小二乗平面の求め方 - エスオーエル
