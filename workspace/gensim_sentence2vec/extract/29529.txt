
4 パフォーマンス向上のためのチューニング
この章では、最高のパフォーマンスを得るためのデプロイメントのチューニングを容易にするDirectory Server機能について紹介します。Directory Server自体にも、ほとんどすべての操作のパフォーマンスを強化する機能が含まれています。
この章の内容は、次のとおりです。
キャッシュの最適化
ログ管理の機能強化
参照先
4.1 キャッシュの最適化
クライアントのリクエストに対して迅速に応答できるように、Directory Serverは、ディレクトリの情報をメモリーにキャッシュします。最高のパフォーマンスを得るために、接尾辞エントリ・キャッシュの設定をチューニングして、パフォーマンスを最適化できます。Directory Serverにより、キャッシュ・サイズの制御が簡単になり、一度チューニングすると、サーバーはキャッシュ設定に厳密に従います。
デフォルトでは、エントリ・キャッシュは、負荷に応じて、完全にサーバーによって管理されています。エントリ・キャッシュ設定を変更する前に、デフォルト値を使用したときのサーバーのパフォーマンスを評価することをお薦めします。チューニングの推奨事項については、『Oracle Directory Server Enterprise Editionリファレンス』および『Oracle Directory Server Enterprise Editionデプロイメント・プランニング・ガイド』を参照してください。
dsconfコマンドを使用してキャッシュ・サイズをチューニングします。詳細は、dsconfのマニュアル・ページを参照してください。
この項では、Directory Serverのキャッシュの主な機能について説明します。
動的メモリーを使用する場合のしきい値の設定
エントリ・キャッシュのメモリー割当ての最適化
4.1.1 動的メモリーを使用する場合のしきい値の設定
Directory Serverを使用すると、キャッシュを目的とするメモリーの使用量を厳密に制御できるため、メモリーの使用量が削減されます。動的メモリーを使用する場合、最小しきい値および最大しきい値を指定します。このしきい値に達すると、Directory Serverは、接尾辞エントリ・キャッシュのメモリーの解放を試み、メモリーの使用量を制御し続けます。サーバー・キャッシュが最大しきい値に達した場合、サーバーはメモリーを積極的に解放します。パフォーマンスに影響があるのは、最大しきい値に達したときのみです。
この機能では、ソフトしきい値およびハードしきい値の2つの構成可能なしきい値が提供されます。ソフトしきい値に達すると、ディレクトリ・サーバーは、他の操作と同時にメモリーを解放しようとします。ハードしきい値に達すると、メモリーを解放している間は、キャッシュ上の操作は行われません。これらの2つのしきい値は、2つのサーバー・プロパティで定義されます。
heap-high-threshold-sizeは、ハードしきい値を指定します。
heap-low-threshold-sizeは、ソフトしきい値を指定します。
この2つのサーバー・プロパティの詳細は、serverのマニュアル・ページを参照してください。
4.1.2 エントリ・キャッシュ・のメモリー割当ての最適化
エントリ・キャッシュのサイズによって、メモリーの割当て方法が決まります。たとえば、キャッシュが2ギガバイトより小さい場合、サーバーは、メモリー・プールを1つ使用します。キャッシュ・サイズが2ギガバイトより大きい場合、サーバーは、特定のサイズに分けられた各プールを必要な数だけ使用してキャッシュ・メモリーを最適化します。
デフォルトでは、エントリ・キャッシュは、負荷に応じて、完全にサーバーによって管理されています。エントリ・キャッシュ設定を変更する前に、デフォルト値を使用したときのサーバーのパフォーマンスを評価することをお薦めします。
設定できるキャッシュ・サイズ・プロパティの詳細は、『Oracle Directory Server Enterprise Edition管理者ガイド』またはserverのマニュアル・ページを参照してください。チューニングの推奨事項については、『Oracle Directory Server Enterprise Editionリファレンス』および『Oracle Directory Server Enterprise Editionデプロイメント・プランニング・ガイド』を参照してください。
4.2.1 時間ベースのログ・ローテーションと削除
Directory Serverは、指定期間の後だけでなく、指定した時間でもログをローテーションしたり削除することができます。この機能を使用すると、ローテーションされた各ログ・ファイルの期間が同じになるため、ログ解析および傾向分析などの操作をより簡単に実行できるようになります。また、この機能は、特定のログ・ファイルが対象とする特定の期間を簡単に判断できるため、これを使用して監査およびセキュリティ要件を満たすこともできます。
ログを時間間隔に応じてローテーションするか、ログ・ファイルのサイズに応じてローテーションするかを指定できます。次の図は、DSCCを使用して、ログ・ローテーションを1週間に1度午前0時に実行し、またサイズ制限が100メガバイトを超えたときにログ・ファイルをローテーションするよう構成していることを示しています。
図config-log-rotate.pngの説明 
rotation-timeログ・プロパティの詳細は、logのマニュアル・ページを参照してください。
たとえば、アクセス・ログの現在の構成をコマンドラインで次のように表示することができます。
$ dsconf get-log-prop -p 20390
enabled                   :  on
level                     :  default
max-age                   :  1M
max-disk-space-size       :  500M
max-file-count            :  10
max-size                  :  100M
min-free-disk-space-size  :  5M
path                      :  /install-path/sA1/logs/access
perm                      :  600
rotation-interval         :  1d
rotation-min-file-size    :  unlimited
rotation-time             :  undefined
verbose-enabled           :  N/A
コマンドラインを使用して、アクセス・ログのローテーション間隔を次のように変更できます。
$ dsconf set-log-prop -p 20390 rotation-interval:2d
パフォーマンス向上のためのチューニング
