 Webサイトなどで公開、配布されているバイナリ・ファイルが正規のものであり、改ざんされたり、ダウンロードが途中で失敗して(一部が欠落して)いないかどうかを確認するのは重要なことである。例えば2005年7月11日、Download.comサイトがミラー、配布していた「Daemon-Tools」のバイナリにトロイの木馬が仕込まれていた、という事件があった(DAEMON Tools公式サイト)。このとき、すでにダウンロードして利用していたファイルがオリジナルと同一のものかどうかをチェックする必要性を再認識した読者もいることだろう。
何らかの理由でファイルが破損していないか、オリジナルから変更されていないかをチェックする場合には、ファイルの「ハッシュ値」(セキュリティ用語事典:ハッシュ関数)を比較する方法が広く使われている。フリーソフトウェアやシェアウェアでは、配布サイト上にMD5(セキュリティ用語事典:MD5)やSHA1方式によるハッシュ値を掲載し、ダウンロード中にファイルが破損するなどの理由でオリジナルと違ってしまっていないかを確認できるようにしているサイトも多い。
ハッシュ値を提供するダウンロード・サイトの例バイナリ・ファイルを配布するサイトでは、ファイルだけでなく、そのファイルのハッシュ値も同時に提供している場合が少なくない。これはシマンテック社のサイトの例。ファイル名のリンクの下に、「MD5: 〜」としてハッシュ値も掲載されている。MD5以外にも、SHA1というアルゴリズムもよく使われる。ダウンロードしたファイルのハッシュ値を計算して、この値と比較することにより、ファイルが正しくダウンロードできたことを確認できる。  (1)ファイル名。  (2)MD5アルゴリズムによって計算されたハッシュ値。32桁の16進数(128bit)。
このような場合には、ファイルのハッシュ値を確認するツールを導入すればよい。単一ファイルのハッシュ値を比較するなら、GUIのツールが適している。例えば、ファイルのプロパティにハッシュ値を表示/比較できるタブを追加する「HashTab Shell Extension」(無償)を使うとよいだろう。
HashTab Shell Extension(Beeblebrox.org)
また、例えばWebサイトの管理者が検証用サーバと公開サーバの変更個所を探すといった、大量のファイルを持つフォルダ同士を比較する場合にもハッシュ値を利用する方法が有効だ。大量のファイルの比較をdiff(Unix系OS)やfcコマンド(Windows系OS)で行うと、比較元と比較対象のファイルのすべてのデータを比較するため、非常に時間がかかる(別サーバのデータの場合、ネットワーク越しになるのでさらに低速になる)。そこで、あらかじめ元のファイルのハッシュ値をXMLファイルにスナップショットとして用意しておき、対象サーバと比較すると効率的である。このような場合は、コマンドライン・ツールの「File Checksum Integrity Verifier utility」(無償)を利用するとよいだろう。
Availability and description of the File Checksum Integrity Verifier utility［英語］(マイクロソフト)
操作方法
単一のファイルのハッシュ値を比較する
単一のファイルを比較するなら、GUIで操作できるHashTabを利用するのが便利だ。Beeblebrox.orgのダウンロード・サイトからHashtab Shell Extensionのインストーラを入手し、インストール作業を行う。インストールが完了すると、以下の画面のようにファイルのプロパティ表示に［ハッシュ値］タブが追加される。HashTabは、MD5/SHA1/CRC-32の3方式に対応している。
ハッシュ値をプロパティで表示するHashTabをインストール後、エクスプローラでファイルを選択して右クリックして表示されるポップアップ・メニューから［プロパティ］を選択すると、新しく［ハッシュ値］タブが追加されている。このファイルに対するMD5/SHA1/CRC-32の3つの値が開いた段階で計算されている。この数値列を目で追いながら比較してもよいが、長くて間違いやすいので、それぞれの値はテキストとしてカット&ペーストして比較できるようになっている。比較した結果、ハッシュ値が異なると(別ファイルであると判断されると)、「異なります」というダイアログが表示される。  (1)ファイルの［プロパティ］ダイアログで［ハッシュ値］タブを開く。  (2)MD5方式のハッシュ値エリア。  (3)ファイルのMD5ハッシュ値。  (4)比較対象となる値(16進数文字列)を入力する。  (5)SHA1方式のハッシュ値エリア。  (6)CRC-32チェックサムのエリア。  (7)これをクリックすると比較が実行される。  (8)比較結果が異なる場合は、このように「異なります」というダイアログが表示される。
複数ファイルやディレクトリ単位で同一性をチェックする
HashTabはGUI操作が可能であり、メッセージも日本語化されていて大変扱いやすい。だがWebサーバのディレクトリごとの比較といった、複数ファイルやディレクトリ単位でのハッシュ値算出/比較には向いていない。大量のファイルをハッシュ値で比較したい場合には、コマンドラインから利用する「File Checksum Integrity Verifier utility」(以下FCIV)を使うとよい。ただし、日本語を含むディレクトリ名とファイル名ではエラーとなることがある点に注意が必要だ。
FCIVを利用するには、まず自己展開型の実行ファイル(windows-kb841290-x86-enu.exe )をマイクロソフトのサイトから入手し、実行する。すると、ReadMe.txtとfciv.exeという2つのファイルが展開される。fciv.exeは、PATHの通っている場所(例えば%SystemRoot%\system32などのフォルダ)にコピーするか、適当なフォルダにコピーしてPATHに該当フォルダを追加しておけば、利用しやすいだろう。PATH環境変数の変更については、「Windows TIPS:環境変数を変更する」を参考にしてほしい。
FCIVの構文は以下のようになっている。
Windows TIPS:ハッシュ値を利用してファイルの同一性をチェックする - @IT
