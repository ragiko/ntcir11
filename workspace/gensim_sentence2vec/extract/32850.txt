トピックの状態: このトピックの一部の情報はプレリリースであり、今後のリリースで変更されることがあります。プレリリース情報では、Microsoft SQL Server 2014 の新しい機能と、従来の機能に加えられた変更について説明します。
基数推定ロジックを基数推定機能と呼びますが、クエリ プランの品質を向上させ、その結果、クエリのパフォーマンスを向上させる目的で、SQL Server 2014 でこの機能を再設計しました。
新しい基数推定機能には、現在の OLTP ワークロードとデータ ウェアハウス ワークロードで適切に機能する想定とアルゴリズムが組み込まれています。 この機能は、現在のワークロードを対象とする基数推定に関する詳細な調査、および SQL Server の基数推定機能を向上させるための過去 15 年にわたる研究を土台としています。 お客様からのフィードバックによると、大半のクエリは今回の変更によって性能が向上するか、何も変化しないこと、一方で、少数のクエリは以前の基数推定機能と比較すると性能が低下する可能性があることが示されています。 
新しい基数推定機能は、SQL Server 2014 を使用して作成したすべての新しいデータベースで有効になっています。
ただし、SQL Server 2014 にアップグレードするだけでは、既存のデータベースでは新しい基数推定機能は有効になりません。 
実稼動システムで新しい基数推定機能を有効にする前に、最適なクエリ パフォーマンスが達成できることを確認するために、次の推奨事項を使用して実際のワークロードをテストしてください。
新しい基数推定機能を使用するように、すべての既存のデータベースをアップグレードします。
この作業を実行するには、ALTER DATABASE 互換性レベル (Transact-SQL) を使用して互換性レベルを 120 に設定します。 
新しい基数推定機能を使用してテスト ワークロードを実行し、パフォーマンス上の問題に対してトラブルシューティングを現在実行しているのと同じ方法で、パフォーマンスの新しい問題に対するトラブルシューティングを実行します。
新しい基数推定機能 (データベース互換性レベル 120) を使用してワークロードを実行し、特定のクエリを回帰させる場合は、基数推定機能バージョン 70 (SQL Server 2012 のバージョン) を使用するために、トレース フラグ 2312 を指定してそのクエリを実行することができます。
トレース フラグを指定してクエリを実行するには、サポート技術情報の資料「特定のクエリ レベルに対応するさまざまなトレース フラグを使用して制御できる、プランが影響を及ぼす SQL Server クエリ オプティマイザーの動作の有効化」を参照してください。 
新しい基数推定機能を使用するようにすべてのデータベースをすぐに変更することができない場合は、ALTER DATABASE 互換性レベル (Transact-SQL) を使用してデータベース互換性レベルを 110 に設定することにより、すべてのデータベースで以前の基数推定機能を使用できます。
データベース互換性レベル 110 を使用してワークロードを実行し、新しい基数推定機能を使用して特定のクエリをテストまたは実行しようとする場合は、基数推定機能バージョン 120 (新しいバージョン) を使用するために、トレース フラグ 9481 を指定してそのクエリを実行することができます。
トレース フラグを指定してクエリを実行するには、サポート技術情報の資料「特定のクエリ レベルに対応するさまざまなトレース フラグを使用して制御できる、プランが影響を及ぼす SQL Server クエリ オプティマイザーの動作の有効化」を参照してください。 
基数推定 (SQL Server)
