高コスト。メンバー数分だけディスク領域を使用する。ただし、REDOログサイズはデータベースに比べて遥かに小さいためこのコストを意識する必要はあまりない。注意としてはRACの場合、各ノードのスレッドでREDOログを持つため、メンバー数を増やすと(グループ数×ノード数)倍で必要なディスク領域が増えること。
2個以上のいくつにするのか
『信頼性』の要件による。
増えれば増えるだけI/Oや必要ディスク領域が比例して増えるため、『信頼性』以外にとってはメリットは無い。
2個以上の場合は各メンバは別々のディスク(Failure Group)に配置されているべきである。
各メンバの配置されるディスク(Failure Group)が同時に全滅する可能性を『想定外』にできるところまで増やせば良い。別ストレージに配置するなら2個でも十分と考えられる(エンタープライズ最高峰の金融機関様とかがどうなっているかは知りません)。
REDOログの物理配置
配置場所
REDOロググループのメンバー数が1であれば配置場所は1カ所でしかない。
REDOロググループのメンバー数が2以上であれば、各メンバーは別々のディスク(Failure Group)に配置されるべきである。また、ファイル名から『グループ』と『メンバーの何個目』の情報が読み取れるようにする。
ストレージ
REDOログのI/Oの性質
REDOログ・バッファにためたログを追記していくシーケンシャル・ライトになる(とはいえログ・バッファの溜まらない期間でフラッシュが多発するとI/O回数が支配的な問題になると考える)。
REDOログ・バッファがフラッシュされる契機(コミット、3秒間隔、ログ・バッファ使用率が1/3を超えた、DBWn要請)ごとに発生する。
REDOログ・バッファのフラッシュが完了しないかぎりコミット完了とならず、REDOログのI/Oが遅いとそのままコミットが遅くなる。
REDOログ・バッファのサイズは数MB〜数十MB。
アーカイブ処理はシーケンシャル・リードになる。
REDOログさえ書いていればデータベースは処理を継続できる(もちろんバッファ・キャッシュの書き込みが追いつかずに空きバッファ確保待ちになる可能性はある)。
上記の性質からREDOログには優先的に高性能のI/Oが可能な領域を割り当てる価値があることになる。
一昔前の資料だとデータファイルはRAID5、REDOログ(と制御ファイル)はRAID1+0なんて設計が結構見られる。
最近はSAMEの思想から、データファイルやREDOログで領域を分けずに同一のディスク・グループに乗せた方がよいとされている。これはディスクの大容量化によってREDOログだけでRAID1+0を組むと大半の領域をすてることになり非現実的という事情とも一致する。データファイルと一緒ならストライピングに使用できるディスクも増える。今後はこのパターンが基本形だと考える。
ここまでしてたのか的配置
『Best Practices for Oracle Database on an LSI CTS2600 Storage System』の配置。メンバーでディスクを分けるのはわかるけど、グループではさすがに・・・と思ったら分けている例があった。アーカイブ処理している間は別のディスクを使うような意図なんだろうが、今だと下手にディスク本数減らしてここまで小分けにするのは勧められないだろう。
ストレージのスナップショット機能を使うオンラインバックアップを行う場合の注意事項
スナップショット機能でオンラインバックアップを行う場合、以下のファイルはスナップショット単位が独立していなければならない(するべきだと私は考えている)。これは先のDGDATAとDGFRAにREDOログを乗せる場合には満たせない。
データファイル
REDOログ
アーカイブREDOログ
まず、REDOログのバックアップはオンラインバックアップ上必須ではない。BEGIN BACKUP - END BACKUPまでのログはアーカイブしたものをバックアップする。よってデータと一緒でもアーカイブREDOログと一緒でも不要なもののスナップショットをとることになる。
最大の問題はリストア時に起こる。直近までの回復が必要な場合、『現在のREDOログは残して』データファイルをバックアップ時まで戻すことが求められるが、REDOログとデータファイルがDGDATAに同居していると、DGDATAを戻すと一緒にREDOログまで戻されてしまう。もちろん、DGFRA上のREDOログは残るが、リカバリを求められている時に『REDOログのメンバ間不整合』『REDOログの冗長性をあえて失わせる』という状況を作り出したいだろうか。
これを避けるために領域を分けると下図のようになる(スナップショットの単位はLU単位)。
領域の分け方はいくつか考えられる。どこでミラーとストライピングをするか、がポイント。
方式ストライピングミラーメリットデメリット個人的評価
オンラインREDOログ設計 - とあるSIerの憂鬱
