プライベートクラウド管理のすゝめ②において、OpenFlowプロトコルを用いたネットワークアーキテクチャ上でL2スイッチをエミュレートすることにより、同一ネットワークセグメント内に属する機器間のトラフィック設定を集中管理し、実際の転送制御を分散配置されたOpenFlowスイッチに委ねることが可能となりました。これにより、機器間に配置されているスイッチを把握し、各スイッチにログインして転送設定をするといった従来のネットワーク運用の手間およびコストが大きく低減されます。さらに応用的な使い方として、OpenFlow(*1)で利用可能なシンプルなパケット転送(Forwarding)だけでなく、破棄(Drop)やパケットのヘッダ情報の書き換えを利用した活用法をご紹介します。
(*1) OpenFlowプロトコルの詳しい情報として、Hinemos開発者も執筆に携わっている書籍「翔泳社 OpenFlow徹底入門 SDNを実現する技術と知識」(外部リンク) などもぜひご活用ください。
異なるネットワークセグメントの機器間で通信する
Hinemos仮想ネットワーク管理オプションでは、仮想L3スイッチを用いることにより、仮想マシンLaptop(192.168.10.101/255.255.255.0)とApacheサーバ(192.168.3.102/255.255.255.0)間でセグメントを跨った通信が可能となります。仮想L2スイッチと同様に直感的なGUI操作でネットワークエディタ上に仮想L3スイッチアイコンを作成し、2つのセグメントと通信するためのインタフェースおよびルーティングテーブルを定義するだけです。
この論理ネットワークが定義された状態でLaptopからApache宛の通信が発生した場合において、OpenFlowにより通信路が確立される流れを説明します。Laptop(192.168.10.101/255.255.255.0)はApache(192.168.3.102/255.255.255.0)が別のネットワークセグメントに属することから、デフォルトゲートウェイ(192.168.10.1)経由で通信を行います。初回の通信では192.168.10.1のMACアドレスを解決するため、ARP要求パケットを送出します。OpenFlowスイッチからOpenFlowコントローラへARP要求パケットが通知され、ARP要求パケットのトラフィックの流れを論理ネットワーク上でシミュレートされるところまでは、仮想L2スイッチと同様となります。ただし、ARP要求パケットに応答すべき機器が実在しない仮想L3スイッチとなる点が異なり、仮想L3スイッチに対するパケットはOpenFlowコントローラが応答を返す必要があります。
そのため、ARP応答パケットのイーサフレームは、仮想L3スイッチの定義に従いOpenFlowコントローラ内で生成されます。生成されたARP応答パケットはOpenFlowスイッチを経由して、Laptopに対して送信されます。LaptopはARP応答パケットを受信すると、ARPテーブルに解決したMACアドレスを登録します。
ゲートウェイアドレスのMACアドレスが解決された後、トラフィックの実体となるパケットを送信します。Laptopから送信された直後のパケットのヘッダは以下の構成となります。
ヘッダ
送信元MACアドレス
宛先MACアドレス
送信元IPアドレス
宛先IPアドレス
プライベートクラウド管理のすゝめ③ - 其の壱 | Hinemos | クラウド時代の統合運用管理
