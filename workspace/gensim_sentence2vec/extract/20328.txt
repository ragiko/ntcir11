
iTunesのバックアップ機能は便利で良いのですが、バックアップして欲しくない物までバックアップしてしまいます。
これは脱獄環境においては非常に不便な事です!
そこで、私がいつも使っているiTunesを使用しない脱獄環境のバックアップ方法をご紹介したいと思います。
文字で見ると面倒で複雑なことのように思えてしまうかもしれませんが、やってることは非常に単純で簡単なことです!
更に、最初にバックアップするファイルを自分で細かく設定出来ますので、iTunesのバックアップ機能よりも広い範囲でファイルのバックアップを行うことが可能です!
保存したバックアップファイルを使用した復元・リストア方法も単純で、簡単な物ですのでこんな物もあるんだ～とどこかで覚えておいて頂ければ幸いです。
注意
この方法は私がいつも行っている方法ではありますが、とりあえず使える程度の物です。
環境によっては予期せぬ不具合等が起こる場合がありますので、実行する際は自己の責任において何が起きても自分一人で解決・対処出来る方のみ実行するようにしてください。
また、バージョン違いや特定の環境において特定のファイルを一気に書き戻すと、読み込みエラーが発生し、復元を必要としてしまう事があります。
このような事にも注意をして下さい。
なぜiTunesのバックアップ機能を使用しないのか?
iTunesのバックアップ機能が悪いというわけではありません。
もちろんiTunesを使用した方が簡単に行えます。
ただ、どうしてもiTunesで行うバックアップには不要なファイルが含まれていたり、逆に脱獄環境において一緒にバックアップして欲しい物が省かれていたりと不便なことがあります。
更に、いわゆる脱獄のゴミといった問題もあります。
これは既にどこからも使用されていない脱獄アプリによって生み出されたファイル達がどんどんと蓄積して行ってしまう問題です。
特に脱獄アプリの設定が保存されているファイル等は、脱獄アプリをアンインストールしてもそのまま残ってしまいますので、これらがiTunesのバックアップによって何世代にも渡り蓄積されていくことがよくあります。
極端に増えてしまった脱獄のゴミが起こす問題はiOSの動作を遅くする原因の1つにもなり得ます。
これらの問題を解決するために私はいつもiTunesのバックアップではなく、これから記していきます方法を使用してバックアップを行っています。
自分にとって必要なファイルだけをバックアップし、不要なファイルはiOSの復元と共に捨て去る。これの繰り返しで安定した脱獄環境も作ることが出来ます。
脱獄アプリのバックアップも可能
これから記していきます方法では現在インストールされている脱獄アプリをリストとして出力し、そのリストを元に自動でインストールしてくれる様にしています。
これ専用の脱獄アプリも複数あるのですが、無料のものではリポジトリが上手く復元出来なかったりすることがあるので、これについても下記の方法で行っています。
AppStoreアプリのデータをバックアップ
AppStoreアプリのデータ(セーブデータ等)のバックアップについてですが、これはちょっと面倒です。
ですので、簡単にサクッとDropboxへ送信することが出来る【DataDeposit】を使用しています。
【DataDeposit – AppStoreアプリのデータをDropBoxにバックアップ&リストア [JBApp] | Tools 4 Hack】
必要な物
私がいつも使っている物にちょっとだけ手を加えた物をご用意しました。
「backup-restore_v0.3.zip」
上記リンクからZIPファイルをダウンロードして頂き、解凍すると中に3ファイルが入っています。
バックアップ作業に使う物
backup.sh
backuplist.lst
リストア作業に使う物
restore.sh
MobileTerminalをインストールする
今回はとても簡単ではありますが、MobileTerminalよりコマンドを入力して使用します。
ですので、作業を始める前にMobileTerminalをインストールしてください。詳しいインストール手順等は下記をご覧下さい。
【[iOS] MobileTerminal – iOS単体でターミナル操作を!コマンド操作を! [JBApp]】
バックアップ リストのカスタマイズ
先ほど解凍して出来たファイル『backuplist.lst』がバックアップを行うファイルのリストになります。
このファイルに記されている通りにバックアップが行われるようになっています。
初期時点では設定関連のファイルを中心にバックアップが行われるように設定しています。
ただし、写真や画像等はファイル数が膨大になることがあるので、初期設定では除外しています。これらはiFunBox等を利用して手動で行うと管理も楽になります。
このままでも良いかと思いますが、自身で好きなファイルをバックアップに追加したり、逆に除外することも可能です。
『backuplist.lst』自体はテキストエディタで開いて編集出来ます。
下記がファイル内容の一部になります。
+ /private/
+ /private/var/
+ /private/var/mobile/
+ /private/var/mobile/Library/
#アドレス帳
+ /private/var/mobile/Library/AddressBook/
+ /private/var/mobile/Library/AddressBook/**
#AskToCall 設定
+ /private/var/mobile/Library/Preferences/
+ /private/var/mobile/Library/Preferences/me.deVbug.AskToCall.plist
#写真
- /private/var/mobile/Media/
- /private/var/mobile/Media/DCIM/
- /private/var/mobile/Media/DCIM/**
記述ルールは単純です。
ファイルのパスを記述し、バックアップ対象に含めたい物は先頭に『+(プラス)』を付けます。
除外したい場合は先頭に『-(マイナス)』を付けます。
また、除外したいファイル、ディレクトリに関しては許可を行う記述よりも上に書いて下さい。
バックアップはリストに書かれている順に上から下へ行われますので、先に許可する記述があるとそちらが優先されてしまいます。
ですので、除外する物は許可する物よりも優先順位を高くするために先に記述する。と言うことになります。
例えば「AskToCall」の設定ファイルをバックアップ対象に含めたい場合は
+ /private/
+ /private/var/
+ /private/var/mobile/
+ /private/var/mobile/Library/
+ /private/var/mobile/Library/Preferences/
+ /private/var/mobile/Library/Preferences/me.deVbug.AskToCall.plist
このようにそのファイルに行き着くまでのディレクトリを許可してあげてください。
許可するのは1度のみで大丈夫です。
上記の記述では既に「+ /private/var/mobile/Library/Preferences/」までが許可されていますので、「Preferences」フォルダ内にあるファイルは
+ /private/var/mobile/Library/Preferences/com.hitoriblog.pasteboardstacker.plist
+ /private/var/mobile/Library/Preferences/com.iptm.bigboss.sbsettings.plist
のように1行書き足すだけで追加することが出来る様になります。
フォルダ内にあるファイル全てをバックアップしたい場合は下記の様にフォルダ名に続け『**』と記します。
+ /private/var/mobile/Library/AddressBook/
+ /private/var/mobile/Library/AddressBook/**
下記の記事に少しですがどのファイルがどのような役割をしているかを記してしますので、こちらを参考にバックアップリストを自分好みにカスタマイズしてみてください!
【[iOS] iOS 5 『ファイル辞典』 (随時更新 2012年4月19日版) [JB]】
『/var/mobile』フォルダへiFunBox等を使用して先ほど解凍して出来たファイル2つを転送します。
backup.sh
backuplist.lst
転送する場所は下記になります。
『/var/mobile/』
続いてファイルを集めるために『rsync』という物をCydiaからインストールしてください。
『rsync』で検索すると出てきますので、いつも通りインストールを実行します。
さて、さっそくバックアップ作業を行いましょう。
ホーム画面よりMobileTerminalを起動します。
続いてrootユーザーとしてログインしましょう。
『su root』と入力しエンターです。
Passwordは自身で変更していない場合は「alpine」となります。入力してエンターです。
セキュリティの関係でパスワードは入力しても画面に反映されませんが、キーボードを押とちゃんと入力されたことになっていますのでご安心ください。
rootユーザーとしてログインできますと、下記左画像の様に文字列の末尾が『root#』となります。
バックアップ作業を開始します。
『sh backup.sh』と入力し、エンターです。
『脱獄アプリのインストール状況をバックアップしますか?』と問われますので、バックアップする場合は『y(Yes)』を入力し、エンターです。
バックアップしない場合は『n(No)』です。
今後この回答方法を使用していきますので覚えておいてください。
続いて『ファイルのバックアップを開始しますか?』と問われますので、バックアップリストに従ってバックアップを開始する場合は『y(Yes)』を入力し、エンターです。
ファイル数にもよりますが、ある程度すぐ完了しますので待ちましょう。
『++++ Backup Complete ++++』と表示されれば完了です。
完了すると『/var/mobile/』に『iosbkup_***.tar.gz』というファイルが出来上がります。(***部はバックアップ日時)
このファイルをiFunBox等などで母艦として使用しているPCにコピーするとバックアップ完了です。
リストア方法
『/var/mobile』フォルダへiFunBox等を使用して先ほど解凍して出来たファイル1つと、バックアップしたファイルを転送します。
restore.sh
iosbkup_***.tar.gz(***部はバックアップ日時)
転送する場所は下記になります。
『/var/mobile/』
続いて『APT 0.7 Strict』という物をCydiaからインストールしてください。
『APT 0.7 Strict』で検索すると出てきますので、いつも通りインストールを実行します。
ホーム画面よりMobileTerminalを起動します。
続いてバックアップ時と同じようにrootユーザーとしてログインしましょう。
『su root』と入力しエンターです。
Passwordは自身で変更していない場合は「alpine」となります。入力してエンターです。
セキュリティの関係でパスワードは入力しても画面に反映されませんが、キーボードを押とちゃんと入力されたことになっていますのでご安心ください。
rootユーザーとしてログインできますと、下記左画像の様に文字列の末尾が『root#』となります。
バックアップ作業を開始します。
『sh restore.sh』と入力し、エンターです。
『バックアップファイルを解凍しますか?』と問われますので、解凍する場合は『y(Yes)』を入力し、エンターです。
ちなみに、ここで解凍だけをして、MobileTerminalを閉じ、iFile等でこの解凍したファイル『/var/mobile/backup-***』フォルダ内を編集することも出来ます。
不要なファイルを削除し、再度ここまで進め、「n(No)」を入力することで不要なファイルを取り除いた物だけをリストアすることが出来ます。
『Cydiaリポジトリをバックアップファイルから書き戻しますか?』と問われますので、書き戻す場合は『y(Yes)』を入力し、エンターです。
ここでリポジトリを書き戻すことで、手動にリポジトリを再登録する必要がなくなります。
続いて『リポジトリの更新(Refresh)を行いますか?』と問われますので、リポジトリの書き戻しを実行した場合は『y(Yes)』を入力し、エンターを押してください。
リポジトリの更新はリポジトリ数とサーバーからの応答速度で掛かる時間が変りますので待ちましょう。
『リストを元に脱獄アプリを自動でインストール(リストア)しますか?』と問われますので、脱獄アプリを全てインストールしたい場合は『y(Yes)』を入力し、エンターを押してください。
ちなみに、脱獄アプリのリストは『/var/mobile/backup-***/cydiaapp.lst』になります。
こちらもテキストエディタで開くことが出来ますので、自身で編集することが可能です。
インストールが始まると質問が2回ほど行われますので、どちらも『y(Yes)』を入力してください。
インストールには数分かかりますので、自動ロックしないように注意しながら待ってください。
また、サーバー状況によっては上手くインストールされなかったアプリも出てくるかもしれません。
その時は「バックアップファイルの解凍」と「脱獄アプリのインストール」作業のみを『y(Yes)』で進めて頂ければ再度インストール作業が行われます。
最後に『バックアップファイルのリストア(復元)を行いますか?』と問われますので、設定ファイル等をリストアする場合は『y(Yes)』を入力し、エンターを押してください。
『++++ Restore Complete ++++』と表示されれば完了です。
登録されているリポジトリもちゃんと元通り!
更に履歴に関しても前回の物を引き継げますので、どれがいつリリースされたか等が分かりやすくなっています。
iTunesを使わない!私が実行している脱獄環境のバックアップ方法! | Tools 4 Hack
