 本連載は「ネットワーク運用管理の基礎」について紹介していきます。読者の皆さんは、「ネットワーク運用管理」と聞くと、多分「あ、あんなことかな?」と、その実作業については何となく理解していることかと思います。この連載では、その「何となく」をもう少し体系立て、まとめることを目的とします。第4回では、さまざまなトラブルケースごとに、トラブルシューティングの考え方や方法を紹介します。
トラブルの原因を絞り込むにはどうする?
対処方法
ネットワークのトラブル事例で最も多いのが、このようなケースです。ここで問題となるのが、「このままでは対応のしようがない」ということです。ただ単に「つながらない」といわれても、その原因は無数に考えられます。その1つ1つを片っ端からつぶしていくなど時間の無駄です。まずは「何が」「どのように」つながらないのかを明確にする必要があります。そのためには連絡をしてきたエンドユーザーに、以下のような質問をします。
どのような現象から「つながらない」と判断したのか?
例えばPCにおけるある操作からそのように判断したとして、同じPCでの、ネットワークを使用する別の操作では結果はどうなるのか?
同じ操作を、例えば別のPCで行った場合の結果はどうなるのか?
これらの質問によって、おおよその障害の状態、場合によっては障害の位置が特定できますので、続いてそれをさらに詳細に切り分けていきます。詳細な切り分けのために用いる手段(例えばツールなど)は、障害の状態や位置によってそれぞれ異なりますが、その中でもよく利用されるのがpingコマンドです。
例えば以下のような順番でpingを打っていく(実行する)ことによって、障害個所を絞り込んでいけます。
localhost(127.0.0.1)へのping
pingを打った機器自体の動作/設定に異常がないかを確認
自端末へのping
(上記に加え)
pingを打った機器自体のIPアドレス/サブネットマスク設定に異常がないかを確認
デフォルトゲートウェイへのping
(上記に加え)
デフォルトゲートウェイのIPアドレス/サブネットマスク設定に異常がないかを確認のIPアドレス/サブネットマスク設定に異常がないかを確認
デフォルトゲートウェイのルーティングテーブル設定に異常がないかを確認
リモートホストへのping
(上記に加え)
リモートホストのIPアドレス/サブネットマスク設定に異常がないかを確認
リモートホストのルーティングテーブル設定に異常がないかを確認
またpingとともによく利用されるのがtraceroute(またはtracert)です。tracerouteによって、ターゲット端末までのネットワーク経路(ルート)が想定どおりのものか、または正常に機能しているか否かの確認を行うことができます。
ただ、pingにせよtracerouteにせよ、確認ができるのはIPのレベル(OSIでいうところのネットワーク層)であり、それより下位の階層(データリンク層や物理層)でのより詳細な確認を行うためには、プロトコルアナライザやケーブルテスタなどを用いる必要があります。
ネットワーク経路とは別に、各ネットワーク機器の詳細な状態の確認が必要な場合は、SNMPを用いて行うことも検討します。
エラーフレームがネットワーク内にあふれてしまう≫
対処方法
エラーフレームとは、プロトコルアナライザなどで見た場合、本来のフレームデータよりも短く途中で切れたように見えたり、CRCのエラーなどと表示されるものを指します。エラーフレーム発生には、以下のような原因が考えられます。
NICの不具合の不具合
ネットワークケーブルの不具合
リピータやシェアードHUBの不具合
NICが動作異常を起こしている場合、しばしばフレームの送出途中で送信をやめてしまうことがあります。結果としてネットワーク内にエラーフレームがあふれるような状態になるわけです。送出中断の理由はいろいろですが、例えば、コリジョンの誤検出などが挙げられます。送出途中で何らかの信号をコリジョン発生と誤認し、そこで送出をやめてしまうわけです。
上記はNICの不具合によって、発生していないコリジョンが発生したと誤認してしまったことによる問題事例ですが、これとは別に、同じくNICの不具合で実際にコリジョンが多発する問題事例もあります。原因はNICが通常持っているオートネゴシエーション機能にあります。これは伝送速度や伝送モード(ハーフまたはフル)を接続相手とネゴシエートするための機能です。何らかの原因でオートネゴシエーションがうまく働かず、その結果、接続している機器同士で異なる伝送速度、伝送モードになってしまうと、通信がうまくできない、またはコリジョンの発生として現れたりします。
ネットワークケーブルの不具合は、ケーブルの品質の低下を意味します。品質が悪くなり過ぎると完全に通信不能になるので、逆に障害としてもはっきり分かるのですが、規格ぎりぎりの品質の場合はやっかいです。つながったりつながらなかったりと、ネットワークは非常に不安定な状態になります。NICの不具合の場合と同様に、CRCエラーなどが大量に検出されるようになります。ただNICの不具合の場合と異なるのは、エラーとなるフレームを送出する機器が、NIC不良の1台の機器だけには限定されずに、問題のケーブル周辺の機器すべてとなる点が異なります。
リピータやシェアードHUBも、その内部構造はケーブルの集合体ですので、それらが不具合を起こせば、結果はケーブルの不具合の場合と同様になります。
ネットワークが非常に不安定な状態になる
ネットワーク運用管理入門(4):—分かっているようでホントは知らない—実践! ネットワーク・トラブルシューティング - @IT
