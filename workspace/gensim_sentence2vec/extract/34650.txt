Windows クラスタリングは、サーバー リソースの高可用性を提供するように設計されています。この資料では、クラスタをあるドメインから別のドメインに移動する方法について説明します。
注 : マイクロソフトは、実稼働環境でこのような移動を実行することを推奨していません。
通常、クラスタ サーバーをあるドメインから別のドメインに移動するための最善のソリューションは、新しいドメインでクラスタを再構築することです。ただし、クラスタ サーバーをあるドメインから別のドメインに移動することもできます。
以下の手順を使用することにより、クラスタ サービスを新しいドメインで開始および操作できるようになります。以下の手順では、すべてのリソースが新しいドメインで利用できるようになることは保証されていないことに注意してください。
注 : Microsoft Exchange サーバーをあるドメインから別のドメインに移動する場合など、利用する操作がサポート対象でない場合、あるドメインから別のドメインへのリソースの移動について、マイクロソフトではサポートを提供しません。また、クラスタ内のノードのいずれかがドメイン コントローラである場合、Windows NT 4.0 ベースのクラスタをあるドメインから別のドメインに移動することはできません。
あるドメインから別のドメインへのクラスタの移動は、クラスタ サービス自体の機能よりも、クラスタがホストするリソースに依存しています。クラスタ サーバーをあるドメインから別のドメインに移動するときの危険性は管理可能な範囲ですが、クラスタがホストするリソースの移動に関連する危険性は、管理者の責任において評価および管理する必要があります。
クラスタ サーバーでホストできるリソースの多くは、ドメイン属性に依存しています。たとえば、クラスタによってホストされる Windows NT ベースのサービスは、サービス ユーザー アカウントのコンテキスト内で実行する必要があります。サービス ユーザー アカウントがローカル ユーザー アカウントの場合 (実際のクラスタ環境では、まずありえません)、問題なくサービスを新しいドメインに移動できます。これらのサービスがドメイン アカウントでログオンする場合、管理者は新しいドメインでこれらのサービス用のユーザー アカウントを再作成し、必要な権利および特権を付与できるかどうかを確認する必要があります。通常、管理者は、このような操作に伴う危険性が高いため容認できないと判断し、新しいドメインでクラスタを再構築する代替案が最適であると判断します。
各クラスタ リソースを新しいドメインに移動できるかどうかを評価したうえで、クラスタを移動するか、新しいクラスタを作成するかを決定してください。
警告 : マイクロソフトは、クラスタを移動する前に、クラスタ内の各ノードのすべての共有ハード ディスク上にあるすべてのデータを完全にバックアップすることをお勧めします。
この資料に記載されている手順を利用することにより、クラスタ サービスを新しいドメインで開始できます。ただし、新しいドメインでリソースをオンラインにできる場合とできない場合があります。また、オンラインにできるリソースが正常に機能する場合と機能しない場合があります。
クラスタを移動するには、以下の手順を実行します。
新しいドメインでクラスタ サービス用にユーザー アカウントを作成します。グループ ポリシー オブジェクト (GPO) またはセキュリティ テンプレート要件によって、以下の権限が削除されないようにする必要があります。ユーザー アカウントには以下の権限が必要です。
メモリ内のページのロック
サービスとしてログオン
オペレーティング システムの一部として機能 (Windows 2000 および Windows Server 2003)
ファイルとディレクトリのバックアップ
クォータの増加
スケジューリング優先順位の繰り上げ
デバイス ドライバのロードとアンロード
ファイルとディレクトリの復元
プロセス用のメモリ クォータの増加 (Windows Server 2003)
クラスタ サービス アカウントの関連情報を参照するには、以下の「サポート技術情報」 (Microsoft Knowledge Base) をクリックしてください。
さらに、クラスタ サービス アカウントは、クラスタ内のすべてのノードに対して管理者特権を持っている必要があります。
クラスタ内のすべてのノードで、クラスタ サービスのスタートアップ値を [手動] に設定します。これを行うには、以下の手順を実行します。
[スタート] ボタンをクリックし、[設定] をポイントします。次に、[コントロール パネル] をクリックし、[サービス] をダブルクリックします。Windows 2000 および Windows Server 2003 の場合は、[スタート] ボタンをクリックし、[管理ツール] をポイントし、[サービス] をクリックします。
[Cluster Server] をクリックし、[スタートアップ] をクリックします。Windows 2000 および Windows Server 2003 の場合は、[Cluster Service] をダブルクリックします。
[スタートアップの種類] ボックスを [自動] から [手動] に変更します。
[OK] をクリックします。
すべてのクラスタ ノードでクラスタ サービスを停止します。これを行うには、以下の手順を実行します。
[スタート] ボタンをクリックし、[設定] をポイントします。次に、[コントロール パネル] をクリックし、[サービス] をダブルクリックします。Windows 2000 および Windows Server 2003 の場合は、[スタート] ボタンをクリックし、[管理ツール] をポイントし、[サービス] をクリックします。
[Cluster Server] をクリックし、[停止] をクリックします。Windows 2000 および Windows Server 2003 の場合は、[Cluster Service] をダブルクリックし、[停止] をクリックします。
1 つのノードを除き、すべてのノードの電源を切ります。
そのノードを新しいドメインに移動します。これを行うには、使用しているオペレーティング システムに該当する以下の手順を実行します。すべての手順を実行したら、ノードを再起動します。
そのノードで、クラスタ サービスがドメインにログオンするために使用するサービス アカウントを、前の手順で作成したユーザー アカウントに変更します。
そのノードでクラスタ サービスを開始します。
クラスタ アドミニストレータを使用して、問題が発生していないことを確認します。すべてのリソースをオンラインにしてみます。クライアント コンピュータからすべてのリソースの機能をテストします。その後、システム イベント ログにエラー メッセージがあるかどうかを確認します。注 : この時点では、このノードを古いドメインに移動して戻し、移動しなかったノードを開始することによって、移動を取り消すことができます。
最初のノードの移動が成功した場合は、各ノードについて手順 5. 以降の手順を実行して、クラスタ内の他のノードを新しいドメインに移行する作業を続行します。
警告 : Microsoft SQL Server 7.0 の仮想インスタンスを含むコンピュータを別のドメインに移動するときに、最初に SQL Server 7.0 のクラスタ化を解除しないと、SQL クラスタ リソースでエラーが発生する可能性があります。この SQL Server 7.0 のエラーが発生した場合、Microsoft PSS に問い合わせて SQL Server 7.0 のクラスタ化を手動で解除することが必要になる場合があります。SQL Server 7.0 のクラスタ化を解除した後、SQL Server のフェールオーバー クラスタ ウィザードを使用して、クラスタ化された SQL Server コンピュータを再構築する必要があります。また、SQL Server 7.0 を手動で完全に削除して再インストールすることが必要な場合もあります。
クラスタ化された SQL Server 2000 のインスタンスを新しいドメインに移動する際の手順の関連情報を参照するには、以下の「サポート技術情報」 (Microsoft Knowledge Base) をクリックしてください。
Windows クラスタ サーバーをあるドメインから別のドメインに移動する方法
