【課題】搬送される対象物を平面分光器を用いて、高い分解能で異種品の検出を可能とすること。  【解決手段】本発明では、搬送手段(11)と、近赤外線の照射手段(4)と、反射光を平面分光する平面分光手段(2)と、撮像手段(3)と、反射光のスペクトルデータを得て主成分分析手法を用いて異種品を検出する解析手段(5)とを備え、前記解析手段(5)は、前記スペクトルデータを平均化および標準化する前処理、波長軸平均化処理、ラグランジェ補間する補間処理、測定位置最適化処理、空間軸平均化処理、一次・二次微分および平滑化する変換処理、予め取得したローディングベクトルデータに基づいて主成分得点を算出する主成分得点算出処理、および異種品の判定を行う判定処理を行う。
【発明の詳細な説明】【技術分野】【0001】  本発明は、医薬品(錠剤、カプセル剤等)、ゴム栓等のように、ある一つの固定した形を持つ検査対象物(以下、「対象物」という。)に、同じ形の異種品が混入していないかどうかを検査する技術に関し、特には、搬送される対象物をインラインで全数検査する装置に関するものである。  なお、錠剤とは、素錠(または裸錠)、糖衣錠、フィルムコート錠(腸溶錠等)を含むものであり、カプセル剤としては、硬カプセル剤、軟カプセル剤を含むものである。【背景技術】【0002】  従来の異種品検出装置は、対象物に照射された光の反射光を1点で分光する点分光器を利用していたため、1列でなく多列搬送される対象物の反射光を分光分析するためには、ガルバノミラーのような可動機構が必要となっていた。(特許文献1参照)  この場合、対象物の位置を確認する為に、分光器の上流側に対象物の位置を確認するためのカメラを別途用意するとともに、カメラで撮影した画像から対象物の位置を特定する画像処理装置を用意する必要がある。【0003】  また、前述したガルバノミラーのような可動機構を利用しない場合には、多列搬送される対象物の列数分の分光器が必要となる。【0004】  また、同時に複数点の反射光を分光することができる平面分光器(特許文献2参照)が提案されている。【特許文献等】【0005】【特許文献1】:EP 0 887 638 B1  公報【特許文献2】:WO 93/21548  公報【発明の開示】【発明が解決しようとする課題】【0006】  前者のように点分光器を用いる場合には、特許文献1に記載されているように、ガルバノミラーのような可動機構と、対象物の位置を確認するためのカメラと、画像処理装置が必要となるので、装置全体のコストがかさむという問題がある。  後者のように、ガルバノミラーのような可動機構を利用せずに、対象物の列数分の分光器を使用する場合には、これらの分光器の設置スペースが非常に大きくなるため、設置場所に制限が出てくるという問題がある。  また、特許文献2に記載のものでは、平面同時分光が可能である反面、点分光と比較すると分解能が約10分の1程度であるため、そのままではインラインにおける分光分析には用いることが困難であった。  そこで、本発明は、上記問題を解決して、搬送される対象物を平面分光器を用いて高い分解能で異種品の検出を可能とする装置を提供することを目的としてなされたものである。【課題を解決するための手段】【0007】  上記課題を解決するために、本発明においては以下の手段を講じた。  即ち、本発明の請求項1の平面分光器を用いた異種品検出装置は、複数の対象物を搬送する搬送手段と、該搬送手段によって搬送される前記複数の対象物に近赤外線を照射する照射手段と、該照射手段によって近赤外線が照射される前記複数の対象物から反射される近赤外線の反射光を平面分光する平面分光器と、該平面分光器にて平面分光された反射光を近赤外線カメラで電気信号に変換する撮像手段と、該撮像手段にて得られる前記電気信号を解析して前記反射光のスペクトルデータを得て主成分分析手法を用いて前記複数の対象物の中から異種品を検出する解析手段とを備えていることを特徴としている。【0008】  請求項2の発明では、前記解析手段は、スペクトルデータを波長軸方向に平均化する波長軸平均化処理、スペクトルデータをラグランジェの2次補間を用いて補間する補間処理、スペクトルデータを空間軸方向に積算して対象物のエッジを検出して対象物の中心位置を検出する測定位置最適化処理、前記測定位置最適化処理によって検出された対象物の中心位置の近傍の複数ポイントにおける各波長毎の平均値を求める空間軸平均化処理、スペクトルデータを一次微分もしくは二次微分する微分処理、予め取得したローディングベクトルデータと以上の処理によって得られたスペクトルデータとを演算することによって主成分得点を算出する主成分得点算出処理、及び、算出された前記主成分得点に基づいて異種品もしくは同種品の判定を行う判定処理を行うように構成されている。【0009】  請求項3の発明では、前記解析手段における波長軸平均化処理は、スペクトルデータを平均化する前処理、スペクトルデータを所定値との比に基づいて標準化する前処理、スペクトルデータを所定値との差分に基づいて標準化する前処理、または、スペクトルデータを波長軸方向に対して移動平均する波長軸平均化処理、の少なくとも何れかの処理を行うように構成されている。  請求項4の発明では、前記解析手段は、スペクトルデータを平滑化する変換処理を行うように構成されている。【0010】  請求項5の発明では、前記解析手段は、スペクトルデータをMSC(Multiplicative scatter correction)手法による補正処理を行うように構成されている。  請求項6の平面分光器を用いた異種品検出装置では、前記解析手段は、スペクトルデータを空間軸方向に積算して対象物のエッジを検出して対象物の中心位置を検出する測定位置最適化処理において、所定のしきい値を越えるエッジが検出できない場合に対象物の異常を検出するように構成されていることを特徴とする。  ここで、対象物の異常とは、形状が異常な場合や対象物が所定の位置に存在していない場合も含む。【0011】  請求項7の平面分光器を用いた異種品検出装置では、前記解析手段は、多列搬送される各列の対象物に関しては、列毎に作成したローディングベクトルデータを用いて主成分分析するように構成した。  請求項8の平面分光器を用いた異種品検出装置では、前記解析手段は、スペクトルデータの所定の波長帯のデータだけを選択して主成分分析するように構成した。  請求項9の平面分光器を用いた異種品検出装置では、前記解析手段は、主成分分析の条件を変えて2回以上繰り返す条件分岐処理を行うように構成した。【0012】  請求項10の平面分光器を用いた異種品検出装置では、前記撮像手段は、ローリング方式の近赤外線カメラとするとともに、前記近赤外線カメラの光軸に平行な軸回りに回動させるカメラ回動機構を備えた。【0013】  請求項11の平面分光器を用いた異種品検出装置では、前記搬送手段は、シート状の対象物を搬送する搬送手段とするとともに、前記対象物の周囲のシート部分を押さえてバタツキを防止するバタツキ防止手段を備えた。【0014】  請求項12の平面分光器を用いた異種品検出装置では、前記撮像手段の視野内に、所定の反射特性を持った光量補正板を配設した。【0015】  本発明においては、以上の構成によって、平面分光器を用いるとともに、データ補間、平滑化処理を行うことにより、緻密且つノイズの少ないデータを生成するので、スペクトルデータによる主成分分析の分解能が改善される。【発明の効果】【0016】  本発明の請求項1〜5の発明によれば、平面分光器を用いるとともに、特徴有るアルゴリズムでデータの補間・平滑化等の処理を行うことにより高い分解能が得られ、広範囲にわたる複数点の成分分析をインラインで安定して行うことが可能となった。また、1組の撮像手段を用いて多列搬送される対象物の多点を同時に分光できるため、省スペース化を図ることができる。また、測定対象搬送経路への取り付け構造を非常にシンプルにできるため、様々な搬送経路へ容易に取り付けることができる。さらに、撮像手段を1組とすることにより撮像特性の校正は1回で完了する。  以上のようにして、搬送される全品のインライン成分モニタリングが可能となり、異種品の混入していない安定した品質の製品を出荷することが可能となる。【0017】  そして、請求項6の発明によれば、前記解析手段における前記測定位置最適化処理において、所定のしきい値を越えるエッジが検出できない場合に対象物の異常を検出するように構成したので、対象物の形状が異常な場合や対象物が所定の位置に存在していない場合、例えば欠錠等を検出することもできる。【0018】  請求項7の発明では、前記解析手段は、多列搬送される各列の対象物に関しては、列毎に作成したローディングベクトルデータを用いて主成分分析するように構成したので、多列搬送される場合の列の違いによる光量差等の条件の違いの影響を排除することができる。【0019】  請求項8の発明では、前記解析手段は、スペクトルデータの所定の波長帯のデータだけを選択して主成分分析するように構成したので、少ないデータ量で精確な分析が可能となり、演算処理の負担が軽減され処理の高速化が可能となった。【0020】  請求項9の発明では、前記解析手段は、主成分分析の条件を変えて2回以上繰り返す条件分岐処理を行うように構成したので、一つの条件での分析では互いに識別できないようなグループがある場合でも、識別が可能である。【0021】  請求項10の発明では、前記撮像手段は、ローリング方式の近赤外線カメラとするとともに、前記近赤外線カメラ軸を回転させて調節する調節手段を備えたので、ローリング方式の近赤外線カメラであっても、データ取り込みタイミングのズレを補償することができる。ローリング方式の近赤外線カメラでない場合には、調節手段は不要である。【0022】  請求項11の発明では、前記搬送手段は、シート状の対象物を搬送する搬送手段とするとともに、バタツキ防止板を備えたので、前記対象物の周囲のシート部分を押さえてバタツキを防止することが可能となり、精確な分析が可能となった。対象物がシート状でない場合にはバタツキ防止板は不要である。【0023】  請求項12の発明では、対象物の近傍に、所定の反射特性を持った光量補正板を配設したので、前記光量補正板から得られるデータが所定の値になるように光源や撮像手段を制御することによって、経時変化等による特性の変化を補償することが可能である。【発明を実施するための最良の形態】【0024】  図1は、本発明にかかる平面分光器を用いた異種品検出装置の実施形態の構成図である。  図中、1は前記平面分光器を用いた異種品検出装置であり、平面分光器2、撮像手段としての近赤外線カメラ3、照射手段としてのライトガイド4、解析手段としてのコンピュータ5、および搬送手段11から構成されている。  11は後述する吸着ドラム式の搬送手段であり、図示しないホッパから供給される例えば錠剤等の対象物Tを吸着ドラム12の表面に吸着して搬送するように構成されている。図2の正面図に示したように、前記吸着ドラム12の表面においては、搬送方向に直角な方向に複数の前記対象物Tが配列された状態で多列搬送されるように構成されている。【0025】  前記ライトガイド4は前記対象物Tの列に対してできるだけ均等に近赤外線を照射するように構成されている。即ち、前記ライトガイド4は前記対象物Tの列を挟むように一対の近赤外線光源から構成され、各対象物Tにできるだけ陰が生じないように、また、均等に照射されるように配置されている。このライトガイド4の位置は調節可能に配置されている。  前記近赤外線光源としては、例えばハロゲンランプと、近赤外線フィルターと、光ファイバー束等の導光手段とで構成することができる。  そして、前記近赤外線カメラ3は、波長900〜1700 nmの近赤外線領域に対して十分な感度を有したものとする。  なお、6は光量補正板であり、前記ライトガイド4によって近赤外線が照射される位置に、前記ライトガイド4と同様に固定されている。【0026】  前記平面分光器2は、前記対象物Tより反射した近赤外線の反射光が効率よく入射するように配設されている。即ち、近赤外線が照射される対象物Tと前記吸着ドラム11の断面の中心とを結ぶ半径の延長線状に、その光軸を前記対象物Tに向けて配設されている。前記平面分光器2の光軸は調節可能に配置されている。  前記平面分光器2には、前記各対象物Tからの反射光が入射され、搬送方向(副走査方向:矢印Y方向)の幅は微少であって、前記吸着ドラム11の搬送幅方向(主走査方向:矢印X方向)に長く、断面がライン状の光束A(図3参照)を得て、この光束Aを平面分光することによって、例えば、横軸が搬送幅方向の位置、縦軸が波長に対応した平面状の分光スペクトルB(図3参照)が得られる。この平面状の分光スペクトルBの1辺近傍には前記光量補正板6から得られた基準となるスペクトルデータも含まれている。【0027】  次に、前記吸着ドラム式の搬送手段に代えて、コンベア式の搬送手段を用いた場合の構成を図14に示して説明する。  図14において、図1と同じ構成に関しては、同じ符号を付してその説明を省略した。  13はコンベア式の搬送手段であり、対象物収納部が形成された樹脂シート(PTPシート)の前記対象物収納部に収納されて多列搬送される例えば錠剤等の対象物Tを、送り出しロールから受け取りロールへ搬送するように構成されている。図15の正面図に示したように、前記PTPシートによって、搬送方向に直角な方向に複数の前記対象物Tが配列された状態で多列搬送されるように構成されている。【0028】  なお、6は光量補正板であり、前記ライトガイド4によって近赤外線が照射される位置であって、且つ、前記近赤外線カメラ3の視野内に、前記ライトガイド4と同様に固定されている。  7は、バタツキ防止板であり、前記ライトガイド4によって近赤外線が照射される位置に、前記ライトガイド4や光量補正板6等と同様に固定されている。図18の(A)に示したように、このバタツキ防止板7には、対象物Tの撮像を妨げないように透孔71が形成されている。従って、図18の(B)に示したように、PTPシートで搬送される対象物Tを前記透孔71を通して撮像することができる。  前記平面分光器2では、上記同様に、例えば、横軸が搬送幅方向の位置、縦軸が波長に対応した平面状の分光スペクトルB(図3参照)が得られる。  なお、対象物からの近赤外線の反射光はPTPシートのフィルムを透過するので、PTPシートのフィルムの上から異品種の有無を測定することができる。【0029】  以上のような吸着ドラム式もしくはコンベア式の搬送手段によって対象物は多列搬送されるように構成されている。  そして、前記平面分光器2にて得られた平面状のスペクトルデータは、近赤外線カメラ3の撮像面上に結像し、例えばCCD素子等の撮像素子によって電気信号に変換され、さらにデジタル信号に変換されて、前記コンピュータ5に送信される。  なお、前記搬送手段によって搬送される対象物が所定の位置に到達したタイミングで得られるトリガー信号に同期して画像を取り込み、前記コンピュータ5に送信するように構成するとよい。  前記コンピュータ5では、送信されたスペクトルデータを、新たに開発した後述するアルゴリズムにより処理し、対象物Tを良品と異品種とに識別する。  後述するアルゴリズムは、スペクトル解析に有効なケモメトリックスの一つである主成分分析を用いたものである。【0030】  前記コンピュータ5における解析手段としてのアルゴリズムは以下の処理を含んでいる。1)前記スペクトルデータを平均化および標準化する前処理、2)前記スペクトルデータを波長軸方向に対して移動平均する波長軸平均化処理、3)前記スペクトルデータをラグランジェの2次補間を用いて補間する補間処理、4)前記スペクトルデータを空間軸方向に積算して対象物のエッジを検出して対象物の中心位置を検出する測定位置最適化処理、5)前記測定位置最適化処理によって検出された対象物の中心位置の近傍の複数ポイントにおける各波長毎の平均値を求める空間軸平均化処理、6)前記スペクトルデータを一次微分もしくは二次微分する微分処理、7)前記スペクトルデータを平滑化し、MSC手法によって補正する処理、8)予め取得したローディングベクトルデータと、以上の処理によって得られたスペクトルデータとを演算することによって主成分得点を算出する主成分得点算出処理、9)算出された主成分得点に基づいて異種品もしくは同種品の判定を行う判定処理、10)測定位置最適化処理を利用して欠品の検出を行う欠品検出処理、11)条件分岐処理。  なお、処理順番は上記順番に限定されるものではない。【0031】  次に、前記各処理の計算手法の詳細を説明する。1)前処理(平均化、標準化)  前記スペクトルデータに以下のような平均化、比率標準化、差分標準化の少なくとも何れかの処理をかける。(後述する空間軸平均化処理の後でもよい。)  平均化と差分標準化を併用することが効果的である。        平均化:スペクトルデータの平均値を各波長のデータより引いて正負のデータ                に変換する処理。        比率標準化:スペクトルデータを所定値との比に基づいて標準化する処理、                  具体的には、スペクトルデータの標準偏差で各波長のデータを割って                標準化して、各スペクトルデータ間のバラツキの影響を除外する処理。        差分標準化:スペクトルデータを所定値との差分に基づいて標準化する処理、                具体的には、スペクトルデータの標準偏差と各波長のデータとの差分                を求めて標準化して、各スペクトルデータ間のバラツキの影響を除外                する処理。2)波長軸平均化処理  縦軸に反射率、横軸に波長を示したグラフの波長軸方向に対し、3〜20点の移動平均をとり、波形に乗った微小なノイズの影響を減少させる。3)ラグランジェ補間処理  約4 nm間隔で得られたスペクトルデータをラグランジェの2次以上の補間を用いて2 nm間隔のより緻密なデータに補間する。4)測定位置最適化処理  空間軸方向のポイント毎に反射率を積算して積算値を計算し、縦軸に積算値、横軸に空間軸ポイント数を示したプロファイル(図4の(A)参照)に対し一次微分をかけ、その極大値と極小値を対象物の縁(即ち「エッジ」)として認識させ(図4の(B)参照)、両エッジの中点から中心位置と半径とを得る。(図4の(C)参照)【0032】5)空間軸平均化処理  前記4)の測定位置最適化処理により求めた対象物の中心より対象物のエッジまでの間の任意のポイント数分において各波長毎の反射率の平均値を求める。この処理によって、対象物の一点のみの反射光ではなく、対象物の複数個所における反射光の平均値に基づいたスペクトルデータを得ることができる。【0033】6)変換処理(一次微分もしくは二次微分、平滑化)  スペクトルデータの吸収ピークを強調させる為に、一次微分もしくは二次微分をかける。また、ノイズの影響を減少させる為に、数ポイント〜数十ポイント毎に平滑化をかける。一次微分もしくは二次微分、平滑化は例えばSavitzky-Golayの最小二乗法を用いている。  または、MSC手法によって補正処理を行うことは、光の散乱の影響等を排除することに効果的である。【0034】7)主成分得点算出処理  予め、検査する全てのサンプルを用いて主成分分析を行い、ローディングベクトル(Loading Vector)データを取得しておく。このローディングベクトルデータと、以上の処理によって補間・前処理・変換を行ったスペクトルデータを、下記の式のように行列計算することにより、インラインでの主成分得点算出を行う。算出した主成分得点は一次元以上のPrincipal Component Analysis(PCA,主成分分析。以下同じ)図にプロットされる。          S=X・La    S:主成分得点  X:スペクトルデータ  La:ローディングベクトル  一般的に、二次元の主成分分析を行うことで十分であるが、三次元以上の主成分分析を行うことも可能である。【0035】8)判定処理  PCA図にプロットされたデータが予め設定された良品範囲内にあれば良品、前記良品範囲外なら異種品として判定したデータを振り分け装置等に送信する。9)欠品検出処理  前記4)の測定位置最適化処理で用いたプロファイルに対して一次微分をかけた波形の極大値に対ししきい値を設け、しきい値に満たないデータを欠品として検知する。(図5参照)  欠品を検出した場合には、他の処理が残っている場合でも、それらの処理を省略して、検査対象に対して「欠品」との判定を行う。【0036】10)条件分岐処理  検査するサンプルが複数あり、一つのPCA図だけでは識別できない場合は、条件分岐処理にて複数回主成分分析を行う。条件分岐処理とは、1回目の主成分分析で異種品のグループに分け、各グループの製品に対して1回目とは異なる条件で主成分分析する処理方式である。これを3回・4回と繰り返し、異種品を全て識別する。【0037】  次に、本発明の平面分光器を用いた異種品検出装置でインラインの全数検査をする手順の概要を以下に説明する。1)先ず、同種品もしくは異種品の判定を行う対象の全ての種類の対象物に関して予めPCA図を作成する。  この際、測定した全ての波長を計算対象とするのではなく、良品スペクトルが異種品スペクトルと比べて有意差がある波長のみを計算対象とすることにより、検査精度の高いPCA図を作成することが可能である。  また、一つのPCA図で複数列を検査した結果、列間のデータのバラツキが大きくなった場合は、列毎にPCA図を作成することにより、検査精度を上げることが可能である。【0038】2)PCA図作成後に良品範囲を設定し、評価チャートを作成する。  インライン検査を行う時は、この評価チャートとPCA図作成時に取得するローディングベクトルを使用する。【0039】3)インライン検査においては、得られたスペクトルデータに対し、先ず平均・平滑・補間処理を行い、次に欠品検査を行う。欠品検査に合格した場合には、測定位置最適化処理を行い、その後に、前処理、変換処理を行う。4)このスペクトルデータに対し主成分分析を行うために、PCA図作成時に求めたローディングベクトルと、得られたスペクトルデータを行列計算させることにより主成分得点を算出する。この方法を採ることにより、主成分分析を用いたインライン検査を可能にした。5)算出した主成分得点は予め作成された評価チャートにプロットされ、良否判定される。  以上の1回の主成分分析で識別できない場合は、計算対象とする波長を変えたり、微分回数を変えたりして条件を変えて、前記条件分岐方式で処理して主成分分析を繰り返す。【0040】  上述したように、本発明にかかる平面分光器を用いた異種品検出装置に用いる前記アルゴリズムは計算量が少ないため、計算処理に要するサイクルタイムが短い。(1回の処理で数mSec)  従って、条件分岐処理を行って多数回繰り返しても、短時間で十分上記の目的を達することができる。【0041】  次に、平面分光器と近赤外線カメラの位置を調整するカメラ回動機構について説明する。  カメラの撮像方式がローリング方式のものを使用する場合、撮像素子の1セル毎に順次データを読み取るため、最初のセルデータの読み取りタイミングと最後のセルデータの読み取りタイミングとでは十数mSecの遅れが生じる。従って、このままでは、搬送列の位置に応じて測定ポイントにズレが生じ、全ての測定列の各対象物の同じ位置を測定することができない。例えば、対象物の表面の中心位置の反射光を測定するつもりが、対象物の搬送位置によっては、対象物の中心からずれた位置、即ち、反射特性の異なる位置の反射光を測定することになる。【0042】  そこで、図16の(A)に示したように、平面分光器2と近赤外線カメラ3を、その光軸に平行な軸回りに回動するカメラ回動機構8を備えるとよい。このカメラ回動機構8は、ツマミ81を回すことによって、平面分光器2と近赤外線カメラ3のマウンド部82を、ベース部83に対して矢印のように回動させることができるように構成されている。  例えば、図16の(B)に示したように、主走査方向を矢印Xの方向、副走査方向を矢印Yの方向としたとき、搬送列の両端の対象物で測定ポイントのズレ(d)が発生する場合には、前記カメラ回動機構8を操作して、平面分光器2と近赤外線カメラ3を光軸に平行な軸まわり(光軸まわりを含む。)に、前記測定ポイントのズレ量に相当する角度(θ)だけ回動させる。  このように、前記カメラ回動機構8によって前記測定ポイントのズレ(d)を補償する適切な角度(θ)に調節することにより、前記読み取りタイミングのズレを吸収し、全ての搬送列の対象物の中心を測定することができるようにした。【0043】  さらに、前記光量補正板6からの反射光によって、近赤外線の光量や撮像手段の感度が時間経過に従って変化しても、自動追従して補正するように構成した。  即ち、本装置の使用に先立って、基準となる白色板を測定して校正に使用する各測定ポイントのリファレンスデータを取得する際に、同時に光量補正板6からの反射光の各波長毎のデータを取得しておき、測定時には随時光量補正板6からの反射光の各波長毎のデータを取得し、初めに測定したデータに対する変化率を各測定ポイントのリファレンスデータに反映させることにより光量補正を行った。  また、光量補正は、図17に示したように、光量補正回路9を設け、測定毎に前記光量補正板6からの反射光のスペクトルデータを比較回路91に取り込んで基準値と比較して、変換回路92においては補正用制御信号を出力し、この補正用制御信号で前記スペクトルデータが所定のレベルになるように、光源駆動回路93を制御して前記ライトガイド4の光源の光量を変化させるように構成することによっても行うことができる。  なお、複数列で搬送される対象物と平面分光器との間に複数の光ファイバーからなる光ファイバー束を配設し、各光ファイバーの一端側をそれぞれ各列の対象物に対向させ、各光ファイバーの他端側は束ねて平面分光器に対向させ、各列の対象物からの反射光をそれぞれに対向させた光ファイバーに入射させて平面分光器まで導くように構成することも可能である。【実施例1】【0044】  次に、本発明の平面分光器を用いた異種品検出装置を、コンベア式の搬送手段を用いてPTP包装(7列)される5種類の錠剤品目(A,B,C,D,E)を対象物として適用した実施例を示す。  先ず、主成分得点算出処理用のローディングベクトルデータを算出するために、各品目それぞれについて、各列40錠のデータを使用し、280錠の錠剤を対象物として適用した。280錠のうちの90錠(3列)には印刷、または刻印のある面を含ませた。【0045】  この実施例での測定条件は次の通りであった。      使用レンズ          :  f=  25mm      波長軸移動平均ポイント数:  3ポイント      統計処理波長        :  1000〜1600 nm      ラグランジェ補間    :  2nm      平滑化              :  2次      一次微分            :  2次      統計前処理          :  平均化+標準化      空間軸平均数        :  5      移動速度            :  4.4m/min      搬送列数            :  7列【0046】  この実施例1において、測定データは次の通りであった。1.ローディングベクトル算出(1)分光スペクトル取得  前記測定条件にて、平面分光器(フィンランドSpecim社製)と、近赤外線カメラ(米国Sensors Unlimited社製)とを用いて撮像した平面状のスペクトルデータの画像を図6に示した。  図6において、紙面横方向は波長軸を示し、紙面縦方向は空間方向を示している。  (1)〜(7)が多列搬送される7つの列(ライン1〜7)の反射光のスペクトルデータであり、最下部の白色部(8)が、白色片で構成した光量補正用板6の反射光のスペクトルデータである。【0047】  ここでは、光量のバラツキやシートのバタツキ等で条件の悪いライン7のデータを使用して、識別力の高いローディングベクトルの算出を行った。(2)周波数帯の選択  図7のスペクトルデータ(横軸が波長軸)に基づいて、全周波数領域を用いた場合のPCA図(図8)と、識別力の高いローディングベクトルデータを得るために図9のように4つの波長帯(印)を選択した場合のPCA図(図10)を示した。  周波数帯を選択しない場合には、図8のように各品種のデータが分離されないため、互いの識別は困難であるが、図9のように周波数帯を選択した場合には、図10のように、領域A,B,C,D,Eのうち、領域B,C,Dは互いに重複がないので、対応する品目B,C,Dは互いに明確に識別できる。(品目A,Eに関しては領域A,Eが重複するため識別困難)  このように識別が困難な品目(品目A,E)がある場合には、前述した条件分岐処理を用いて、別の周波数帯のデータで主成分分析を行うか、後述するように色等の別の指標を用いて識別するとよい。【0048】2.検証  以上のようにして算出したローディングデータと評価シート(第1成分と第2成分からなる矩形領域を設定)を用いて、各品目300錠をインライン測定して次のように検証した。  ライン1〜7を測定した際のデータの中からライン1、2のデータを選択し、その場合のPCA図と、それぞれの平均値(m)、標準偏差(σ)、平均値+5σ、平均値−5σの数値データを図11、12に示した。  ライン1のデータ(図11の(A)、(B))によれば品目B,C,Dは互いに明確に識別できる(品目A,Eに関しては識別困難)。  ライン2のデータ(図12の(A)、(B))によれば品目Cは明確に他から識別できるが、品目Bと品目Dとはこのままでは識別できない。即ち、品目Bの第2成分の平均値+5σと、品目Dの第2成分の平均値−5σの領域が僅かに重複(印)している(品目A,Eに関しては識別困難)。【0049】  なお、ライン3〜7の場合のPCA図とそれぞれの数値データに関しては、図示及び説明を省略した。【0050】3.検討  以上のようにして第1成分と第2成分からなる矩形領域を設定すると、ライン2の場合のように、一部の重複が発生するが、図13に示したように、第1成分と第2成分とをそれぞれ長短2軸とする楕円領域R1、R2を設定することによって、重複する部分の発生を防ぎ、互いに識別することが可能となる。  なお、以上の実施例において、品目Aと品目Eとは、錠剤色が異なっているため、カラーセンサを用いることによって容易に識別することができる。  以上のように、この実施例においては、本発明の平面分光器を用いた異種品検出装置とカラーセンサとを組み合わせることによって、5品目全てを識別することができた。【図面の簡単な説明】【0051】【図1】本発明にかかる平面分光器を用いた異種品検出装置の実施の形態(吸着ドラム式)の側面構成図である。【図2】前記実施形態の要部の平面構成図である。【図3】平面分光器の機能を説明する説明図である。【図4】解析手段における測定位置最適化処理の一部を説明する説明図であり、(A)はプロファイルの波形、(B)は微分処理してエッジを検出した波形、(C)は中心位置と半径の算出を説明する図である。【図5】前記測定位置最適化処理における欠品検出処理の説明図である。【0052】【図6】2次元の平面に分光したスペクトル例を示す図である。【図7】図6のスペクトルのライン7のスペクトルを示す図である。【図8】図7のスペクトルデータに基づいたPCA図である。【図9】図7のスペクトル図から4波長帯を選択したスペクトルを示す図である。【図10】図9のスペクトルデータに基づいたPCA図である【0053】【図11】実施例のデータであり、(A)はライン1のPCA図、(B)はライン1の数値データを示した図である。【図12】実施例のデータであり、(A)はライン2のPCA図、(B)はライン2の数値データを示した図である。【図13】第1成分と第2成分とをそれぞれ長短2軸とする楕円領域を設定したPCA図の例を示す図である。【0054】【図14】本発明にかかる平面分光器を用いた異種品検出装置の実施の形態(コンベア式)の側面構成図である。【図15】前記実施形態の要部の平面構成図である。【図16】カメラ回動機構の説明図である。【図17】光量補正板を用いた補正回路のブロック図である。【図18】バタツキ防止板の詳細説明図であり、(A)はその斜視図、(B)はその使用状態の側面断面図である。【符号の説明】【0055】1    平面分光器を用いた異種品検出装置2    平面分光器3    近赤外線カメラ4    ライトガイド5    コンピュータ6    光量補正板7    バタツキ防止板8    カメラ回動機構9    光量補正回路11    吸着ドラム式の搬送手段12    吸着ドラム13    コンベア式の搬送手段T    対象物
【特許請求の範囲】【請求項1】複数の対象物を搬送する搬送手段と、該搬送手段によって搬送される前記複数の対象物に近赤外線を照射する照射手段と、該照射手段によって近赤外線が照射される前記複数の対象物から反射される近赤外線の反射光を平面分光する平面分光器と、該平面分光器にて平面分光された反射光を近赤外線カメラで電気信号に変換する撮像手段と、該撮像手段にて得られる前記電気信号を解析して前記反射光のスペクトルデータを得て主成分分析手法を用いて前記複数の対象物の中から異種品を検出する解析手段とを備えていることを特徴とする平面分光器を用いた異種品検出装置。【請求項2】前記解析手段は、スペクトルデータを波長軸方向に平均化する波長軸平均化処理、スペクトルデータをラグランジェの2次補間を用いて補間する補間処理、スペクトルデータを空間軸方向に積算して対象物のエッジを検出して対象物の中心位置を検出する測定位置最適化処理、前記測定位置最適化処理によって検出された対象物の中心位置の近傍の複数ポイントにおける各波長毎の平均値を求める空間軸平均化処理、スペクトルデータを一次微分もしくは二次微分する微分処理、予め取得したローディングベクトルデータと、以上の処理によって得られたスペクトルデータとを演算することによって主成分得点を算出する主成分得点算出処理、及び、算出された前記主成分得点に基づいて異種品もしくは同種品の判定を行う判定処理を行うように構成されていることを特徴とする請求項1に記載の平面分光器を用いた異種品検出装置。【請求項3】前記解析手段における波長軸平均化処理は、スペクトルデータを平均化する前処理、スペクトルデータを所定値との比に基づいて標準化する前処理、スペクトルデータを所定値との差分に基づいて標準化する前処理、または、スペクトルデータを波長軸方向に対して移動平均する波長軸平均化処理、の少なくとも何れか1つの処理を行うことを特徴とする請求項2に記載の異種品検出装置。【請求項4】前記解析手段は、スペクトルデータを平滑化する変換処理を行うように構成されていることを特徴とする請求項1乃至3の何れか1項に記載の平面分光器を用いた異種品検出装置。【請求項5】前記解析手段は、スペクトルデータをMSC(Multiplicative scatter correction)手法による補正処理を行うように構成されていることを特徴とする請求項1乃至4の何れか1項に記載の平面分光器を用いた異種品検出装置。【請求項6】前記解析手段は、スペクトルデータを空間軸方向に積算して対象物のエッジを検出して対象物の中心位置を検出する測定位置最適化処理において、所定のしきい値を越えるエッジが検出できない場合に対象物の異常を検出するように構成されていることを特徴とする請求項1乃至5の何れか1項に記載の平面分光器を用いた異種品検出装置。【請求項7】前記解析手段は、多列搬送される各列の対象物に関しては、列毎に作成したローディングベクトルデータを用いて主成分分析するように構成されていることを特徴とする請求項1乃至6の何れか1項に記載の平面分光器を用いた異種品検出装置。【請求項8】前記解析手段は、スペクトルデータの所定の波長帯のデータだけを選択して主成分分析するように構成されていることを特徴とする請求項1乃至7の何れか1項に記載の平面分光器を用いた異種品検出装置。【請求項9】前記解析手段は、主成分分析の条件を変えて2回以上繰り返す条件分岐処理を行うように構成されていることを特徴とする請求項1乃至8の何れか1項に記載の平面分光器を用いた異種品検出装置。【請求項10】前記撮像手段は、ローリング方式の近赤外線カメラとするとともに、前記近赤外線カメラの光軸に平行な軸回りに回動させるカメラ回動機構を備えたことを特徴とする請求項1乃至9の何れか1項に記載の平面分光器を用いた異種品検出装置。【請求項11】前記搬送手段は、シート状の対象物を搬送する搬送手段とするとともに、前記対象物の周囲のシート部分を押さえてバタツキを防止するバタツキ防止手段を備えたことを特徴とする請求項1乃至10の何れか1項に記載の平面分光器を用いた異種品検出装置。【請求項12】前記撮像手段の視野内に、所定の反射特性を持った光量補正板を配設したことを特徴とする請求項1乃至11の何れか1項に記載の平面分光器を用いた異種品検出装置。
平面分光器を用いた異種品検出装置
