株式会社富士通研究所(注1)は、クラウドコンピューティングや企業システムのインフラ環境として広く普及している仮想環境の性能問題の原因を特定する性能分析技術を世界で初めて開発しました。
従来、仮想環境での問題発生時に、仮想環境全体の挙動を分析可能なツールがなく、アプリケーション(プログラム)レベルで「なぜ」遅くなったのか根本原因を特定することが困難でした。今回、仮想基盤のハイパーバイザー(注2)上で各仮想マシン(VM:Virtual Machine)のユーザープログラムの動作情報を採取することにより、一元的なプログラムの挙動分析を実現しました。
本技術により、ハイパーバイザー内の処理からVM上のOSやユーザープログラム(業務アプリケーション)の処理までの性能を迅速・正確に分析し、挙動を把握することが可能となり、リソースの使用効率の向上によるコスト削減も期待されます。
開発の背景
サーバの仮想化では、1台の物理サーバ上に複数のVMを搭載し、それぞれのVM上でOSと業務アプリケーションを同時に稼働させることができます。これにより、従来は別々のサーバで動作していた業務を1つのサーバに集約することで、高性能化が進むサーバのCPUを有効に活用でき、機器コストを削減することができます。
仮想環境の普及にともない、エンドユーザーでは「原因不明の突発的な性能劣化が起こる」「期待通りの業務性能が得られない」といった事象が多く見られるようになりました。その理由として、以下の要因があげられます。
1台の物理サーバ上に、複数のVM環境、およびVM機能を提供しているハイパーバイザーの環境が混在しているために、環境が複雑化しており原因特定が難しくなっている。
VMは実際にはハイパーバイザーにより切替えられて動作しているので、単体VMだけの性能監視・分析では性能の正確な把握ができない。
また、障害の発生による中断や停止が許されないミッションクリティカル向けアプリケーションの仮想化も進んでおり、仮想環境においても性能が要求され、アプリケーションも含めたシステム全体のプログラムレベルでの性能最適化が必要となってきています。
課題
仮想環境の性能の劣化などの性能問題に対し、既存の性能管理ツールの仮想化対応が進み、CPU・メモリ・IOなどのリソースレベルのボトルネック箇所の確認までは可能となりましたが、ハイパーバイザー内の処理からVM上のOSやユーザープログラムの処理まで一括して正確にプログラムレベルの分析が可能な性能ツールはありませんでした。そのため、問題を解決するためにはVMの移動やリソースの再配分を行う対処方法しかなく、リソースの使用効率や運用管理コストの増加につながることが懸念されています。
開発した技術
今回、仮想基盤のハイパーバイザー上で各VMのユーザープログラムの動作情報を採取することにより、ハイパーバイザー内の処理から各VM上のOSやユーザープログラムの処理までの性能を迅速・正確に分析する技術を開発しました。情報採取から分析までの手順は以下の通りです。
測定フェーズ
各VM上のユーザープログラムの動作情報を、それぞれの該当VM上ではなく、VMの切替え処理を活用してハイパーバイザー上で一元採取します。
マップ情報生成フェーズ
測定フェーズで採取したデータを、アプリケーション名や処理関数名などのシンボル名に変換するためのマップ情報を各VM上で作成します。
分析フェーズ
測定フェーズで採取した各VM上のユーザープログラムの動作情報と、マップ情報生成フェーズで生成したマップ情報とを照合し、各VM上の動作プログラムの実行内訳をハイパーバイザーの時間軸で一元分析します。
このように一元的にデータ採取と分析を行うことにより、複雑化した仮想環境でも正確な実体把握ができます。また、ハイパーバイザーに本機能を組み込むだけで、各VM上のOSやアプリケーションの変更を必要とせずに、ブラックボックス化している仮想環境の性能分析と可視化を実現しました。
効果
本技術により、「なぜ性能問題が発生したのか」、「どこに解決すべき原因となるプログラムの処理があるのか」など、従来は困難であった仮想環境での原因特定が可能になります。また、性能を迅速・正確に分析し、挙動を把握することが可能となり、リソースの使用効率の向上によるコスト削減も期待されます。
今後
本技術は、2013年4月より、富士通Linux技術支援サービスでの利用を予定しています。
商標について
記載されている製品名などの固有名詞は、各社の商標または登録商標です。
世界初!仮想環境の性能低下などの原因を特定する性能分析技術を開発 : 富士通
