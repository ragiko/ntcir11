コスト削減を目的とした適正なマシン能力やソフトウェア料金の選択、またはオープン系への移行などによりダウンサイジングを検討する際、業務への影響が許容できる範囲であるかの確認はどのように実施されていますでしょうか。
今回は弊社にて行った2つの事例、CPUのダウンサイジング予測と、IBMシステムのソフトウェア課金で用いられるMSUキャッピングの制限値変更による影響予測について、ご紹介させていただきます。
CPUダウンサイジング予測
移行後のモデル候補
現行との性能比 60%
当初、CPUダウンサイジング後のCPU使用率を次の条件で予測しました。対象データは10分インターバル24時間分を使用しています。
予測条件
(1)業務毎のCPU使用率の割合は保つ
(2)CPU性能比から算出したCPU使用率が100%を超えた場合、次インターバルへ持ち越す。
現行CPU使用率は図1、予測後CPU使用率は図2をご覧下さい
この予測方法では、元々CPUを必要としていない時間帯を加味していないため、業務のCPU使用特性の山が反映されませんでした。そこで、次のような条件を追加して再度予測を実施しました(図3)。
予測条件
①業務ごとのCPU使用率の割合は保つ
②CPU性能比から算出したCPU使用率が100%を超えた場合、
(1)次インターバルが100%以上の場合、次インターバルに余剰分を持ち越す。
(2)次インターバルが100%未満の場合、そのインターバル以降を後へずらし、持ち越された余剰分のみのインターバルを挿入する。
業務を切り出した後の予測を実施する場合、切り出し対象の業務がサービスクラスやパフォーマンスグループでグループ化されていれば、対象業務グループのCPU使用率を除外後、CPU性能比からCPU使用率を算出します。
また、月単位でのCPU使用状況を予測すべく、同様の方法で筐体のCPU使用率を海水温グラフで表しました。データ対象期間は2ヵ月間です。現行筐体CPU使用率は図4、予測後筐体CPU使用率は図5となります。
MSUキャッピングの制限値変更の影響予測
MSUキャッピングの制限値を下げた場合、オンライン時間帯でCPUの使用を制限される可能性があるか、またバッチ時間帯においてはバッチ終了時刻が目標を超えることがないかの確認を行うために、制限値変更後のCPU使用率予測を実施しました。
【制限値】
現 在 : 16 MSU
変更後: 15 MSU
MSUキャッピングでは4時間平均MSU値が制限値に達しなければ、制限値を超えてCPUを使用することができます。
グラフ図6は実測データです。 制限値は16 MSUに設定されています。4時間平均MSU使用値が制限値を超えた2:00辺りから、CPUの使用が抑えられていることを確認できます。
MSU値はSMFデータより取得できますが、MSU値とCPU使用率の比率が一定のため、CPU使用率よりMSU値の算出も可能です。CPU使用率
より4時間平均MSU値を算出して、下記の条件で予測を実施したところ、実測値の4時間平均MSU値と近い結果を得ることを確認しました。
予測条件
①4時間平均MSU値が制限値を超えたら、制限値までCPUの使用を下げる
②4時間平均MSU値が制限値以下になったら、CPUの使用を制限しない
この方法で制限値を15 MSUにして予測したグラフが図7となります。現行と比べてCPUの使用を制限される時間帯が増えて、オンライン時間帯においてもCPUの使用が制限される予測結果となりました。
まとめ
実際には業務スケジューリングや優先順位制御、その他のリソースの使用状況による影響も出てくるかと考えますが、ひとつの参考資料としていただけるのではないでしょうか。
皆様の今後のパフォーマンス管理にお役立ていただけましたら幸いです。
ダウンサイジング予測事例
