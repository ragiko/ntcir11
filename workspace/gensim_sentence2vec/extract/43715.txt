
グラフのデータ範囲を可変にする
データの範囲に合わせて、自動的にグラフのデータ範囲が変更されるようにします。
グラフのデータ個数が増えるたびに、
「データの選択」(2003は元データ)を変更するのは、いかにも面倒です。
できれば、マクロでやりたいところですが、マクロはちょっという人用に解説します。
一応、マクロも最後に載せています。
以下の表で説明します。
作成するグラフは、以下になります。
グラフはなんでも結構です。
ていっても限度がありますけど、上記の表なら折線か棒グラフくらいでしょう。
まず、名前定義をします。シート「リスト」を選択します。
データのあるシートを選択 
Ctrl+F3で名前定義を起動する。メニュー等からの起動はバージョン毎に違います。 
新規作成(追加) 
「名前」に「グラフ軸」と入力。 
「参照範囲」に「=OFFSET($A$2,0,0,COUNTA($A:$A)-1,1)」 
「OK」 
新規作成(追加) 
「名前」に「グラフデータA」と入力。 
「参照範囲」に「=OFFSET($B$2,0,0,COUNTA($A:$A)-1,1)」 
「OK」 
新規作成(追加) 
「名前」に「グラフデータB」と入力。 
「参照範囲」に「=OFFSET($C$2,0,0,COUNTA($A:$A)-1,1)」 
「OK」 
2007以降の場合は、「範囲」は、「ブック」にして下さい。
では、グラフの設定です。
2007以降は、「データの選択」
ここで、「軸ラベル」の「編集」
範囲に、「ブック名!グラフ軸」と入れます。
ブック名は、拡張子も含めて正しく設定する必要があります。
続いて、「系列」の「編集」
これを、全ての系列に対して行います、ここでは2系列です。
名前定義したデータ列と一致するように、注意してください。
2003では、「元のデータ」
上図のように設定して下さい。
全ての系列に対して、行って下さい。
以上で完成です。
少し面倒ですが、一度設定してしまえば、データ個数に自動対応されますので、
その後は保守が楽になります。
しかし、この方法はいかにも面倒です。
系列が増えるたびに、名前定義からやらなければなりません。
やはり、できれば、マクロでやる事をお勧めします。
以下に、そのコードを一例を示しておきます。
Sub test()  Dim i As Long, F As String, lngMax As Long  lngMax = 
Cells(Rows.Count, 1).End(xlUp).Row  With 
ActiveSheet.ChartObjects(1).Chart    For i = 1 To 
.SeriesCollection.Count      .SeriesCollection(i).Formula = 
_        "=SERIES(" & _        Cells(1, i + 
1).Address(External:=True) & "," & _        Cells(2, 
1).Resize(lngMax - 1, 1).Address(External:=True) & "," & 
_        Cells(2, i + 1).Resize(lngMax - 1, 1).Address(External:=True) & 
"," & _        i & ")"    Next i  End WithEnd 
Sub
このマクロは、系列のデータが連続したセルにあることを前提にしています。
今回は、関数としての紹介なので、VBAの説明は省略します。
しかし、このマクロを実行すれば、
直ちにデータ範囲も変更されますし、系列が増えても、このマクロは変更が必要ありません。
グラフのデータ範囲を可変にする｜エクセル関数超技
