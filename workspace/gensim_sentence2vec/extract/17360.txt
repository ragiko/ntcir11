カメラキャリブレーションと3次元再構成¶
このセクションで述べる関数は,いわゆるピンホールカメラモデルを取り扱います.つまりこのモデルでは,3次元座点を透視投影変換を用いて画像平面に射影することで,シーンのビューが構成されています.
ここで
はワールド座標系の3次元座標を表し
は画像平面に投影された点の座標を表します.
は,カメラ行列,またはカメラの内部パラメータ行列と呼ばれます.
は主点(通常は画像中心),
はピクセル単位で表される焦点距離です.
したがって,あるファクタによってカメラ画像がスケーリングされている場合,
このすべてのパラメータを同じファクタでスケーリング(それぞれが,拡大または縮小)する必要があります.
内部パラメータ行列はビューに依存しないので,一度推定すれば(ズームレンズの場合)焦点距離を固定している限りは繰返し使用することができます.
並進-回転の同次変換行列である
は,外部パラメータ行列と呼ばれます.
これは,静的環境に対するカメラの動き,または逆に,固定カメラの前の物体の剛体運動を表します.
つまり
は,点座標
をそれぞれのカメラの座標系に変換します.
上述の変換は,以下の式(で
の場合)と等価です.
というベクトルとして,渡されたり返されたりします.つまり,ベクトルが4つの要素をもつならば,
であることを意味します.
歪み係数はシーンのビューに依存しないので,カメラの内部パラメータに属します.
また,キャプチャされた画像の解像度に関わらず同じ値のままになります.
つまり,例えば,あるカメラが
の画像でキャリブレーションされた場合,同じカメラの
の画像に対してもまったく同じ歪み係数を用いることができます
(
,
,
,
は適切にスケーリングされなければいけませんが).
以降の関数は,このようなモデルを用いて,次のようなことを行います:
内部パラメータ,外部パラメータが与えられた場合に,3次元座標を画像平面上に投影します.
内部パラメータ,少数の3次元点,その投影点が与えられた場合に,外部パラメータを求めます.
既知のキャリブレーションパターンを写した複数のビュー(つまり,各ビューが,複数の3次元点と2次元点の対応として記述できます)から,カメラの内部パラメータ,外部パラメータを推定します.
ステレオカメラ「ヘッド」の相対位置と相対姿勢を推定し,カメラの光軸を平行にする
平行化
変換を求めます.
cv::calibrateCamera¶
Comments from the Wiki
double calibrateCamera(const vector<vector<Point3f> >& objectPoints, const vector<vector<Point2f> >& imagePoints, Size imageSize, Mat& cameraMatrix, Mat& distCoeffs, vector<Mat>& rvecs, vector<Mat>& tvecs, int flags=0)¶
キャリブレーションパターンを写した複数のビューから,カメラの内部・外部パラメータを求めます.
パラメタ:
objectPoints – キャリブレーション器具上の点群座標(座標系は器具固定)を表すベクトル,のベクトル.1つのベクトルが,器具の1つのビューを表します.同じキャリブレーション器具がそれぞれのビューに完全に写っている場合,(それぞれのビューの順序を入れ替えたとしても)その座標ベクトルはすべて同じにできます.点群は3次元ですが,器具に固定された座標系上にあるので,もしその器具が平面ならば,器具平面とXY 座標平面とを一致させて点群の Z-座標が0になるようにするのは適切なやり方と言えます.
imagePoints – キャリブレーション器具上の点を,そのビューへ投影した点のベクトル,のベクトル.1つのビューに対して1つのベクトルになります.この投影点は,対応する器具上の点と同じ順序でなければいけません.
imageSize – 画像サイズ.カメラの内部行列を初期化するためだけに利用されます.
cameraMatrix – 入出力用の,カメラの内部パラメータ行列    .    CV_CALIB_USE_INTRINSIC_GUESS  および/または  CV_CALIB_FIX_ASPECT_RATIO   が指定される場合,  fx, fy, cx, cy  のいくつか,あるいはすべてが初期化されていなければなりません.
distCoeffs – 歪み係数の出力ベクトル    .4,5,または8要素となります.
rvecs – 出力される  ベクトル   .各ビューにおいて推定された回転ベクトルを表します(  Rodrigues2  を参照してください).つまり,k番目の回転ベクトルとk番目の並進ベクトル(下の出力パラメータの説明を参照してください)によって,キャリブレーションパターンが,モデル座標空間(物体上の点が指定される空間)からワールド座標空間,つまり,k番目のビューにおけるキャリブレーションパターンの実際の位置に移動することになります(k=0.. M -1).
tvecs – 出力される  ベクトル   .各ビューにおいて推定された並進ベクトルを表します.
flags – 様々なフラグ.0,あるいは以下の値の組み合わせ:
カメラキャリブレーションと3次元再構成 &mdash; opencv 2.2 documentation
