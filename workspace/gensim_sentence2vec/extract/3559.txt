Amazon Web Services(AWS)のバイスプレジデント兼ディスティングイッシュド・エンジニア、ジェームズ・ハミルトン氏は、AWSが11月11〜14日に開催した「AWS re:Invent 2014」で、データセンターの構成、サーバーやスイッチの自社設計、SR-IOVなどについて語った。
[2014/11/21訂正]記事の初出時に、ハミルトン氏がAZ間の距離を「数キロメートル」と言ったと記述しましたが、数十キロメートルである可能性もあります。ハミルトン氏はAZ間が「multiple kilometers」であると表現しています。後出のハミルトン氏の議論では、例えばロサンゼルスとニューヨークの間の伝送遅延は74ミリ秒だが、これを1、2ミリ秒に抑えるためにAZ間は近くなくてはならないとしています。ロサンゼルス—ニューヨーク間は約4000キロメートルですので、この距離の伝送遅延が74ミリ秒なら、54キロメートルで1ミリ秒、108キロメートルで2ミリ秒という計算になります。このため、「近距離(multiple kilometers)」という表現に訂正します。ただし、ハミルトン氏はこの講演の中で、航空機が一度あるAZ(のデータセンター)に衝突し、バウンドしてさらにもう1つのAZ(のデータセンター)にぶつかる可能性がなくはないとも言っています。これからすれば、やはり数キロメートル以内と考えるのが自然かもしれません。
Amazon Web Services(AWS)のバイスプレジデント兼ディスティングイッシュド・エンジニアであり、インフラエンジニアリングを指揮するジェームズ・ハミルトン(James Hamilton)氏は、AWSが2014年11月11〜14日に開催した「AWS re:Invent 2014」で、同社のサービスインフラの規模や構成について講演した。AWSの日本人社員も、「ここまで話していいの?」と思ったという。その内容を要約して紹介する。
ハミルトン氏は、大学卒業後にオートメカニックとして働き、その後IBMおよびマイクロソフトでエンジニアとして活躍した経験を持つ異色のエンジニア。IBMでは、データベース「IBM DB2」の各種OSへの展開に関わった。マイクロソフトに移籍後は、SQL Server関連のさまざまな開発チームを率いるなどし、データセンターの将来を考えるアーキテクトとして活躍。その後AWSにバイスプレジデント兼ディスティングイッシュド・エンジニアとして入社し、以来同社のデータセンターおよびインフラの設計に関わっている。
ハミルトン氏がAWSと恋に落ちた理由
AWSのインフラは、「リージョン(Region)」、「Availability Zone(AZ:「エーズィー」)」、データセンターという階層的な構成になっている。1カ所または複数のデータセンターで1つのAZを構成し、複数のAZでリージョンを構成している。ハミルトン氏はAZという存在について、「他社と根本的に異なる機能」といい、「私が2000年にアマゾンと恋に落ちた理由はこれだ」と話した。
リージョンはそれぞれ全く異なる地域に存在するデータセンター群だ。11月20日現在、世界で11のリージョンがある(正式にサービスを提供開始していない北京リージョンを含む)。米国内には、例外的に4つのリージョンがあるが、それ以外は1国で2つ以上のリージョンがあるところはない。
「ほとんど全ての主要リージョン間は、プライベート接続している」(ハミルトン氏は、「全てのリージョン」とは言っていない)。理由は通信事業者間でピアリングに関する紛争が起こっていたり、キャパシティプランニングが下手な事業者がいたり、余計なバッファリングを行う事業者がいたりするからだという。通信事業者に依存せずに自社でネットワークを持っていた方が高速であり、遅延も低く、コストも低いとする。
全てのリージョンは少なくとも2つのAZを持っている(北京は例外的に1つ)。下図はUS Eastリージョンの例で、5つのAZがある。ネットワーク的には、冗長化された2つのトランジットセンターで外部と接続。AZは相互にメッシュ接続されている。AZ間のトラフィック量は、最大25Tbpsに達する。AZ間のネットワーク遅延は2ミリ秒以下、ほとんどの場合は1ミリ秒以下。つまり、AZ間の距離は「近距離(multiple kilometers)」だという。また、1つのAZは1つあるいは複数のデータセンター施設で構成されているが、複数の施設で構成されている場合でも、遅延は0.25ミリ秒以下。実質的には1つの施設のように使える。
「ここまで話していいの?」:AWSのデータセンターの中身を、設計総責任者が話した (1/2) - @IT
