ええと・・・きっと「結論を先に知りたい」と思われるでしょうが、今回のお話は「ちゃんと理屈を知っていないと、適切な設定が行えない」内容となるため、タイトル通り「カクつきをなくしてなめらか映像を見たい」とお考えの方は、じっくりご覧いただければと思います。読み終わる頃にはきっと「貴方の環境における正しいセッティング」が、適用できることでしょう。
すでにご存じの方はご覧いただく必要はありませんの・・・です? 物好きな方だけ(汗笑)、文末の補足部分でもお読みください(SLI AFR向けSmooth VsyncとAdaptive Vsyncについて)。
海外のWikipediaにはScreen tearingとしてしっかり記載されている本話題。国内版にはないのですよね・・・。でも、初めてパソコンゲームなどに触れる方にとっては「なぜ」となる疑問点なので、簡単に記しておきますね。
先日匿名さんから「僕のパソコンはなめらかに動かせるだけの性能があるハズだのに、(私の作成した)ここに置いてあるムービーのようにスムーズに映らない」とのコメントをいただきました。本当は、こんな話題ができるようなクライアントをPSO2の開発チームが作らなければ(できのいいものにすれば)、良かったわけですが・・・。
そもそも、前作PSUでさえ、この問題を回避できる唯一のオプション、初期から実装していましたしね。・・・そう、「Vsync」と呼ばれる機能です。
PSO2で遊ばれている方の中に、「映像が割となめらかに動いてはいるけど、一瞬だけ画面の上下の部分が途切れたり、波打ったり乱れたりして、あたかもちらついたような見栄えになる」ような現象に遭遇された方、いらっしゃいますか? きっといらっしゃるとは思うのですけどね。
この「映像が一瞬途切れて見える」ような現象のことをティアリング、と呼んでいます。英語では Tearing ・・・引き裂く、といった意味合いになります。実際、その現象に遭遇した一瞬を切り出した画像が、上記海外のWikipediaの中にありますので、興味のある方は確認されるといいでしょう。
難しい部分ですが、このティアリングが起きる理由は「テレビ/モニタの画面の表示(=書き換え)速度」と、「PSO2クライアントで処理・表示する速度」とで『一致しない』ことが大きな原因となります。匿名さんが私のムービーでチラツキがない、と話されていますけど、これは言い換えれば「動画再生のソフト」が「モニタの書き換え速度」と『一致する』から、なめらかに見えるのですよね。
(もちろん、そのような違和感を与えないために、ぱそ子さんの性能であったり、キャプチャー時の工夫ですとか、いろいろすべきところはありますけどね)
いうなれば、そう。ちらつき=ティアリングを発生させないためには『モニタの表示速度』と『PSO2の表示速度』を「等しくする」ことができれば、原理的には発生しないことになります。このことを「同期をとる」と呼んでいます。
では、同期をとるためにはどうしたらいいのか・・・となりますけど、ここで使われる概念が「Vsync」という言葉。略語となっていて、正式名称は「Vertical synchronization」。日本語に訳すると「垂直同期」。
そして、ぱそ子さんとモニターとがお互いにやりとりする信号ということで「垂直同期信号」なんていわれることもあります。いずれにせよ、この信号でお互いに綺麗に表示し合えるようになるということです。
ティアリングが起きてしまう理由は、ぱそ子さんなりがモニター側で「ちゃんと1コマ1コマ表示し切れているかを確認しないまま」、「次の信号を送ります」と、スピーディーに流し続けようとするため、モニター側では表示されないまま次のを受け取り・・・それが積み重なるといったイメージです。
ゆえ、モニターの表示スピードよりもぱそ子さんが速いときに起きやすい現象です。よくモニター側の表示速度=リフレッシュレート(単位はHz(ヘルツ))と呼んでいますが、液晶モニタやテレビなど、普通は「60Hz」を基準にしています。これがよく言われるぬるぬる映像=60フレーム/秒といわれるものです。1秒間に最大60コマ、表示できますよということです。
フレームレートに関する話題はこちらでも確認してみてください。参考になるはずです。
その様子は・・・携帯電話やスマートフォンをお持ちの方なら、そのカメラ機能を用いて。モニターやテレビに向かってカメラを向けると・・・その携帯電話やスマートフォンに映るテレビやモニターの画面は、上下に細かく点滅している様子が確認できるでしょう。これが「1秒間に何コマ表示しているか」の実態です。
で、PSO2クライアントの難点は「Vsyncの仕組みを実装していない」ため、「ソフト側で意図的にフレームレートを制限してしまおう」という、「FPS制限」なる仕組みを用意しました。元々、これさえ用意しておらず、「常にフルパワーで動かす仕様」だったわけですから、どれだけ・・・となるわけです。エルダーさんの言う「無能浅薄脆弱ぶり、弁えよ!」状態でしょうか(汗笑)。PSUでさえ、ちゃんと持っている項目だったのですけどね・・・。
ここで注意しておきたいのは「モニターは60Hz=1秒間60コマ」が基本で、「PSO2クライアント側でも60fpsにセット」すれば、値は一緒でなめらかになる・・・と思いますよね。でも、それは正しい設定とはいえないのです。
先ほど記した「同期」をとっていないため、「微細なわずかなフレームレートの違いが積み重なる」ことで、ティアリングが発生してしまうのです。なぜなら、そう。モニターによっては60Hzきっちりではなく、微妙に下がった58Hzや59Hzの時もあるからです。ゆえ、きちんと垂直同期の周波数に、一致させる必要があるわけですね。
これが、匿名さんが疑問に思っている「性能は足りているのに、カクついてコマ落ちしたかのようなイメージになってしまう」原因です。ゆえ、厳しい物言いとなりますが「クライアントにまだまだ欠陥といえるような実装しかできていないため、なめらかに動かすことはほぼ不可能」といってしまいます。
もしもこの現象を「極力」減らしたい場合は、FPS制限を「無制限」にするのが正解です。こうすることでグラフィックスカードは常時最大性能で描画しますので、「処理がうまいこといけばティアリングが一番発生しにくい」状態になります。もちろん、FPSを高めることも有効で、90や120を選ぶ意味もありましょう。
ですが、そうしてしまうとそれだけ「パワーを無駄に消費する」状態となるため、静かに、涼しくぱそ子さんを運用したいという方にはおすすめできません。そこで考えなくてはならないのが「VsyncをどうやったらOnにできるのだろう?」。
それに対する答えが・・・そう。アンチエイリアシングでもお世話になっている「NVIDIA Inspector」なのです。あるいは・・・そうですね。今回の件だけならそのソフトを使わなくても、純正ドライバーの「NVIDIA コントロールパネル」内からも設定可能です。ただ、後者は言い換えればNVIDIA Inspectorの中の設定値にもちゃんとありますので、今回はこのツールで必要事項を押さえていただきたいかなと考えています。
・・・といった感じで、では、ここから実際の作業例を記しますね。ここまでご一読いただければ「Vsyncを有効にする方法」を解説するだけで、いい、ということになりますよね。実はこの設定、以前から提供しているアンチエイリアシング用のプロファイル中に「すでに設定済み」だったりします。
ゆえ、フルスクリーンで遊んでいる人はきっとそれを適用するだけで「綺麗になるだけでなく、ティアリングさえも防ぐことができ、かつグラフィックスカードに負担をかけずにすむため(上限がモニターのリフレッシュレート(基本は60Hz=コマ/秒)に制限されるため)、いいことづくめのプロファイル」と感じていただけているものとは思っています。中にはウィンドウモードでないとイヤダ、という方もいらっしゃるでしょうけど・・・。
私はパソコンでゲームって元々考えていない人だったものですから、その名残みたいなもので「ゲームはゲームに専念したい、没頭したい」と思うので、フルスクリーンモードはある意味必然なのですよね。ウィンドウモードに比べて別のウィンドウを描画・管理しなくていい分、パソコンに対する負担も下がりますしね。パソコンの性能が非力な人ほど、フルスクリーンモードは必携といえるでしょう。
(そのため、仮想フルスクリーンモードなんてばかげたものを入れた理由は、一体何のため・・・と思ってしまうのでした。きっと、ゲームしながらなになに、のためなのでしょうけどね>それならAlt+Tabキーでウィンドウを切り替えられますし)
では、アンチエイリアシングは適用しなくていいから、Vsyncだけ設定したい、という方のために。こちらもすでに用意しているファイルがありまして・・・そう、FPS制限のお題で配布しているpso2cc.zip(.nip)ファイルだったりします。
あの当時からご覧いただいている方は周知のことかもしれませんけど、今回は改めて仕組みを取り上げるということで、詳し目に記しておきました。読み終えた後、上記リンクへ移動して、後はその文章通りに設定してみてください。問題が解消されるはずです。
このファイルはNVIDIAドライバーに対して「フルスクリーンモード時はVsyncを有効に、ウィンドウモード時はNVIDIAドライバー側で60fpsにセット」しますよというものです。お話ししましたように、PSO2クライアントには残念ながらVsyncは実装されていません。そして、NVIDIAドライバー側でVsyncを強制On(Force On)のパラメーターを与えたとしても、ウィンドウモード時には何故か無効・・・。
このあたりが、アンチエイリアシングでもたびたび記している「トリッキーな実装」=まともな設計になっていないのでは、と勘ぐってしまう部分です。なぜ前作PSUでは問題ない部分でしたのに(フルスクリーン/ウィンドウモード問わずちゃんと同期がとれていたのです)、PSO2になって変なことになってしまったのか・・・。当時の技術者さん、もうおられないのでしょうか。
ゆえ、一般的な液晶モニターのお方でしたら60fpsで問題はないでしょうけど、もしもハイ・リフレッシュレートモニター(120Hz/144Hz)をお持ちの方は、ご自身でFPS制限の値を上位のものに打ち替えてしまうといいでしょう。そうすることでより高いリフレッシュレートで安定して動かせますので、動体視力のいい方なら違いがわかることでしょう。
よくいわれる「倍速液晶」ですとか「4倍速液晶」や、今の「120Hz対応モニター」って、とても誤解を招きやすいのですよね。気をつけていただきたいのは「x倍速液晶」はあくまで、「内部で擬似的にコマを複製・生成し、なめらかにつなぐことで自然な動きを目指す」方式なだけであって、「元々何倍速分のデータをきちんと用意して処理している」わけではありませんのでご注意ください。
言い換えれば、補完データの生成は各テレビメーカーによって癖があり、その補完の仕方でミスなどが続くと本来ない微細な振動などを知覚できる場合があり、必ずしも万全ではありません。SONYさんが一歩上手とはいわれますけど、あくまで「補完技術」ですので、「元々持っていないデータを創り出している=擬似的な動作にとどまる」点は押さえておきましょう。
上記に対し「xHz対応モニター」は文字通り、「1秒間にxコマ描画しきります」という性質のもののため、「偽りのないなめらかさ」はもちろんこちらとなります。パソコンの特徴としてグラフィックスカードの性能が許せばFPSは4桁でも目指すことは可能ですから、動体視力のいい人ほどハイリフレッシュレートモニターをご覧になると、なめらかな映像を体感できるはずです。混同しやすいところですので、ここで整理しておくといいでしょう。
(なお、将来的にはSHV・・・スーパーハイビジョンなる規格が実現すれば、8K UHDとも呼ばれる途方もないスペックがあなたを包み込むことでしょう。7680x4320/120fps、画素数3300万オーバーというすさまじさです)
そのため、マニアックなゲーマーさんはこぞって「120Hz/144Hz対応モニター」を指名買いするわけなのでした。もちろん、ぱそ子さんの基本性能も高度に要求されますので、出費が大変なことになりやすいですけどね。いわば平均フレームレートが60fpsではなく、120fpsがターゲットになるわけですから・・・。性能を2倍要求されるのは想像以上に大変なものなのです。
(ハイリフレッシュレートモニターをお持ちで、処理落ちは避けたいですからね・・・)
・・・といった感じで、Vsyncとティアリングの関係をざっくばらんにではありますが、記しておきました。よく検索語句で「pso2 FPS制限 おすすめ」なんてありますけど、このことが物語っているのですよね。「開発さん、しっかり作ってください!」と。Vsyncを実装すれば終わることですのに、なぜそれができないのか。αテスト時からずっと警鐘は鳴らしてきたのですが・・・。
まとめとして「なめらかにみせるためにはモニター側に処理を合わせる=VsyncをOnにする」ことが必要で、「PSO2クライアントにはその機能がない」ため、
「PSO2クライアント側のランチャーにあるFPS制限は『無制限』とし」、「NVIDIA Inspector側にてVsyncをForce On(強制有効化)」することで、「フルスクリーンモード時」限定で、最大限なめらかにできますよ、と。
原理的にはクライアント側での制限でもなめらかにできるはずなのですけど・・・匿名さんのように「環境によっては、だめ」となることから(この時点でおかしいわけですが(汗笑))、ドライバー側の制御ということで、私はNVIDIA Inspector側での適用を、強くおすすめするのでした。こちらならほぼ、間違いないですしね。
また、ウィンドウモード時はNVIDIA Inspector側のFPS制限であれば同様になめらかにできますので、そちらでお好みのフレームレートに制限をかけてしまうのがおすすめです。もしも60fpsでうまく同期がとれたように感じられない場合、59fpsや58fpsを選択することで、改善できるかもしれません。いくつか試してみましょう。
同ページにあるコメントで、みんとさんの書き込みが大変参考になるヒントだと思いますので、じっくりご参照いただければと思います。この方の場合は「ブラウン管ディスプレイ」のため、75Hzで視聴中。ゆえ、「FPS制限を75とする」ことで、きわめてなめらかになったとのことでした。PSO2クライアントにはこんな設定、ありませんからね(ニヤリ)。数値で何とかしようとするからこうなるわけです。
追記:パワーユーザー向けの情報として、313.95ドライバから用意された「垂直同期(スムーズ)」ですが、これはSLIユーザーの一部の環境においては、複数枚のカード間でうまく同期をとれないケースがある模様で、その事象に当てはまる人が選ぶと改善できるといった内容です。
英文では「often perceived as stutter」とあることから、意訳すると「しばしば認知する震え(微細な振動)」を抑制するための、バリエーションの一つとしているみたいです。なお、こちらをOnにした際は、Adaptive VsyncをStandardにしておくのがポイントになります。この組み合わせでしかSLI AFR構成でスムーズに描画されませんのでお気をつけくださいね。むろん、言うまでもなくフルスクリーン時のみ有効の設定ですので・・・。
私の環境では選ぶとかえって一部シーンでフレームレートが半分となる30fpsまで落ち込みますので、きっと2枚のカードを装着し、問題が起きている方向けのオプションなのでしょう。デュアルGPU搭載モデルの方はあまり選ぶ意味はなさそうです。その際はこちらの画像のように設定してみてください。なめらかになるといいのですけど。
・・・はあ。本当、セガさんがちゃんと作ってくだされば、こんなに長い文章を記すまでもないのですけど。読む方もきっと疲れてしまうと思うのです。外部ツールに頼らないとまともに動かせない現状というのは、いかがなものかなと感じてしまうのでした。
追記:インタラクティブムービー中にカクついたりするのは、単純にセガさんのプログラムミスでしょう。ここが直せないでどうするの・・・と思ってはしまいますけどね。PSUではほとんど見られなかっただけに、残念です(Vsyncがないからしょうがないのでしょう)。
七つの海: PSO2がなめらかに動かない・カクつく症状について FPS設定 ex.NVIDIA Inspector 1.9.7.1
