筆圧
ペイントソフトでは、ペンタブレットの筆圧を描画に適用できれば、よりアナログに近い線を描くことができます。
今回は、今までの自由線描画に筆圧を適用してみたいと思います。
ただし、ペンタブレットのない環境でもテストできるように、実際の筆圧を取得するのではなく、擬似的に生成した値を使うことにしています。
ここでは、ペンタブレットから筆圧を取得する方法は説明しません。
筆圧を適用するには
まず、自由線に筆圧を適用するには、どうすればよいでしょうか。
ペンタブレットから得られるのは、現在の座標と筆圧です。
送られてきたその位置と位置の間を線で描画し、さらにその線を描画するために、直線上に複数の点を描画しているのですから、描画する各点において、大きさや濃度をその位置の筆圧に合わせてやれば、筆圧を適用することになりそうです。
つまり、点の半径と濃度が筆圧によって変化するものとした場合、筆圧が最小の時は、半径や濃度を0に、筆圧が最大の時は、半径や濃度を最大値にすると良さそうです。
パラメータ
ここで一つ、筆圧に関するパラメータを付けてみたいと思います。
筆圧が最小の時に常に半径や濃度を0にするのでは、応用力がない状態となります。
筆圧を適用させたくない場合や、筆圧最小時でも半径や濃度がある程度欲しい場合などに対応できるように、「筆圧最小時の半径・濃度」をパラメータとして指定できるようにします。
ちなみに、筆圧が最大の場合には、描画する半径と濃度の最大値を使うことになります。
筆圧が最大の場合を基準にして考えると、筆圧が下がるほど、半径や濃度は、最大値を頂点として下がっていくことになります。
ということは、筆圧最小時にどこまで値を下げるか、というパラメータがあれば、筆圧による半径や濃度の下げ幅を変更することができます。
実際の実装では、このパラメータは、描画の最大半径と最大濃度に対する相対的な割合とし、0.0〜1.0 で指定するものとします。
そして、筆圧最小時には、最大半径・濃度にこの値を掛けた数値が、半径・濃度の最小値になるようにします。
つまり、パラメータが 0 なら、半径・濃度の最小値は 0、ということで、半径や濃度は、筆圧によって 0〜最大値 まで変化します。
パラメータが 1.0 の場合は、半径・濃度の最小値は最大値と同じ。つまり変化幅なしということで、半径や濃度は、筆圧の影響を全く受けなくなります。
スクリーンショット&ソースファイル
筆圧は、擬似的に一定間隔で変化します。
濃度の最小は 0.0 です。
1 キーで、半径の最小を 1.0、
2 キーで、半径の最小を 0.5、
3 キーで、半径の最小を 0.0 に変更できます。
>> 030_aaline6.c.txt
解説
筆圧値は、0.0〜1.0〜0.0... の値を繰り返すように、擬似的に生成されます。
線の描画に関するパラメータは、以下のようになっています。
double line_max_radius = 5,  /* 最大半径 */
line_max_opacity = 0.2,  /* 最大濃度 */
line_interval = 0.15,    /* 間隔 */
line_min_radius = 0,     /* 最小半径 */
line_min_opacity = 0,    /* 最小濃度 */
最大半径は px 単位、最大濃度は 0.0〜1.0、筆圧の最小半径・濃度は 0.0〜1.0。
アンチエイリアス付きの自由線描画(6)・筆圧
