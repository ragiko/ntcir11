
予測モデル開発の進め方
建築業の現場では、顧客の希望と予算を確認し、設計を行い、施工し、引き渡されます。
弊社が本業とするシステム開発も、このような工程を踏む仕事ということで、よく建築業に例えられることがあります。
その際、両者に共通することは、開発規模が大きくなればなるほど(犬小屋から超高層ビルへ)、後工程からの手戻りがないように工程をマネージメントできるかどうが、プロジェクト成功の成否を決定付けるということです。
予測モデルの開発においても、同じことが言えます。
目的・ゴールがあいまいな状態で、闇雲にデータを解析ソフトに投入して結果をみて試行錯誤するのは、木を見て森を見ない、局所最適は実現できても、全体最適に寄与しないというような危険が常に背中合わせであることを肝に銘じる必要があろうかと思います。
さて、予測モデルの開発工程を大きく4つに分けると
(1) 経営目標と課題認識に基づく分析テーマ確定
(2) 業務分析に基づくモデル化方針検討
(3) 可視化/集計/相関分析に基づくモデル詳細仕様決定 
(4) 予測モデル構築/評価に基づく業務への適用可能性検討 
となろうかと思います。
なにか難しい言葉を並べましたが、ようは経営ビジョン(森)に対して、木(業務)を最適化する、そのための予測モデル構築であるということを述べているに過ぎません。
また、建築やソフトウェア開発同様に、前工程での品質レベルが、後工程の品質を左右するという点が重要なポイントで、(4)に関係する、いくら高価な分析環境をそろえても、(1)〜(3)の準備が十分配慮されていなければ、プロジェクトは失敗するということです。
最近では、アジャイルBIというキーワードで、(1)〜(4)のプロセスを短いスパンでまわして、変化の激しい業務要件に適合するアプローチが提唱されているようですが、いずれにせよ、テクニカルな部分にとらわれて、木を見て森を見ずとならないよう、常に注意が必要です。
需要予測におけるカレンダー情報の活用
最近、特に需要予測システムの構築に関わるご相談が顕著となっており
おります。
この背景には、日本市場の高度成長期におけるメーカー主導型の作れば
売れる時代から、成熟期における顧客主導型へ移行したことを反映して、
ターゲット顧客の行動心理をベースとした予測システムへの需要があるかと
思います。
そこでは、需要予測モデルを構築するにあたって、単に過去の売上げデータ
からの外挿にとどまらず、その変動要因を、ターゲット顧客の行動心理に基づ
いた仮説-検証が本質的に重要となってきます。
カレンダー情報は、その中でも行動心理に影響を与える基本的な情報ですね。
例えば、大型家電の販売予測では、月(ボーナス、期末)・五十日(ごとおび)・
日祭日、旅行関連サービスの場合は休前日・連休日数 等々、
商品やサービス内容に依存した変動要素がパラメータとして考えられますね。
予測モデルを構築するにあたっての仮説設定には、実際の業務知識・経験を
モデルへ反映できるかどうかは、予測性能および検証の効率性からも重要
です。
予測誤差分析への自己組織化マップの活用
予測システムの構築にあたって、弊社ではまずその柱である予測モデルの
プロトタイプ構築とテストデータに対する統計的な性能評価を行います。
次に、そこで見出された予測値と実績値(答え)との誤差をどのように解釈し、
モデルに反映していくかを業務の観点で顧客と検討を行ないます。
その際、その誤差はテストデータ中に学習データに含まれないパターンが
ある為であるとして、機械的に学習データ+テストデータを新たな学習データ
として学習させる戦略は、問題の本質を隠し、かつ学習データ量および
計算時間の無制限の増大を引き起こし兼ねません。
そこで次善策として、誤差が大きいレコードに着目し、かつ外れ値とは見なせ
ないレコードのみを学習データとして追加する戦略を取る場合、
注意すべきは目的変数値は大きく異なるが、説明変数のセットに大きな違い
がないような場合で、この場合にはそれぞれのケースを識別する情報量が
足りないことが問題であり、新たな変数を見つけなければ問題は解決できません。
このような、学習データとテストデータのパターンの違いを把握するに当たって、
自己組織化マップ(SOM)の適用は効果的です。
SOMによって説明変数セットに対するパターンの可視化を行なうことで、
予測誤差が学習データのパターンの不足によるものか(学習データとテスト
データで明確なクラスターを構成)、あるいは説明変数の不足によるものか
(この場合は、同一ノード上の目的変数値のばらつきを見ます)を把握でき、
モデルの性能改善の指針となります。
ニューラルワークスPredictやProfessional II/PLUSでは、SOMの基本出力のみ
で出力結果のグラフィックス表現を持っていませんが、弊社ではこの点を補うべく、
ニューラルワークスが出力した結果をExcel散布図を使用して可視化するマクロ
を現在無償でご提供しています。
上記問題で課題をもたれている、あるいは関心を持たれた読者様はニューラル
ワークス技術サポート(ann@setsw.co.jp)まで、お問い合わせください。
PredictモデルをExcelマクロ関数から利用する
PredictあるいはNeuralSightが生成したモデル(ファイル拡張子npr)
を業務で使用するには、
(1) ExcelのPredictメニューからモデル読み込み、シート上の
入力データを参照して予測結果を出力する
(2) コマンドラインインターフェースによるバッチ処理用スクリプト
ファイルを作成し、予測用CSV入力データから予測値を算出する
(3) Flashコード機能により、モデルをC言語等で関数出力して、
アプリケーションから参照する
(4) Visual Basic,Java,C#アプリケーション用のインターフェースを使用して
Predictモデルを実行
の手段が多用されますが、更に簡便な手段をご紹介します。
ニューラルワークスPredictをインストールすると、自動的にExcel関数
の中のユーザー定義関数として、Predictモデルを実行する関数
PredictRunが追加されています。
(Excelメニューの「挿入」-->「関数」で、関数の分類=ユーザー定義
で現れるリストから、上記関数名を探すことができます。)
具体的には、Excelシートのセル中に以下の関数呼び出しを記述します:
=PredictRun([モデルファイル名],[予測用入力(1レコード)セル範囲])
ExcelのPredictメニューからの操作やプログラミング作業無しで
実行できる点や、セル上の数値の変更に対して、即座に予測結果が
得られる為、Excelを使用した業務やシミュレーション分析に大変便利
な仕組みです。
是非ご活用ください。
教師データに偏りがある場合の取り扱い
実社会で関心がもたれているデータは、通常偏りがあるのが普通です。
リスク管理の例でいえば、システム異常診断や不正アクセス監視などでは、
得られるデータのほとんどが正常データであり、関心のある異常データは
ほとんど取れません(あるいは運用開始後全く存在しない)。
上記システムのデータから判定モデルを作成する際、このようなアンバランス
なデータに対して、標準的な学習方法では、メジャークラスの判別性能に
偏ったモデルが生成されやすくなります。
この問題は機械学習の世界では、不均衡データにおける学習問題
(Learning from Imbalanced Data Sets)として、近年精力的に研究が行な
われています。 
問題点を理解する分かりやすい例として、クラスAとクラスBに属するデータ
の割合がそれぞれ99%および1%としましょう。
この場合、単純にすべてクラスAと答えるモデルであっても、正答率
(正解数/サンプル数)からみれば正答率99%の優れたモデルに見えてしま
います。
この問題の背景には、クラスAとクラスBの分布には偏りがないという前提が
崩れていることが問題な訳です。
この問題の対策としてよく知られているものには、サンプリングの方法があり
、問題に応じてその有効性が示されています:
アンダーサンプリング:メジャーなクラスからサンプリングして、マイナー
クラスのレコード数と同レベルに保つ。
オーバーサンプリング:マイナークラスのデータを、メジャークラスと同レベル
まで人工的に増やす。
前者では、自己組織化マップなどのクラスタリング手法により、類似パターンの
レコード群から、代表レコードを抽出するなども、有効と考えられます。
ニューラルネットワークによるビッグデータ解析ソリューション
