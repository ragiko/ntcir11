先日、筆者の在籍する会社で、受注する案件にOracle RACが必要になりそうとのことで、一時騒然となる光景を目の当たりにしました。要するにOracle RACを構築できる人間が社内にいないという現実を突きつけられて、彼らはびびっていたわけです。
Oracle RAC自体は、10g以降比較的簡単に構築できるようになっていて、オラクルが推奨するとおりにハードウェアが揃えば、大きな問題は発生しません。とはいえ、いくつか注意すべきポイントがあります。
1つ目のポイントは「共有ディスクの可用性を最大限にする」ことです。
RACの生命線は共有ディスクです。特にノードと共有ディスクのネットワークアクセスは絶対に譲ってはいけません。FibreChannelが使えればベストですが、iSCSIでも代替は可能です。iSCSIを使う場合には、ノードは通常と別のNICでLANに接続します。間違っても通常のNICで兼用しようとはしないでください。場合によってはOSが起動直後からハングアップするような事態に陥ります。
RAC自体はNASでも構築できるようにはなっています(一部対応しないプラットフォームもあります)。ただし、NASの応答性能が良くないとノードの足を引っ張ってしまい、うまく構築できません。特に個人向けのNASの組み込みLinuxと64bitのSolarisはTCP/IPスタックの性能が格段に違うので非常に相性の悪い組み合わせです。
ネットワーク周りで構築の妨げになる要因が多い一方で、共有ディスクの信頼性については、単に構築すること(=Clusterwareをインストールすること)を目的とするならば無視しても問題ありません。
2つ目のポイントは「SSH鍵交換でミスをしない」ことです。
RACはノード認識等のノード間通信にSSHまたはRSHを使います。RSHは最近あまり使われないようで、現実的な選択肢としてはSSHとなりますが、Clusterwareのインストーラは毎回SSHパスフレーズを聞いてくるようなことはしません。代わりにノード間でSSHの鍵交換(具体的にはssy-keygenコマンドを使う)を行い、共通鍵認証をするようにします。
この鍵交換がしっかりできていないと、インストール時に他のノードが認識されないような事態が発生します。Clusterware自体は単一ノードでもインストールできますが、インストール後に他のノードを認識できなければRACは構築できません。
3つ目のポイントは「時刻同期をNTPのSlewモードで行う」ことです。
実は時刻同期については、Clusterwareインストール時には問題になりません。ただし、ノード間で時刻の同期が取れていないと、データベースのSCNがずれて更新不整合が発生したりします。ノードがダウンしていたり、インターコネクト障害が発生したりしてもRACは検出しますが(完璧じゃないという噂もありますけど...)、ノード間のSCNずれによる更新不整合はいざ発生するとなかなか見つかりません。
時刻同期にはOSのNTPクライアントを使いますが、動作モードをデフォルトのStepではなく、Slewモードに変更する必要があります。Stepモードでは同期間隔がある程度開くため、次の同期が行われるまでの間、ノード間で時刻にわずかなばらつきが生じる可能性があります(マシンの時計は思ったより誤差が大きく出ます)。そこでSlewモードに変更し、少しずつ時刻同期を行うようにします。
最後に、RACはバージョンを重ねるごとに敷居が低くなっていて、未経験者であっても推奨ハードウェアを用意してインストールマニュアル通りに作業を進めれば、構築そのものは難しくありません。筆者も変則的な機器構成ながら一度はRACの構築に成功しています。RAC構築の最大の難関は、RACに対する恐怖心なのかもしれません。
Oracle RAC構築のポイント - Programming Studio
