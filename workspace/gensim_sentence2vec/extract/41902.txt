
データを保存する形式を考える                           
データを保存する場合は、ソフトの対象作業によって決めることになります。
1.固定長か可変長かを見極めるには
固定長の利点 アクセスポイントを計算でき、ピックアップすることができる。
欠点 メモリーを大きく取らざるを得ない。メモリー効率が悪い。
可変長の利点 必要なサイズの領域しか使わないため、メモリー効率が良い。
を考えなければなりません。固定長のファイルを一般にランダムファイルと呼びます。
ディスクアクセスの仕方がランダム(一本釣り式)に行うからです。
固定長でも
1.固定長で最初から全体のサイズが変わらないタイプ
2.全体のサイズは固定せず、1データのサイズは固定長で、追加して行くタイプがあります。
可変長
画像データ処理や、ワープロソフトなど、データはサイズが大きく変動することが多いようです。
こうしたソフトでは、修正を加える場合は一旦全データをメモリー上に読み込む処理を行います。
修正作業後に改めて全データを書き込みます。可変長のファイルを一般にシーケンシャルファイルと呼びます。
ディスクアクセスの仕方がシーケンシャル(順番通り)に行うからです。
2.読み込み作業のスピード
全体を読み込む場合は、頭からシーケンシャルに一気に読み込む方がランダムより、かなり高速処理できます。
ピックアップして特定のデータだけを読み込む場合は、ランダムの方が極めて高速に処理できます。
3.検索作業
検索を行う場合に、直接ディスクを検索して行くケースと、一旦メモリー上に展開して検索するケースがあります。
メモリー上に展開する場合は、搭載メモリーとの相談になるでしょう。データ量が少ないソフトでは、こうした配慮を
する必要がありませんが、巨大データを処理する場合は考えて置かなくてはならないでしょう。
検索作業が1回ではなく複数回を行うことを想定する場合は、メモリー上に展開することになります。
検索は全データを展開することは必要ではなく、キーワード関連データのみに限定することで処理スピードが
高速化できます。覚えておくと良いでしょう。目次検索とでも言いましょうか。
メモリー上に展開したデータは固定長になります。
4.業種別ソフト
画像ソフトやワープロソフトなど可変長が有利です。データを修正した後で全データを書き込みます。
元ファイルを一旦削除した上で再度書き込むことになります。
データ検索をする場合は、別に検索用ファイルを固定長で作成されるかも知れません。或いは可変長のまま
で良いのかも知れません。要は一番効率的かどうかの判断によると思います。
会計ソフトでは、固定長が有利でしょう。後で検索する必要が出て来るからです。
但し、データベースを利用しているソフトでは、アプリケーション側では直接ディスクの読み書きを行っていないのが普通です。
実際に固定長なのか可変長なのかは分りません。
分っているのは、読み書きする前にデータベースの内容をメモリー上に展開していることだけです。
まあ、ディスクアクセスを直接行わないためにそれだけ楽なことは楽ですが、細かいコントロールはできません。
POSレジスタでは、固定長が基本です。検索作業でデータをメモリーに展開する場合は、シーケンシャルアクセスですが
個別データの書き換えはランダムアクセスで行います。固定長だからランダムアクセスと言う固定観念を持つべきではありません。
POSレジスタでは高速でアクセスできることが基本です。但し、データベースを利用している場合はアプリ側ではコントロールできない
ことは同様です。
5.データフォーマット
フォーマットは基本的には、アプリ側が使うだけなのでどんなフォーマットでも構いません。
但し、ファイルが目で見て読めることが条件になります。これは正しく書き込めたかどうかを容易に確認できるためです。
この条件から言えばテキストファイルが適していることになります。さらに、データ区分はコンマ区切が見易いと思います。
つまりCSV形式と言われるタイプです。固定長にしろ、可変長にしろ、同様の形式で書き込めば後々利用できるメリットが大きいからです。
古くはマルチプラン最近ではエクセル等はこうしたコンマ区切りを行っています。こうした作りを最初からして置けば
エクセルなどで読み込む場合に殆ど修正せずに、そのまま使えることになります。
6.備考
テキストファイルの場合、行末は0x0D、0x0Aで終わります。
テキストファイル形式で書くには、普通に考えるとテキストモードでオープンすることになりますが、私はバイナリーモードでオープンしています。
コンパイラーを信用しなかった訳ではありませんが、今後を考えてバイナリモードでオープンしています。統一しているんです。
じゃあどうしているかと言うと、行末は0x0D、0x0Aをアプリ側で処理しています。書き込むときは付加し、読み込む時は削除する処置を施しています。
そのまま表示する場合もあるかと考えたのですが、ウインドウアプリケーションでは今の所使い道があまりなさそうで。
但し、メモ帳などでファイルを見る場合は大変便利です。行末で1段スライドしてくれますから、見易いです。
データを保存する形式を考える
