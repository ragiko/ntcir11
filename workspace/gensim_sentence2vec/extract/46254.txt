相関と回帰
PDFファイル
回帰(1)JMP
回帰(2)JMP
回帰(3)JMP
今回は相関と回帰について学習していきます。
相関は皆さんも今まで学んだ事のある、正や負の相関等について学びSTARで分析します。
また回帰とは、相関が手元に実際にあるデータを分析するのに対して、
手元にあるデータから測定していないデータを予測する事を言います。
1.相関:2つの変数間の関係の強さを記述する
(1)相関係数
相関は、2つの変数の共変関係を記述する統計的な指標です。
相関は通常、相関係数(r)で示されます。
rは最大値が1、最小値がー1です(rの値は、正の相関の時は+、負の相関の時はーの値)。
rの絶対値が0.7以上を高い相関、0.4〜0.6を中程度の相関、0.3以下を弱い相関と呼びます。
では下のFlashで正と負の相関について、また相関関係の強弱(rの値の変化)についてイメージしてみましょう。
(練習1)実際のデータをエクセルとSTARを使って分析する
下の表11.3にはデータセットAとセットBの2つのデータがあり、更に下の図11.6の左がセットAの、
右がセットBの散布図を示しています。
まず、セットAのデータをエクセルに入力し散布図を作ります。次にSTARを使って相関係数rを求めます。
そして同じ作業をセットBについても行い、2つのデータのrの値を比較します。
この作業の詳しい説明は図11.6の下にあります。ではやってみましょう。
引用元:「統計の基礎」 ジョンソン・リーバート サイエンス社
まずセットAについてやってみましょう。
エクセルを開き、X、Yの値だけ(20個)を表11.3の様に入力します。
次に入力したデータを全て選択した状態から、「挿入」「グラフ」と進んで散布図を作ります。
次にSTARを開きます。
まずページの左側にある「サンプルデータ出力」を選びます。このデータは同じ被験者の1要因のデータですから
「sA」タイプを選び、「作成!」をクリックします。
次に数字を入力する時は半角にする事を忘れないで下さい。被験者数には10、要因名にはセットA、要因の水準数
には2と入力して下さい。
すると*の20個あるデータが作成されますから、*を全て消して、先程エクセルに入力した20個のデータを
コピーしてSTARの*のあった部分にペーストして下さい。
今度はSTARのデータを全てコピーして、ページの左側にある「相関係数計算」を選びます。
そしてデータをペーストして「計算!」をクリックすると、下の様な結果が出てきます。
== Means & SDs(samples') ==
A= セットA
N= 10
------------------------------------------------
A		Mean		S.D.		Min.		Max.
------------------------------------------------
1	   4.000	   2.828	   0.000	   8.000
2	   4.000	   2.000	   1.000	   7.000
------------------------------------------------
Correlation Matrix
A= セットA
df= 1 &8
------------------------------------------------
Var.       r       F   Test
------------------------------------------------
A1xA2	 0.989	392.00	**
------------------------------------------------
_/_/_/ Analyzed by JavaScript-STAR _/_/_/
この結果の下の方にあるrを見ると0.989と書いてあります。
つまりこのセットAの相関係数rは0.989で、高い相関であると分かります。
では同じ手順でセットBも分析してみましょう。下の様な結果が出てくるはずです。
== Means & SDs(samples') ==
A= セットB
N= 10
------------------------------------------------
A	 Mean	 S.D.	 Min.	 Max.
------------------------------------------------
1	 4.000	 2.828	 0.000	 8.000
2	 4.000	 2.236	 0.000	 8.000
------------------------------------------------
Correlation Matrix
A= B
df= 1 &8
------------------------------------------------
Var. r F Test
------------------------------------------------
A1xA2	 0.885	 29.04	**
------------------------------------------------
_/_/_/ Analyzed by JavaScript-STAR _/_/_/
結果を見ると、セットBの相関係数rは0.885で、こちらも高い相関であると分かります。
しかしセットAの相関係数の方が高いので、セットAの方がセットBよりも高い相関であると分かるのです。
ちなみに、rの値は下の様な方法で計算されているのですが、皆さんはSTARが使えるのでこの計算式を
覚える必要はありません。
引用元:「統計の基礎」 ジョンソン・リーバート サイエンス社
(2)正の相関、負の相関、無相関
相関関係には、正の相関、負の相関、無相関の3つの状態があります。
正の相関:片方の測定値が高いと、もう一方の測定値も高くなる(片方が低いと、他方も低くなる)関係
(図11.7のbとe)
負の相関:片方の測定値が高いと、もう一方の測定値は低くなる(片方が低いと、他方は高くなる)関係
(図11.7のaとd)
無相関:2つの変数が独立で、共変関係が見られない状態(図11.7のc)
引用元:「統計の基礎」 ジョンソン・リーバート サイエンス社
ここで図11.7のaとbを見て下さい。
正と負の相関という違いはありますが、どちらも相関係数rの絶対値は1になっています。
なぜデータの傾きが違うのに、rの絶対値は1になるのでしょうか。
これを理解する為に下のFlashを見て下さい。
また無相関については、図11.7のcの様にデータが丸く集まっている場合の他にも見られます。
無相関の説明を下のFlashで見てみましょう。
右の様にデータが1直線になって無相関になっている場合、これが少しでも傾けば相関係数は1になります。
(3)相関の有意性の検定(相関がゼロでないことを示す検定)
無相関の検定のtの式
引用元:「統計の基礎」 ジョンソン・リーバート サイエンス社  
相関の有意性の検定は、上の式で行う事が出来ます。無相関の検定は無意味ではないですが、データ数が
多ければ0.1でも無相関ではありません。相関係数が0.1で相関係数が(有意に)高いとは言えません。
(4)無相関の解釈
下の図11.8は曲線相関の例です。2次関数以上の関数が当てはまるような場合には、
データ変換してから相関係数を計算するべきです。
(例:人間の運動能力・・・年齢と共に上昇していき、ピークを迎え下降していく)
引用元:「統計の基礎」 ジョンソン・リーバート サイエンス社
では、下のFlashを見てみましょう。
この様に、散布図を見ないと相関が見つけられない事があります。
相関係数を計算する時は、必ず散布図を書く様にしましょう。
下の図11.9は母集団からのサンプリングの偏りによって、相関係数(関係)が異なることを示す例です。
サンプリングが偏る原因はいろいろ有り、ランダムサンプリングが保障されないと、この(b)のように
相関がゼロになったり、(c)のように非常に高い相関計算されますが、名義尺度のデータになってしまう
場合が有ります。
引用元:「統計の基礎」 ジョンソン・リーバート サイエンス社
上記の2つの例以外に、母集団の下位集団(例えば男女や年齢層)によって相関関係が異なる場合等も
相関係数が低くなることが予測されます。
いずれにしても、相関係数だけを求めるのではなく、それぞれの変数の基本統計量を検討したり
相関図を描くことで、より客観的な結果の記述と分析が可能になります。
(5)相関関係と因果関係
相関関係があることは、因果関係を必ずしも意味しません。
しかし因果関係があれば、相関は必ずあります。
2.回帰:これまでのデータから将来のデータを予測する(回帰分析)
実際には重回帰分析(説明変数が複数ある回帰分析)を用いることが多いのですが、この教材では
分かりやすい様に単回帰を扱います。
ここでは、単回帰の意味、直線のあてはめ、最小2乗法、予測(内挿と外挿)等の概念を学習します。
(1)不確実性が減少しないデータの例 説明変数(X)=論理学の成績 被説明変数(Y)=総合点
引用元:「統計の基礎」 ジョンソン・リーバート サイエンス社
図11.1のデータは、被験者6人の論理学の成績と総合点、更にその散布図を示しています。
全ての学生が論理学の授業を受講していて、その成績から総合点を予測しようというのが回帰分析です。
では実際にJMPを使って回帰分析をしてみましょう。
(例題1)JMPで回帰分析を行う
まずエクセルを開き、論理学の成績(X)と総合点(Y)(12個)を図11.1の様に入力します。
そしてそのファイルをデスクトップ等に保存します。
次にJMPを開きます。
まず「データテーブルを開く」をクリックし、先程保存したエクセルファイルを開きます。
すると「Sheet1.jmp」が出てきますから、列1を論理学、列2を総合点に変更します。
そして「分析」「モデルのあてはめ」と進みます。
次に左側にある「総合点」を「Y」の所にドラッグし、「論理学」を「追加」の所にドラッグします。
最後に「手法」が「標準最小2乗」、「強調点」が「効果てこ比」になっている事を確認したら、
「モデルの実行」をクリックすると下の様な結果が出てきます(下の結果は一部ですが、
このページの1番上にある「回帰(1)JMP」の様な結果が出ればOKです)。
結果を見ると、「回帰プロット」に回帰直線が描かれ、「パラメータ推定値」の「切片の推定値」に切片が、
「論理学の推定値」に傾きが示されています。つまりこの回帰直線は
Y=2+0×X
=2
と推定され、論理学の成績が分かっても総合点は予測出来ないという事になります。
言い換えれば、上のデータでは論理学の成績は総合点に対して説明力を持っていない
(影響を与えていない)という事になります。
また回帰直線は、後で説明する「最小2乗法」によって求められています。
下のFlashで最小2乗法をイメージしてみましょう。
(2)不確実性が減少する例
引用元:「統計の基礎」 ジョンソン・リーバート サイエンス社
次に図11.2のデータも、被験者6人の論理学の成績と総合点、更にその散布図を示しています。
では先程と同じ様に、実際にJMPを使って回帰分析をしてみましょう。
(例題2)JMPで回帰分析を行う
まずエクセルを開き、論理学の成績(X)と総合点(Y)(12個)を図11.2の様に入力します。
そしてそのファイルをデスクトップ等に保存します。
次にJMPを開きます。
まず「データテーブルを開く」をクリックし、先程保存したエクセルファイルを開きます。
すると「Sheet1.jmp」が出てきますから、列1を論理学、列2を総合点に変更します。
そして「分析」「モデルのあてはめ」と進みます。
次に左側にある「総合点」を「Y」の所にドラッグし、「論理学」を「追加」の所にドラッグします。
最後に「手法」が「標準最小2乗」、「強調点」が「効果てこ比」になっている事を確認したら、
「モデルの実行」をクリックすると下の様な結果が出てきます(下の結果は一部ですが、
このページの1番上にある「回帰(2)JMP」の様な結果が出ればOKです)。
結果を見ると、「回帰プロット」に回帰直線が描かれ、「パラメータ推定値」の「切片の推定値」に切片が、
「論理学の推定値」に傾きが示されています。つまりこの回帰直線は
Y=0+1×X
=X
と推定され、論理学の成績が分かれば総合点を予測出来るという事になります。
言い換えれば、上のデータでは論理学の成績は総合点に対して説明力を持っている
(影響を与えている)という事になります。
こちらも下のFlashで最小2乗法をイメージしてみましょう。
Y=a+bX  YはYの予測値
引用元:「統計の基礎」 ジョンソン・リーバート サイエンス社
(3)最小2乗法による回帰直線の推定
ここまで2つの例題で扱ってきたデータはきれいな形で散布していたので、回帰直線は簡単に描けそうな
感じがしました。
しかし実際のデータはもっとばらついているもので、その時にどうやって回帰直線を求めるかが問題に
なります。
ここで最小2乗法の考え方が出てきます。
数学的に回帰直線の傾きと切辺を求める為に用いられる最小2乗法とは、予測値(予測された直線上の
Yの値)と実測値との距離の合計が最小になるように予測式を定める方法です。
具体的には、回帰直線から各データへの距離(誤差)の2乗の和(平方和)が最小になるように直線を
決めるのです。
計算式は下に示したもので、表11.1は先程JMPで回帰分析をした(例題2)の計算過程を示したものです。
実際にエクセルを使って計算する事が出来ます。
引用元:「統計の基礎」 ジョンソン・リーバート サイエンス社
引用元:「統計の基礎」 ジョンソン・リーバート サイエンス社
最後にもう1つ例題をやってみましょう。
表11.2のデータは被験者12人の両親の結婚年数と被験者自身の結婚年数を、図11.5はその散布図と
回帰直線を示しています。
つまり被験者の両親の結婚年数から、被験者の結婚年数を予測しようという回帰分析です。
では先程と同じ様に、実際にJMPを使って回帰分析をしてみましょう。
(例題3)JMPで回帰分析を行う
まずエクセルを開き、両親の結婚年数(X)と被験者の結婚年数(Y)(24個)を表11.2の様に入力します。
そしてそのファイルをデスクトップ等に保存します。
次にJMPを開きます。
まず「データテーブルを開く」をクリックし、先程保存したエクセルファイルを開きます。
すると「Sheet1.jmp」が出てきますから、列1を両親、列2を被験者に変更します。
そして「分析」「モデルのあてはめ」と進みます。
次に左側にある「被験者」を「Y」の所にドラッグし、「両親」を「追加」の所にドラッグします。
最後に「手法」が「標準最小2乗」、「強調点」が「効果てこ比」になっている事を確認したら、
「モデルの実行」をクリックすると下の様な結果が出てきます(下の結果は一部ですが、
このページの1番上にある「回帰(3)JMP」の様な結果が出ればOKです)。 
結果を見ると、「回帰プロット」に回帰直線が描かれ、「パラメータ推定値」の「切片の推定値」に切片が、
「論理学の推定値」に傾きが示されています。つまりこの回帰直線は
Y=2.64+0.59×X
=2.64+0.59X
と推定され、両親の結婚年数が分かれば被験者の結婚年数を予測出来るという事になります。
言い換えれば、上のデータでは両親の結婚年数は被験者の結婚年数に対して説明力を持っている
(影響を与えている)という事になります。 
また、最小2乗法の最初の説明で見た様にこのデータの回帰直線も、エクセルを使って下の計算を
行って求める事が出来ます。
引用元:「統計の基礎」 ジョンソン・リーバート サイエンス社
(4)説明変数と被説明変数
回帰分析では、独立変数を説明変数、従属変数を被説明変数と呼びます(変数間に因果関係を仮定しなくても
予測そのものは可能だからです)。
通常は説明変数は独立変数であり、被説明変数は従属変数である(因果関係があると仮定されています)。
回帰分析で求めた式で、実際には測定されていないXに対するYを予測することが可能です。
予測する範囲が、実際に測定されたXの最大値と最小値の間にある場合には、その予測は内挿です。
最大値以上、あるいは最小値未満のXに対する予測は、外挿と呼ばれます。
通常、内挿は可能ですが、外挿には注意を要します(関数関係が変化する可能性があるので)。
12回目 相関と回帰
