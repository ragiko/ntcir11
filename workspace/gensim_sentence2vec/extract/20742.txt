VMware Horizon Viewの提案に必要な知識を身につけよう!パート1では、「VMware Horizon Viewの必要なコンポーネント」を紹介しました。 パート2は、「仮想デスクトップの展開方法① ー フル仮想マシン編」です。 
仮想デスクトップの展開は、次の2つを理解することが必要です。
仮想マシンの渡し方 -  VMware Horizon Viewでは「専用」と「流動」があります。
仮想マシンの作成方法 -  VMware Horizon Viewでは「フルクローン」と「リンククローン」があります。
「渡し方」は、物理PCの受け渡し方法にたとえると、ざっくりこんな感じです。他には、オフィスの「固定席」「フリーアドレス」の座席にもたとえられます。
専用の渡し方
たとえば、IT部門にPCを受け取りに行きます。受け取ったPCには使用者の名前が割り振られ、そのPCをユーザー固定で継続使用できます。まさに「専用」で使用できるのです!PCを受け取っていない人はIT部門に払い出しを受けます。受け取った後は、名前が割り振られ、そのPCを固定で使用できます。
流動の渡し方
こちらは、ユーザー固定でPCを使用できません。返却(仮想デスクトップで言えば、たとえばログオフ)すると、次に受け取りに行く時は、マスターイメージでインストールされた新しいPCを渡されます。そのため前回使用したPCのローカルディスクに保存したデータは消失します。毎回インストールしますから、システムディスクにごみが残りません。注意するのは、ユーザーデータの置き場所です。
作成方法も、イメージ図で説明します。
フルクローンによる作成
「フル仮想マシン」は、「マスターイメージ」をクローン(複製)して作成します。仮想デスクトップのディスクサイズが50GBで、ユーザー数が100人であれば、50GB&times;100人の5TBのディスク容量が最低でも必要となります。
リンククローンによる作成
リンククローンで作成された仮想デスクトップは、マスターイメージ(各仮想デスクトップで共有する部分)と差分ディスク(各仮想デスクトップの固有情報)で構成されます。差分ディスクを構成することで、ストレージの消費を抑えます。
フルクローンと同じ例で、マスターイメージのディスク30GB+差分ディスク20GB&times;100人の2TB強のサイズで収まります。「差分ディスク20GB」は最大使用量を想定したサイズです。各ユーザーの使用方法により使用量は異なります。
ユーザーの使用により、差分ディスクがどんどん拡張されることを防ぐために、ログオフ時などに差分ディスクをゼロにします。ゼロに更新されると困るインストールしたアプリケーションや作成したユーザーデータは仮想マシンから外部へ分離しなければならないのです。
View Administratorの操作上、渡し方(「専用」・「流動」)と作成方法(「フルクローン」・「リンククローン」)を組み合わせ、4パターンの展開方法を選択することができます。選択することはできますが、メリットや用途から、「専用-フルクローン」と「流動-リンククローン」の組み合わせが主に選択されます。
選別の検討項目として、次の3点がポイントです。
アプリケーション
ユーザーデータ
バックアップ
展開方法の1つである、「専用-フルクローン」で3つの検討項目を見ていきましょう。
アプリケーション
各ユーザーに仮想デスクトップが割り当てられるため、ユーザーがアプリケーションをインストールすることができます。
ユーザーデータ
ユーザープロファイル、ユーザーデータをローカルディスクに維持し続けることができます。
バックアップ
ユーザーに関するデータがローカルディスクにあるため、個々の仮想デスクトップのシステムディスクを丸ごとバックアップしてリストアするか、新規に仮想デスクトップを展開し、個々のユーザーデータを戻す必要があります。追加したアプリケーションも含めて復旧したい場合は、システムを丸ごとバックアップしてリストアします。
「専用-フルクローン」は、現在の物理を使用した環境とほぼ変わらない環境で使用することができます。「これではVDIにするメリットがない」「リンククローンを使ってこそVDIだ」という声も耳にしますが、「アプリケーション」「ユーザーデータ」「バックアップ」を前提に展開方法を検討しなければ意図したものとは違う結果を招いてしまいます。
「流動-リンククローン」は、ログオフ時などに差分ディスクをゼロにするため、アプリケーションの分離、ユーザーデータの外部保存ができる環境において、効果を発揮することができます。詳細は第3回で説明します。
またどちらかを選択しなければいけないのではなく、タスクワーカーかパワーユーザーか、ユーザーの使用に合わせた複数の展開方法を選択するのも1つです。たとえば経理部門の方には「流動-リンククローン」で展開した仮想デスクトップを、IT部門は「専用-フルクローン」で展開した仮想デスクトップをお渡しするイメージです。
x x x
閑話休題
最近、「専用-フルクローン」仮想デスクトップのバックアップ案件がありました。「物理でローカルディスクのバックアップを取っていますか?」とバックアップの提案をなさらないことがあるとうかがいましたが、実際にやってみると、仮想デスクトップは、物理サーバー上に存在しているため、思ったより容易でした。
vSphere側でリストア後、View Administrator側の仮想デスクトップとユーザーとの関係性が消えてしまったらと懸念しておりましたが、関係を維持したままリストア可能でした。ただ仮想デスクトップは数十台では納まりませんから、Jobの作成は大変です(笑)
ユーザーがインストールしたアプリケーションも復旧したい場合は、システムのバックアップは避けられません。その場合バックアップ対象が多いため、バックアップが時間内に収まるのか?という別の懸念点もありますね。なかなか悩ましいです。
台数が多い場合は、フルクローンであっても、ユーザーデータは外部のファイルサーバーに置くことが鉄則ですね!ユーザーデータが外部にあれば、バックアップからリストアしなくても、再度仮想デスクトップを展開することで、仮想デスクトップ環境を復旧できます。
当社では、物理PCのリプレイスの例ではありますが、リプレイス用に一時的に付与された共有フォルダを経由して、ユーザー自身がユーザープロファイルおよびユーザーデータを移行する方法を取っています。これも1つの手段かもしれません。
<<もどる VMware Horizon Viewの提案に必要な知識を身につけよう! part1 必要なコンポーネント編
>> 次回  流動-リンククローンの展開と運用
過去のVMwareブログ一覧 (まとめWikiサイト)
<データセンターの切り替え>Site Recovery Manager
【SRM概要前編】 ~仮想化基盤におけるサイト切り換えをシンプルに~
【SRM概要後編】 ~仮想化基盤におけるサイト切り換えをシンプルに~
EqualLogic + vCenter SRM連携が可能にする仮想化基盤のサイト切替
<仮想化基盤の健全性をチェック> vCenter Operations
第1回 導入後、仮想基盤の健全性をどのように維持していくか?
第2回 仮想化基盤全体を筋肉質な基盤に変えるために
第3回 普段から安定した仮想基盤を提供するために
最終回 vSphereの基本機能を改めて活用する
<新機能とDellサーバで信頼性向上> vSphere 5.5
【前編】 vSphere 5.5の新機能とDellサーバで信頼性向上へ
【後編】 vSphere 5.5の新機能とDellサーバで信頼性向上へ 
<EqualLogic と vSphere連携>
第1回 vSphereのPortbind
第2回 EqualLogicのMEM (Multipathing Extention Module)
第3回 VAAI (vStorage APIs for Array Integration)
第4回 EqualLogicのHIT/VE (名称変更: VSM for VMware)
第5回 Profile-Driven StorageとVASA(vStorage APIs for Storage Awareness)
VMware Horizon Viewの提案に必要な知識を身につけよう!パート2 - フルクローン展開編 - テックセンター - Blog - テックセンター - Dell コミュニティ
