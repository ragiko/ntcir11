概要
・集計関数を使用して集計を行うことができる。代表的な集計関数は合計値を求めるSUM, 平均値を求めるAVG, 個数を求めるCOUNT, 
最大値を求めるMAX, 最小値を求めるMIN。
・GROUP BY句を使用すると集計単位を指定することができる。
例:SELECT 目ID, AVG(体長) FROM T_動物マスタ GROUP BY 目ID
・集計関数はNULLを無視する。
・HAVINGを使用すると集計後のレコードに対してしぼりをかけることができる。
・DISTINCTは重複するレコードを省く効果がある。
1.SQLの本領
SQLはデータを集合としてとらえてさまざまな集計・分析を行うことができます。値と値の計算であればVBであれなんであれどのような言語でも可能なのですが、データをひとまとまりとして扱いそのまとまりに対して集計・分析を行うことができる言語は多分SQLの他にはありません。
これまではSQLを単にアプリケーションとデータベースをつなぐ言語と位置づけて使用例を紹介してきましたが、今回はSQLによる集計の一端を紹介してSQLの本領に触れていこうと思います。
今回説明するのは合計・平均・個数・最大値・最小値です。どれも集計・分析の中ではごく基本的なものですが、複雑な集計・分析であってもこのような基本を組み合わせているだけという場合が少なくありません。
できればただ説明を読むだけではなく、紹介しているSQL文を実際に実行したり、少し自分で改造して調べてみたりしながら読んでください。SQLを試すためには前回紹介したクエリデザイナを使用することができます。
メモ  -  Animals.mdbが新しくなりました
今回からは新しいバージョンのAnimals.mdbを使用します。2007年2月4日以前にAnimals.mdbをダウンロードされた方は、お手数ですが新しいバージョンのAnimals.mdbをダウンロードして上書きしてください。
ここからダウンロードを行うことができます。
データベースのダウンロード    
Animals.lzh    
26.9KB
2007年2月5日以降にAnimals.mdbをダウンロードされた方はこの作業を行う必要はありません。
ここでダウンロードできるものはデータベース講座の第2回でダウンロードできるものと同じです。
新しいバージョンのAnimals.mdbではT_動物マスタに「生息地ID」と「体長」という2つの項目が追加されました。また、T_生息地マスタというテーブルも追加されています。T_目マスタにはデータを追加しておきました。
T_動物マスタに登録されているいくつかの動物は名前を修正しました。たとえば、旧版では「ジンベイザメ」となっていたのを「ジンベエザメ」に修正しました。
2.GROUP BY句
2−1.集計単位と集計関数
合計や平均値に限った話ではありませんが、集計を行う場合は何を単位に集計を行うかを指定する必要があります。たとえば学校を想定すると、学年別の平均値を求めるのか、クラス別の平均値を求めるのか、他にも志望校別というのもあるかもしれませんし、志望校別で男女別というのもあるかもしれません。
SQLではこのような集計の単位をGROUP BY句で指定します。また、合計値を求めるにはSUM、平均値を求めるためにはAVGなど集計関数と呼ばれる関数を使用して集計方法を指示します。
代表的な集計関数を表にまとめます。
VB SQL SELECT文による集計 - GROUP BY, HAVING, SUM, AVG, COUNT
