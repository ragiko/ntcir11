 
神谷 雅紀 Escalation Engineer
前回 CXPACKET 待ちは悪いことか?で、クエリの実行について触れました。クエリがどのように実行されているのかを知るためには、実行プランを見る必要がありますが、実行プランの見方について解説している文書があまりないため、今回は、実行プランの基本的な見方について説明したいと思います。
実行プランとは
実行プランとは、SQL Server がクエリの結果を得るために、そのクエリをどのように処理するのかを表したものです。例えば、select c1, c2 from tabA where c3=1 というクエリの結果を得るために、tabA テーブルの非クラスタ化インデックス ind_tabA を検索して行を絞り込み、その絞り込んだ行をクラスタ化インデックスから読み取り、読み取った行の中から c1, c2 の 2 列の値を取り出す、といったような、クエリ結果を得るためのプロセスを表しています。
実行プランは、内部的には、tree 構造を持つメモリ上のオブジェクトです。SQL Server で表現される場合は、tree 構造の表現として一般的に使われる、上から下へ伸びていく形ではなく、下の図のように、左上にルートを置き、右側に伸びていく形で表現されます。
制御フローとデータフロー
この制御フローとデータフローという表現は、Microsoft 社内では聞いたことはありません。この言葉は、数年前にシアトルで開催されていた PASS Conference (PASS = SQL Server ユーザー会) のあるセッションで使われていた言葉ですが、分かりやすい表現だと思いますので、ここでもこの言葉を使いたいと思います。
実行プラン内の各オペレータ (上の例では、Nested Loops や Index Seek) は、3 つの主要なメソッドを持っています。それは、Open, Fetch (GetRow), Close です。各メソッドは以下の働きをします。(Fetch という言い方はカーソル風、GetRow という言い方は OLE DB 風でしょうか。どちらでも構いません。)
実行プランを読む - 基本編 (その 1) - Microsoft SQL Server Japan Support Team Blog - Site Home - MSDN Blogs
