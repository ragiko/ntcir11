
実行速度を速くしよう。
マクロを組むようになると、いろいろな処理が自動でできるようになり、作り上げた喜びもどんどん大きくなっていきます。
それはそれでいいのですが、処理に時間がかかるようだと、使っている時ストレスを感じます。
したがって、『いかに実行速度をあげるか?』を考えてマクロを組むことが重要です。
以下で、その例を紹介します。
1.画面表示の更新をOFFにする。
下のマクロは、どちらもA1に1を10000回足していきます。
そして、処理が終了したら、メッセージを表示するようにしています。
ところが、このマクロを実行させてみると、明らかに「B」のマクロの方が処理速度が速いのです。
それは、どうしてなのでしょうか?
Sub A()
Dim n As Integer
Cells(1, 1) = ""
For n = 1 To 10000
Cells(1, 1) = Cells(1, 1) + 1
Next n
MsgBox "終了!"
End Sub
Sub B()
Dim n As Integer
Cells(1, 1) = ""
Application.ScreenUpdating = False
For n = 1 To 10000
Cells(1, 1) = Cells(1, 1) + 1
Next n
Application.ScreenUpdating = True
MsgBox "終了!"
End Sub
AとBのマクロの違いは、
Applicationオブジェクトを使っているかどうかです。
ApplicationオブジェクトのScreenUpdatingで、
画面表示の更新をするかしないかを設定します。
(Falseは、しない。Trueは、する。)
更新をしないとどうなるか?
処理が済んでも、ワークシートの表示は変わりません。
実は、パソコンが処理をするとき、画面表示にずいぶんと時間がかかっているのです。
そこで、画面表示の更新を、最後に1回だけ行って時間の短縮をしているわけです。
実行速度を速くしよう。
