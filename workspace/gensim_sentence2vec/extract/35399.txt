
商品一括登録or更新に便利なCSVですが、EXCELで編集するとEXCELの仕様上アップロードしたファイルにエラーが出てしまうことがあります。
今回はitem.csvでエラーを起こる原因と、エラーを起こさない方法をお伝えしたいと思います。
Chapter 1. CSVとは
Comma Separated Values 略してCSVと呼ばれるデータ形式のことです。
値(Values)をカンマ(Comma)で区切った(Separated)ものですね。
メモ帳などのテキストエディタで開く事ができて、編集なども行えます。item.csv開くと下図のようになっています。
※例のため項目数は少なくしています。
ちなみに、このCSVをEXCELで開くと次のようになっています。
行(レコード)を改行で区切り、列(項目or値)を「,(カンマ)」で区切っている事がわかります。
Chapter 2. item.csvでエラーが起こる原因
上記のサンプルCSVをアップロードしてもエラーは起こりません。
では、エラーが起こる原因は何か?多くの場合3つの原因が考えられます。
原因1 値(Values)の中に改行が含まれている
行(レコード)の区切りが改行ですから、改行が行われているところがあるとエラーが起こります。
エラーメールが送られてきて「項目数が一致しません」的なエラーの場合がありますが、、この場合は値に改行データが入っていないかを確認します。
例えば上図の様なファイルが有った場合、EXCELでCSV保存したファイルでは次のようになっています。
商品説明文中の改行が項目(レコード)の区切りとして扱われてしまい、以降のデータがずれてしまうわけですね。
原因2 最終項目の列の値が空白になっている場合
項目の中にはデフォルト値が設定されているため空白でも楽天側のCSV処理プログラムが保管してくれる項目があります。
ヘッダー・フッターレフトナビやカテゴリCSVの「1ページ複数表示形式」など。
このように最終列が空白になっていると、値の区切り文字である「,(カンマ)」が抜けてしまう場合があります。(EXCELのバージョンや処理手順によっては大丈夫な場合もあります)
この場合も「項目数が一致しない」等のエラーが発生しアップロードが正常に完了しません。
原因3 説明文にカンマが入っている場合
文字列ではなく区切り文字として認識されてしまうケースです。
例えば下図のようにカラーをカンマで区切って表示したい場合、このようなことが起こったりします。
Chapter 3. 対処法
原因1の対処法
CLEAN関数を使います。
改行データを除いてくれる関数です。
あるいは検索置換で改行を除きます。
検索する文字列で改行を指定。「Ctrl+J」を押すことで改行を指定できます。
置換後の文字列を空欄に。これで改行を除くことが出来ます。
原因2の対処方法
コントロールカラム以外の項目に関しては順番が不問なので列の移動を行います。
原因3の対処方法
検索置換で「カンマ」を「、」に置換する。
句読点では無くてはならない訳ではないので、カンマ以外の文字に変換しましょう。
楽天item.csvでエラーが出る時の対処法 | 通販チップス
