【課題】フーリエ変換によるピークパワースペクトル検出において、測定対象とする時間範囲の分解能を高めつつ、周波数分解能を高める。【解決手段】時間変化する信号における所望の時間幅の範囲内でのピークパワー周波数を検出する方法は、信号を所望の時間幅内においてサンプリングしてデジタルデータ列とするサンプリング段階と、必要とされる周波数分解能を満たすために高速フーリエ変換において必要なサンプル数を基準サンプル数として、基準サンプル数に達するように、デジタルデータ列にゼロデータを付加する付加段階と、ゼロデータが付加されたデジタルデータ列に対して高速フーリエ変換を行うFFT段階と、を有する。高速フーリエ変換の結果において最大値を示す周波数をピークパワー周波数として検出する。
【発明の詳細な説明】【技術分野】【0001】  本発明は、時間に応じて変化する信号の中から所望の時間幅内の部分を切り出し、その切り出された部分における信号のピークパワースペクトルを検出する方法と装置とに関し、特に、検出の高速化を図りつつ、検出されるスペクトルの周波数精度を向上させた方法及び装置に関する。【背景技術】【0002】  所定の周波数帯域幅を有して時々刻々と変化する信号の中から所望の時間幅の部分のみを切り出し、その切り出された部分内での信号のピークパワースペクトルを検出することは、後述するように、例えばドップラー計測などで広く行われている。ここでいう所望の時間幅は、信号全体の継続時間に比べた場合には十分に短く、例えば、その開始時刻が与えられているかあるいは開始時刻を自動検出できるものである。また、検出されるピークパワースペクトルは、切り出された部分内での信号の周波数スペクトルの中で一番強いパワースペクトルを有するものである。パワースペクトルの検出には、一般的にフーリエ変換が用いられ、計算量の観点から、中でも、FFT(高速フーリエ変換:Fast Fourier Transform)が使用される。【0003】  ところで、ある信号を媒質中に発射(送信)し、その媒質中から反射した信号(エコー信号)を受信したとき、送信した時刻をスタート時刻とすると、スタート時刻から反射によるエコー信号を受信するまでの時間は、媒質中でのその信号の伝搬距離すなわち対象物までの距離に依存する。したがって、信号の伝搬速度(音波であれば音速)を考慮して、スタート時刻から所望の時間経過した時点で受信されるエコー信号は、その時間経過に応じた距離の位置にある対象物からのエコー信号となる。スタート時刻からの時間(すなわち距離)に応じてエコー信号の強度を映像として表示するようにした応用機器が、例えば、レーダーや魚群探知機である。【0004】  信号を反射する対象物が相対的に移動しているとすると、反射エコーでは、ドップラー効果により、送信した周波数からの周波数変位が観測される。この周波数差、すなわち媒質に対して送信したときの周波数と反射エコーで観測される周波数との差をドップラー周波数という。ドップラー計測では、一定の周波数の信号を媒質中に発射し、媒質中の対象物によって反射された信号(反射エコー)を受信し、その周波数解析を行って、ドップラー周波数を決定するものである。ドップラー計測を行うものとして、例えば、ドップラーレーダー、ドップラーソナー、ADCP(音波ドップラー流速プロファイラー;acoustic Doppler current profiler)、潮流計、音波レーダー、超音波ドップラー速度計などがあり、これらは、ドップラー周波数に基づいて、対象物との相対速度を決定する。【0005】  送信回路によって一定の送信周波数ftxの信号を生成して、この信号を送受波器から媒質に発射する。媒質中を対象物(反射体)が移動しているとして、ドップラー周波数fdopは、対象物の移動速度をV(m/s)、媒質中での信号の伝搬速度をC(m/s)とすると、媒質中の信号の伝搬速度が対象物の速度よりも十分に速い場合(C≫V)には、次の近似式で表される。【0006】【数1】【0007】  ここでθは、対象物から送受波器を見たときの方向と対象物の移動方向とがなす角度であり、同じ方向であれば(対象物が送受波器にむかってまっすぐ進んでいるときには)、θ=0となる。したがって、ドップラー周波数fdopは、対象物が近付いているときには正(+)となり、遠ざかるときには負(−)となる。【0008】  エコー信号の周波数解析を行ってドップラー周波数fdopを求めるが、この周波数解析には、一般的に、フーリエ変換の手法が使われている。フーリエ変換として、パワースペクトル解析を行う場合にはDFT(離散フーリエ変換;Discrete Fourier Transform)が用いられ、あるいは信号の標本数(サンプル数)が2のべき乗個であるときには、高速演算処理が可能なFFT(高速フーリエ変換:Fast Fourier Transform)が通常用いられている。DFTもFFTも複素乗算演算を反復するものであるが、サンプル数をNとすると、DFTでの複素乗算数回数はN×N回(すなわちN2回)であり、N=2nとすると、FFTでの複素乗算回数は、2n×log2 2n回(すなわちN×log2 N回)であり、Nが大きくなるほど、FFTはDFTに比べて高速演算ができる。【0009】  ところで、ドップラー計測では、対象物の位置と速度の両方に関する情報を取得したい場合が多い。例えば、海洋において深さごとの潮流の方向と速度とを求めて流速プロファイルを得るためには、海中に対して斜め方向に音波パルスを放射して反射エコーを取得し、周波数解析を行う。この際、音波パルスの放射から所定の時間の経過後にある時間幅で反射エコーを切り出し、切り出された部分に対して周波数解析を行うことになる。音波パルスの発射からの所定の時間によって、どの深度の流速を計測しようとするかが定まることになり、反射エコーを切り出す時の時間幅によって、どの程度の深度範囲(厚さ)にわたる平均として流速が算出されるかが定まることになる。例えば、切り出す時の時間幅が大きければ、海中における厚みの大きい層での平均的な流速が求められることになる。これに対し、時間幅が小さければ、薄い層での流速を求めることが可能になって、結果として、細かな流速プロファイルが得られることになる。【0010】  しかしながら、ドップラー周波数を求めるための周波数解析としてのフーリエ変換の問題点として、周波数分解能と時間(距離)分解能とが相反する関係にある、ということが挙げられる。ここでいう周波数分解能は、ドップラー周波数を求める際の分解能であり、これは速度の分解能に比例する。時間分解能とは、反射エコーを切り出す時にどこまで時間幅を小さくできるかということであり、これは、ドップラー計測における距離あるいは位置の分解能に比例する。時間分解能が粗ければ、上述した流速プロファイルの場合であれば、深度方向の厚みが大きな層でのおおざっぱな平均的な流速しか得られないことになる。【0011】  離散フーリエ変換(DFT)は、次の式で表される。【0012】【数2】【0013】  DFTまたはFFTでのサンプリング周波数をfft、フーリエ変換の基本波の周期をT0とすると、周期の逆数は、フーリエ変換での基本周波数f0と呼ばれ、    f0=1/T0                        :式1−4  と表される。この基本周波数f0は、DFTやFFTでの最小分解周波数すなわち周波数の分解能となる。サンプルされた信号点の総数すなわちサンプル数をNとすると、    T0=N/fft                        :式1−5  が当然に成立し、周波数分解能である最小分解周波数f0は、    f0=1/T0=fft/N                :式1−6  と表されることになる。逆に、所望の周波数分解能f0が与えられたとして、必要なサンプル数Nは、    N=fft/f0                        :式1−7  と表されることになる。フーリエ変換では、基本波の周期T0と等しい時間幅の信号から等間隔でN個のサンプルを取り出すから、T0が信号の切り出し時間(切り出しの時間幅)ということになる。【0014】  FFTで得られるパワースペクトルの例が図1に示されている。FFTのパワースペクトルは、サンプル数Nに対し、0から(N/2)−1までの一定の周波数間隔で周波数ごとの値14,15が与えられるスペクトルとして表される。ここで周波数間隔は上記のf0と一致し、f0=1/T0である。【0015】  式1−4に示すように、周波数分解能f0は、信号の切り出し時間幅T0の逆数であるから、周波数分解能を上げる(f0を低くする)ためには、信号の切り出し時間幅T0を長くしなければならない。その結果、周波数分解能を2倍細かくすると、時間分解能すなわち位置(距離)の分解能は2倍粗くなって劣化する。【0016】  対象物との相対的な速度によって、ドップラー周波数fdopは変化する。このドップラー周波数ffopが変化する範囲をΔfpとおくことにすると、近づく方向と遠ざかる方向での移動が同等に起こるものと仮定すれば(この過程は、潮流計などの用途において妥当な仮定である)、ドップラー信号の周波数範囲ΔfPの中心周波数fc、つまりドップラー周波数fdopがゼロのときの受信信号の周波数は、送信周波数ftxと一致する(fc=ftx)。【0017】  以下の条件に従い、超音波のパルス状の信号を海中に送信し、移動物からの反射エコーのドップラー周波数を測定する場合を考える。【0018】    海水中の音波伝搬速度C:C=1500(m/s)    送信周波数ftx:ftx=120kHz    検出最大速度(水平方向)V:V=15(m/s)  また、音波は水平方向から斜め方向(θ=60°)に送受信するものとする。式1−1により、【0019】【数3】【0020】となり、検出最大速度が15m/sであるとすれば、ドップラー信号として観測される周波数範囲Δfpは、120±1.2(kHz)となる。【0021】  測定速度範囲すなわち検出最大速度は、通常、予め決められているので、ドップラー信号についても、その周波数範囲が予め定められて測定する。【0022】  ドップラー計測による速度精度を0.1m/sとすると、それに必要な周波数分解能f0は12Hzとなる。ドップラー計測において検出対象とする位置の範囲(位置分解能)を7.5mとすると、信号の切り出し時間幅は、海水中で音波が1mを往復する時間である2/1500(m/s)を乗ずると、7.5×2/1500=0.01となって、10msとなる。【0023】  しかしながら、周波数分解能f0である12Hzを式1−4に代入すると、T0=1/f0=1/12≒83.3msとなり、83.3msは、海水中で音波が1mを往復する時間2/1500(m/s)で割ることにより距離に換算すると、83.3(ms)×1500(m/s)/2≒62.5(m)となる。【0024】  すなわち、速度精度を0.1m/sとするために周波数分解能f0を12Hzとすると、信号の切り出し時間幅として83msが必要であり、これは距離に換算すれば63mに相当し、位置(距離)に関する分解能を7.5mとする要求を満足することできない。逆に、位置に関する分解能が7.5mである信号でFFTを行うとすると、式1−4より周波数分解能f0が100Hzとなり、速度精度から定められた周波数分解能12Hzの要求を満足できない。【0025】  このようにフーリエ変換には、周波数分解能と、測定対象に関する時間分解能とが両立しない、という基本的な問題があり、これは、ドップラー計測の場合には、周波数分解能あるいは速度分解能と、距離あるいは位置の分解能とが両立しないことを意味する。【0026】  図2は、一般的なドップラー計測機器の構成の一例を示している。ここでは、信号が音響信号であり、信号が伝搬する媒質が水(あるいは海水)であるとする。音響信号の送受波器1は、送受信切替回路2を介し、送信回路3の出力と受信増幅器4の入力に接続している。送信回路3は、送信周波数ftxの信号を生成するものである。受信増幅器4の出力には、受信信号を中間周波数信号に周波数変換する変調器5が設けられており、変調器5には、局部発振回路6から局部発振周波数flocの信号が供給されている。変調器5の出力すなわち中間周波数信号は、アナログフィルタ7を介してアナログ/デジタル変換器(A/D)10に供給されてデジタル信号に変換され、このデジタル信号は、所定のサンプル数(すなわち時間幅)で信号を切り出す信号切り出しゲート11に供給される。信号切り出しゲート11で切り出された信号は、次にFFT処理部13に送られてFFTによる周波数解析の対象となる。FFT処理部13から、計算されたパワースペクトルが出力される。【0027】  このドップラー計測機器では、水中に音波パルスを発射する時には、送信周波数ftxの信号を送信回路3から送受信切替え回路2を介して送受波器1に供給する。その後、直ちに送受信切替え回路2を受信側とし、媒質(水中)からの反射エコーを送受波器1で受信して電気信号である受信信号に変換し、送受信切替え回路2を介して受信信号を受信増幅器4に供給する。その結果、受信信号は受信増幅器4において信号増幅され、変調器5に対して供給されることになる。【0028】  図3は、受信信号や中間周波数信号などの周波数間の関係を示している。受信増幅器4から出力される信号自体は、図3において符号52で示されるような周波数帯域を有するものとする。受信信号の帯域は、符号52で示す周波数帯域の一部であり、検出対象となるドップラー信号は、符号51で示される周波数範囲Δfpの中にある。周波数範囲Δfpの中心、すなわち、ドップラー周波数がゼロの時の周波数fc(47)は、送信周波数ftxと同じである(fc=ftx)。局部発振回路6は、周波数fcよりも中間周波数fmidだけ低い局部発振周波数floc(45)の局部発振信号を生成し(すなわちfc>floc)、変調器5に供給する。その結果、変調器5では、局部発振信号を受信信号に乗算することにより、受信信号を中間周波数fmidの中間周波数信号に変換する。【0029】  受信信号の周波数帯域のうち、トップラー計測のために着目する周波数範囲Δfpの上限を上限周波数fmax(49)とし、下限を下限周波数fmin(48)とすると、フーリエ変換すべき周波数範囲Δfp(51)は、Δfp=fmax−fminで表される。【0030】  変調器5における中間周波数fmidの信号の生成は、下記の式で表されるものであり、2つの変換周波数から、ローパスフィルタかバンドパスフィルタを使用して、低い方の周波数を得る。【0031】【数4】【0032】  ドップラー信号の周波数範囲Δfpは、中間周波数fmidを中心に、【0033】【数5】【0034】の範囲に変換されることとなり、検出対象の周波数範囲Δfpは、周波数変換しても保たれる。上記の式は、floc<fcの時の処理を示しているが、floc>fcの時も、複号(符号(±))が逆になるだけで、同様に処理がなされる。【0035】  図3において、右側部分が受信信号と局部発振信号との関係を表しており、ここでfmid(46)は、fmid=fc−flocの関係を満たしている。一方、図3の左側部分では、中間周波数信号に変換後のスペクトルを示しており、ここでは中間周波数信号の中心周波数はfmid(50)となっている。また、上述の周波数帯域52も周波数帯域54に変換され、検出対象の周波数範囲Δfp(51)は、中心周波数がfmidである周波数範囲Δfp(53)に変換されている。【0036】  図4は、潮流における流速プロファイル測定を行うために、観測船からθ=60°の方向(水平方向から60°下を向いた方向)に対して音波パルスを発射して反射エコーを受信したときの、受波波形の一例を示している。図において横軸は時刻を表している。ここでは反射エコー16は、中間周波数信号に変換されたのちの信号として示されている。時刻0の直後の振幅の大きな信号17は、送信した音波パルス自体を送受波器が受信したことによるものである。また、振幅の大きい波形18は、海底によって反射されたエコー(海底エコー)を示している。海底エコーにも、観測船の船速に応じ、±Δfp/2の周波数範囲内でのドップラーシフトが含まれる。【0037】  ここで中間周波数fmid(すなわち周波数変換された信号の中心周波数)は5kHzであるとし、アナログ/デジタル変換でのサンプリング周波数及びFFTでのサンプリング周波数fftは20kHzであるとする。このとき、フーリエ変換でのサンプル数Nは、式1−7より、N=fft/f0=20000/12≒1667となるが、FFTの使用を前提とすると、サンプル数は2のべき乗としなければならないので、サンプル数N=211=2048とする。サンプル数Nが2048であるとき、周波数分解能は、式1−6よりf0=20000/2048=9.766Hzとなり、上述した速度精度の0.1m/sに対応する周波数分解能12Hzよりも細かく、要求事項を満足している。【0038】  図4において、符号20は、音波パルスの送信と同時に取り込みを開始するとして、FFTに必要な2048個の信号サンプルを取り込むのに要する時間T0を表している。この2048個の信号サンプルに対してFFTを行った結果を図5に示す。【0039】  図5に示すスペクトルは、FFTステップで512番目に位置するピーク38と、574番目あたりに位置するピーク39とを顕著なピークとして含んでおり、強度としては、ピーク38の方が大きい。FFTステップ数に周波数分解能f0を乗じたものが実際の周波数であり、ここでは、f0=20000/2048=9.766Hzであるから、ピーク38の周波数は、9.766Hz×512=5000Hzとなる。上述のように、中間周波数信号における中心周波数fmidは5kHzであって、これは送信周波数の信号を周波数変換したものと一致するから、ピーク38は、送信波を直接検出したピークに対応する。また、同様の考察を行うと、ピーク39は、海底エコーに相当するものであり、船速に応じて送信周波数がドップラーシフトした周波数となっている。ここに示した例では、サンプリング周波数fft=20kHzであってサンプル数N=2048としているから、式1−5からT0=102.4msとなる。これは、距離に換算すれば、送受波器の位置から海底までをまとめてFFTの対象としていることになる。その結果、最もパワーが大きな送信信号自体がピークパワースペクトルとして検出されたことになる。つまり、所望する時間範囲以外に強い信号があるFFT入力信号では、その所望する時間範囲内でのピークパワーとなるスペクトルあるいは周波数を求めることはできない。【0040】  図4において、音波パルスの送信時刻を始点として時間t1(22)だけシフトさせ、ピーク18だけを含む時間範囲T1(21)の信号だけを切り出してFFTを行うことも考えられる。ちょうど128個のサンプルが切り出されてFFTを行ったとすると、周波数分解能f0は、f0=20000/128≒156Hzであり、これは、FFTステップが1つずれれば156Hz異なるという、粗い精度である。この周波数分解能は、要求されている分解能12Hzと比べて極めて粗く、要求に応えることができない。【0041】  なお、説明のため、図6ではスペクトルが連続する実線で描かれているが、実際にはFFTによる解析結果であるので、図1に示したものと同様に、FFTステップごとの離散値として表されるものである。【0042】  従来のドップラー計測では、所望の時間間隔内でピークパワーとなる周波数を求める場合、まず、距離(時間)分解能を優先させて、受信信号から必要な範囲T1を切り出し、周波数分解能が粗いままでFFTによる周波数解析を実行する。解析結果において最も高い値となったサンプリング点、次に大きな値となったサンプリング点、また次に大きな値となったサンプリング点などから、スペクトルにおけるピークの形状を仮定したカーブフィッティングなどの手法によって補間を行うことにより、真のピークパワー周波数を推定する方法などを用いていた。補間によるので、真のピークパワー周波数は、FFTにおける周波数分解能よりも細かい分解能で算出できる。【0043】  しかしながら、このような従来のやり方では、補間によってピークパワー周波数を求めるための回路や推定アルゴリズムが複雑になり、その結果、FFT以外の処理にも演算パワーを費やす必要が生じ、演算速度の低下やコストアップの要因となっていた。また、FFTの後で周波数推定を行うため、測定精度が悪化しやすいという問題もある。【0044】  特許文献1には、FFTにおける演算ポイント数を減らしつつ、周波数分解能を高めるようにした信号処理方法が示されている。【先行技術文献】【特許文献】【0045】【特許文献1】WO2006/043511【発明の概要】【発明が解決しようとする課題】【0046】  上述したように、ドップラー計測などにフーリエ変換を適用する場合、周波数分解能を向上させることと測定対象とする範囲の時間(あるいは距離)についての分解能を向上させることとが両立しない、というフーリエ変換の基本的な問題に起因する問題が生じる。この問題を回避するために、所望の短い時間幅で信号を切り出した上でFFTを行い、そのFFT結果に対して各種の補間方法や推定方法を適用して、FFTによって離散化した周波数間隔よりも細かくピークパワーの周波数を求めることも行われているが、これは、構成の肥大化やアルゴリズムの複雑化をもたらし、そのために演算速度の低下やコストアップがもたらされる。さらに、これらの補間方法や推定方法を用いた場合には、必ずしも所望の周波数精度が得られない、という問題点もある。【0047】  本発明の目的は、フーリエ変換における上述した基本的な問題を解決し、測定対象とする時間範囲の分解能を高めつつ、周波数分解能を高めることができる検出方法及び装置を提供することにある。【課題を解決するための手段】【0048】  本発明の検出方法は、時間変化する信号における所望の時間幅の範囲内でのピークパワー周波数を検出する方法であって、信号を所望の時間幅内においてサンプリングしてデジタルデータ列とするサンプリング段階と、必要とされる周波数分解能を満たすために高速フーリエ変換において必要なサンプル数を基準サンプル数として、この基準サンプル数に達するように、デジタルデータ列にゼロデータを付加する付加段階と、ゼロデータが付加されたデジタルデータ列に対して高速フーリエ変換を行うFFT段階と、を有し、高速フーリエ変換の結果において最大値を示す周波数をピークパワー周波数として検出する。【0049】  本発明の検出装置は、時間変化する信号における所望の時間幅の範囲内でのピークパワー周波数を検出する装置であって、信号を所望の時間幅内においてサンプリングしてデジタルデータ列とするサンプリング手段と、必要とされる周波数分解能を満たすために高速フーリエ変換において必要なサンプル数を基準サンプル数として、この基準サンプル数に達するように、デジタルデータ列にゼロデータを付加するゼロ付加手段と、ゼロデータが付加されたデジタルデータ列に対して高速フーリエ変換を行うFFT手段と、を有する。【発明の効果】【0050】  本発明では、粗い周波数分解能でのFFTの結果から補間や推定によってピークパワー周波数を求めるのではなく、所望の周波数分解能が得られるようにゼロデータを付加してからFFTを行うので、FFT後の補間や推定などを行うことなく、所望の周波数分解能でFFTからピークパワー周波数を直接求めることができるようになる。本発明は、複雑な回路やアルゴリズムを必要としないので、シンプルな構成で、低コストで、精度良く、かつ高速に、ピークパワー周波数を求めることができる。【図面の簡単な説明】【0051】【図1】FFTによる周波数スペクトル解析結果を示すグラフである。【図2】ドップラー計測機器の構成の一例を示すブロック図である。【図3】受信信号の中間周波数への変換などを説明するスペクトル図である。【図4】斜め方向に海中に音響信号を送波したときのその反射エコーの受信波形の一例を示す波形図である。【図5】送信信号を含んだ反射エコーの周波数スペクトル解析結果の一例を示す図である。【図6】入力サンプル数が少ない時のFFTによる周波数スペクトル解析結果を示す図である。【図7】本発明の実施の一形態のピークパワースペクトル検出装置の構成を示すブロック図である。【図8】FFTへの入力信号を説明する波形図である。【発明を実施するための形態】【0052】  図7は、本発明の実施の一形態のピークパワースペクトル検出方法の実施に適したドップラー計測機器の構成を示している。このドップラー計測機器は、本発明に基づくピークパワースペクトル検出装置の一例である。【0053】  図7に示したドップラー計測機器は、図2に示したドップラー計測機器において、信号切り出しゲート11とFFT処理部13との間に、ゼロ付加部12を挿入したものである。信号切り出しゲート11からは、測定対象の時間範囲に対応して信号をサンプリングしデジタル化して得られるデジタルデータ列が出力されるが、ゼロ付加部12は、必要とされる周波数分解能を満たすためにFFTにおいて必要なサンプル数を基準サンプル数として、この基準サンプル数に達するように、デジタルデータ列にゼロデータを付加するものである。ゼロ付加部12での処理の詳細については後述する。【0054】  図7に示すドップラー計測機器では、図2に示したものと同様に、変調器5及び局部発振回路6を使用して、送受波器1で受信した信号における上述の周波数範囲Δfpを低周波数側に周波数変換している。これは、高い周波数成分を検出するためにFFTを行うためには、サンプリング周波数を高くする必要があり、サンプリング周波数が高い分だけサンプル数が膨大となり過ぎるからである。ドップラー計測の場合、例えば、120kHz±1.2(kHz)の周波数範囲内でドップラー周波数を検出すればよく、検出対象とすべき周波数範囲Δfpが決まっているから、FFTにおいてサンプリング周波数を低下させ、かつ、必要な分解能の範囲内でサンプル数を減らすために、本実施形態では、受信信号を元の周波数よりも低い周波数の中間周波数信号に周波数変換している。前述の式2−1〜2−3などを用いて示したように、周波数変換後の中間周波数信号でも、周波数範囲Δfpは保たれている。【0055】  変調器5の出力から低周波側の中間周波数成分だけを取り出すことと、後段のアナログ/デジタル変換においてエリアシングが生じないようにすることのために、アナログフィルタ7が設けられている。アナログ/デジタル変換器(A/D)10は、FFTの実行が可能なサンプリング周波数でアナログフィルタ7の出力をサンプリングしてアナログ/デジタル変換する。これにより、A/D変換器10から、中間周波数信号における瞬時値を表すデジタル値からなるデジタルデータ列が出力されることになる。信号切り出しゲート11は、所望する時間範囲のデジタルデータ列を切り出す。この切り出されたデータのサンプル数を切り出しサンプル数とする。ゼロ付加部12は、要求されている周波数分解能に対応するFFTのサンプル数を基準サンプル数として求め、基準サンプル数に達するように、基準サンプル数と切り出しサンプル数との差に相当する数のゼロデータ(値がゼロであるサンプル)を切り出されたデジタルデータ列に付加する。そして、ゼロデータが付加されてサンプル数が基準サンプル数とされたデジタルデータ列に対し、FFT処理部13がFFTを実行し、ピークパワースペクトルを算出する。算出されたピークパワースペクトルは、信号切り出しゲート11において切り出された範囲に対するものであって、信号におけるその時間範囲でのピークパワー周波数を示している。また、ゼロデータが付加されたことにより、信号においてFFTの対象となる時間幅が実質的に拡大されており、この時間幅の逆数が周波数分解能に該当することから、周波数分解能が向上している。このように、本実施形態によれば、受信信号の中での所望の時間範囲(あるいは距離範囲)のピークパワースペクトルを、FFTの演算だけで、所望の周波数精度を満たして検出することができる。【0056】  以下、数値例を挙げて、この実施形態における周波数分解能について説明する。【0057】  背景技術の欄で述べたものと同じ条件で、超音波のパルス状の信号を海中に送信し、移動物からの反射エコーのドップラー周波数を測定する場合を考える。すなわち、海水中の音波伝搬速度CをC=1500(m/s)とし、送信周波数ftxをftx=120kHzとし、検出最大速度(水平方向)VをV=15(m/s)とし、音波を水平方向から斜め方向(θ=60°)に送受信するものとする。【0058】  このとき、ドップラー信号は120±1.2(kHz)の範囲であり、速度精度として0.1m/sを要求すれば周波数分解能f0は12Hzとなる。また、ドップラー計測において検出対象とする位置の範囲(位置分解能)を7.5mとし、周波数変換後の信号の中心周波数すなわち中間周波数fmid(50)を5kHzとし、アナログ/デジタル変換でのサンプリング周波数及びFFTのサンプリング周波数fftを20kHzとする。【0059】  周波数分解能f0から必要なT0を求めると、T0=1/f0=1/12≒83.3msとなる。【0060】  海中に音波パルスを発射して受信信号を観測し、その受信信号を中間周波数信号に変換した後の波形を示す図4において、上述したように、符号16は反射エコーを表し、符号17は送信信号自体を表し、符号18は海底エコーを表している。海底エコー18の周波数を解析し、式1−1に基づき、ドップラー周波数から船の速度を求める場合を考える。ここでは、送信信号などの不要な信号が含まれないようにするために、海底エコー18の部分だけを切り出してFFTを行い、海底からの反射波に関してドップラー周波数を求める。図8は、図4に示す信号波形から海底エコーだけを切り出した信号19を示している。ここでは、海底エコー19の部分として、音波パルスの送信から時間t2(26)の経過後に時間幅T2(24)を切り出すものとする。ここで切り出された信号は、サンプル数としては100個である。【0061】  時間幅T2の100個のサンプルのみを用いてフーリエ変換を行った場合の周波数分解能f0は、f0=20000Hz/100=200Hzとなり、要求されている周波数分解能である12Hzを全く満たさない。【0062】  ここで、要求されている周波数分解能である12Hzをフーリエ変換が満たすために必要なサンプル数Nを求めると、式1−7から、N=fft/f0=20000/12≒1667となる。1667は2のべき乗数ではないので、1667を超えて最も1667に近い2のべき乗数を考えると、211=2048が見つかる。そこで、FFTにおけるサンプル数Nとして2048を採用すると、式1−6より、周波数分解能f0は、f0=20000Hz/2048=9.766Hzとなって、要求事項を満足している。【0063】  そこでこの実施形態では、FFTをサンプル数N=2048で実行するものとし、海底エコーの信号19の分のサンプル数は100なので、不足した1948個のサンプルについては、ゼロ値からなるサンプルを挿入する。図8においてT0(23)は、2048個のサンプルに対応する時間であり、FFT解析の対象となる時間幅である。【0064】  ここでT0=T2+T3の関係が成り立っており、測定したい範囲の信号19を切り出してFFT解析に必要なサンプル数Nを満たすように付加されるゼロ値信号の継続時間が、T3に対応することになる。時間幅T3の挿入位置は、時間幅T2すなわち切り出された信号19の前でも後でもよい。あるいは、信号19を挟むように前後に分割してゼロ値信号を挿入する時間幅を配置してFFT解析の時間幅T0(27)を設定してもよい。【0065】  ここで示す例では、音波パルスの送信から信号の切り出しを開始するまでの経過時間t2(図8での符号26)と時間幅T2(図8での符号24)を予め定めているが、海底エコーのような強度の大きな反射エコーを検出対象とする場合であれば、切り出しまでの経過時間t2も切り出しの時間幅T2も自動検出して決定することも可能である。深度ごとの潮流の流速を求める場合などには、自動検出を行うことができないのでt2及びT2について予め設定しておくことになる。【0066】  ここでゼロ付加部12によるゼロ値データの付加について説明する。【0067】  一般にFFTではその対象とするサンプル数は2のべき乗である必要がある。その一方で、FFTによる解析を行いたい対象データにおけるサンプル数が2のべき乗となっていないことはよくあることである。そこで、サンプル数が2のべき乗となるように、ゼロデータのサンプルを付加することがゼロパディングなどと称して行われている。その場合、とにかくFFTを行えるだけのサンプル数となればよいのであるから、対象データのサンプル数をNsとして、2m-1<Ns≦2mを満たす自然数mが存在する時に、2m−Ns個のゼロ値データを付加することになる。それに対して本実施形態では、単にFFTの実行が可能になるようにゼロ値データを付加するのではなく、FFTにおけるサンプリング周波数fftを考慮して所望の周波数分解能が得られるように、ゼロ値データを付加する。したがって、付加されるゼロ値データの数も、単にFFTを実行可能になるようにする場合に比べ、はるかに多くなることがある。上述した例では、海底エコーを切り出してサンプル数が100になったとして、単にFFTを実行するためだけであれば27=128であるので28個のゼロ値データを付加すればよいだけであるが、所望の周波数分解能を満たすようにするために、1948個もののゼロ値データを付加しているのである。【0068】  以上、本発明の好ましい実施形態について、反射エコーにおけるドップラー周波数の検出を例に挙げて説明したが、本発明の適用範囲はこれに限られるものではない。検出対象とすべき周波数範囲を想定できる信号から短い時間範囲の部分を切り出してFFTによる解析を行う場合に、本発明は広く一般的に適用可能である。例えば、バンドパスフィルター等のフィルターを通して所望する周波数帯域の中の信号へと変換し、その後、短い時間信号を切りだして周波数検出を行うことに対しても、本発明は適用可能である。【符号の説明】【0069】    1    送受波器    2    送受信切替回路    3    送信回路    4    受信増幅器    5    変調器    6    局部発振回路    7    アナログフィルタ  10    アナログ/デジタル変換器(A/D)  11    信号切り出しゲート  12    ゼロ付加部  13    FFT処理部
【特許請求の範囲】【請求項1】  時間変化する信号における所望の時間幅の範囲内でのピークパワー周波数を検出する方法であって、  前記信号を前記所望の時間幅内においてサンプリングしてデジタルデータ列とするサンプリング段階と、  必要とされる周波数分解能を満たすために高速フーリエ変換において必要なサンプル数を基準サンプル数として、該基準サンプル数に達するように、前記デジタルデータ列にゼロデータを付加する付加段階と、  前記ゼロデータが付加された前記デジタルデータ列に対して高速フーリエ変換を行うFFT段階と、  を有し、  前記高速フーリエ変換の結果において最大値を示す周波数を前記ピークパワー周波数として検出する方法。【請求項2】  前記基準サンプル数は、前記サンプリング段階で得られる前記デジタルデータ列のサンプル数の2倍以上である、請求項1に記載の方法。【請求項3】  前記信号は、所定の周波数帯域を有し、前記所定の周波数帯域が低周波側に変換されるように、前記サンプリング段階の前に、前記信号に対して周波数変換を行う段階を有する、請求項1または2に記載の方法。【請求項4】  時間変化する信号における所望の時間幅の範囲内でのピークパワー周波数を検出する装置であって、  前記信号を前記所望の時間幅内においてサンプリングしてデジタルデータ列とするサンプリング手段と、  必要とされる周波数分解能を満たすために高速フーリエ変換において必要なサンプル数を基準サンプル数として、該基準サンプル数に達するように、前記デジタルデータ列にゼロデータを付加するゼロ付加手段と、  前記ゼロデータが付加された前記デジタルデータ列に対して高速フーリエ変換を行うFFT手段と、  を有する装置。【請求項5】  前記基準サンプル数は、前記サンプリング手段で得られる前記デジタルデータ列のサンプル数の2倍以上である、請求項4に記載の装置。【請求項6】  前記サンプリング手段は、前記信号に対してアナログ/デジタル変換を行うA/D変換器と、前記所望の時間幅に応じ、前記A/D変換器から出力されるデジタルデータ列を切り出す信号切り出しゲートと、を有する、請求項4または5に記載の装置。【請求項7】  前記信号は所定の周波数帯域を有しており、  さらに、前記サンプリング手段の前に、前記所定の周波数帯域が低周波側に変換されるように前記信号に対して周波数変換を行う周波数変換手段を有する、請求項4乃至6のいずれか1項に記載の装置。
短時間信号のピークパワースペクトルを検出する方法及び装置
