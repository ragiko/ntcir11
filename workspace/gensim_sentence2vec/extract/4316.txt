 Entierの内部アーキテクチャ
パックフェッチ
フェッチ、つまりデータベースからSELECTした結果を取り込む作業を考えてみる。通常、プログラムが動くプロセス内部に、動的にバッファ(フェッチ・バッファ)を確保し、データベースから1行ずつ取り込んでプログラムに渡す、というのが一般的な構造である。
ところで、行のサイズが極端に小さい(図4)場合、メモリの無駄は少ないが、1行単位でデータベースから取り込んでプログラムに渡すという作業は、非常に無駄が多い。
一方、1行のサイズが極端に大きい(図5)場合、動的に大きなサイズのフェッチ・バッファが取られることになる。組み込み環境ではそれほど大きなマージンがないのが常であり、動的に大量のバッファが確保されるとシステム全体の動作に影響を及ぼす。これが問題になりやすいのは行のサイズに合わせてフェッチ・バッファのサイズが変動することで、特に可変長データを扱う場合に顕著となる。だからといって、想定される最大サイズに合わせてフェッチ・バッファ用のヒープを確保しておくのは、無駄が大き過ぎる。
@ITモノイスト - カーナビに最適な空間検索を装備した「Entier」 − @IT MONOist (プリンタ用)
