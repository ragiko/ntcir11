
TNKな画像処理1
窓際天文台INDEX
玄の館トップページに戻る
この窓際天文台、少なくとも2014年時点での基本的な撮影方法は「TNK=て・ぬ・き」だ。これは望遠鏡の直焦点撮影を、一眼レフデジカメの超高感度を活用することで、赤道儀の精度だけにまかせてノータッチで短時間撮影するというものだ。望遠鏡・カメラ・赤道儀があれば比較的簡単に撮影できるので、TNKという名前にしてある。要はラッキーイメージングなのだが、少なくとも普通の人が見て「おおっ!」と思える写真ぐらいまでは撮影できる。ポイントは撮影方法と画像処理だ。ここでは自分なりの画像処理のワークフローとポイントを並べてみたので、参考に、もしくはあざ笑ってみて欲しい。
2014年1月25日
まずはファイル名を変更し、ガイドずれをチェック
撮影が終わったら、まずはカメラの撮影データをPCに入れる。私は適当な写真フォルダを撮影日毎に作成している。通常の撮影だとそれをやるとフォルダが増えすぎるので何を撮影したか分からなくなることが多いのだが、天体写真撮影だと年間10回〜20回ぐらいまでなので、それほど多いイメージは無いので撮影地+日付のフォルダーを掘っている。そこにデータをぶっこんで、まずは撮影対象毎にリネーム。これをやっておかないと現像時に結構手間なのと、何を撮影したのか後から見てもよく分かるので面倒だけを大事な作業だ。
この辺も作業を楽にするために、対象+日付+番号のファイル名に変更しているのだが、対象+日付を入力したところでコピー(CTRL+C)して、次のファイル名変更時にペースト(CTRL+V)で入力を大幅に省略している。同じ対象を複数枚撮影する天体写真なので、このパターンだと比較的楽に入力できる。RAWとJpegも同じ名前にしている。
ファイル名の入力が終わったら、ガイドずれのチェックだ。TNKだと基本この作業は欠かせない。ガイドずれ(ピリオディックモーションの山にかかって大幅にガイドずれを起こしているカット等)を除外するための大事な作業だ。基本、同時撮影しているJpeg(場合によってはRAW)ファイルを「IrfanView」で開いて、ガイドずれの状況を評価する。
Irfanview(要はビューソフト)で開いて、その脇に評価用のテキストファイルを置いて、評価を次々に下してテキストファイルに書き込んでいく。これだと手書きのメモが不要なので、メモをなくす心配とかも無い。テキストファイルはたいてい撮影データと同じフォルダに置いておく。他にも色々方法はあるかもしれないが、私はこの方法が汎用的なので使っている。
基準はテキトーだが、私の場合は一般的にa〜dで評価して、a(ほぼずれ目立たず)、とb(ずれは分かるが十分使えるレベル)、を使い、枚数が足りない場合はc(そこそこずれているがなんとか使えるか)、の評価のものも使用するようにしている。d(ずれが大きく普通使えない)、はそのままお蔵入りになる。赤道儀にスーパーポラリスを使っているときはだいたい歩留まり3〜6割ぐらいだった。北極星の近くだと比較的歩留まりが良くなる。必要なファイル数は最低2枚、できれば4枚、可能なら6〜8枚ぐらいを目安にしている。4枚がセットになっているのは、この後で使うスタックソフトのYIMGが4枚ずつしか処理できないからだ。
ファイルの評価が終われば、RAW現像作業を行う。基本Canonのカメラなので、使うソフトはDigital Photo Professionalだ。ソフトを立ち上げて、フォルダを指定する。ここで最初に日付別にフォルダを作っておいたのが便利になる。Jpegと同時撮影をしている場合は「表示」−「整列」で、RAW優先とすると、RAWファイルが頭の方に来るのでややこしくなくなる。ただ、枚数が多い場合、全部サムネイルが表示される前にこれをやってしまうと、サムネイルが表示されないファイルが後ろの方に整列されずに残ってしまう場合があるようだ。焦りは禁物である。
セレクトしておいて使う予定のファイルを一つダブルクリックすると現像パラメーターのダイアログが開く。ここでも画像拡大ができるので、ここでガイド評価もできなくはないが、いちいち拡大表示するのに時間がかかるので、サクサク動くビュワーソフトでチェックしておいた方が話が早い。
パラメーターは、原則デフォルトを使うのだが、余分な強調処理がされないように、まずはピクチャースタイルを「ニュートラル」にしている(たまに忘れるんだな、これが)。その上で、写真のカーソルのように、レベル調整をする。レベル調整そのものは後で画像処理ソフトでもやるのだけど、天体写真は撮影データの中で情報が乗っている部分はかなり狭いので、特に真っ暗な部分は情報が無い(はず)なので、ここでいくらかは落としておく。
次は色温度。これがRAW現像での一番のキモというか、一番大事な項目になるんじゃ無いかと思っている。最初の頃はデフォルトで全然調整しなかったのだが、そうすると撮影するたびにコロコロ変わるし、星雲に妙な色が付いたりしてた(それはそれで楽しかったりするけど…)
皆さんがどんな風に調整しているのかは知らないのだけど、私はRGBのヒストグラムを見て、ピークが極力重なるように調整している。色温度を「撮影時設定」から「色温度」にして、「RGB」のタグを見ながら微調整していく。なんでこのタグが別々なのか解せないのだが、とにかく面倒(^^;。ただ、ここでしっかり調整できるのはRとBだけ。Gに関しては大抵不足する形になる。そこで、「微調整」ボタンを使う。そうすると円グラフみたいなのが出てくるので、ここでGを強くするため少し上のポイントをクリックしてやるととRGBのピークがほぼ揃ってくれる。ただ、Gに関してはあんましぴったり合わせると少し強すぎる傾向があるので、今のところは少し控えめにしている。こんな感じかな。
最後にノイズ調整。NR/Lens/ALOのタブで、オートライティングオプティマイザをオフにして、ノイズリダクションは輝度で7、色ノイズで17ぐらいにしてやっている。但しこれはISO6400の場合。ISOが低い場合はもう少し控えめでいいだろうし、夏場でノイズが多いときは少し強めにしてもいいかもしれない。ダークや別の方法でノイズリダクションをする場合はここのパラメーターはゼロにするのかな。
1枚の調整が終われば、同じカットはだいたい同じパラメーターでいけるはず(はず…。)なので、パラメーターをコピペする。画像サムネイルを右クリックして、「レシピをクリップボードにコピー」を選び、そのデータを必要な画像(ずれの少ない画像)のみに「レシピを貼り付け」でコピーしていく。別にセレクトしていない画像にペーストしてもいいのだが、ここで制限しておけば誤って現像してしまうことも無いので確実だ。
現像パラメーターのコピーが終われば、現像するファイルをセレクト(CTRLキーを押しながら順にクリックしてセレクト)して、「ファイル」−「一括保存」で適当なファイル名を入れて一括保存する。このときに保存形式を「TIFF 16bit」にしてある。それほど深い意味は無いが、なるべく情報を失わないように、という形だ。TIFFファイルは大きくなるので、基本テンポラリーフォルダーに現像する。最終的にこの現像ファイルは消えていく運命にある…
現像が終われば、次はスタックになる。ここから先は色んなソフトがあるが、私はフリーソフトで使いやすい「YIMG」を使わせてもらっている。詳しくは作者田中さんのホームページをご覧下さい。ここでは、ざくっとした使い方(スタック)のみを並べてみた。機能的には一部分しか使ってないのだが、このスタックは簡単で便利なのと、なんといってもフリーソフトでここまでできるのが便利だ。ちなみに、コレを書いているときの最新バージョン(Ver.5.16)だと、私の環境ではインストーラーが正常に動作しなかった。実行ファイルのみでも、YIMG.EXEを叩けばちゃんと動いてくれるので特に問題は無い。
使い方はさほど難しくない。YIMGを立ち上げたら、先ほど現像したTIFFファイルをドラッグ&ドロップでYIMGに落とし込む。勝手に読み込んでくれるが、ファイルサイズがあるのでそれなりに時間はかかる。なお、画像で「+tempへコピー」と出ているが、これは画面をキャプチャーをするときに「CTRL」キーを押す必要があるので、どうしても出てしまうのだ。無いものと思って見てもらいたい(^^;
読み込んだ画像は左クリックで拡大、右クリックで縮小ができる。そのままだと等倍になっているので見難いと思うが、右クリックで縮小してい行って、必要な部分を左クリックで拡大すれば好きなところを見られる。まぁ、画像に特に問題なければとっととスタックしてしまおう。
画像を読み込んだら、「画像合成」−「画像合成(自動)」を選んで、読み込んだファイルを4枚まで指定してやる。このダイアログの合成画像の部分は開くたびにリセット(空白)になってしまうので、この指定を忘れると白い画像ができるだけで何も起こらないのでお忘れなく…。ちなみに、画像名称意外の各種設定は、ソフトを立ち上げている間はリセットされないようだ。
ファイルは4つ単位でスタックする。6枚だとしたら、3枚ずつスタックして、そのスタックしたファイル2枚を再度スタックする。5枚の場合は、2枚と3枚でスタックして、2枚をスタックする際に右側の「100%」の部分を40%と60%にすればよい(…はず…)。
ファイルが4枚以上の場合は、まず奇数コマを合成し、その後偶数コマを合成するようにしている。こうしているのは、前半/後半で区切ってしまうと、その合成コマ間のズレが大きくなってしまう場合があるからだ。その場合、合成後の2コマを合成するときにうまく行かなくなる確率が高くなる。あくまで確率だが、偶数・奇数で分けてやると2コマ間のズレが少なくなるようで、うまく行くような気がする。
ファイル名以外の指定としては、「比較範囲」を少し大きめ(デフォルトは20ドット)にしてやっている。だいたい40〜100ドットぐらいだ。TNKだとずれが大きくなる場合があるので少し大きめにしてやる場合が多い。比較方法は「低速(全画素比較)にしてやると、なーんとなく結果がいい様な気がするので選んでいる。ちゃんと撮影できていれば、中央のみとあまり変わらないはずだが…。
「ノイズ除去」は、いわゆるシグマクリップなのだが、普段はONのままで良いかと思う。ただ、状況によっては星雲部分が不自然にギザギザになってしまうことがあるので、そうした場合はここをオフにした方がいい場合があるようだ。(人工衛星なんかが写っていてもOFFだと消えてくれないが…)
スタックは少し時間がかかるが、Ver.4以降は大幅にスピードアップされているので、RAW現像より待たされない感じだろう。ISO6400で撮影した画像を4枚、8枚とスタックすると、もうびっくりするぐらい滑らかになる。スタックした画像に問題なければ、ファイル−保存で保存する。このときにも「TIFF」にしてやる。ここから先は、画像処理ソフトでの強調処理になる。それはまた、次の機会に…
窓際天文台INDEX
玄の館トップページに戻る
玄の館−窓際天文台−TNKな写真処理1−
