発行日 : 2004 年 12 月
Microsoft IT チームではデータ ドキュメントを保護するために、マイクロソフト社員が Windows Rights Management Services (RMS) を利用できるようにしています。作業負荷を分散して、可用性を最大限に高めるために、RMS サーバーを、ネットワーク負荷分散を使用するように構成されたクラスタに配置しました。このドキュメントでは、この構成を設定する手順について詳しく説明します。
トピック
はじめに
RMS クラスタで NLB を設定する
詳細情報
はじめに
Microsoft IT チームでは、Microsoft Office Outlook® 2003 で送信された電子メール メッセージ、および Microsoft Office Word 2003、Microsoft Office Excel 2003、Microsoft Office PowerPoint® 2003、RMS と連動するように設計された他のアプリケーションで作成されたドキュメントを保護するために、マイクロソフト社員が Microsoft® Windows® Rights Management Services (RMS) を利用できるようにしています。RMS は、Microsoft Windows Server™ 2003 の追加アドインです。RMS を使用すると、コンテンツを暗号化して、データ ファイルの作成者がコンテンツにアクセスできるユーザーを制限したり、コンテンツの受信後にユーザーが実行できる操作を制限できます。
RMS は、Microsoft SQL Server™ 2000 データベースをバックエンドとして使用する Windows Server 2003 上のインターネット インフォメーション サービス (IIS) でホストされているステートレスな Web サービス フロントエンドになるように設計されています。また、RMS には、1 つの SQL Server データベースを共有する複数のフロントエンド RMS サーバーを作成して、サービスの高可用性を保証したり、作業負荷の均一化を図る組み込みの機能があります。Windows Server 2003 のクラスタ サービスやネットワーク負荷分散クラスタと混同しないようにするため、この構成を「RMS クラスタ」と呼びます。RMS クラスタは、Web ファームと似ていて、さまざまなハードウェアやソフトウェアの負荷分散テクノロジを使用して負荷を分散できます。
このドキュメントでは、Microsoft IT チームが Windows Server ネットワーク負荷分散 (NLB) を使用して RMS クラスタの負荷分散を行う際に使用した手順について説明します。以下の手順に読み進む前にネットワーク負荷分散マネージャのヘルプ ファイルで NLB の使用に関する詳細を確認することをお勧めします。
RMS クラスタで NLB を設定する
ここでは、固定の IP (インターネット プロトコル) アドレス (192.168.0.10 および 192.168.0.20) を使用する 2 台の RMS サーバー (Server1 および Server2) が RMS クラスタ内に既に構成されていることを前提としています。サブネットのサブネット マスクは 255.255.255.0 です。以下の手順は、Microsoft IT チームが、クラスタ IP アドレス 192.168.0.30 の NLB クラスタに 2 台のサーバーを追加する場合に使用するものです。
Server1 のコンソールで、[管理ツール] メニューの [ネットワーク負荷分散マネージャ] をクリックします。
[ネットワーク負荷分散クラスタ] を右クリックして、[新しいクラスタ] をクリックします。
新しいクラスタの IP アドレス (この例では、サンプル アドレス 192.168.0.30 を使用) およびサブネット マスク (255.255.255.0) を入力します。
クラスタの完全な名前を入力します (サンプル名 RMSclustername.nwtraders.com では、"RMS クラスタ名" とクラスタ名のドメイン名を使用しています)。
[マルチキャスト] をクリックします。[IGMP マルチキャスト] チェック ボックスがオフになっていることを確認します。
[リモート制御を許可する] チェック ボックスはオフのままにします。
[次へ] を 2 回クリックします。
[ポートの規則] ダイアログ ボックスで、既定のポートの規則を選択し、[編集] をクリックします。以下のプロパティを使用して、ポートの規則を編集します。
クラスタ IP アドレス : すべて
ポート範囲 : 80 ～ 80 (Secure Sockets Layer [SSL] の場合は 443 ～ 443)
プロトコル : TCP
フィルタのモード : 複数ホスト | なし
[OK] をクリックします。
Microsoft IT の社内ネットワークでは、インターネット プロトコル セキュリティ (IPsec) を使用しているため、もう 1 つのポートの規則を追加しました。ここで同じ操作を行うには、[ポートの規則] ダイアログ ボックスで、[追加] をクリックします。以下のプロパティを使用して、新しいポートの規則を編集します。
クラスタ IP アドレス : すべて
ポート範囲 : 500 ～ 4500
プロトコル : UDP
フィルタのモード : 複数ホスト | 単一
注 : NLB での IPsec の使用方法の詳細については、サポート技術情報の資料「IPSec で動作する 構成 ネットワーク読み込む分散 の方法」 (http://support.microsoft.com/default.aspx?scid=kb;ja;820752&sd=tech) を参照してください。
[OK] をクリックして、[次へ] をクリックします。
1 台目の RMS サーバーの名前を入力し、[接続] をクリックします (この例ではサンプル名 Server 1 を使用します)。
サーバーの IP アドレス (192.168.0.10) が割り当てられたインターフェイスを選択します。
既定のホスト パラメータをそのまま使用し、[完了] をクリックします。
NLB で 1 台目の RMS サーバー Server1 が構成されるまで待機します。
クラスタ名 [RMSclustername.nwtraders.com] を右クリックして、[ホストをクラスタに追加] をクリックします。
2 台目の RMS サーバーの名前 (Server2) を入力して、[接続] をクリックします。
2 台目のサーバーの IP アドレス (192.168.0.20) が割り当てられたインターフェイスを選択します。
既定のホスト パラメータをそのまま使用し、[完了] をクリックします。
注 : この手順を実行した後に、"インターフェイスの構成が間違っています" というエラー メッセージが表示される場合があります。Microsoft IT チームでは、しばらく待機してから、[クラスタの更新] を右クリックしました。通常、この操作で、エラー状態が解決されます。このエラーは、2 台目のサーバーのネットワーク設定がリモートで変更され、サーバーが一時的にオフラインになっていることが原因で発生する場合があります。ローカル ホストにログオンした状態で、2 台目のサーバーをクラスタに追加した場合、このエラーは発生しません。
この時点で、NLB の構成は完了し、正常に実行されています。DNS 管理者は、RMS クラスタの現在の DNS 名前解決が新しい NLB クラスタ IP アドレスをポイントするように設定を変更する必要があります (上記の手順で使用した例を基に 192.168.0.30 を指定しました)。
これで NLB クラスタの IP アドレスに着信した RMS 要求の負荷は、2 台の RMS サーバー間で分散されるようになります。クラスタ内のサーバーのうち 1 台がオフラインの場合、RMS クラスタでは、もう 1 台のサーバーを使用して RMS 要求の処理が続行されます。
警告 : NLB で検出されるのは、ネットワーク アダプタ レベルのエラーのみです。一方のサーバーで World Wide Web 発行サービスなど、サービスの 1 つが停止されても、サーバーがオンラインであると、NLB では停止されたサービスに要求を送信し続けます。その結果、この例では、サービスへの要求の約半分が失敗します。管理者は、アプリケーション サービスの問題が解決するまで、問題が発生しているサーバーの NLB を手動で停止する必要があります。
ここでは、マルチキャスト モードの NLB を使用して、ネットワーク アダプタを 2 つ使用する必要を回避し、ネットワーク構成をシンプルにしました。ただし、NLB のマルチキャスト モードは、一部のネットワーク ルーターやネットワーク スイッチで正常に動作しないことがあります。NLB で問題が発生する場合は、ネットワーク ハードウェアに対して追加の構成作業を行うか、ユニキャスト モードで NLB を実行する必要があります。ユニキャスト モードで NLB を実行する必要がある場合、Microsoft IT チームでは、NLB 以外のネットワーク トラフィックに別のネットワーク アダプタを使用することをお勧めします。たとえば、ネットワーク負荷分散マネージャは、NLB 以外のネットワーク トラフィック用のネットワーク アダプタが正しく構成されていないと、正常に機能しません。マルチキャスト モードおよびユニキャスト モードの詳細については、Windows Server 2003 クラスタ サービス - IT プロのためのテクニカル リソース – (http://www.microsoft.com/japan/technet/prodtechnol/windowsserver2003/technologies/clustering/default.mspx) の「展開」にある NLB に関するドキュメントを参照してください。また、サポート技術情報 (http://support.microsoft.com/search/?adv=1) でも「NLB」に関する多くのサポート技術情報の資料を提供しています。
NLB を使用した RMS クラスタの負荷分散
