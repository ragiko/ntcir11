VLAN(Virtual LAN)
レイヤ3スイッチの仕組みを理解する上で、VLANは非常に重要だ。VLANはレイヤ2スイッチで仮想的にネットワークを分割する技術だ。もっと直感的にわかりやすく言うと、VLANとは1台のレイヤ2スイッチを仮想的に複数に分割する。以下の図にVLANの仕組みを簡単にまとめている。
図2では、1台のレイヤ2スイッチにPC1～PC4が接続されている。レイヤ2スイッチでVLAN10とVLAN20の2つのVLANを作成すると、レイヤ2スイッチは2台に分割されることになる。そして、VLANごとにポートの割り当てを行う。図では例としてVLAN10のポートとしてポート1とポート2を割り当て、VLAN20のポートとしてポート3とポート4を割り当てている。
こうしてレイヤ2スイッチでVLANを作成しポートを割り当てると、同じVLANのポート間のみが通信できる。つまり、VLAN10のPC1とPC2間は通信可能だ。同様にVLAN20のPC3とPC4間は通信可能だ。しかし、異なるVLAN間の通信はできなくなる。すなわち、PC1またはPC2からPC3またはPC4への通信はできない。
以上のように、VLANを作成するとレイヤ2スイッチを仮想的に分割して、直接通信できる範囲を限定する。つまり、ネットワークを分割する。いくつVLANを作成するか、どのポートをどのVLANに割り当てるかは自由に設定できる。VLANによって、物理的な配線を変えずとも、自由に直接通信できるポートのグループを決めることができるので、ネットワーク構成を柔軟に決められる。
トランクポート
VLANは1台のスイッチだけではなく複数のスイッチをまたがって構成することできる。複数のスイッチをまたがってVLANを構成する際には、スイッチ間をトランクポートで接続する。トランクポートとは、VLANごとに分割して利用できるポートだ。
図3では、2台のレイヤ2スイッチL2SW1とL2SW2にまたがってVLAN10とVLAN20を構成している例だ。L2SW1のポート1に接続されているPC1とL2SW2のポート2に接続されているPC2が同じVLAN10に所属する。そして、L2SW1のポート3に接続されているPC3とL2SW2のポート4に接続されているPC4が同じVLAN20に所属する。L2SW1とL2SW2はそれぞれのポート5で接続している。そして、ポート5はトランクポートとしている。
VLANを作成することはスイッチを分割することなので、L2SW1、L2SW2はそれぞれ2台に分割される
。
L2SW1L2SW1(VLAN10)、L2SW1(VLAN20)
L2SW2L2SW2(VLAN10)、L2SW2(VLAN20)
そして、トランクポートとしているポート5は、VLANごと分割した複数のスイッチそれぞれのポートとなる。L2SW1のポート5は、L2SW1(VLAN10)のポートであり、L2SW1(VLAN20)のポートだ。つまり、ポート5はVLANごとに分割される。L2SW2のポート5も同様だ。
トランクポートであるポート5はVLAN10のデータもVLAN20のデータも転送されることになる。VLAN10とVLAN20を区別しなければいけないので、トランクポート上で転送されるデータにはどのVLANのデータであるかを表すVLANタグが付加されることになる。VLANタグを付加することからトランクポートのことをタグVLANと呼ぶ場合もある。
さて、VLANによってネットワークを分割する様子を見てきたが、VLAN間の通信はできなくなってしまう。社内LANでは、営業部、人事部といった部署ごとにネットワークを分割しているケースが多いだろう。部署ごとにVLANでネットワークを分割することができるが、部署間で通信ができなくなってしまってもよいだろうか? 当然、よくない。部署間の通信も必要になるはずだ。
部署間、つまり、VLAN間で通信するためにはVLANを相互に接続する必要がある。レイヤ3スイッチが開発される以前は、VLANを相互に接続するためにはルータを利用している。ルータは異なるネットワークを相互接続するネットワーク機器であるからだ。なお、VLANを相互接続して、VLAN間の通信ができるようにすることをVLAN間ルーティングと呼ぶ。
ルータによるVLAN間ルーティングは、レイヤ2スイッチとルータをトランクポートで接続する。ルータは基本的に1つのポートで1つのネットワークを接続する。複数のVLANがある場合は、ルータに複数のポートが必要になるが、トランクポートで接続することで1つのポートを複数に分割して利用することができる。次の図は、レイヤ2スイッチのVLAN10とVLAN20をルータで相互接続する様子を表している。
ゼロから始めるスイッチ講座 (15) レイヤ3スイッチの仕組み - VLANとVLAN間ルーティング(前) | マイナビニュース
