
Option Explicit
' TEST2を呼んで結果を受け取りたい
Sub TEST1()
Dim 変数 As Long
変数 = 1
Call TEST2(変数)
MsgBox 変数
End Sub
' TEST1から呼び出されるサブプロシージャ
Private Sub TEST2(HENSU As Long)
' TEST1で宣言した「変数」に値をセット
HENSU = 9
End Sub
このコードは、「変数の有効期間(範囲)、プロシージャ間の変数の受け渡し」の3番目の項目で説明しているものです。
呼び先側プロシージャで単に変数を宣言しただけ場合は、「参照渡し(ByRef)」として扱われ、変数名が呼び元、呼び先で違っていても同一の変数に対して参照・更新を行なうことになります。
これは呼び先でこの変数に書き込みを行なった場合は、呼び元でのセットした値が保持されないことを意味しており、知らずに使うと誤解の元です。
但し、これは良くない結果を呼ぶだけではありません。このことを逆手に使って、呼び先の結果を引数に宣言した変数を使って呼び元のプロシージャに伝えることができるのです。
なお、呼び先プロシージャに「Private」が付いているのは、このプロシージャが同一モジュール上の他のプロシージャから呼び出されるサブプロシージャであるためです。
時にメインで動作したり、単一モジュールを超えて呼び出される場合は、「Private」は付けません。
呼び先で引数の値を変更されたくない場合はこうします。
呼び先の引数の宣言を「値渡し(ByVal)」で宣言すると、呼び元でセットした変数は呼び先で違う値に置き換わることがなくなります。
具体的には、引数の変数宣言の前に、「ByVal」を付加するだけです。
VBA基本(プロシージャ間の変数の受け渡し:その2)
