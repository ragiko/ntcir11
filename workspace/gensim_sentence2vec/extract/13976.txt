続いてはサーバ側同期である。
おさらいすると、サーバ側同期は、OutlookクライアントやE-mail Routerと異なり、
連携エンジンをインストールするものではなく、CRMサーバに同梱されるものである。
サーバサイドでの処理という点ではE-mail Routerと類似するとともに、機能は基本的に包含される。
利用方法であるが、O365 Exchangeとの連携に関しては下記がよくまとまっているため、記載を省略する。
http://blogs.msdn.com/b/crmjapan/archive/2014/07/03/dynamics-crm-spring-14-sp1-server-side-sync-mail.aspx
1点補足をすると、2014年10月現在においてはExchangeサーバの自動検出の問題は解消されているようであり、
https://outlook.office365.com/EWS/Exchange.asmx
をセットする必要はなかった。
最後にテストである。メールの送信に関してはE-mail Routerの送信と同様に
電子メール活動を作成して確認するのがよい。
新しい機能として確認すべきは、メール以外の同期である。
例えば予定の同期はどのように処理されるのか。
Outlookクライアントの場合はOutlook上で追跡ボタンが表示され、
追跡することが可能であった。
サーバサイド同期の場合はモジュールをインストールするわけではないため、
追跡することはできない。従ってOWAを含むメールクライアント側からの同期はできないと思われる。
しかしながら、CRM上から予定活動を作成するとO365の予定表にも予定が作成される。
一度連携がなされれば、CRM側で更新した内容はO365予定表にも反映され、
O365予定表で更新された内容はCRMにも反映される。以下、画面イメージである。
※一番上の予定はCRM上で作成し、更新した。
※10/7の予定はOWAから作成したもの。上の画像に存在していないため、同期されていない。
※10/8の予定はCRMから作成したものをさらにOWAで編集したもの。OWAからの編集は同期される。
続いてはE-mail Routerである。
おさらいすると、E-mail Routerは、Outlookクライアントと異なり、
連携エンジンをサーバサイドに搭載して連携を行うものである。
サーバサイド故、常時起動しているため、システムメール(アラート系)を処理するという
利用方法があるということを紹介した。また、2013から登場したサーバ側同期は
原則E-mail Routerの上位機能であるため、今後は利用が少なくなると思われる機能である。
まず、インストールモジュールのダウンロードである。
http://www.microsoft.com/ja-jp/download/details.aspx?id=40342
こちらからモジュールをダウンロードし、任意のフォルダを指定してプログラムを展開する。
展開後のイメージは下記。
SetupEmailRouter.exeをダブルクリック。
コンポーネントは[Microsoft Dynamics CRM E-mail Routerサービス]のみでよい。
※[ルール展開ウィザード]はExchangeサーバを利用して、転送用メールボックスによる
受信処理を行う場合に必要な仕訳ルールを作成するサービスである。
インストール完了後は利用環境相当のURの適用を実施する。
適用時のウィザードは省略する。基本的に次へをクリックするだけである。
また、設置型において忘れがちなのは、「PrivUserGroupへE-mail Routerコンピュータの追加」である。
対象画面だけ記載しておく。
E-mail Routerのインストール後は具体的環境への接続設定である。
今回はシステム系メールの送信ということで、送信のプロファイルを作成してみる。
メールシステムはO365 Exchangeサーバを利用し、アカウントもO365ユーザーを利用する。
[E-mail Router構成マネージャー]を起動する。[新規]をクリックする。
※選択されているレコードは初期状態では表示されない
送信処理用のプロファイルを作成する。
プロファイル名:任意
通信方向:発信
電子メールサーバーの種類:Exchange Online
場所:[AutoDiscoveryを使用する]にチェック
ユーザータイプ:管理者
ユーザー名/パスワード:メール送信するアカウント
アクセスの種類:[代理人アクセス]にチェック
最下部のチェック:チェック
[詳細]タブ:変更なし
次に[展開]タブをクリックし、[新規]をクリックする。
※表示されているレコードは初期状態では表示されない
接続する組織情報を入力する。
展開:[Microsoft Dynamics CRM Online]を選択
Microsoft Dynamics CRM Server:[https://disco.crm5.dynamics.com/組織独自の名前(※)]
アクセス資格情報:システム管理者アカウントなど権限の強いもの
既定の構成プロファイル:[送信構成プロファイル]にて作成済みのプロファイルを選択
(※)組織IDは[設定]>[カスタマイズ]>[開発者リソース]で確認ができる。
また、利用環境によってはURLの指定の仕方が異なるため、以下などを参照すとよい。
http://technet.microsoft.com/ja-jp/library/hh699786.aspx
[ユーザ、キュー、転送用メールボックス]タブに移動し、[データの読み込み]をクリックする。
今までの設定が正しいものであれば、下図のようにアカウントが表示される。
そうでない場合はエラーが表示される。エラー内容から正しく修正を行う。
アカウントを利用した接続の正常性を確認するため、アカウントを選択して、[アクセスのテスト]をクリックする。
以下のように成功すれば、E-mail Router上での設定は正常となる。
エラーが表示された場合はその内容にしたがって、修正を行う。
例えば、システム設定の不備を指摘されることがある。以下の[電子メール処理の構成]では
[Microsoftr Dynamics CRM 2013 E-mail Router]を選択する必要がある。
最後に設定を公開する。[公開]をクリック。
以上で、インストールおよび構成は完了となる。
最後にテストを行う。OutlookクライアントではOutlookより追跡メールの送受信にてテストを行った。
E-mail Routerの送信では、対象アカウントによる電子メール(活動)の送信を行い、
電子メール活動が送信完了かつ、実際のE-mailが送信されれば、基本処理の正常性が確認できると考えられる。
以下のように電子メール活動を作成して、[送信]をクリック。
Outlookクライアントでの確認のように、電子メールメッセージを高度な検索で確認するとよいと思われる。
以上。
個別の連携方法に関する内容にはいる。
今回はOutlookクライアントである。
おさらいすると、Outlookクライアントは、Outlook画面でメールや予定などに対し、
追跡を行いながら連携を行いたい場合に利用することが多い連携パターンである。
まず、インストールモジュールのダウンロードである。
http://www.microsoft.com/ja-jp/download/details.aspx?id=40344
こちらからモジュールをダウンロードし、任意のフォルダを指定してプログラムを展開する。
展開後のイメージは下記。
SetupClient.exe実行後のウィザードは省略。基本的に次へをクリックだけである。
インストール完了後は下記のステップが必要だと思われる。
・(英語以外の言語の場合)言語パックの適用
・利用環境相当のURの適用
前者に関しての必要性や影響はよくわからないが、初期状態では個人用オプションが英語であった。
これの適用もしくはURの適用により、正常に日本語表示されるようになった。
後者に関しては、2014年9月末時点でOnlineを利用する場合はSP1UR1が最新である。
OutlookクライアントのURは必ずしもサーバのURと合わせる必要はない。
バグフィックスのほか、パフォーマンス改善も含まれることがあるので、
極力最新化するのがよいと思われる。
URは、ClientというOutlookクライアント用とmuiという言語パック用を適用する。
適用時のウィザードは省略する。基本的に次へをクリックするだけである。
Outlookクライアントのインストール後は具体的環境への接続設定である。
[構成ウィザード]を起動する。
上記の画面で設定を行う。
設置型の場合はURLを入力する。Onlineの場合はプルダウンからOnlineを選択する。
[接続テスト]をクリック。
Onlineの場合は、(エラー画面の後)以下の画面が表示されるので、認証情報を入力する。
正常に接続ができると、組織情報が表示される。[OK]をクリック。
[閉じる]をクリック。
以上でインストールの作業は完了となる。
Outlookを起動すると、メニューにDynamics CRM関連が追加されていることがわかる。
以降、まず行うことはのメールの送受信処理ができているかの確認である。
例えば、以下のような追跡設定をしたメールを受信可能なメールアドレスに送信する。
受信可能なメールアドレスから返信を行い、初期設定であれば15分程度待つ。
高度な検索から、電子メールメッセージを検索し、[ステータス]が[受信]と[送信]のレコードが存在するか
を確認する。
受信のポーリング間隔はOutlookから起動する個人用オプションの以下の設定で変更が可能と思われる。
※ブラウザから起動可能な個人用オプション設定の画面とは表示内容が異なる。
以上、Outlookクライアントに関してである。
運用で利用するには、同期対象であったり、電子メール活動の閲覧権限であったり、
さまざまなことを検討する必要があるが、一旦はこれで終了とする。
またどこかのタイミングで記載しようと思う。
個別の設定などにはいる前に連携イメージと共通設定に関して記載する。
まず、連携イメージである。
なぜこれを記載するか。
それはメール系連携は接続できない、または処理が完了しないということが比較的多く発生するからである。
何と何がどのように連携するのかを抑えておくとトラブルシュートに役立つと思われる。
ポイントは下記である。
・メール系機能と連携するのは活動(及び取引先担当者)である。
⇒メールの送信であれば、電子メールが送信されると共に送信の電子メール活動が作成される。
つまり、電子メール活動の作成権限がなければ処理が失敗する。
・連携処理は(すべて)非同期に行われる(と思われる)。
⇒時差がある。多くの連携処理に関しては間隔の設定が行える。
設定箇所を探す癖をつけるとともに、少し待って結果を確認する。
もう少しイメージとして捉えるのであれば、下記が参考になるかもしれない。
https://community.dynamics.com/crm/b/dynamicscrmsupportblog/archive/2012/11/09/email-router-demystified-explanation.aspx
次に共通設定である。
①ユーザーエンティティでの設定
②電子メールの承認
③セキュリティロールによる権限付与
④(各連携方法の設定)
①ユーザーエンティティでの設定
まず、電子メールを設定する必要がある。
有効なアドレスを[既定の電子メール]に設定する。
これと共に[メールボックス]にて連携方法を設定する。
Lookupの値をダブルクリックして詳細設定画面へ。
連携方法に関してはアカウント単位に設定を行い、受信メール、送信メール、その他でそれぞれ選択をする。
②電子メールの承認
連携を許可する設定である。
ユーザー毎に許可するか、システム全体で許可/拒否の設定をするか選択が可能である。
・ユーザー毎の場合はユーザーレコードのリボンから
・システム全体の場合は、[システムの設定]から
[承認されたユーザーについてのみ電子メールを処理する]のチェックをはずせば、
ユーザー毎に承認する必要はなくなる。
③セキュリティロールによる権限付与
明確には分からない。
それと思われる特権と少なくとも活動系エンティティの読み込みと作成権限は必要。
最初はシステム管理者などで設定を行い、正常に処理されることを確認した後に、
権限を狭めていくのがよいかと思われる。
④(各連携方法の設定)
Outlookクライアントであれば、モジュールのインストールや接続先の設定などである。
それぞれでの設定を行い、連携テストを行って完了となる。
以上。
新しいテーマである。
Dynamics CRMはいわゆるメール連携が可能である。
これから数回にわたって、このいわゆるメール連携に関して記載をする。
まず、連携方法に関して記述する。連携方法は以下の3種類である。
①Outlookクライアント
②E-mail Router
③サーバ側同期(Server Side Sync)
それぞれに関して簡単に説明していく。
①Outlookクライアント
3.0から存在する機能で、Outlookにアドインして連携を行うものである。
Outlookが搭載されているクライアントPC毎にインストールして利用するものである。
Outlookの画面上CRMの画面がはめ込まれているものを見たことがあるかと思う。
また、メール送信画面からCRMと追跡のようなボタンをクリックして、
CRMのレコードとメールを関連付けて送信するような機能も見たことがあると思う。
これらの機能はこの連携方法のみで提供される機能である。
連携対象はメールだけではなく、取引先担当者やタスク、予定なども連携が可能である。
連携するためのエンジンはクライアント側に搭載され、
クライアントPC上でサービスが起動している時点のみ連携処理が行われる。
つまり、PCをシャットダウンしている間は連携処理が停止し、PCを起動後に処理がおこなわれる。
最後にOutlookクライアントは別の機能も持っている。
Dynamics CRM Onlineにて、動的Export機能を有効にする場合、これをインストールする必要がある。
②E-mail Router
3.0から存在する機能で、一般的にはサーバにインストールして連携を行うものである。
連携するためのエンジンはサーバサイドに搭載されるため、
機能の集約化に伴うトラブル箇所の削減や常時連携処理を行うということも容易になる。
Outlook以外のメーラーを利用している場合であったり、
システムアラートメールの送信処理などで利用することが多いと思われる。
E-mail Routerの名のとおり、連携対象はメールのみである。
③サーバ側同期
2013から登場した機能で、Dynamics CRM アプリケーションに搭載されたエンジンを利用して連携をとるものである。
Dynamics CRM Onlineを利用し、Outlookクライアントの利用がマッチしない場合、
この機能が存在しないのであれば、Email Routerを利用しなければならない。
「折角CRMサーバをクラウド化したのにローカルサーバを構築しなければいけなくなる」という
ケースを排除するために登場してきたという背景があると思われる。
基本的にはE-mail RouterがDynamics CRMアプリケーションに取り込まれた機能というようなものであるが、
メールだけでなく、取引先担当者やタスク、予定表の連携も可能である。
注意する点としては、サーバ側同期の設定が可能な構成が限定されることがあるということくらいである。
一部の構成では、メール以外の連携がサポートされない。以下が参考となる。
https://community.dynamics.com/crm/b/tsgrdcrmblog/archive/2014/08/30/microsoft-dynamics-crm-2013-server-side-exchange-synchronisation.aspx
以上。
次回以降はそれぞれの具体的設定や共通の設定に関して触れたいと思う。
システム連携 | 実践 Dynamics CRM
