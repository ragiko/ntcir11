   〜≪c≫
インデクスの作成方法を指定します。
なお,共有モードの場合は指定しても無視されます(sが仮定されます)。
c
インデクス一括作成モードを示します。このモードを指定した場合,行データをリバランスした後,インデクスを一括作成します。
<適用基準>
占有モードでリバランスした行データのインデクスを,インデクス情報ファイル,ソート用ワークファイルを使用して高速に作成したいときに指定してください。なお,execstop文を指定した場合,データ移動後にインデクスの一括作成をするため,移動したデータのインデクスが作成されるまでpdrbalが停止できないことがあります。
s
インデクス更新モードを示します。このモードでは,行データを移動するごとにインデクスを更新します。
<適用基準>
占有モードでリバランスした行データが少ない場合,又はインデクス情報ファイル,ソート用ワークファイルが確保できない場合に指定してください。また,execstop文に指定したpdrbal実行時間でpdrbalを確実に停止させたい場合にも指定してください。
<注意事項>
-i cを指定すると,「インデクス数×追加した表格納用RDエリア数」のインデクス情報ファイルを作成します。このファイルは,データ格納時に同時にオープンするため,ファイル数が多いと1プロセスで使用できるファイル数の上限を超えることがあります。ファイル数の上限を超える場合,システム定義のpd_max_open_fdsオペランドの指定値を大きくしてください。ただし,pd_max_open_fdsオペランドの上限値を超える場合は,1サーバ内の表の分割数,定義しているインデクス数を見直すか,又は-i sを指定するかで対処してください。
index文,及びidxwork文を省略すると,/tmpディレクトリに次の名称規則でインデクス情報ファイルを出力します。
/tmp/INDEX-インデクス名-インデクス格納用RDエリア名-一意となる文字列
pdrbalが異常終了した場合,このファイルは削除されません。そのままpdbalを再実行すると,更に別の名前でファイルが作成され,/tmpディレクトリの容量不足になることがあります。そのため,不要となったインデクス情報ファイルは,OSのrmコマンドで削除するようにしてください。
〜《a》
pdrbal実行時の,データベースの更新ログの取得方法を指定します。
なお,占有モードの場合は必ず-lオプションを指定してください。また,共有モードの場合は指定できません(aが仮定されます)。
a
ログ取得モードを示します。ロールバック,及びロールフォワードに必要なデータベースの更新ログを取得します。
<適用基準>
リバランスの行データが少ない場合,又はpdrbalの実行前,実行後にバックアップを取得したくない場合に指定します。
ログ取得モードで実行した場合,pdrbalの実行前,実行後のバックアップは取得する必要はありませんが,ログレスモードと比べて処理性能は劣ります。
n
ログレスモードを示します。データベースの更新ログは取得しません。
<適用基準>
リバランスの行データが大量の場合に指定します。
ログレスモードで実行した場合,ログ取得モードに比べると実行時間は短縮できます。ただし,pdrbal実行中の異常終了に備えて,pdrbalの実行前にバックアップを取得する必要があります。また,データベースの更新ログが取得されていないためpdrbal実行後にもバックアップの取得が必要です。
なお,pdrbalが異常終了した場合,表格納用RDエリアは障害閉塞となるため,pdrbal実行前に取得したバックアップで回復する必要があります。
<規則>
以前に取得したバックアップから回復できるときは,pdrbal実行前のバックアップ取得は不要です。
ログレスモードでは,データベースの更新ログの代わりに,1サーバ当たり次の量のENQログを出力します。
ENQログ=(p+q+r)×T
p:表格納用RDエリア数
q:LOB列(LOB属性)格納用RDエリア数
r:インデクス格納用RDエリア数
T:トランザクション数(-cオプションの説明を参照してください)
ログレスモードの運用方法については,マニュアル「HiRDB Version 8 システム運用ガイド」を参照してください。
execstop文を指定してpdrbalを数回に分けて実行する場合,実行するごとにバックアップを取得する必要があります。
ログ同期方式のリアルタイムSANレプリケーションを適用している場合,業務サイトで-l n指定のpdrbalを実行したときは,システムログ適用化を実施してください。システムログ適用化については,マニュアル「HiRDB Version 8 ディザスタリカバリシステム 構築・運用ガイド」を参照してください。
pdrbalを実行するユーザの認可識別子を指定します。
省略した場合の仮定値については,<省略時仮定値>を参照してください。
このオプションを指定した場合,パスワード入力要求の応答付きメッセージが表示されます。パスワードが不要な場合は,応答付きメッセージに対して空送信してください。
ここで指定した認可識別子でHiRDBに接続し,実行権限のチェックをします。
<適用基準>
環境変数PDUSERに設定されている認可識別子ではない,別の認可識別子で実行したい場合に指定します。
<省略時仮定値>
省略した場合,次の方法で認可識別子/パスワードが仮定されます。
pdrbal実行時の環境変数PDUSERの設定値が仮定されます。シェルで&を付けてバックグラウンドで実行する場合や,リモートシェル環境で実行する場合など,パスワードの応答ができない環境で実行するときは,PDUSERを必ず設定してください。環境変数PDUSERの指定例を次に示します。
(例)Cシェルの場合
パスワードありの場合 setenv PDUSER '"認可識別子"/"パスワード"'
パスワードなしの場合 setenv PDUSER '"認可識別子"'
環境変数PDUSERが設定されていない場合,ログインウィンドウのユーザ名が仮定されます。パスワードについては,入力要求の応答付きメッセージが表示されるので,そこで応答してください。パスワードが不要な場合は,応答付きのメッセージに対して空送信してください。
<規則>
このオプションは,シェルで&を付けてバックグラウンドで実行する場合や,リモートシェルなどの応答できない環境では指定しないでください。
認可識別子を引用符('')で囲んだ場合は,英大文字と英小文字が区別されます。引用符('')で囲まない場合は,すべて英大文字として扱われます。なお,sh(Bourneシェル),csh(Cシェル),及びksh(Kシェル)の場合は,更にアポストロフィ()で囲む必要があります。
〜<符号なし整数>((0〜1000000))
≪共有モードの場合は10,占有モードの場合は100000≫
リバランス処理でデータを再配置するための行データの移動で,何行移動したときにコミットするかを行数で指定します。
0を指定した場合は,1トランザクション当たりの移動行数を制限しません(リバランスが終了するまで,又はexecstop文で指定した時間までを1トランザクションとして移動処理をします)。
HiRDB/パラレルサーバの場合,各RDエリアに格納されている行数によっては,ここで指定したコミット単位より少ない行数でコミットすることがあります。
<推奨値>
共用モードの場合,pdrbalでは行データ移動のときに移動元と移動先のRDエリアに対して排他を掛けます。そのため,該当する移動元,移動先RDエリアに対して,移動が終了するまで(コミットするまで)アクセスできなくなります。したがって,共有モードの場合には,コミット単位に小さい値を指定することでほかからの排他待ち時間を短くできます。
UAPなどの動作を優先したい場合は小さい値を指定し,リバランス処理を優先したい場合は大きな値を指定してください。
占有モードで,かつログレスモードの場合,処理対象となる表にインデクスが定義しているときは,コミット単位に0を指定することで処理性能を向上できます(コミット時のインデクスメンテナンス処理で更新したグローバルバッファのフラッシュ処理が1回になるため,性能向上が期待できます。また,コミット数も削減できます)。ただし,1トランザクションで処理するため,処理行数の増加に伴い,排他資源数が増加します。また,シンクポイントダンプを取得しない期間も長くなります。
<注意事項>
オンライン業務でのトランザクション数が比較的多い場合,100以下を指定することをお勧めします。
コミット単位に小さい値を指定した場合,リバランス処理の時間は長くなり,また,コミット回数の増加に伴い多量のトランザクションログが出力されます。トランザクションログは,-lオプションの指定値に関係なく必ず出力されるログで,次の計算式から求められます。
トランザクションログ量(単位:バイト)
=(1328+176×3)×T
T:(a÷b+1024÷c)
a:リバランス対象のデータ件数
b:-cオプションの指定値
c:表格納用RDエリアの数
トランザクションログは,コミットするごとに上記の計算式のログを,各サーバのシステムログファイルに出力します。各サーバとは,すべてのフロントエンドサーバ,及び表格納用RDエリアがあるバックエンドサーバのことです。また,抽象データ型がある表の場合は,ディクショナリサーバも含まれます。
コミット単位に大きい値を指定した場合,シンクポイントを取得できない期間が長くなり,ほかのUAPと同時実行中に障害が発生したときは,再開始に要する時間が増大します。
占有モードで,かつログレスモードの場合,コミット単位に0を指定できます。それ以外の場合は0を指定できません。
オプション
