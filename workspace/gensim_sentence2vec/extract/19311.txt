【課題】MUSIC法を使用して安定的に音源定位を行なえる音源定位装置を提供する。【解決手段】音源定位装置50は、マイクロホンアレイ52の出力から得られる複数チャンネルの音源信号の各々と、マイクロホンアレイ52に含まれる各マイクロホンの間の位置関係とに基づいて、3次元空間内で定義された複数の方位の各々について、MUSICアルゴリズムにより、所定時間ごとにMUSICパワーを算出するMUSIC処理部62と、複数の方位の各々について、MUSIC処理部62により時系列として得られたMUSICパワーの値の強度及びその変化量に基づいて、音源の発生から消滅までの音源の方位の変化を検出する音源推定部64とを含む。
【発明の詳細な説明】【技術分野】【0001】  この発明は実環境における音源定位技術に関し、特に、実環境におけるMUSIC(MUltiPle  SIgnal  Classification)法を用いた音源定位、及び、音声の方向性による、移動する音源による音声の発生区間の検出技術に関する。【背景技術】【0002】  人とロボットとの音声コミュニケーションにおいて、ロボットに取付けたマイクロホンは通常離れた位置(1m以上)にある。したがって例えば電話音声のようにマイクと口との距離が数センチの場合と比べて、信号と雑音の比(SNR)は低くなる。このため、傍にいる他人の声や環境の雑音が妨害音となり、ロボットによる目的音声の認識が難しくなる。従って、ロボットへの応用として、音源定位や音源分離は重要である。【0003】  音源定位に関しては過去にさまざまな研究がされている。しかし、その大半ではシミュレーション・データ又はラボ・データのみが使用され、ロボットが動作する実環境のデータを評価するものは少ない。3次元の音源定位を評価する研究も少ない。発話相手の顔を見ながら話したり聞いたりすることも人間とロボットとの対話インタラクションを改善するための重要なビヘービアであり、そのためには3次元の音源定位も重要となる。【0004】  実環境を想定した従来技術として特許文献1に記載のものがある。特許文献1に記載の技術は、分解能が高いMUSIC法と呼ばれる公知の音源定位の手法を用いている。【0005】  特許文献1に記載の発明では、マイクロホンアレイを用い、マイクロホンアレイからの信号をフーリエ変換して得られた受信信号ベクトルと、過去の相関行列とに基づいて現在の相関行列を計算する。このようにして求められた相関行列を固有値分解し、最大固有値と、最大固有値以外の固有値に対応する固有ベクトルである雑音空間とを求める。さらに、マイクロホンアレイのうち、1つのマイクロホンを基準として、各マイクの出力の位相差と、雑音空間と、最大固有値とに基づいて、MUSIC法により音源の方向を推定する。【先行技術文献】【特許文献】【0006】【特許文献1】特開2008-175733号公報【発明の開示】【発明が解決しようとする課題】【0007】  MUSIC法は分解能が高いという特長があるが、MUSIC法を使用する場合には音源の数を与えなければならないという問題がある。特許文献1に記載の技術では、音源は一つであることが想定されているため、こうした問題は生じない。しかし、実際にロボットが稼動する環境としてはそのような環境であることはまれで、常に複数の音源が存在しており、しかもその数は一定していない。MUSIC法を用いる場合、音源の数の予測を誤ると音源定位も誤ってしまい、ロボットが人間と正しくインタラクションをすることが困難となってしまう。特に、音源の数を多く予測しすぎると、好ましいインタラクションが難しくなるだけでなく、計算コストも高くなるという問題がある。【0008】  さらに特許文献1に記載の技術では、音源定位は2次元的に行なわれている。しかし、実際のロボットの稼働環境は2次元ではなく、3次元的である。例えば、商店街などでは比較的高い位置にスピーカが置かれており、そのスピーカから常に音声が流されていることが多い。また、スピーカの位置は一定であるが、音量が変化することもある。そうした環境では音源を3次元的に定位することが好ましいが、特許文献1に記載の技術では2次元的にしか行なえないという問題がある。【0009】  特に人間を相手にするロボットの場合、人間の身長はさまざまで、大人の場合にはロボットより高い位置で話し、子供の場合には逆にロボットより低い位置で話すことが多い。そうした点からも、3次元的な音源定位をすることが望まれる。ロボットと人とが対話するときには、ロボットの顔を相手の顔の方向に向ける必要があるが、3次元的な音源定位が行なえないと、そのような対話を行なうことは困難である。【0010】  さらに、人間は頻繁に移動するため、音源を実時間で安定してトラッキングすることも必要である。【0011】  それゆえに本発明の目的は、MUSIC法を使用して安定的に音源定位を行なうことができる音源定位装置を提供することである。ここでの音源定位とは、音源の方位を継続的に特定することをいう。【0012】  本発明の他の目的は、MUSIC法を使用して安定的に音源をトラッキング可能な音源定位装置を提供することである。【0013】  本発明のさらに他の目的は、MUSIC法を使用して安定的に音源のトラッキングを行ない、音源の発生及び消滅を精度高く実時間で予測できる音源定位装置を提供することである。【課題を解決するための手段】【0014】  本発明の第1の局面によれば、音源定位装置は、マイクロホンアレイの出力から得られる複数チャンネルの音源信号の各々と、マイクロホンアレイに含まれる各マイクロホンの間の位置関係とに基づいて、マイクロホンアレイの位置に関連して定められる点を中心とする3次元空間内で定義された複数の方位の各々について、MUSICアルゴリズムにより、所定時間ごとにMUSICパワーを算出するためのMUSIC応答算出手段と、複数の方位の各々について、MUSIC応答算出手段により時系列として得られたMUSICパワーの値の強度及びその変化量に基づいて、音源の発生から消滅までの音源の方位の変化を検出するための音源推定手段とを含む。【0015】  好ましくは、音源推定手段は、複数の方位の各々に対して、複数の方位の内で、処理対象となっている方位に隣接する方位の各々に関して直前にMUSIC応答算出手段により算出されたMUSICパワーの値と、当該処理対象となっている方位に関して得られた最新のMUSICパワーの値との差を算出し、その差のうちで所定の条件を充足する値を当該方位についてのMUSICΔパワーとして出力するためのMUSICΔパワー算出手段と、複数の方位の各々に対して、当該方位についてMUSIC応答算出手段により算出されたMUSICパワーの値と、当該方位についてMUSICΔパワー算出手段により出力されたMUSICΔパワーとに基づいて、音源の発生があったか否かを検出し、音源の発生の検出に応答して、音源発生を示す情報とその方位を示す情報とを出力するためのオンセット検出手段と、オンセット検出手段により音源の発生が検出されたことに応答して、オンセット検出手段により発生が検出された音源の方位を、MUSIC応答算出手段により当該音源の方位に隣接する方位の各々について算出されたMUSICパワーの値と、当該音源の方位に隣接する方位の各々についてMUSICΔパワー算出手段により出力されたMUSICΔパワーとに基づいて、当該音源の消滅までトラッキングするためのトラッキング手段とを含む。【0016】  より好ましくは、音源定位装置はさらに、MUSIC応答算出手段により出力されたMUSICパワーの移動平均を複数の方位の各々に対して算出して平滑化するための平滑化手段を含む。MUSICΔパワー算出手段と、トラッキング手段はいずれも平滑化手段により平滑化されたMUSICパワーを入力として受ける。【0017】  さらに好ましくは、オンセット検出手段は、複数の方位の各々に対して、MUSICΔパワー算出手段により算出されたMUSICΔパワーの値が第1のオンセット用しきい値より大きく、かつMUSIC応答算出手段により算出されたMUSICパワーの値が第2のオンセット用しきい値より大きいか否かを判定するための第1の判定手段と、第1の判定手段による判定結果に基づいて、音源の発生を検出するための第2の判定手段とを含む。【0018】  第2の判定手段は、第1の判定手段による判定結果が肯定であった方位のうち、当該方位について算出されているMUSICパワーの上位から限定された一定個数のみを、検出された音源として特定するための音源限定手段を含んでもよい。【0019】  好ましくは、トラッキング手段は、オンセット検出手段により音源の発生が検出されたことに応答して、当該検出以後、所定時間ごとにMUSIC応答算出手段により出力されるMUSIC応答のうちで、音源の方位に隣接する方位について算出されるMUSICパワーの値の最大値を辿ることにより、発生が検出された音源の移動をトラッキングするための手段と、トラッキングするための手段によりトラッキングされた音源の方位について算出されたMUSICパワー及びMUSICΔパワーが所定の条件を充足したときに、当該音源の消滅を検出し、トラッキングするための手段によるトラッキングを中止させるための音源消滅検出手段とを含む。【0020】  より好ましくは、音源消滅検出手段は、トラッキングするための手段によりトラッキングされた音源の方位について算出されたMUSICΔパワーが第1のオフセット用しきい値より小か否かを判定するための第1のオフセット判定手段と、当該方位について算出されたMUSICパワーが当該音源の発生時のMUSICパワーよりある正の定数だけ大きな第2のオフセット用定数より大きいか否かを判定するための第2のオフセット判定手段と、第1及び第2のオフセット判定手段の判定結果のいずれかが肯定であるという結果が、MUSIC応答算出手段により所定時間ごとに算出されたMUSIC応答について所定回数(好ましくは複数回)だけ連続して得られたときに、トラッキングするための手段によりトラッキングされている音源が消滅したと判定し、トラッキングを中止させるための手段とを含む。【0021】  本願発明の第2の局面に係るコンピュータプログラムは、コンピュータにより実行されると、当該コンピュータを、上記したいずれかの音源定位装置の各手段として機能させる。【図面の簡単な説明】【0022】【図1】本発明の1実施の形態に係る音源定位処理部50を有するロボット30にマイクロホン台32を装着した状態を示す図である。【図2】マイクロホン台32の3面図である。【図3】音源定位処理部50のブロック図である。【図4】音源推定部64の機能を実現するためのコンピュータプログラムの制御構造を示すフローチャートである。【図5】オンセット検出処理を実現するコンピュータプログラムの制御構造を示すフローチャートである。【図6】トラッキング処理を実現するコンピュータプログラムの制御構造を示すフローチャートである。【図7】オフセット検出処理を実現するコンピュータプログラムの制御構造を示すフローチャートである。【図8】実施の形態に係る音源定位処理部50について、その性能を測るために行なった実験の結果を示すグラフである。【図9】実施の形態に係る音源定位処理部50について、その性能を測るために行なった実験の結果を示すグラフである。【図10】実施の形態に係る音源定位処理部50について、その性能を測るために行なった実験の結果を示すグラフである。【図11】本発明の実施の形態に係る音源定位処理部50を実現するコンピュータのブロック図である。【発明を実施するための形態】【0023】  以下の本発明の実施の形態の説明において、同一の部品には同一の参照番号を付してある。それらの機能も同一である。したがってそれらについての詳細な説明は繰返さない。【0024】  ［概要］  本実施の形態では、ロボットの頭部付近にマイクロホンアレイを配置し、これらマイクロホンアレイから得られた信号からリアルタイムで複数個の音源を定位し、それらのトラッキングを行なう。そのために、以下に説明する実施の形態の音源定位装置は、音源数を固定したMUSICアルゴリズムによりMUSIC空間スペクトルを算出し、得られたMUSIC空間スペクトルを直接に用いて音源数とその位置とを動的に推定する仕組みを採用する。【0025】  ［構成］  図1に、マイクロホンアレイをロボット30の胸部にフィットさせた状態を示す。具体的には、ロボット30の首の周囲にマイクロホンをフィットさせるためのマイクロホン台32を作成し、複数のマイクロホンMC1等をこのマイクロホン台32に固定した後にマイクロホン台32をロボット30の首の周りに固定してある。【0026】  図2に、マイクロホン台32の正面図、平面図、及び右側面図を示す。図2を参照して、マイクロホンMC1等は全部で14個だけ使用される。それらのうち9個はマイクロホン台32の前部に取付けられ、残りの5個はロボット30の首を囲む形でマイクロホン台32の上面に取付けられている。なお、14個のマイクロホンのうち、中央にあるマイクロホンMC1の出力については、後の処理で他と区別して使用する。本実施の形態では、各マイクロホンは無指向性のものを用いている。【0027】  図3は、図1に示すロボットのうち、音源定位に関係する音源定位処理部50のみを取り出してブロック図形式で示した図である。図3を参照して、音源定位処理部50は、マイクロホンMC1等を含むマイクロホンアレイ52から14個のアナログ音源信号を受け、アナログ/デジタル変換を行なって14個のデジタル音源信号を出力するA/D変換器54と、A/D変換器54から出力される14個のデジタル音源信号を受け、MUSIC法で必要とされる相関行列とその固有値及び固有ベクトルを100ミリ秒にういて1ブロックとしてブロックごとに出力するための固有ベクトル算出部60と、固有ベクトル算出部60からブロックごとに出力される固有ベクトルを使用し、MUSIC法によりMUSIC空間スペクトルを出力するMUSIC処理部62と、MUSIC処理部62が出力するMUSIC空間スペクトルに基づいて、音源数とその位置とを動的に推定してその位置(方向)を表す値(本実施の形態では、3次元極座標の内の2つの偏角φ及びθとする。付録の「MUSIC応答」を参照。)を時系列で出力する音源推定部64と、音源推定部64の出力の時系列を蓄積するためのバッファ66とを含む。なお、本明細書では、「MUSIC応答」とは、MUSICアルゴリズムにより得られるMUSIC空間スペクトルを所定の式で平均化したものである。詳細については付録の「MUSIC応答」を参照されたい。【0028】  本実施の形態では、A/D変換器54は、一般的な16kHz/16ビットで各マイクロホンの出力をA/D変換する。【0029】  固有ベクトル算出部60は、A/D変換器54の出力する14個のデジタル音源信号を4ミリ秒のフレーム長でフレーム化するためのフレーム化処理部80と、フレーム化処理部80の出力する14チャンネルのフレーム化された音源信号に対してそれぞれFFT(Fast  Fourier  Transformation)を施し、所定個数の周波数領域(以下、各周波数領域を「ビン」と呼び、周波数領域の数を「ビン数」と呼ぶ。)に変換して出力するFFT処理部82と、FFT処理部82から4ミリ秒ごとに出力される各チャネルの各ビンの値を100ミリ秒ごとにブロック化するためのブロック化処理部84と、ブロック化処理部84から出力される各ビンの値の間の相関を要素とする相関行列を所定時間ごと(100ミリ秒ごと)に算出し出力する相関行列算出部86と、相関行列算出部86から出力される相関行列を固有値分解し、固有ベクトル92をMUSIC処理部62に出力する固有値分解部88とを含む。なお本実施の形態では、音源信号の周波数成分のうち、空間的分解能が低い1kHz以下の帯域と、空間的エイリアシングが起こり得る6kHz以上の帯域を除外する。【0030】  通常、FFTでは512〜1024点を使用する(16kHzのサンプリングレートで32〜64ミリ秒に相当)が、ここでは1フレームを4ミリ秒(FFTでは64〜128点に相当)とした。このようにフレーム長を短くすることにより、FFTの計算量が少なくてすむだけでなく、後の相関行列の算出、固有値分解、及びMUSIC応答の算出における計算量も少なくて済む。その結果、性能を落とすことなく、比較的非力なコンピュータを用いても十分にリアルタイムで音源定位を行なうことができる。【0031】  MUSIC処理部62は、マイクロホンアレイ52に含まれる各マイクロホンの位置を所定の座標系を用いて表す位置ベクトルを記憶するための位置ベクトル記憶部100と、位置ベクトル記憶部100に記憶されているマイクロホンの位置ベクトル、及び固有値分解部88から出力される固有ベクトルを用いて、音源数が固定されているものとしてMUSIC法によりMUSIC空間スペクトルを算出し出力するMUSIC空間スペクトル算出部104とを含む。ブロックごとに得られる相関行列の固有値が音源数に関連することは、例えばF.アサノら、「リアルタイム音源定位及び生成システムと自動音声認識におけるその応用」、Eurospeech,2001、アールボルグ、デンマーク、2001、1013−1016頁(F.  Asano,  M.  Goto,  K.  Itou,  and  H.  Asoh,  Real-time  sound  source  localization  and  separation  system  and  its  application  on  automatic  speech  recognition,  in  Eurospeech  2001,  Aalborg,  Denmark,  2001,  pp.  1013-1016)にも記載されており、既に知られている事項である。【0032】  なお、本実施の形態では、各音源の2次元的な方位角だけでなく、仰角も推定する。そのために、MUSICアルゴリズムの3次元版(付録を参照)を実装した。方位角と仰角とのセットを、これ以降、音源方位(DOA)と呼ぶ。このアルゴリズムでは、音源までの距離は推定しない。音源方位のみを推定するようにすることで、処理時間を大幅に減少させることができる。【0033】  MUSIC処理部62はさらに、MUSIC空間スペクトル算出部104により算出されたMUSIC空間スペクトルに基づいて、MUSIC法にしたがいMUSIC応答と呼ばれる値を各方位(後述する。)について算出し出力するためのMUSIC応答算出部106を含む。【0034】  ここでいう「方位」とは、音源位置を探索するために3次元空間に定義されたメッシュの各枠のことをいう。このメッシュは、以下の実施の形態では、仰角5度の範囲で空間を輪状に区切り、仰角の大きさにより異なる数の探索点を設けた。ここでいう「探索点」とは、上記したメッシュの中央の点のことをいう。【0035】  探索点の数は、仰角が0度の輪においては隣接する探索点への方向角が5度となるように選ばれている。探索点の数は仰角が0度の輪で最大であり、仰角が大きくなるにつれて少なくなる。この際、一つの輪内の探索点の間の距離(角度と考えてもよい。)は互いに等しく、その距離(角度)は仰角が0度の輪における隣接する探索点同士の距離(角度)とできるだけ近くなるように選ばれている。【0036】  音源推定部64は、MUSIC応答算出部106により算出されたMUSIC応答のピークを、一時的に時系列に所定数だけFIFO形式で蓄積するためのバッファ108と、バッファ108に蓄積された各ブロックの各探索点のMUSIC応答について、移動平均を算出し平滑化することでノイズを除去するための平滑化フィルタ部110と、平滑化フィルタ部110の出力する各ブロックの各探索点のMUSIC応答の値に基づき、各探索点におけるMUSIC応答の、前ブロックのMUSIC応答との差(MUSICΔパワー)を算出するためのMUSICΔスペクトログラム算出部112とを含む。MUSICΔスペクトログラム算出部112は、具体的には以下のようにしてMUSICΔパワーを算出する。すなわち、探索点の各々につき、現ブロックのMUSICパワーの値と、その探索点に隣接する全ての点における、前ブロックのMUSICパワーとの間の差を取る。その差の最小値をその探索点におけるMUSICΔパワーとする。なお、ここでは、時系列として、各方位について算出されるMUSICパワーをMUSICスペクトログラムと呼び、各方位について上のように算出された値の時系列をMUSICΔスペクトログラムと呼んでいる。【0037】  音源推定部64はさらに、平滑化フィルタ部110から出力される、平滑化された各ブロックのMUSIC応答を使用して、音源が音の発生を開始した方位(音源が音声の発生活動を開始したことをオンセットと呼ぶ。)を検出する処理と、音源からの音の発生が停止した方位及び時刻(音源による音の発生の停止をオフセットと呼ぶ。)を検出する処理とを行ない、オンセット及びオフセットの発生方位を出力するためのオンセット・オフセット検出部114と、MUSICΔスペクトログラム算出部112の出力するMUSICΔパワーと、オンセット・オフセット検出部114からのオンセット検出出力及びオフセット検出出力に応答して、音源のオンセットからオフセットまでをトラッキングするためのトラッキング部118と、MUSICΔスペクトログラム算出部112、オンセット・オフセット検出部114及びトラッキング部118がそれぞれの処理に使用する、各探索点の位置、及び、各探索点に隣接する、探索対象となる探索点に関する情報を記憶するための探索点記憶部116とを含む。【0038】  なお、各音源からの音声信号のパワーを算出するに先立って、音声信号に対してチャンネル間スペクトルバイナリマスキング処理を行なう。これは、2つのチャンネル間において、パワーの大きな方の信号を残し、他方のチャンネルの信号はゼロにする、という処理である。こうすることにより、チャンネル間の干渉リークを削減することができる。また、マイクロホンアレイ52のうち、中央に位置するマイクロホンMC1からの音声信号を用い、全ての音声信号から周囲の音楽による雑音を除去する処理を行なう。【0039】  ［コンピュータによる実現］  上記した音源定位処理部50は、実際にはコンピュータハードウェアと、当該コンピュータハードウェアにより実行されるコンピュータプログラムとにより、ハードウェアとソフトウェアとの協働により実現される。以下、音源定位処理部50の中でも、本実施の形態の特徴となる音源推定部64の機能を実現するためのコンピュータプログラムの制御構造について説明する。【0040】  図4を参照して、音源推定部64の機能を実現するためのプログラムは、ロボットの電源投入後、初期化を行なうステップ130と、MUSIC応答算出部106からバッファ108を介して処理対象となるブロックのMUSIC応答を受信するステップ132と、処理対象のブロックのMUSIC応答に対する移動平均をとることにより、MUSIC応答からノイズを除去するための平滑化処理を行なうステップ134と、全ての探索点について、MUSICΔパワー(MUSICΔスペクトログラム)を算出するステップ136と、ステップ136で各方位について算出されたMUSICΔパワー、及びMUSICパワーに基づいて、音源の発生(オンセット)を検出するステップ138と、ステップ138で検出された音源をトラッキングし、処理をステップ132に戻すステップ140とを含む。なお、全ての探索点の識別子とその方位、並びにその探索点に隣接する探索点の識別子は、図3に示す探索点記憶部116に記憶されている。【0041】  既に述べたとおり、ステップ136におけるMUSICΔスペクトルの算出にあたっては、各探索点について、現ブロックのMUSICパワーと、その探索点に隣接する探索点の各々の前ブロックのMUSICパワーとの差を算出し、その中の最小値を採用することで、各探索点について、ブロックごとにMUSICΔパワーが算出される。【0042】  図5を参照して、図4のステップ138で実行されるオンセット検出処理は、トラッキングの対象となっている探索点以外の各探索点について、以下に述べるステップ162,164,166及び168を実行するステップ160を含む。【0043】  ステップ160の処理は、その探索点について図4のステップ134で算出されたMUSICΔパワーの値が1.0dBより大きいか否かを判定し、MUSICΔパワーの値が1.0dB以下の場合にはその探索点に関する処理を終了するステップ162と、ステップ162でその探索点のMUSICΔパワーの値が1.0dBより大きいと判定されたときに実行され、その探索点のMUSICパワーの値が1.8dBより大きいか否かを判定し、MUSICパワーの値が1.8dB以下の場合にはこの探索点に関する処理を終了するステップ164と、ステップ164でMUSICパワーの値が1.8dBより大きいと判定されたときに実行され、この探索点をオンセット候補として一旦その探索点の識別子を記憶するステップ166と、ステップ166に続き、この探索点のMUSICパワーをこの音源のトラッキングのオンセットMUSICパワーとして記憶してこの探索点に対する処理を終了するステップ168とを含む。なお、ステップ166では、予め準備したオンセット候補数を示す変数に1が加算される。【0044】  オンセット検出処理はさらに、ステップ160において全ての探索点についてオンセット候補か否かが判定された後に実行され、オンセット候補数が0か否かを判定し、オンセット候補数が0のときには現ブロックに対するオンセット検出処理を終了するステップ170と、ステップ170でオンセット候補数が0ではないと判定されたことに応答して実行され、オンセット候補のうち、MUSICパワーの値が最大のものからMUSICパワーの値の順番で2個までをこのブロックにおけるオンセットとして選択するステップ172と、ステップ172において選択された最大2個のオンセットの各々に対し、新たにトラッキング用のリストを準備し、各々の先頭要素にオンセットMUSICパワーなど、オンセットとなった探索点に関する情報を格納してオンセット検出処理を終了するステップ174とを含む。ここで新たに作成されたトラッキングリストの全てが、以後のトラッキングの対象となる。各トラッキングリストの先頭要素には、トラッキングの終了フラグを格納する領域が設けられ、その値が0に設定される。トラッキングの終了フラグとは、そのトラッキングリストに対応する音源のトラッキングが終了したか否かを示すフラグである。トラッキングの終了フラグは、その値が0であればそのリストに対するトラッキングが実行中であることを示し、その値が9であればそのリストに対するトラッキングが終了した(音源からの音の発生が終了した)ことを示す。【0045】  図6を参照して、図4のステップ140で実行されるトラッキング処理は、トラッキングリストの各々について、以下に説明するステップ202214を実行するステップ200を含む。【0046】  ステップ200において、各トラッキングリストについて実行される処理は、対象となるトラッキングリストについてのトラッキングの終了フラグが0か否かを判定し、終了フラグが0でないときにはこのトラッキングリストに対する処理を終了するステップ202と、ステップ202でこのトラッキングの終了フラグが0と判定されたときに実行され、トラッキングリストの末尾の探索点(前ブロックで検出された音源の方位を示す。)の周囲の探索点の全てについて、算出済のMUSICパワーを記憶装置から読出すステップ204と、読出されたMUSICパワーのうち最大のものに対応する探索点を、このトラッキングリストの末尾に追加するステップ206とを含む。【0047】  ステップ200の処理はさらに、ステップ206に続き、対象となっているトラッキングリストについてオフセット検出処理を実行するステップ208と、ステップ208に続き、オフセット検出処理によりオフセットフラグに設定された値が0か否かを判定して判定結果により制御の流れを分岐させるステップ210とを含む。オフセットフラグは、0のときこのトラッキングリストに対応する音源について、音の発生が停止したと判定されたときには9となり、それ以外のとき、すなわち引続き音源があると判定されたときには0に設定される。【0048】  ステップ200で実行される処理はさらに、ステップ210においてオフセットフラグの値が0でないと判定されたときに実行され、ステップ208のオフセット検出処理の結果、5ブロック続いてオフセットフラグが0以外の値に設定されたか否かを判定し、5ブロックに達していないときには何もせず処理対象のトラッキングリストに対する処理を終了するステップ212と、ステップ212において、5ブロック連続してこのトラッキングリストについてオフセットフラグが0でなかったと判定されたことに応答して実行され、このトラッキングリストの終了フラグをセット(終了フラグの値を9に設定)してこのトラッキングリストに対する処理を終了するステップ214とを含む。【0049】  図7を参照して、図6のステップ208で実行されるオフセット検出処理は、対象となるトラッキングリストに最後に追加された探索点(図6のステップ206)について、そのMUSICΔパワーが−1.2dBより小か否かを判定し、判定結果により制御の流れを分岐させるステップ230と、ステップ230でMUSICΔパワーが−1.2dBより小であると判定されたときに実行され、このトラッキングリストのオフセットフラグを9に設定してオフセット検出処理を終了させるステップ236とを含む。【0050】  オフセット検出処理はさらに、ステップ230においてMUSICΔパワーの値が−1.2dB以上であると判定されたときに、オフセット検出のためのしきい値θH=オンセットMUSICパワー+α(α>0)という式にしたがってオフセット検出のためのしきい値θHを算出するステップ232と、トラキングリストに最後に追加された探索点(図6のステップ206)の現ブロックのMUSICパワーが上記したしきい値θHより小さいか否かを判定し、もしも判定結果が肯定であれば制御をステップ236に進めるステップ234と、ステップ234での判定が否定であるときに、このトラッキングリストのオフセットフラグを0に設定してオフセット検出処理を終了するステップ238とを含む。【0051】  後述するように、オフセット検出において、トラッキング中の音源のMUSICパワーがオンセット時のパワーよりも小さくなったときではなく、オンセット時のパワー+αよりも小さくなったときに強制的にオフセットとすることにより、音源のトラッキングの精度が高くなるという効果が得られる。【0052】  ［動作］  上記実施の形態に係る音源定位処理部50は以下のように動作する。マイクロホンアレイが図1及び図2に示すようにマイクロホン台32を用いてロボット30に装着されるものとする。【0053】  マイクロホンアレイ52は音源からの音声を14個のアナログ電気信号に変換し、A/D変換器54に与える。A/D変換器54は16kHzでこれら信号を16ビットのデジタル信号化し、14個のデジタル信号をフレーム化処理部80に与える。【0054】  フレーム化処理部80は、4ミリ秒のフレーム長でこれら各チャンネルのデジタル音源信号をフレーム化し、FFT処理部82に与える。FFT処理部82は、各チャンネルの各フレームのデジタル音源信号に対してFFTを施し、各周波数成分の出力に変換してブロック化処理部84に与える。この間、音声信号に対して前述のチャンネル間スペクトルバイナリマスキング処理、及び中央に位置するマイクロホンMC1からの音声信号を用い、全ての音声信号から周囲の音楽による雑音を除去する処理を行なう。【0055】  ブロック化処理部84は、FFT処理部82から4ミリ秒ごとに出力される信号を100ミリ秒ごとにブロック化し、相関行列算出部86に与える。相関行列算出部86はこれら各ブロックについて、チャンネル毎の相関行列を算出し、固有値分解部88に与える。固有値分解部88は、相関行列算出部86により算出された相関行列に固有値分解を施し、MUSIC空間スペクトル算出部104に与える。【0056】  MUSIC空間スペクトル算出部104以下の処理は通常のMUSIC法の処理を3次元化したものである。まずMUSIC空間スペクトル算出部104は、位置ベクトル記憶部100に記憶された位置ベクトルと、固有値分解部88から出力される固有ベクトル92とに基づき、音源数が固定したものとしてMUSIC空間スペクトルを100ミリ秒ごとに算出しMUSIC応答算出部106に与える。MUSIC応答算出部106はMUSIC空間スペクトルに基づき、100ミリ秒ごとにMUSIC応答を算出しバッファ108に記憶させる。【0057】  バッファ108は、MUSIC応答算出部106から出力されるMUSIC応答を時系列で、FIFO形式で所定数だけ蓄積する。【0058】  平滑化フィルタ部110は、バッファ108に記憶された各ブロックのMUSIC応答を読出し(図4のステップ132)、そのブロックのMUSIC応答について、所定ブロックにわたる移動平均をとり、平滑化されたMUSICパワーをMUSICΔスペクトログラム算出部112及びオンセット・オフセット検出部114に与える。【0059】  MUSICΔスペクトログラム算出部112は、ブロックデータを受信すると(図4のステップ132)、各探索点について、現ブロックのMUSICパワーと、その探索点に隣接する探索点の各々の前ブロックのMUSICパワーとの差を算出し、その中の最小値を採用することで、各探索点について、ブロックごとにMUSICΔパワーを算出し(図4のステップ134)トラッキング部118に与える。オンセット・オフセット検出部114は、既に述べた構造のプログラム(図5及び図7)により実現され、平滑化フィルタ部110から出力される平滑化後のMUSICパワー及びMUSICΔパワーに基づいて、各ブロックにおいて音源のオンセット又はオフセットがあればそれらを検出し、トラッキング部118に与える。オンセット検出時にはその方位(探索点)も検出され、トラッキング部118に与えられる。【0060】  具体的には、オンセットの検出においては、図5のステップ162及び164により示されるように、各ブロックについて、MUSICΔパワーが1.0dBより大きく、かつMUSICパワーが1.8dBより大きい探索点がオンセット候補となる。図5のステップ170−174により示されるように、各ブロックについてオンセット候補があるときには、上位から2個までがオンセットとして検出される。【0061】  オフセットの検出では、図7のステップ230234により示されるように、トラッキングされた最後の探索点について、そのMUSICΔパワーが−1.2dBより小さいときにはオフセットと判定されるが、それ以外にもMUSICパワーがその音源のオンセットMUSICパワー+αよりも小さくなったときにも強制的にオフセットと判定する。【0062】  トラッキング部118は、オンセット・オフセット検出部114からオンセット検出信号が与えられると、音源のトラッキングを開始する。具体的には、トラッキング部118は、オンセット検出後、その音源位置の探索点に隣接する探索点のうち、MUSICパワーが最大の探索点をトラッキングし(図6のステップ204ステップ206)、オフセットが検出された時点でトラッキングを終了する。ただし、本実施の形態では、オフセットが発生した後、4ブロックまではトラッキングを継続し、5ブロック経過後もオンセット条件を満たす探索点がトラッキング方向に生じないときに初めてトラッキングを終了する(図6のステップ210,212及び214)。【0063】  トラッキング部118によってトラッキングされた音源方位はバッファ66にブロックごとに蓄積される。【0064】  以上のような動作によって、音源定位処理部50は継続的に複数個の音源の定位とトラッキングとを行なうことができる。【0065】  図8−図10に、上記実施の形態に係る音源定位処理部50について、その性能を測るために行なった実験の結果を示す。この実験では、音源(Directions  Of  Arrival)定位の性能を測るために、以下の値を用いる。第1はDOA精度、第2はDOA挿入率である。DOA精度とは、上記した装置により、正しいDOAが検出された率のことである。DOA精度は高い方が好ましい。DOA挿入率とは、正しいDOAの数と比較して、ブロック当たりで余分に検出された音源数の平均値のことをいう。DOA挿入率は低い方が好ましい。【0066】  正しいDOAとしては、音源信号から得られた音源の活動を示す情報から、正しい音源数を使用して得られたDOAを用いた。各音源が活動している間の、DOAの予測位置から得られる軌跡を区分線形近似で近似した。音源が移動しているか否かをチェックするため、ビデオ映像も利用した。【0067】  実験では、2つの異なった環境(OFC、UCW。これらについては後述する。)において、ヒューマノイド型ロボットに実装された音源定位処理部50によるDOA予測を行ない、そのDOA精度とDOA挿入率とを求めた。図8−図10はその結果を示している。これら環境は実験のための音声を収録した環境であり、具体的には以下のとおりである。【0068】  すなわち、マイクロホンアレイによるデータ収録を2つの異なった環境で行なった。1つ目はオフィス環境(Office  Environment:OFC)で、室内のエアコンとロボットの内部雑音が主な雑音源となる。2つ目の環境は、実験を行なった野外のショッピングモールの通路(Universal  City  Walk  Osaka:UCW)である。UCWでの主な雑音源は、天井に設置されているスピーカから流れてくるポップ・ロックミュージックである。通路内のさまざまな位置およびさまざまな向きにロボットを配置して実験用データ及び画像の収録を行なった。なお、図8−図10において「OFC3」など、「OFC」又は「UCW」の後に付加されている数字は、録音の順番を示す。【0069】  OFCでは、4つの参加者(4人の男性)を音源として用いた。最初に各参加者が1人ずつロボットに対して約10秒間話しかけた。この間、他の参加者は静かにしていた。収録の最後の15秒間では、4人の参加者が同時に発話した。録音時、各参加者はそれぞれ別々の音声キャプチャ装置に接続されたマイクロホンを着用していた。録音開始時の一時的な音を用いて、これら参加者の発話を録音したものとマイクロホンアレイ52からの音声信号の録音とを人手により同期させた。【0070】  UCWでは、全ての録音には2人の参加者(いずれも男性)を音源として用いた。実験では、いずれの場合も、最初に各参加者が10秒程度順番に別々に話し、最後に同時に発話を行なった。UCW7及びUCW8では1人の参加者が移動、別の参加者が静止しながら、ほぼ全ての時間にわたり2人が共に発話していた。UCW1−4及びUCW9では、ロボットは天井のスピーカから遠く離れた位置に配置された。UCW5−8では、ロボットをスピーカの近く(数メートル)に配置した。UCW10−13では、ロボットをスピーカの直下に配置した。【0071】  全ての試行において、ロボットを様々な方向に向け、音源を様々な位置に配置してデータの取得を行なった。【0072】  図8は、OFC及びUWC環境において、音源定位に関するパラメータのいくつかを変えて行なった試行でのDOA予測の性能(精度及び挿入率)を示す。変更されたパラメータは、平滑化フィルタ部110の有無、オフセット検出時のしきい値θTHに加算される値αの有無、ブロック当たりのオンセット数の制限の有無、及びトラッキングの前後、である。【0073】  MUSICスペクトログラムの算出で使用したパラメータの値は以下のとおりである。すなわち、NFFT(FFT長)=64、周波数範囲=1−6kHz、MUSIC空間スペクトル算出部104における固定音源数=2、である。NFFTの値を大きくすると性能は多少高くなるが、NFFT=64とすると動作クロック周波数2GHz程度の市販のCPUを使用してもリアルタイムで動作できるため、この値を使用した。【0074】  図8の左側に、各実験条件とOFC及びUCWの各々とにおける、音源に関する平均のDOA精度を示し、図9の中央にDOA挿入率を示した。【0075】  これらのグラフから、「αなし」とした場合のDOA精度が最も高いことが分かる。しかしこの場合にはまた、DOA挿入率が最も悪い。「平滑化なし」、「オンセット数制限なし」、及び「トラッキング前」について得られたDOA精度は互いによく似ている。しかし、「トラッキング前」ではDOA挿入率が低下していることが明確に見て取れる。これは、平滑化及び1ブロック当たりのオンセット数の制限が有効であることを示している。「トラッキング前」及び「トラッキング後」を比較すると、UCW3−6及びUCW10−11においてDOA精度にやや改善が見られるのに対し、UCW8−9ではDOA挿入率に非常に小さな改善しか見られないことが分かる。【0076】  環境音楽についてのDOA精度の結果を、図8の右側に示す。この結果によれば、UCW1−4及びUCW7−9においてDOA精度が低いことが分かる。これはロボットがスピーカから比較的遠くに配置されていたためであろう。UCW10−13ではDOA精度は100%に近い。これらの実験条件では、ロボットがスピーカの直下に配置されていて、背景音楽が明確に指向性を持った音源として検知されたためである。これに対し、ロボットがスピーカにほど近い位置に置かれたUCW5−6では、DOA精度は中間の値となっている。【0077】  各音源についての性能を検討すると、図9から、OFC2の第2及び第4の音源、UCW9の1番目の音源、及びUCW12の2番目の音源のDOA精度が低くなっている。これらの環境では、音源からの音声がロボットの背後にあったため、ロボットの前方からの音声では、パワー及び指向性の双方ともが低かったためと思われる。【0078】  上記実施の形態に係る音源定位処理部50によれば、MUSIC応答の生データを用いて音源定位を行なっている。実験結果からも明らかなように、このような処理により、高い精度で音源数を予測し、トラッキングすることができる。また、オフセット検出のためのしきい値として、オンセット時のMUSICパワーの値にαを加算することで、オンセット時のMUSICパワーよりMUSICパワーが多少高くても、オフセットを検出したものと見なすことができ、その結果、DOAの後挿入の頻度を下げることができる。その結果、MUSIC法による音源定位を安定して精度高く行なうことができる。背景雑音の発生源が音源定位処理部50のすぐ近くにあるような場合には、精度は低下するが、実際のロボットの実装では、音声だけではなく画像を使用して音源が対話相手か否かを予測することもでき、精度の低下を防止することが期待できる。【0079】  さらに、本実施の形態では3次元MUSIC法を用いているため、方位角だけではなく、ある範囲で仰角を含めて音源方位を推定することができる。そのため、実環境でさまざまな方向から音声を受ける環境でもロボットなどが正しく音源を定位して適切な動作を行なうことが可能になる。ロボットが人間とのインタラクションを行なう場合でも、相手の顔を見つめながら適切な動作を行なうことが期待でき、ロボットと人間とのインタラクションをよりスムーズなものとすることができる。［コンピュータによる実現］  この実施の形態に係る音源定位処理部50は、コンピュータハードウェアと、そのコンピュータハードウェアにより実行されるプログラムと、コンピュータハードウェアに格納されるデータとにより実現することができる。図11はこのコンピュータシステム330の内部構成を示す。【0080】  図11を参照して、このコンピュータシステム330は、リムーバブルメモリの着脱部であるメモリポート370およびDVD(Digital  Versatile  Disc)ドライブ364を有するコンピュータ340と、キーボード346と、マウス348と、モニタ342とを含む。【0081】  コンピュータ340は、メモリポート370およびDVDドライブ364に加えて、CPU(中央処理装置)356と、CPU356、メモリポート370およびDVDドライブ364が接続されたバス366と、バス366に接続され、ブートアッププログラム等を記憶する読出専用メモリ(ROM)358と、バス366に接続され、プログラム命令、システムプログラム、および作業データ等を一時的に記憶するランダムアクセスメモリ(RAM)360と、バス366に接続され、大量のデータを記憶する不揮発性記憶装置であるハードディスク362と、バス366に接続され、A/D変換器54からの出力を受ける入出力インタフェース(I/F)368と、無線によりローカルエリアネットワーク(LAN)への接続を提供する無線ネットワークI/F372とを含む。【0082】  コンピュータシステム330に音源定位処理部50として機能させるためのコンピュータプログラムは、DVDドライブ364またはメモリポート370に挿入されるDVD390またはリムーバブルメモリ392に記憶され、さらにハードディスク362に転送される。または、プログラムは図示しないネットワークを通じてコンピュータ340に送信されハードディスク362に記憶されてもよい。プログラムは実行の際にRAM360にロードされる。DVD390から、リムーバブルメモリ392から、またはネットワークを介して、直接にRAM360にプログラムをロードしてもよい。【0083】  このプログラムは、コンピュータ340にこの実施の形態の音源定位処理部50として動作を行なわせる複数の命令を含む。この動作を行なわせるのに必要な基本的機能のいくつかはコンピュータ340上でオペレーティングシステム(OS)が動作しているときにはOSにより提供されることもある。それら機能はサードパーティのプログラム、またはコンピュータ340にインストールされる各種ツールキットのモジュールにより提供されることもある。従って、このプログラムはこの実施の形態のシステムおよび方法を実現するのに必要な機能全てを必ずしも含まなくてよい。このプログラムは、命令のうち、所望の結果が得られるように制御されたやり方で適切な機能または「ツール」を呼出すことにより、上記した音源定位処理部50としての動作を実行する命令のみを含んでいればよい。コンピュータシステム330の動作は周知であるので、ここでは繰返さない。【0084】  今回開示された実施の形態は単に例示であって、本発明が上記した実施の形態のみに制限されるわけではない。本発明の範囲は、発明の詳細な説明の記載を参酌した上で、特許請求の範囲の各請求項によって示され、そこに記載された文言と均等の意味および範囲内でのすべての変更を含む。【0085】  ［付録:MUSIC法］  M個のマイク入力のフーリエ変換Xm(k、t)は、式(1)のようにモデル化される。【0086】【数1】ただし、ベクトルs(k、t)はN個の音源のスペクトルSn(k,t)から成る:s(k、t)=［S1(k,t),…,SN(k、t)］T。kとtはそれぞれ周波数と時間フレームのインデックスを示す。ベクトルn(k、t)は背景雑音を示す。行列Akは変換関数行列であり、その(m、n)要素はn番目の音源から、m番目のマイクロホンへの直接パスの変換関数である。Akのn列目のベクトルをn番目の音源の位置ベクトル(Steering  Vector)と呼ぶ。【0087】  まず、式(2)で定義される空間相関行列Rkを求め、式(3)に示すRkの固有値分解により、固有値の対角行列Λk及び固有ベクトルから成るEkが求められる。【0088】【数2】固有ベクトルはEk=［Eks｜Ekn］のように分割出来る。EksとEknとはそれぞれ支配的なN個の固有値に対応する固有ベクトルと、それ以外の固有ベクトルとを示す。【0089】  MUSIC空間スペクトルは式(4)と(5)とで求める。rは距離、θとφとはそれぞれ方位角と仰角とを示す。式(5)は、スキャンされる点(r、θ、φ)における正規化した位置ベクトルである。【0090】【数3】空間スペクトル(本明細書では「MUSIC応答」と呼ぶ。)は、MUSIC空間スペクトルを式(6)のように平均化したものである。【0091】【数4】式(6)においてkL及びkHは、それぞれ周波数帯域の下位と上位の境界のインデックスであり、K=kH−kL+1。音源の方位は、MUSIC応答のピークから求められる。【符号の説明】【0092】30  ロボット32  マイクロホン台50  音源定位処理部52  マイクロホンアレイ60  固有ベクトル算出部62  MUSIC処理部64  音源推定部86  相関行列算出部88  固有値分解部104  MUSIC空間スペクトル算出部106  MUSIC応答算出部110  平滑化フィルタ部112  MUSICΔスペクトログラム算出部114  オンセット・オフセット検出部118  トラッキング部
【特許請求の範囲】【請求項1】  マイクロホンアレイの出力から得られる複数チャンネルの音源信号の各々と、前記マイクロホンアレイに含まれる各マイクロホンの間の位置関係とに基づいて、前記マイクロホンアレイの位置に関連して定められる点を中心とする3次元空間内で定義された複数の方位の各々について、MUSICアルゴリズムにより、所定時間ごとにMUSICパワーを算出するためのMUSIC応答算出手段と、  前記複数の方位の各々について、前記MUSIC応答算出手段により時系列として得られたMUSICパワーの値の強度及びその変化量に基づいて、音源の発生から消滅までの音源の方位の変化を検出するための音源推定手段とを含む、音源定位装置。【請求項2】  前記音源推定手段は、  前記複数の方位の各々に対して、前記複数の方位の内で、処理対象となっている方位に隣接する方位の各々に関して直前に前記MUSIC応答算出手段により算出されたMUSICパワーの値と、当該処理対象となっている方位に関して得られた最新のMUSICパワーの値との差を算出し、その差のうちで所定の条件を充足する値を当該方位についてのMUSICΔパワーとして出力するためのMUSICΔパワー算出手段と、  前記複数の方位の各々に対して、当該方位について前記MUSIC応答算出手段により算出されたMUSICパワーの値と、当該方位について前記MUSICΔパワー算出手段により出力されたMUSICΔパワーとに基づいて、音源の発生があったか否かを検出し、音源の発生の検出に応答して、音源発生を示す情報とその方位を示す情報とを出力するためのオンセット検出手段と、  前記オンセット検出手段により音源の発生が検出されたことに応答して、前記オンセット検出手段により発生が検出された音源の方位を、前記MUSIC応答算出手段により当該音源の方位に隣接する方位の各々について算出されたMUSICパワーの値と、当該音源の方位に隣接する方位の各々について前記MUSICΔパワー算出手段により出力されたMUSICΔパワーとに基づいて、当該音源の消滅までトラッキングするためのトラッキング手段とを含む、請求項1に記載の音源定位装置。【請求項3】  さらに、前記MUSIC応答算出手段により出力されたMUSICパワーの移動平均を前記複数の方位の各々に対して算出して平滑化するための平滑化手段を含み、  前記MUSICΔパワー算出手段と、前記トラッキング手段はいずれも前記平滑化手段により平滑化されたMUSICパワーを入力として受ける、請求項2に記載の音源定位装置。【請求項4】  前記オンセット検出手段は、  前記複数の方位の各々に対して、前記MUSICΔパワー算出手段により算出されたMUSICΔパワーの値が第1のオンセット用しきい値より大きく、かつ前記MUSIC応答算出手段により算出されたMUSICパワーの値が第2のオンセット用しきい値より大きいか否かを判定するための第1の判定手段と、  前記第1の判定手段による判定結果に基づいて、音源の発生を検出するための第2の判定手段とを含む、請求項2又は請求項3に記載の音源定位装置。【請求項5】  前記第2の判定手段は、  前記第1の判定手段による判定結果が肯定であった方位のうち、当該方位について算出されているMUSICパワーの上位から限定された一定個数のみを、検出された音源として特定するための音源限定手段を含む、請求項4に記載の音源定位装置。【請求項6】  前記トラッキング手段は、  前記オンセット検出手段により音源の発生が検出されたことに応答して、当該検出以後、前記所定時間ごとに前記MUSIC応答算出手段により出力されるMUSIC応答のうちで、音源の方位に隣接する方位について算出されるMUSICパワーの値の最大値を辿ることにより、発生が検出された音源の移動をトラッキングするための手段と、  前記トラッキングするための手段によりトラッキングされた音源の方位について算出されたMUSICパワー及びMUSICΔパワーが所定の条件を充足したときに、当該音源の消滅を検出し、前記トラッキングするための手段によるトラッキングを中止させるための音源消滅検出手段とを含む、請求項2〜請求項5のいずれかに記載の音源定位装置。【請求項7】  前記音源消滅検出手段は、  前記トラッキングするための手段によりトラッキングされた音源の方位について算出されたMUSICΔパワーが第1のオフセット用しきい値より小か否かを判定するための第1のオフセット判定手段と、  当該方位について算出されたMUSICパワーが当該音源の発生時のMUSICパワーよりある正の定数だけ大きな第2のオフセット用定数より大きいか否かを判定するための第2のオフセット判定手段と、  前記第1及び第2のオフセット判定手段の判定結果のいずれかが肯定であるという結果が、前記MUSIC応答算出手段により所定時間ごとに算出されたMUSIC応答について所定回数だけ連続して得られたときに、前記トラッキングするための手段によりトラッキングされている音源が消滅したと判定し、トラッキングを中止させるための手段とを含む、請求項6に記載の音源定位装置。【請求項8】  前記所定回数は複数回である、請求項7に記載の音源定位装置。【請求項9】  コンピュータにより実行されると、当該コンピュータを、請求項1−請求項8のいずれかに記載の各手段として機能させる、コンピュータプログラム。
音源定位装置及びコンピュータプログラム
