unireplaceとは
unify 
環境ツール第4弾は、テキスト置換ツールです。
ただ置換ができるだけなら、unigrep 
に置換モードをつければ済みそうですよね。
いままで、仕事で複数のファイルを置換するケースに遭遇しましたが、これが一番というツールには出会えませんでした。
そこで、コマンドラインツールを自作していたのですが、今回は、誰でも使えるように簡単なツールにしてみました。
unigrep 
と unitext 
を合体させて、複数ファイルを対象とした、複数キーワードで一度に置換ができるツールです。
いざ使うという時に、コマンドラインの使い方を調べなくても直感で使えます。きっと便利になりますよ。
unireplaceの特徴
・常に正規表現モード。
・文字コードを自動判別して、いろんな文字コードのファイルがあるフォルダを指定しても、検索置換できます。
・置換シミュレーションと検索位置プレビュー機能がとても便利です。
・unitext 
エディタを内蔵していますので、プレビューウインドウでも修正可能です。
・検索キーワードが色分けされます。置換結果が一目瞭然です。
・背景色やフォントなどのカスタマイズが行えます。
・unifiler 
と一緒に使うとさらに便利になります。
・Windows と 
Linuxで動きます。
動作画面
左の部分に/検索文字列/置換文字列/のパターンを編集して、検索開始ボタンを押します。
sed のパターンファイルの 
s/検索文字列/置換文字列/g 
のままでも修正なしで使えます。
置換シミュレーションを開始します。
途中で中止する場合は、中止ボタンかESCキーを押してください。
パターン編集ウインドウでは、unitext 
と同じ機能が使えます。
置換パターン入力ウインドウで、Ctrl+K で検索パスマスク入力欄にカーソルを飛ばします。
また、検索パスマスク入力欄で、Ctrl+K 
で置換パターン入力ウインドウにカーソルを飛ばします。
さらに、検索パスマスク入力欄で、Enter 
で検索開始します。
右側の正規表現サンプルウインドウには、unireplace/regexpmemo.html 
を表示します。
右側ウインドウを修正しても、自動で上書きされます。
正規表現メモとして、自分で修正してみてください。
こんなメモは表示させたくない場合は、unireplace/regexpmemo.html 
を削除してください。
置換シミュレーション結果が unigrep 
の結果と同じように表示されますが、2行ペアで表示されます。
上の(行番号:桁位置:)がある行が、検索前の状態です。
下の行は、置換後のシミュレーション結果が表示されます。行番号:桁位置は空白になります。
検索キーワードが目立つ色で色分けされますので、とても分かりやすいと思います。
置換したくない行は、行削除で削除してください。置換しなくなります。
残った行番号を見て置換しますので、1つの置換後にそれ以降の行の行番号が変わってしまうような置換では、
それ以降の行番号が狂うので置換しない可能性があります。偶然行番号が同じ行で検索文字列が存在したら、
置換してしますので、注意してください。置換後文字列に\nを含まないようにしてください。
カーソルを動かすと、下のプレビューウインドウに該当行が表示されます。
下のプレビューウインドウは、unitext 
と同じものですので、そのまま編集可能です。
置換ではできないような修正が発見された場合は、ここで修正保存できます。
置換実行ボタンを押すと、実際の置換が実行されます。
置換シミュレーションウインドウに残っている行だけ、置換が実行されます。
ファイルは必ずバックアップが残りますので、心配しないでください。
オプションの設定でバックアップ履歴を残すこともできますし、バックアップファイルは他のフォルダに集める
こともできます。
私の考えでは、バックアップフォルダに集めて、バックアップ履歴は残す設定がベストだと思います。
オプション設定
フォント
入力ウィンドウのフォントは、全ウインドウのフォントです。メインウインドウは起動後に有効になります。
エディタウィンドウのフォントは、固定幅フォントを指定してください。
カーソル位置がずれると正しく動いているか分からなくなります。 
固定幅フォントは、MSゴシック(ubuntu:Takaoゴシック)とかです。
きれいな固定幅フォントには、IPAゴシック や メイリオコンソール等があります。
ネットで入手してフォントのインストールをするだけで使えるようになります。
ユニコードを表示する場合は、フォントによっては、\(半角)記号が¥(全角)になって
表示されるフォントがあります。
新バージョンのフォントでは修正されている場合もありますので、最新版フォントを使うようにしてください。
カーソルライン背景色を表示する
見にくい場合は、チェックしないでください。
行番号を表示する
チェックしない場合は、行番号を表示しなくなります。
カーソル位置のユニコードを表示する
下のステータスバーにカーソル位置のユニコードを表示します。
Shift-Jisの場合は、Shift-Jisコードを表示すべきですが、まだ作っていません。
Qtライブラリは、内部が全てユニコードになっています。
集団編集時は改行以降に挿入しない
集団編集モードの時、改行よりも後ろにカーソル位置がある行では、打った文字が挿入されなくなります。
この例では、xxxxxxxx 
を入力しています。入力位置より改行位置が前の行には、xxxxxxxxは挿入されてません。
チェックをはずすと、空行でも、そのカーソル位置に挿入されます。
範囲の全行にxxxxxxxxが入力されています。
行番号位置を位置を記憶して再現する
ファイルを開いて、閉じた時に最後のカーソル位置記憶します。
次に同じファイルを開いた時に、カーソル位置を復元します。
最大数は、記憶する最大のファイル数です。初期値は100ファイルまで記憶します。
スクロール時にカーソルをセンターにする
カーソル移動でスクロールした場合に、カーソル位置をセンタリングして画面の中央になる
様に、スクロールします。これは、人によって好みが分かれるかも知れません。
改行時に字下げする
改行すると前の行のスペース、タブを複写して、字下げ位置を揃えます。
Shift+Enter 
の前行挿入でも同じ仕様になります。 
文字コード自動判別
対応している文字コードは、以下のコードです。
・ Shift-JIS
・ EUC-JP
・ ISO-2022-JP
・UTF-8   
・UTF-16BE
・UTF-16LE
・UTF-32BE
・UTF-32LE
UNICODEMAP_JP=cp932を内部で設定しています。
著作権等
このソフトはフリーソフトです。 
Qtライブラリの使用について
QtライブラリのLGPL版を使用して開発しました。全てライブラリは動的リンクを採用しています。
リーバースエンジニアリングを禁止しません。どうぞご自由に行ってください。
QtライブラリLGPL版は以下のサイトからダウンロードできます。
http://qt.digia.com/
アイコンライブラリの使用について
このソフトで使ったアイコンは、http://commons.wikimedia.org/wiki/Crystal_Clear のアイコンを利用させて
もらっています。とてもきれいなアイコンをLGPLライセンスで提供されています。
免責事項
このソフトを利用したことによるいかなる損害にも作者は責任を負えないことをお断りいたします。
自己責任の上で使用して下さい。大切なファイルはバックアップを取るように心がけてください。
それでは、このソフトがあなたのお役にたてば、幸いです。      m.osako
ホームページアドレス:http://uilabo.sakura.ne.jp/
unireplace
