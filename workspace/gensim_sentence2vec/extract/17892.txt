
iptables [-t table] -[AD] 
チェイン ルールの詳細 [オプション]
iptables [-t table] -I 
チェイン [ルール番号] ルールの詳細 [オプション]
iptables [-t table] -R 
チェイン ルール番号 ルールの詳細 [オプション]
iptables [-t table] -D 
チェイン ルール番号 [オプション]
iptables [-t table] -[LFZ] 
[チェイン] [オプション]
iptables [-t table] -N 
チェイン
iptables [-t table] -X 
[チェイン]
iptables [-t table] -P 
チェイン ターゲット [オプション]
iptables [-t table] -E 
旧チェイン名 新チェイン名
iptables
は Linux カーネルの IP パケットフィルタルールのテーブルを
設定・管理・検査するために使われる。
複数の異なるテーブルを定義できる。
各テーブルにはたくさんの組み込み済みチェインが含まれており、
さらにユーザー定義のチェインを加えることもできる。
各チェインは、パケット群にマッチするルールのリストである。
各ルールはマッチしたパケットに対して何をするかを指定する。
これは「ターゲット」と呼ばれ、
同じテーブル内のユーザー定義チェインにジャンプすることもできる。
ひとつのファイアウォールルールでは、
パケットを判断する基準とターゲットとが指定される。
パケットがマッチしない場合、チェイン内の次のルールが評価される。
パケットがマッチした場合、
ターゲットの値が次のルールを指定する。
ターゲットの値は、ユーザー定義チェインの名前、または特別な値
ACCEPT
,
DROP
,
QUEUE
,
RETURN
のうちの 1 つである。
ACCEPT
はパケットを通すという意味である。
DROP
はパケットを床に落す (捨てる) という意味である。
QUEUE
はパケットをユーザー空間に渡すという意味である
(カーネルがサポートしていればであるが)。
RETURN
は、このチェインの検討を中止して、
以前の (呼び出し元) チェイン内の
次のルールから検討を再開するという意味である。
組み込み済みチェインの最後に到達した場合、
または組み込み済みチェインでターゲット
RETURN
を持つルールにマッチした場合、
チェインポリシーで指定されたターゲットが
パケットの行方を決定する。
現在のところ 3 つの独立なテーブルが存在する
(ある時点でどのテーブルが存在するかは、
カーネルの設定やどういったモジュールが存在するかに依存する)。
-t, --table 
table
このオプションは、このコマンドを適用する
パケットマッチングテーブルを指定する。
カーネルに自動モジュールローディングが設定されている場合、
そのテーブルに対する適切なモジュールがまだロードされていなければ、
そのモジュールがロードされる。
テーブルは以下の通りである。
filter
:
(-t オプションが渡されなければ) これがデフォルトのテーブルである。
これには
INPUT
(マシン自体に入ってくるパケットに対するチェイン)・
FORWARD
(マシンを経由するパケットに対するチェイン)・
OUTPUT
(ローカルマシンで生成されたパケットに対するチェイン)
という組み込み済みチェインが含まれる。
nat
:
このテーブルは新しい接続を開くようなパケットに対して参照される。
これには
PREROUTING
(パケットが入ってきた場合、すぐにそのパケットを変換するためのチェイン)・
OUTPUT
(ローカルで生成されたパケットをルーティングの前に変換するためのチェイン)・
POSTROUTING
(パケットが出て行くときに変換するためのチェイン)
という 3 つの組み込み済みチェインが含まれる。
mangle
:
このテーブルは特別なパケット変換に使われる。
これには、カーネル 2.4.17 までは
PREROUTING
(パケットが入ってきた場合、すぐにそのパケットを変換するためのチェイン)・
OUTPUT
(ローカルで生成されたパケットをルーティングの前に変換するためのチェイン)
という 2 つの組み込み済みチェインが含まれる。
カーネル 2.4.18 からは、これらの他に
INPUT
(マシン自体に入ってくるパケットに対するチェイン)・
FORWARD
(マシンを経由するパケットに対するチェイン)・
POSTROUTING
(パケットが出て行くときに変換するためのチェイン)
という 3 つの組み込み済みチェインも含まれる。
これらのオプションは、実行する特定の動作を指定する。
以下の説明で注記されていない限り、
コマンドラインで指定できるのはこの中の 1 つだけである。
長いバージョンのコマンド名とオプション名は、
iptables
が他のコマンド名やオプション名と区別できる範囲で
(文字を省略して) 指定することもできる。
-A, --append 
チェイン ルールの詳細
選択されたチェインの最後に 1 つ以上のルールを追加する。
送信元や送信先の名前が 1 つ以上のアドレスに解決された場合は、
可能なアドレスの組合せそれぞれに対してルールが追加される。
-D, --delete 
チェイン ルールの詳細
-D, --delete 
チェイン ルール番号
選択されたチェインから 1 つ以上のルールを削除する。
このコマンドには 2 つの使い方がある:
チェインの中の番号 (最初のルールを 1 とする) を指定する場合と、
マッチするルールを指定する場合である。
-I, --insert
チェイン
[ルール番号
] ルールの詳細
選択されたチェインにルール番号を指定して 1 つ以上のルールを挿入する。
ルール番号が 1 の場合、ルールはチェインの先頭に挿入される。
これはルール番号が指定されない場合のデフォルトでもある。
-R, --replace 
チェイン ルール番号 ルールの詳細
選択されたチェインでルールを置換する。
送信元や送信先の名前が 1 つ以上のアドレスに解決された場合は、
このコマンドは失敗する。ルール番号は 1 からはじまる。
-L, --list
[チェイン
]
選択されたチェインにある全てのルールを一覧表示する。
チェインが指定されない場合、全てのチェインにあるリストが一覧表示される。
他の各 iptables コマンドと同様に、指定されたテーブル
(デフォルトは filter) に対して作用する。
よって NAT ルールを表示するには以下のようにする。
iptables -t nat -n -L
DNSの逆引きを避けるために、よく
-n
オプションと共に使用される。
-Z
(ゼロ化) オプションを同時に指定することもできる。
この場合、チェインは要素毎にリストされて、
(訳註: パケットカウンタとバイトカウンタが) ゼロにされる。
出力表示は同時に与えられた他の引き数に影響される。
iptables -L -v
を使わない限り (訳注: -v オプションを指定しない限り)、
実際のルールそのものは表示されない。
-F, --flush 
[チェイン
]
選択されたチェイン(何も指定しなければテーブル内の全てのチェイン)
の内容を全消去する。
これは全てのルールを 1 個ずつ削除するのと同じである。
-Z, --zero 
[チェイン
]
すべてのチェインのパケットカウンタとバイトカウンタをゼロにする。
クリアされる直前のカウンタを見るために、
"-L, --list"
(一覧表示) オプションと同時に指定することもできる (上記を参照)。
-N, --new-chain 
チェイン
指定した名前でユーザー定義チェインを作成する。
同じ名前のターゲットが既に存在してはならない。
-X, --delete-chain 
[チェイン
]
指定したユーザー定義チェインを削除する。
そのチェインが参照されていてはならない。
チェインを削除する前に、そのチェインを参照しているルールを
削除するか置き換えるかしなければならない。
引き数が与えられない場合、テーブルにあるチェインのうち
組み込み済みチェインでないものを全て削除する。
-P, --policy 
チェイン ターゲット
チェインのポリシーを、指定したターゲットに設定する。
指定可能なターゲットは「ターゲット
」の章を参照すること。
(ユーザー定義ではない)組み込み済みチェインにしかポリシーは設定できない。
また、組み込み済みチェインもユーザー定義チェインも
ポリシーのターゲットに設定することはできない。
-E, --rename-chain 
旧チェイン名 新チェイン名
ユーザー定義チェインを指定した名前に変更する。
これは見た目だけの変更なので、テーブルの構造には何も影響しない。
-h
ヘルプ。
(今のところはとても簡単な) コマンド書式の説明を表示する。
以下のパラメータは (add, delete, insert,
replace, append コマンドで用いられて) ルールの仕様を決める。
-p, --protocol 
[[] protocol
ルールで使われるプロトコル、またはチェックされるパケットのプロトコル。
指定できるプロトコルは、
tcp
,
udp
,
icmp
,
all
のいずれか 1 つか、数値である。
数値には、これらのプロトコルのどれかないし別のプロトコルを表す
数値を指定することができる。
/etc/protocols にあるプロトコル名も指定できる。
プロトコルの前に "!" を置くと、そのプロトコルを除外するという意味になる。
数値 0 は
all
と等しい。
プロトコル
all
は全てのプロトコルとマッチし、
このオプションが省略された際のデフォルトである。
-s, --source 
[[] address
[/mask
]
送信元の指定。
address
はホスト名
(DNS のようなリモートへの問い合わせで解決する名前を指定するのは非常に良くない)
・ネットワーク IP アドレス (/mask を指定する)・
通常の IP アドレス、のいずれかである。
mask
はネットワークマスクか、
ネットワークマスクの左側にある 1 の数を指定する数値である。
つまり、
24
という mask は
255.255.255.0
に等しい。
アドレス指定の前に "!" を置くと、そのアドレスを除外するという意味になる。
フラグ
--src
は、このオプションの別名である。
-d, --destination 
[[] address
[/mask
]
送信先の指定。
書式の詳しい説明については、
-s
(送信元) フラグの説明を参照すること。
フラグ
--dst
は、このオプションの別名である。
-j, --jump 
target
ルールのターゲット、つまり、
パケットがマッチした場合にどうするかを指定する。
ターゲットはユーザー定義チェイン
(そのルール自身が入っているチェイン以外) でも、
パケットの行方を即時に決定する特別な組み込み済みターゲットでも、
拡張されたターゲット (以下の
「
ターゲットの拡張
」を参照) でもよい。
このオプションがルールに指定されなかった場合は、
ルールにマッチしてもパケットの行方に何も影響しないが、
ルールのカウンタは 1 つ加算される。
-i, --in-interface 
[[] name
パケットを受信することになるインターフェース名
(
INPUT
,
FORWARD
,
PREROUTING
チェインに入るパケットのみ)。
インターフェース名の前に "!" を置くと、
そのインターフェースを除外するという意味になる。
インターフェース名が "+" で終っている場合、
その名前で始まる任意のインターフェース名にマッチする。
このオプションが省略された場合、
任意のインターフェース名にマッチする。
-o, --out-interface 
[[] name
パケットを送信することになるインターフェース名
(
FORWARD
,
OUTPUT
,
POSTROUTING
チェインに入るパケットのみ)。
インターフェース名の前に "!" を置くと、
そのインターフェースを除外するという意味になる。
インターフェース名が "+" で終っている場合、
その名前で始まる任意のインターフェース名にマッチする。
このオプションが省略された場合、
任意のインターフェース名にマッチする。
"[[] " "-f, --fragment"
このオプションは、分割されたパケット (fragmented packet) のうち
2 番目以降のパケットだけを参照するルールであることを意味する。
このようなパケット (または ICMP タイプのパケット) は
送信元・送信先ポートを知る方法がないので、
送信元や送信先を指定するようなルールにはマッチしない。
"-f" フラグの前に "!" を置くと、
分割されたパケットのうち最初のものか、
分割されていないパケットだけにマッチする。
-c, --set-counters 
PKTS BYTES
このオプションを使うと、
(
insert
,
append
,
replace
操作において) 管理者はパケットカウンタとバイトカウンタを
初期化することができる。
iptables - システム管理コマンドの説明 - Linux コマンド集 一覧表
