スコープを分割すると、自動的にDHCPサーバの情報が別のDHCPサーバへコピーされ、さらにリースするIPアドレス範囲が両方のサーバ間で重複しないように除外範囲が設定される。
ネットワーク機器に対してIPアドレスを配布/管理するためには、現在ではDHCPサービスを利用するのが一般的である。そのため、DHCPサーバが故障すると、すべてのネットワーク・クライアントで通信ができなくなるなど、その影響は非常に大きい。DHCPサーバは通常は1つのネットワーク上に1台しか設置しないが、可能ならば2台用意して、耐障害性を向上させたいところだ。TIPS「DHCPサーバを冗長構成で運用する方法」では、DHCPのスコープを2つに分割して、2台のDHCPサーバでDHCPサービスを提供する方法を紹介した。
Windows Server 2008 R2には、このような運用をサポートするために、DHCPサービス(「DHCP サーバー」役割)において、「スコープの分割」機能が用意されている。分割を行うと、別のDHCPサーバ上にスコープ情報をコピーし、さらに2台のDHCPサーバ上で、割り当てるIPアドレスの範囲が重複しないようにスコープの除外範囲を自動的に設定してくれる。本TIPSではこの設定方法を解説する。
なお、このスコープの分割ができるのは、コピー元もコピー先もWindows 2008 R2のDHCPサービスのときだけである。Windows Server 2008やそれ以前のServer OSのDHCPサービスに対してスコープの分割操作を行うことはできないし、分割されたスコープのコピー先にもできない。それらのDHCPサービスを利用している場合は、手動で設定してただきたい。
手順1——承認された追加のDHCPサーバを用意する
DHCPサーバでスコープの分割を行うには、すでに存在するコピー元のDHCPサーバのほかにもう1台、Active Directoryに承認されたDHCPサーバが必要である(いずれもWindows Server 2008 R2のDHCPサーバでなければならない)。Active Directoryドメインに参加しているWindows Server 2008 R2上でサーバ・マネージャを起動し、［役割の追加］で［DHCP サーバー］役割を追加すると、ウィザードの途中で「DHCP サーバーの承認」というステップがあるので、そこでドメイン管理者のアカウントを指定し、承認させておく(この段階で承認させず、後でDHCPの管理ツールでActive Directoryに承認させることもできる)。ただし、DHCPのスコープは何も定義しておく必要はない。これは次の分割の段階で自動的に作成されるからだ。もし同じ範囲のスコープがあれば分割処理がエラーになるので、必要なら手動で削除しておくこと。
手順2——コピー元のDHCPサーバでスコープを分割する
コピー先のDHCPサーバの準備ができたら、次は元のDHCPサーバをDHCP管理ツールで開き、スコープ情報を右クリックする(念のために、作業前にスコープを「非アクティブ」状態にしておいてもよいだろう)。そしてポップアップ・メニューから［分割スコープ］を実行する。
DHCPのスコープを分割して冗長構成にする(Windows Server 2008 R2編) − @IT
