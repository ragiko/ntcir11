
9.1 視覚整形モデル概論(Introduction to the visual formatting model)
この章及び次の章では、視覚整形モデル、すなわち視覚系媒体を対象にしたUAが木構造をどう処理するかについて述べる。
視覚整形モデルでは、木構造内の各要素がボックスモデルに従ってゼロ個以上のボックスを生成する。
それらボックスのレイアウトは以下の様な事項に左右される:
ボックスの寸法及び種類。
ボックスの配置体系。
(通常フロー、浮動、絶対配置)
木構造における要素間の関係。
外部情報。
たとえば閲覧領域の大きさ、画像の内在寸法など。
この章及び次の章で定めるプロパティは、連続媒体とページ媒体の両方に適用される。
ただし、マージンのプロパティについては、ページ媒体で用いる場合にだけ違う意味になる。
詳細は[13 ページ媒体]を参照のこと。
視覚整形モデルは、整形のあらゆる面について規定している訳ではない。
たとえば文字間隔の算出アルゴリズムについては規定しない。
したがって、適合UAであっても本仕様の対象外となる整形については各々異なった動作をしてよい。
9.1.1 閲覧領域(The viewport)
一般に、連続媒体に出力するUAは(ウィンドウあるいはその他画面上の視界として)ユーザに閲覧領域(viewport)を提供する。
UAは閲覧領域のリサイズに伴って文書のレイアウトを変更してもよい(初期包含ブロックの項を参照)。
閲覧領域が文書の初期包含ブロックより小さい場合、UAはスクロールの仕組みを提供すべきである。
1つのキャンバスを複数の閲覧領域に関連付けてはならないが、1つの文書を複数のキャンバスへ同時に描画するのは構わない(すなわち1文書に対して同時に別々の閲覧領域を提供してよい)。
9.1.2 包含ブロック(Containing blocks)
CSS2では、ボックスの位置やサイズの多くを、包含ブロック(containing block)と呼ばれる矩形ボックスの四辺を参照することによって計算する。
一般に、ある要素が生成したボックスは、その子孫ボックスの包含ブロックとして機能する。
このことを、ボックスが子孫のために包含ブロックを「設定する」("establishes")と表現する。
「ボックスの包含ブロック」("a box's containing block")と表現した時、それは「そのボックスが含まれている包含ブロック」("the containing block in which the box lives")を指すのであり、「そのボックスが設定する包含ブロック」("the one it generates")を指すのではない。
各ボックスは包含ブロックからの相対位置を与えられるわけだが、その位置は決して包含ブロックの内部だけに制限されるものではなく、外にはみ出しても構わない。
木構造の根にあたる要素もボックスを生成する。
そのボックスは、以降に続くレイアウトの初期包含ブロック(initial containing block)として機能する。
初期包含ブロックの横幅はルート要素の'width'プロパティで指定するとよい。
このプロパティが値'auto'を取る場合はUAが初期幅を決定する(たとえば、その時点における閲覧領域の幅などを用いる)。
初期包含ブロックの高さはルート要素の'height'プロパティで指定するとよい。
このプロパティが値'auto'を取る場合、初期包含ブロックの高さは文書の内容量に合わせて変化することになる。
初期包含ブロックを位置指定したり浮動させたりはできない。
すなわち、ルート要素に'position'や'float'を設定しても、UAはこれらを無視する。
包含ブロックの寸法を計算する方法についての詳細は次章を参照せよ。
9.2 ボックスの生成を制御する(Controlling box generation)
以下の章では、CSS2で生成されるボックスの種類について述べる。
視覚整形モデルでは、ボックスの種類が部分的にボックスの動作に影響する。
ボックスの種類は、後で示す'display'プロパティによって指定する。
9.2.1 ブロック要素とブロックボックス(Block-level elements and block boxes)
ブロック要素(block-level elements)とは、ソース文書のうち、見た目にブロック(段落など)として整形される要素のことである。
'display'の値のうちいくつかは、要素をブロックレベルにする。
'block'、'list-item'、'compact'、'run-in'、'table'などがその例である。
(ただし、'compact'と'run-in'は場合によって生成するボックスの種類が変化する。
各解説を参照のこと)
ブロック要素は、内部にブロックボックス(block box)のみを含む主要ブロックボックス(principal block box)を生成する。
主要ブロックボックスは、子孫ボックスや生成内容が参照するための包含ブロックを設定し、自身もまた何らかの配置体系に属する。
また、主要ブロックボックスはブロックの整形コンテキストに属する。
ブロック要素の中には、主要ボックス以外にも更にボックスを生成するものがある。
リスト項目の要素がマーカー入りのボックスを生成する場合などがこれにあたる。
こういったボックスは主要ボックスの位置を基準に配置される。
匿名ブロックボックス(Anonymous block boxes)
次の様な文書で:
<DIV>
Some text
<P>More text
</DIV>
DIV要素とP要素が'display: block'だと仮定すると、DIV要素は内容としてインラインとブロックの両方を持っている様に見える。
ここで、整形の定義付けを容易にするために、「Some text」の周囲に匿名ブロックボックス(anonymous block box)があるものと考える。
視覚整形モデル
