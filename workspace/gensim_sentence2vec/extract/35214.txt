前処理のデモ
BIDOでは、アレイデータ(またはハドルデータ)解析の一環として、以下のようなデータの前処理ができます.
1)トレンド(直流成分)の除去
波形の0線が時々刻々直線的に変化するような場合、その影響を取り除いてやることで、スペクトル解析に用いるセグメントをより適切により多く抽出できる可能性があります.
2)波形のテーパーリング
バンドパスフィルターをかけるための前処理として、波形の両端の振幅を スムーズに0に近付けます. 
3)バンドパスフィルター
フィルターをかけてノイズの多い周波数帯域をカットすることにより、スペクトル解析に用いるセグメントをより適切により多く抽出できる可能性があります.
4)データの間引き
スペクトル解析の時短に寄与します.間引きによってデータの高周波数帯域はカットされますが、解析可能な帯域における解析精度は変わりません.
5)機器特性の相違の補正
機器応答特性がチャンネルごとに異なるような記録システムの記録はそのままではアレイ処理できません.機器特性の相異を補正することによりアレイデータとして使えるようになる可能性があります.
初めてBIDOを使う方は、全般的な使い方を知るためにまず「アレイデータ解析のデモ」をご覧ください.ここではデモデータ\demo\HDL0002を用いて前処理の部分のみを説明します.このデータは\demo\HDL0001と同様に(HDL0001の説明はハドルテストのデモを参照)、鳥取大学の野口竜也博士から頂いたものです.HDL0001と同日に同じ環境下で記録されたものですが、下の写真のように地震計の位置が異なります.
HDL0001            HDL0002
それでは
run.sh  demo/HDL0002/param.sh
[RETURN KEY].
として解析を開始して下さい.
ダイアログで「Preprocessing the data?(データのを前処理しますか?)」と尋ねられますので、「y(はい)」と回答すれば、データに前処理を適用することができます.このデモではすべてディフォルトの値を使えば、最初に次のような波形がプロットされると思います.これは前処理をかける前のオリジナルデータです.
ここでダイアログに重要なメッセージが表示されますので必ずご一読下さい. 
-------------------------ココから-------------------------------
Do you want to preprocess the waveforms? [y/n] 
[This includes elimination of the trend, application of tapers (and bandpass filtering and decimation if necessary)]
NOTE: The original data will be moved to a directory named "originaldata", which will be automatically created by
BIDO under the directory where the original data files are currently stored.
Instead, new files with the same names as those of the original data will be
created to store the preprocessed data. (The seismfile
will also be moved to the directory "originaldata"
as well, and newly created by BIDO under the directory where the original seismfiles are currently stored. This is necessary because
the preprocessing possibly involved decimation.) The original data files will
not be overwritten (destroyed) by BIDO. It is strongly recommended, however, to
create backup of the original data files to avoid their accidental destruction.
Type "n" to skip preprocessing. 
【日本語訳】
前処理をしますか?[y/n] 
[これにはトレンド除去、テーパーの適用(必要ならばバンドパスフィルタリング、間引きも)が含まれます.]
注意:オリジナルデータはoriginaldataという名前のフォルダ(BIDOによってオリジナルデータファイルがあるフォルダの直下に自動的に生成されます)に移動されます.その代わりにオリジナルデータのファイル名と同じ名前のファイルが作成されて前処理済みのデータが格納されます.(seismfileも同様にoriginaldataというフォルダに移動され、もとのseismfileが置いてあるフォルダに自動生成されます.これは前処理により波形データのサンプリング時間間隔が変わる可能性があるからです.)BIDOによってオリジナルデータファイルが壊される(上書きされる)ことはありません.しかし、予期せずにオリジナルデータファイルが壊れる可能性を考えてバックアップをとっておくことを強く勧めます.
-------------------------ココまで-------------------------------
ここで「y」と入力すれば、前処理を実行するためのダイアログが始まります.ここでは「Correct
for the difference in instrumental response?(機器応答の相違を修正しますか)」に「n」、「Bandpass filter?(バンドパスフィルターをかけますか)」に「y」と答えることにします(機器応答の相違の修正については改めて下のほうで説明します).低周波数側および高周波数側のカットオフ(limit)をそれぞれ1、20[Hz]にすると、次のような最終確認のメッセージが表示されます.
「y」と入力すれば、次のような前処理済みの波形が表示されます.バンドパスフィルターの効果により、オリジナルデータに見られたうねり(数十秒の長周期成分)がなくなっていることが分かります.
バンドパスフィルターの適用に際しては、トレンド除去、テーパーリング、間引きが自動的に含まれる仕様となっています.テーパーはcos型で、ディフォルトでは波形の両端5%の部分に適用するようになっています.テーパーの割合は\script\setpar.shのtpendという変数で変更できます.バンドパスフィルタは、斎藤(1978)によるチェビシェフ・フィルターI(等リップル通過帯域型)を適用しています.フィルター適用後は、高周波数側のカットオフを考慮して自動的にデータが間引かれます(最大限間引きます).この解析ではオリジナルデータのサンプリング時間間隔は0.01秒ですが、20〜23Hz以上の高周波数帯域をフィルターで落としていますので、サンプリング時間間隔が0.02秒すなわちナイキスト周波数が25Hzとなるようにデータが間引かれています.
さて、ここで\demo\HDL0002以下にあるファイルを確認してみましょう.次のようになっていると思います.
ダイアログのメッセージ通り、originaldataというフォルダが生成されていることが分かります.もとのデータファイルはすべてその中に移動され、ここにあるデータファイルS0X.dはすべて前処理済みのデータとなっていますのでご注意下さい(seism.dも同様です).
前処理が終わると、波形の出力に加えて再び
Do you want to preprocess the waveforms?
[y/n] 
(前処理をしますか?)
というメッセージが表示されます.「n」と入力すれば次のステップすなわち本解析に進むことができます.
「y」と入力すれば何度でも前処理をやり直すことができます.すなわちこれ以降の繰り返しは、i)originaldataというフォルダに格納されたもとデータの読み込み、ii)前処理、iii)データフォルダへの出力(前処理済みの波形データファイルはオーバーライトされる)という手順で行われます.したがって、ダイアログですべての前処理オプションに対して適用せず(「n」)と回答すれば、データはオリジナルに戻ります.
ダイアログによる前処理のフローは以下のようにまとめられます.
機器特性の相違の補正
HDL0002の解析結果には、HDL0001の場合(ハドルテストのデモの解析結果を参照)と同様にチャンネル番号3(データファイルS03.d)の位相特性に他のチャンネルと異なる傾向が見られたことと思います.どうやらチャンネル番号3には他と異なる応答をする癖があるように見えます.このように、誰が設置するか(あるいは設置状態のちょっとした相違)によらず、常に特定のチャンネルの記録特性に同じような偏り(癖)が見られるならば、データ解析前にそれを補正しておいたほうが良いように思われます.BIDOはそのような補正もできるようになっています. 
データファイルのあるフォルダに地震計の成分ごとに機器の応答特性の相違を補正するためのファイルを置いておいて下さい.ファイル名の規則は、
(データファイル名).{e, n, u }.correction
となります.e, n, uはそれぞれ東西、南北、上下成分に対応します.HDL0002のアーカイブに入っている「*. correction」という5個のファイルは補正用のファイルです.各ファイルの内容は、
周波数F [Hz]  振幅比R [無次元]  位相差P [°]
という並びになっています.補正前のデータのFFTスペクトルをAexp(iθ)とすると、補正後は、(A/R)exp(i(θ-P))となります.補正用ファイルの周波数刻みは適当で構いません(1次補間されます).機器の応答特性の補正オプションをYESにしたにも関わらず同じフォルダ内に補正用のファイルが見つからない場合、R=1,
P=0が仮定されます.
フォルダ\demo\HDL0002にはすでに補正用ファイルが同梱されています.これらの補正用ファイルは、HDL0001の解析結果\RESULT \ave
\DIFINSTRES1_Xu.dを \S0X.d.u.correctionという名前でコピーしたものです.ここではこれらのHDL0001の結果を用いて、HDL0002のデータを補正してから解析してみましょう.
run.sh  demo/HDL0002/param.sh [RETURN KEY].
として再度解析を開始して下さい.ダイアログを進め、「Do you want to preprocess the original waveforms anew?」に対して「y」、「Correct for the difference in
instrumental response?」に対して「y」と回答して下さい.前処理にはバンドパスフィルターも自動的に含まれますから、低周波数側および高周波数側のカットオフ(limit)をそれぞれ1、20[Hz]にすると、次のような最終確認のメッセージが表示されます.
「y」と入力すれば、前処理が進められます.波形プロットの後、再度「Do you want to preprocess the original waveforms anew?」と聞かれますが、既に機器応答の相違の補正は済んでいるので、「n」と入力して本解析に進みます.最終的に、次のような解析結果が得られます.
・パワースペクトル密度
・振幅2乗コヒーレンス
・位相差
・NS比
・インコヒーレントノイズのパワースペクトル密度
となります.機器特性の相違の補正によりチャンネル番号3(データファイルS03.d)の位相特性の癖がかなりキレイに消えたことが分かります. 
斎藤正徳, 1978, 漸化式ディジタル・フィルターの自動設計, 物理探鉱, 31,112-135.
[戻る] [BIDOトップ]
微動アレイ解析ツールBIDO
