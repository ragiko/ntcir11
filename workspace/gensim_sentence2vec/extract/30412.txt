
COBOL85 言語
10.6.9 入出力状態
入出力状態は,2けたの数字で表される概念上の存在であって,CLOSE文,DELETE文,OPEN文,READ文,REWRITE文,START文,又はWRITE文の実行中,かつその入出力文と関連する無条件文の実行前,又は関連するUSE AFTER STANDARD EXCEPTION手続きの実行前に,その入出力動作の状態を示す値が設定される。入出力状態の値は,そのファイルに対するファイル管理記述項中のFILE STATUS句を使用することによって,COBOLプログラムで使用可能となる。
また,入出力状態は,USE AFTER STANDARD EXCEPTION手続きが実行されるか否かを決定する。「1. 成功」の項に含まれるもの以外のどれかの条件が起きると,その手続きはほかの箇所で述べられる規則によって実行される。「1. 成功」の項に述べられた条件のどれか一つが起きると,そのUSE手続きは実行されない(「第2編 10.43 USE文」参照)。
入出力状態の幾つかは,重大誤り状態を示す。これらは,値3若しくは値4,又はこのシステムが重大であると定めた値9を持つけたで始まる状態である。入出力動作に対する入出力状態の値が,この誤り状態を示すならば,このシステムでは,該当するUSE AFTER STANDARD EXCEPTION手続きを実行した後に入出力文の終わりに制御を移す。該当する手続きがなく,FILE STATUS句の指定がない場合,異常終了する。
入出力状態は,入出力動作完了後の次の条件のうち一つを示す。
成功。入出力文の実行が成功した。
ファイル終了。順呼び出しのREAD文の実行が,ファイル終了条件によって不成功になった。
無効キー。入出力文の実行が,無効キー条件によって不成功になった。
永続誤り。入出力文の実行が,そのファイルに対する処理の続行を妨げる誤りによって不成功になった。USE AFTER STANDARD EXCEPTION手続きの指定があれば,それが実行される。永続誤り条件は,そのファイルに対して引き続いて行われるすべての入出力動作に影響し続ける。
論理誤り。入出力文の実行が,そのファイル上の妥当でない順序の入出力動作,又は利用者が定めた境界を超えたことによって不成功になった。
作成者定義。入出力文の実行が,作成者の定めた条件によって不成功になった。
入出力状態を定める値を,表10-2に示す。
表10-2 入出力状態を定める値とその内容
条 件
入出力状態
内       容
成功
00
入出力文の実行が成功した。その入出力動作に関しては,これ以上情報がない。
02
入出力文の実行は成功したが,重複キーが検出された。
READ文で読み込んだレコードキーの参照キーの値が,その索引における次のレコードの参照キーと等しい。
REWRITE文,又はWRITE文によって書かれたレコードの副レコードキーの値が,既にファイルに存在している。ただし,この副レコードキーは重複した値が許されるので誤りではない。
04
READ文の実行は成功した。しかし,処理したレコードの長さが,そのファイルのファイル固有属性に従っていない(テキストファイルだけ)。
または,CSV形式ファイルから入力した一つのセルの文字列長が,入力領域より長い。
05
OPEN文の実行は成功した。しかし,OPEN文を実行したとき,参照した不定ファイルは存在しない。OPEN文のモードが入出力両用,又は拡張ならば,ファイルは生成される。
07
入出力文の実行は成功した。ただし,REEL/UNIT指定のCLOSE文で参照したファイルが非リール/ユニットの媒体上にある(順ファイルだけ)。
ファイル終了
10
順呼び出しのREAD文を実行しようとしたが,次のレコードが存在しない。次の場合のどれかである。
ファイルの終わりに達した。
存在しない不定入力ファイルに対して,順呼び出しのREAD文を初めて実行しようとした。
14
相対ファイルに対して順呼び出しのREAD文を実行しようとしたが,相対レコード番号の有効けた数がそのファイルの相対キー項目の大きさより大きい(相対ファイルだけ)。
無効キー
21
呼び出しにおいて,順序誤りがあった。すなわち,成功したREAD文と次のREWRITE文の間で主レコードキーの値が変更されたか,又はWRITE文の実行時に主レコードキーの値が昇順になっていない(索引ファイルだけ)。
22
重複キーがあった。
既にレコードがある位置に,重ねてWRITE文でレコードを書き出そうとした(相対ファイルだけ)。
WRITE文又はREWRITE文で書き出そうとしたレコードの,主レコードキー,又は重複の許されない副レコードキーの値が,既にファイル中に存在している(索引ファイルだけ)。
23
次の場合のどれかである(相対ファイル,及び索引ファイル)。
ファイル中に存在しないレコードを乱に呼び出そうとした。
存在しない不定入力ファイルに対して,START文,又は乱呼び出しのREAD文を実行しようとした。
24
次の場合のどれかである。
COBOLの外部で定義されたファイルの区域外にレコードを書き出そうとした(相対ファイル,及び索引ファイル)。
順呼び出しのWRITE文を実行しようとしたが,そのレコードの相対レコード番号の有効けた数がそのファイルの相対キー項目の大きさより大きい(相対ファイルだけ)。
乱呼び出しのWRITE文を実行しようとしたが,その相対レコード番号が0以下である(相対ファイルだけ)。
永続誤り
30
永続誤りが存在する。次の場合のどれかである。
順固定長ファイルから入力した最後のレコードの長さが,レコード長より短い。
順固定長ファイルに標準入力(stdin)を割り当てた場合,入力した長さがレコード長より短い。
相対可変長ファイルのレコード長領域が破壊されている(最大レコード長と最小レコード長の範囲外の値が設定されている)。
相対ファイルのスロットが破壊されている。有効,無効レコードの識別ができない。
入出力両用モードで開かれたテキストファイルに対してREAD文を実行したが,入力したテキスト行がプログラム中で定義したレコード領域より長い。
34
区域外書き出しによる永続誤りが存在する。COBOLの外部で定義されたファイルの区域外にレコードを書き出そうとした(順ファイルだけ)。
35
不定ファイルでないファイルが存在しないとき,INPUT指定,I-O指定,又はEXTEND指定を持つOPEN文を実行しようとしたことによる永続誤りが存在する。
37
OPEN文を実行しようとしたが,指定されたファイルがOPEN文に書かれたモードを使えない。次の場合のどれかである。
EXTEND指定,又はOUTPUT指定が書かれたが,そのファイルでは出力動作が使えない。
I-O指定が書かれたが,そのファイルでは,入出力両用モードで開かれている順ファイル/相対ファイル/索引ファイルに対して許される入出力動作が使えない。
INPUT指定が書かれたが,そのファイルでは入力動作が使えない。
OUTPUT指定以外が書かれたが,書式印刷機能でプリンタの出力動作が使えない。
38
施錠して閉じたファイルに対して,OPEN文を実行しようとしたことによる永続誤りが存在する。
39
ファイル固有属性とプログラム中で指定した属性との間で矛盾が検出されたため,OPEN文が不成功になった。
論理誤り
41
開かれているファイルにOPEN文を実行しようとした。
42
開かれていないファイルにCLOSE文を実行しようとした。
43
順呼び出しで,DELETE文,又はREWRITE文を実行する前に,関連するファイルに対して実行された最後の入出力文が,成功したREAD文でない。
44
次のどれかの条件で,区域外書き出しが起こった。
関連するファイル名のRECORD IS VARYING句によって許される最大のレコードより大きい,又は最小のレコードより小さいレコードを書き出そうとした,又は書き換えようとした。
レコードを書き換えようとしたが,そのレコードは,書き換えられるレコードと同じ大きさではない。
46
入力モード,又は入出力両用モードで開かれたファイルに順呼び出しのREAD文を実行しようとしたが,有効な次のレコードがない。次の場合のどれかである。
先行するSTART文が不成功であった。
先行するREAD文が,ファイル終了条件以外によって不成功であった。
先行するREAD文が,ファイル終了条件を引き起こした。
47
入力モード,又は入出力両用モードで開かれていないファイルに,READ文,又はSTART文を実行しようとした。
48
入出力両用モード,出力モード,又は拡張モードで開かれていないファイルにWRITE文を実行しようとした。
49
入出力両用モードで開かれていないファイルに,DELETE文,又はREWRITE文を実行しようとした。
作成者
規定
90
入出力実行時,実行不可能な状態になった。次のどれかである。
入出力に必要なメモリが不足した。
ファイルにディレクトリが指定された。
CBL_ファイル定義名で示される環境変数がない。
1プロセス内でオープンできるファイル数の上限を超えた。
CLOSE文実行時,バッファに残っていた内容をファイルに書き出す。このとき,大記憶ファイルの許容範囲を超えた。
ファイル名の指定に誤りがある。
92
レコード長がDEPENDING ON指定で指定されているが,指定されたデータ名中の値が数字以外である。
レコード番号が処理できる最大値を超えた(相対ファイルだけ)。
開かれていないファイルにUNLOCK文を実行しようとした。
93
OPEN文を実行しようとしたが,該当ファイル又は該当ファイル中のレコードは既に使用されている。
書式印刷機能を使用するとき,プリンタがほかで既に使用されている。
99
入出力文(OPEN,CLOSE文を除く)を実行しようとしたが,該当レコードは既に使用されている。
[目次][前へ][次へ]
[他社商品名称に関する表示]All Rights Reserved. Copyright (C) 1997, 2004, Hitachi, Ltd.
入出力状態
