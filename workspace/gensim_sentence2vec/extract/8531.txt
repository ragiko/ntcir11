
IISのログ・ファイルはデフォルトではシステム・ドライブ上に作成されるが、パフォーマンスや管理のことを考えると別ドライブに記録するのが望ましい。
ログ・ファイルの格納フォルダはWebサイトやFTPサイトのプロパティで変更することができる。
IIS全体のプロパティを変更すると、新規作成されるサイトのデフォルト・フォルダを変更することができる。
解説
IIS(Internet Information Service)使ってWebサイトやFTPサイトを構築すると、デフォルトでクライアントからのアクセス履歴を記録するログ・ファイルが作成される。これらのログ・ファイルには、どのクライアント(IPアドレス)から、いつどのような要求が行われたかなどの情報が記録され、Web/FTPサイトのアクセス・ログ解析やトラブル・シューティングなどに利用される。
このログ・ファイルにはテキスト形式でアクセス履歴が記録されるが、1つのコマンド(要求)ごとに1つずつエントリが作成される。そのためそのサイズは大きくなりがちである。規模の大きなサイトの場合には、1日で数十Mbytes〜数百Mbytesにもなることがある(Webの場合なら、いわゆる「1ヒット」ごとに1つずつエントリが作成され、デフォルトでは、1日ごとに1つずつファイルが作成される)。
ログ・ファイルのように、ファイル数やファイル・サイズが不定長で、その総サイズも大きくなることが予想される場合は、ログを書き込む場所(フォルダ)についても十分考慮しておくべきである。デフォルトでは、IISのログ・ファイルはWindows OSのシステム・ドライブ上に作成される。だがこのドライブ(ボリューム)はOSシステムそのもののためだけに利用するべきであり、ログ・ファイルのように、不定長、不定個数で、しかも日々その数が増えるような種類のファイルを置くのは望ましくない。システム・ドライブ全体のバックアップやリストアをする場合、無駄なログ・ファイルまでもバックアップすることになるし、システム・ドライブの適切なサイズを見積もるのも困難になるからだ。またOSのシステム・ファイルとログ・ファイルのアクセスが競合したり、ファイル・システムのフラグメントが多くなって、システム全体のパフォーマンスが低下したりするという問題もある。
このような事態を避けるため、ログ・ファイルはシステムとは別のパーティションに記録するようにしておきたい。可能ならば、物理的に独立した別のディスクを用意し、そこに書き込むようにするのがよいだろう。ディスクのアクセスが分散され、パフォーマンスの低下を最小限に抑えることができる。
操作方法
サイトごとのログ設定
IISのログ・ファイルの作成場所(ログ・ファイルのフォルダ)を変更するには、IISの管理ツール(［管理ツール］メニューの［インターネット サービス マネージャ］)を起動し、定義されている「Webサイト」や「FTPサイト」の［プロパティ］ダイアログを表示させる。
Webサイトのプロパティ
「Webサイト」や「FTPサイト」ごとにこのようなプロパティがあり、ログ・ファイルを記録する場所を設定することができる。
ログ・ファイルの場所を変更するにはこれをクリックする。
この画面の下にあるログ・ファイル形式の［プロパティ］ボタンをクリックすると、ログ・ファイルの書き込み場所を指定するダイアログが表示される。デフォルトでは%WinDir%\System32\LogFilesというフォルダの下に、さらにW3SVC1といったフォルダが作成される(最後の数字「1」の部分は、作成したサイトごとに変更される)。実際のログ・ファイルは、日付ごとに異なるファイル名(例:ex050122.log)になる。なお、IISでは、いったん作成されたログ・ファイルは自動的に削除されることはないので、ときどきログ・ファイル・フォルダの内容やサイズを確認して、手動で削除するなどの操作を行う必要がある。
ログ・ファイルのプロパティ
ログ・ファイルのフォルダを変更するにはこのダイアログを使用する。ログ・ファイルのフォルダはデフォルトでは「%WinDir%\System32\LogFiles」となっているが、これを、十分な容量のある別ドライブ(別ボリューム)に変更するとよい。
ログ・ファイルのフォルダ。
で指定されたフォルダの中にさらに「W3SVC*」や「MSFTPSVC*」というフォルダが作られ(「*」の部分にはサイトごとに異なる数字が入る)、その中にログ・ファイルが記録される。
作成されるファイルの名称「exyymmdd.log」の「yymmdd」には年月日が入る。
サイトごとのログ設定
以上の設定は、WebサイトやFTPサイトごとの設定であり、すでに作成されているサイトのログ・フォルダを変更する場合に使用する。これに対して、IIS全体のデフォルトのログ・フォルダ設定を変更することもできる。デフォルトのフォルダを設定しておくと、以後、新しくWebサイトやFTPサイトを作成すると、最初からそのフォルダがログ・フォルダとして作成されるようになる。
IISのデフォルト・ログ・フォルダ設定
作成するサイトのデフォルト・フォルダを変更するには、IIS全体のプロパティ(「マスタ プロパティ」)で設定しておく。IISの管理ツールでサーバ名を右クリックし、ポップアップ・メニューから［プロパティ］を表示させると、このようなダイアログが表示される。
「WWW サービス」と「FTP サービス」の2つが選べる。それぞれのプロパティを同じように編集すること。
サービスを選んでこのボタンをクリックすると、先ほどと同じ［プロパティ］画面が表示されるので、デフォルトにしたいログ・フォルダ名を入力する。
ただしすでに作成されている既存のサイトに関しては、そのフォルダ設定が変更されることはないので、必要ならば最初の方法で、サイトごとの設定を手動で変更していただきたい。
関連記事
Windows TIPS:クライアント版WindowsでIISをインストールする(Windows Server Insider)
Windows TIPS:IISのログ・ファイルを午前0時に切り替える(Windows Server Insider)
Windows TIPS:tailコマンドでログ・ファイルをリアルタイムに監視する(Windows Server Insider)
Windows TIPS:クライアント版Windowsに付属するIISの制限(Windows Server Insider)
IISのログ・ファイル・フォルダを変更する − @IT
