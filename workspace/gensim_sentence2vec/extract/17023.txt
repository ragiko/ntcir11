前回の課題 2において、画像処理アプリケーションを変更し、「画像を読み込み、輝度 128 を閾値として二値化を行うプログラム」を作成してもらった。
この二値化の閾値を 100 や 200 に変更すると、また違った二値化画像が得られるのは
想像できると思うが、
ここまでの知識では閾値を変更するたびに再コンパイルの必要があり不便である。
ここではアプリケーションを実行中にこの閾値を変更し、二値化画像の変化を即座にチェックできるよう
プログラムを変更してみよう。
このページの内容は、C/C++ の解説というよりは Visual C++ の解説である。
このページの内容についてより詳しく学びたければ例えば以下の本などを学習する必要があるだろう。
明快入門 Visual C++ 2005 ビギナー編
明快入門 Visual C++ 2005 シニア編
二値化プログラムの完成
まずは出発点の二値化プログラムを完成させねばならない。以下のようになる。
コピーおよび貼り付け後、タブを挿入して字下げを調整してビルドし、動作を確認しておこう。
そして、動作を確認したらメニューから「ビルド」「ソリューションのクリーン」を実行しておこう。
int gray = (int)(0.114*inImage[index(i,j) + 0] + 0.587*inImage[index(i,j) + 1] + 0.299*inImage[index(i,j) + 2]);
if(gray>=128){
outImage[index(i,j) + 0] = 255;  // Blue
outImage[index(i,j) + 1] = 255;  // Green
outImage[index(i,j) + 2] = 255;  // Red
}else{
outImage[index(i,j) + 0] = 0;  // Blue
outImage[index(i,j) + 1] = 0;  // Green
outImage[index(i,j) + 2] = 0;  // Red
}
では順を追って解説する。まずは、閾値を調節するためのスライダーを追加しよう。
まず、リソースビューから「ImageOpen.rc」「Dialog」「IDD_IMAGEOPEN_DIALOG」をダブルクリックする。
リソースビューがなければ、ファイルメニューから「表示」(「その他のウィンドウ」)「リソースビュー」を選択。
すると、アプリケーションの画面をデザインするウインドウが現われる。
次に、ツールボックスで Slider Control を選択し、
スライダを置きたい位置でマウスをドラッグするよう操作する。
すると、以下のようにスライダが現われる。
ツールボックスがない場合は、
メニューから「表示」「ツールボックス」で現われる。
次に、追加したスライダ上で右クリックし、「変数の追加」を選択。
下記のようなダイアログが現われるはずだが、変数名に例えば
「th_slider」と記入して「完了」。
余談だが th は threshold (閾値) の意味で用いた。
次に、アプリケーションのデザインを行うウインドウにおいて、
アプリケーションのメニューのところで右クリックしてプロパティを選択。
以下のように赤い四角の「メッセージボタン」をクリックし、WM_HSCROLL という箇所を探す。
そして、右側の矢印部をクリックして「<追加>OnHScroll」を選択。
もしここで以下のように「読み取り専用である」というようなエラーが出た場合、
一旦全てを保存してから ImageOpenDlg.cpp タブを閉じる、とか
一旦全てを保存して Visual Studio を立ち上げ直す
などをすることでエラーが出なくなることが多い。
「<追加>OnHScroll」がうまく行くと、「スライダを動かしたときに呼ばれる関数 (メッセージハンドラ)」が追加され、その箇所が編集できるようになる。
そこに上記のような行を追加。以下をコピー&貼り付けで良い。
これは、スライダを動かしたら画面を再描画する、という命令である。
(2009.02.25 imageopen.zip の更新に伴い変更しました)
第六回-03 [おまけ] スライダによる閾値の調節
