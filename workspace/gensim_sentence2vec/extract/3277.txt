3 インターネットの設計理念とアーキテクチャ
TCP/IPのようなプロトコル群を設計する場合には,それが実現するシステムの果たすべき機能を明確にし,それをどのような形でまとめるかという設計理念がまず必要となる.逆に,その理念の理解なしには,インターネットやTCP/IPのプロトコル群がなぜ今の形となっているのかを理解することは難しい.
たとえば,インターネットはパケットがなくなって信頼性が低いから問題だという意見を耳にすることがある.しかし,そう思うのは早計である.なぜならば,帯域を保証し機能満載で複雑なネットワークの対極として,帯域を保証せずに機能を簡単にするという理念の下にインターネットを設計したからである.すなわち,ここでの理念は,ネットワークの中核部分は簡単にすべきというものである.そして,複雑な機能のほうはネットワークに接続されるホスト側にまかせてしまう.その結果,インターネットはひたすらパケットを転送することに専念し,エラーの訂正も,フロー制御も行わないものとなった.輻輳(ネットワークの過負荷)が発生したら,単にパケットを捨ててしまう.
また,電話のように通信に先だって相手までの通信路を設定するコネクション指向のネットワークではなく,パケットを単にネットワークに渡せば,指定された相手のコンピュータまでただちにパケットを転送してくれるというコネクションレス型のネットワークとした.
インターネットにはもう一つの理念がある.それは,インターネットの名前の由来となった「ネットワークのネットワーク」という考え方である.つまり,inter-networkである.
インターネットは1983年にARPA(Advanced Research Project Agency)注1 Internetとして始めて世に姿を表わしたが,その前身のARPAnetでは,NCP(Network Control Protocol)というプロトコル体系を採用していた.このプロトコル体系では,ネットワーク全体を一つのシステムとして管理する必要があった.しかし,このようなネットワークでは,規模の拡大にともなって管理も複雑となり,破綻する恐れがある.そこで,規模が拡大しても管理がうまくいくように,各組織が管理するネットワークを相互接続した集合体とした.これがインターネットアーキテクチャである.各組織が管理するネットワークのことを自律システムAS(Autonomous System)と呼ぶ.
インターネットは,この自律システムをパケット交換機であるルータ (Router)で相互接続した集合体である.図4にこのインターネットのモデルを示す.自律システムとは,同一の組織によって管理運営されるネットワークのことである.
たとえば,各大学や企業のネットワークは自律システムである.ISP(Internet Service Provider)も自律システムである.ルータは,自律システム間でパケットを中継する.自律システムの内部は,Ethernetのようなネットワークセグメント,それに接続されたサーバやPCなどのホストから構成される.しかし,自律システムの内部が,さらにルータで接続された自律システムの集合になっており,inter-networkを構成している場合もある.たとえば,大学のキャンパスネットワークは,その内部が各学部の自律システムから構成されており,inter-networkを形成していることが多い.このように,インターネットは入れ子構造をもつ.
4 TCP/IPプロトコル群のアーキテクチャ
4.1 プロトコルのレイヤ構造
インターネットを実現すべくTCP/IP(Transmission Control Protocol/Internet Protocol)プロトコル群が設計された.「プロトコル群」というくらいだから,プロトコル単体のものではなく,一連のプロトコルの集合体である.各プロトコルが連携することによって全体としてインターネットの通信機能を実現する.
インターネットのプロトコル群は,ちょうどソフトウェアが機能別にモジュール化されて実装されるのと同じく,レイヤ(層)別にモジュール化されている.これを図5に示す.このプロトコル群は,五つのレイヤから構成される.それぞれのレイヤには,複数のプロトコルが属する場合がある.これらは,使用目的によって使い分けられる.ここでは各レイヤのプロトコルのうち代表的なものだけを示している.
下位のレイヤは,上位のレイヤにサービスを提供する.上位のレイヤはそのサービスを使用して,さらに上位のレイヤにサービスを提供する.
たとえば,リンクレイヤは,同一Ethernetセグメント上の隣接するホスト間のパケット転送サービスをネットワークレイヤに提供し,ネットワークレイヤは,これを使用して,異なるEthernetセグメント上にあるインターネットのホスト間(エンドツーエンド)のパケット転送サービスをトランスポートレイヤに提供する.なお,インターネットでは,パケットをレイヤごとに区別するため,リンクレイヤにおいてはフレーム(frame),ネットワークレイヤにおいてはデータグラム(datagram),トランスポートレイヤにおいてはセグメント(segment)と呼ぶ.
4.2 物理レイヤとリンクレイヤの概要
物理レイヤは変調方式や光ファイバなどの伝送媒体などの規定をする.また,リンクレイヤは,同一ネットワークセグメント上のホスト間でのフレームの転送を規定する.リンクレイヤの代表的なものとして,Ethernet,専用線,モデムを使用した電話網,ISDNなどのリンクがある.インターネットでは既存のリンクをそのまま使用するので,RFCでは,それらの使い方は規定しても,物理レイヤやリンクレイヤのプロトコルは規定しない.このため図5では,物理レイヤとリンクレイヤとを一体化して示している.
リンクレイヤの機能は,同一回線上の隣接するルータやホストまでフレームを転送することである.ここで重要なことは,インターネットがどのようなリンクでも使用できることである.すでに述べた4月1日付けのRFC1149伝書鳩によるIPデータグラムの伝送を実際にやった人もいるくらいである.このようにさまざまなリンクが使用できるのは,IPデータグラムをリンク固有のフレーム内のデータとして転送するからである.これをエンキャプシュレーションと呼ぶ.このようにするのは,次の理由による.
もしも,インターネットプロトコルとして物理レイヤ/リンクレイヤのプロトコルを規定すれば,プロトコル群はきわめて大きなものとなる.また,すでに存在する規格を使用するとしても,それぞれのリンクの規格と渾然一体となったプロトコルを規定していたのでは,プロトコル群の複雑化が進む一方である.
そこで,どのようなリンクのプロトコルでも使用できるように,TCP/IPのパケットをリンクのパケットにどう入れるかというエンキャプシュレーションの方法(5節を参照)とTCP/IPのアドレスとリンクのアドレスとの対応付けを動的に行うアドレス解決の方法(7.4節を参照)だけを規定することにした.アドレス解決のおかげで,リンクのアドレスの構造とインターネットのアドレスの構造とをまったく独立したものにできる.したがって,異なるアドレス構造の新たなリンクの規格が出現してもすぐに対応できる.
4.3 ネットワークレイヤの概要
ネットワークレイヤは,インターネットレイヤと呼ばれることもある.ネットワークレイヤは,トランスポートに対してインターネットのホスト間(エンドツーエンド=end to end)のデータグラムによる転送サービスを提供する.そのために,下位のリンクレイヤのサービスを使用する.このレイヤには,IP(Internet Protocol)のプロトコルがある.IPのプロトコルでは,IPデータグラムの喪失などの誤りが発生しても,回復を行わない.
個々のホストやルータは,回線を接続するインターフェースごとに,インターネット内で一意に識別できるIPアドレスをもっている.転送元のホストは,データをIPデータグラムに分割して転送する.その際に,転送先のホストに割り当てられたIPアドレスを,転送先アドレスとしてIPデータグラムに埋め込む.そして,回線に送り出して隣接するルータに渡す.ルータには複数のリンクが接続されている.あるリンクからフレームを受信すると,その中のIPデータグラムを取り出し,その転送先IPアドレスを元に,次に渡すべき隣接したホストあるいはルータを決定する.そして,そこへ接続されているリンク固有のフレームにIPデータグラムをエンキャプシュレーションして転送する.
このようにしていくつものルータによって中継されたIPデータグラムは,最終的に転送先のホストに到着する.転送された一連のIPデータグラムは,転送先のホストによって元のデータに復元される.たとえば,図4のホストH1で,IPデータグラムに分割されたデータは,ネットワーク上を二つのルータR12, R23によって中継されながら転送先のホストH3へ転送されていき,そこで元のデータに組み立てられる.
2003年6月号 特集 第1章
