【課題】アライメント精度を高める。【解決手段】実施形態のアライメント方法は、局所領域設定ステップと、局所アライメントステップと、シフトステップとを、含む。局所領域設定ステップでは、局所領域設定部が、アライメント対象領域の中から、アライメント要求精度以上の精度で行われる局所アライメントの実行対象領域である局所領域を設定する。局所アライメントステップでは、局所アライメント部が、前記局所領域において、検査対象のパターン画像と検査基準の基準パターン画像との前記局所アライメントを行い、局所アライメント結果であるシフト量を得る。シフトステップでは、シフト部が、前記シフト量を用いて前記基準パターン画像全体をシフトする。
【発明の詳細な説明】【技術分野】【0001】  本発明の実施形態は、アライメント方法及び検出装置に関する。【背景技術】【0002】  近年、LSI(Large  Scale  Integration)パターン寸法の微細化に伴い、レチクル等のフォトマスクに形成されるパターン画像も微細化している。この結果、パターン画像の欠陥など検出しなければならない欠陥の最小寸法も微細化し、パターン画像の欠陥を検出するためにパターン画像を基準パターン画像と比較する際に、パターン画像と基準パターン画像との画素位置のズレ、パターン画像の伸縮・うねり、及びセンシングノイズに埋もれるほどの欠陥などを検出する必要性も生じている。【0003】  このため、従来技術では、パターン画像と基準パターン画像とを比較する前処理として、画素単位でのアライメントを行い、その後に、パターン画像のリサイズ補正、伸縮・うねり補正、及びノイズの平均化処理などの画像補正を行っている。【先行技術文献】【特許文献】【0004】【特許文献1】特許第3965189号公報【発明の概要】【発明が解決しようとする課題】【0005】  しかしながら、上述した従来技術のような画素単位でのアライメントでは、アライメントに失敗する可能性がある。【課題を解決するための手段】【0006】  実施形態のアライメント方法は、局所領域設定ステップと、局所アライメントステップと、シフトステップとを、含む。局所領域設定ステップでは、局所領域設定部が、アライメント対象領域の中から、アライメント要求精度以上の精度で行われる局所アライメントの実行対象領域である局所領域を設定する。局所アライメントステップでは、局所アライメント部が、前記局所領域において、検査対象のパターン画像と検査基準の基準パターン画像との前記局所アライメントを行い、局所アライメント結果であるシフト量を得る。シフトステップでは、シフト部が、前記シフト量を用いて前記基準パターン画像全体をシフトする。【図面の簡単な説明】【0007】【図1】図1は、本実施形態の検査装置例を示す構成図。【図2】図2は、本実施形態のパターン画像の取得手法例を示す説明図。【図3】図3は、本実施形態の検出回路例を示す構成図。【図4】図4は、本実施形態の基準パターン画像例を示す図。【図5】図5は、本実施形態の基準パターン画像の除外領域例を示す図。【図6】図6は、本実施形態の輝度階調差画像例を示す図。【図7】図7は、本実施形態の輝度階調差画像の除外領域例を示す図。【図8】図8は、本実施形態のパターン画像例を示す図。【図9】図9は、本実施形態の輝度階調差画像例を示す図。【図10】図10は、本実施形態のグリッド領域に分割された輝度階調差画像例を示す図。【図11】図11は、本実施形態の輝度階調差画像の除外領域例を示す図。【図12】図12は、本実施形態の二値化SSDマップ例を示す図。【図13】図13は、本実施形態の二値化SSDマップ例を示す図。【図14】図14は、本実施形態の二値化SSDマップ例を示す図。【図15】図15は、本実施形態の第1特性領域及び第2特性領域例を示す図。【図16】図16は、本実施形態のアライメント処理例を示すフローチャート。【発明を実施するための形態】【0008】  以下、添付図面を参照しながら、アライメント方法及び検出装置の実施形態を詳細に説明する。以下の実施形態では、レチクルに形成されたパターン画像のアライメント方法を、レチクルに形成されたパターン画像の欠陥の有無を検出する検出装置で使用する場合を例にとり説明するが、これに限定されるものではない。【0009】  図1は、本実施形態の検査装置1の一例を示す構成図である。図1に示すように、検査装置1は、光源10と、ステージ12と、透過光学系14と、反射光学系16と、透過光センサ18と、反射光センサ20と、検出回路22とを、備えている。【0010】  光源10は、光を発生する。ステージ12は、レチクル2を載置する。なおステージ12は、図示せぬ駆動系により駆動される。透過光学系14は、光源10からの光がステージ12上に載置されたレチクル2を透過するように構成されている。反射光学系16は、ステージ12上に載置されたレチクル2に照射された光源10からの光の反射光を検出できるように構成されている。透過光学系14及び反射光学系16は、例えばハーフミラー及び凸レンズにより構成されている。透過光センサ18は、透過光学系14による透過光を検出し、レチクル2上の2つのダイそれぞれのセンサデータ24(例えば、パターン画像)、センサデータ26(例えば、基準パターン画像)を取得(記録)する。反射光センサ20は、反射光学系16からの反射光を検出し、レチクル2上の2つのダイそれぞれのセンサデータ24(例えば、パターン画像)、センサデータ26(例えば、基準パターン画像)を取得(記録)する。【0011】  図2は、本実施形態のパターン画像の取得手法の一例を示す説明図である。透過光センサ18によるレチクル2に形成されたパターン画像の取得は、図2に示すように、レチクル2をラインセンサ(図示省略)で走査することにより行われる。ここでは、便宜上、図2に示すX軸方向(レチクル2の一辺の方向)に細長く切った短冊4をストライプと称し、1ストライプをさらにY軸方向(X軸方向に垂直な方向)に細かく切った正方形の画像5をサブストライプと称する。1ストライプは、例えば2048ピクセル(画素)幅を有しており、1サブストライプは、例えば2048×2048ピクセル(画素)とする。ここで、1ピクセル(画素)は、256階調のグレースケールとする。また、検査装置1によるパターン画像の欠陥の有無の検査は、1サブストライプ毎に行うものとする。なお、基準パターン画像の取得についても同様の手法を適用できる。【0012】  図1に戻り、検出回路22(検出装置の一例)は、パターン画像を基準パターン画像と比較してパターン画像の欠陥の有無を検出する。ここで、パターン画像と基準パターン画像との比較には、ダイとダイとの比較(DD比較:Die  to  Die  比較)、及びダイとデータベースとの比較(DB比較:Die  to  Database比較)がある。ダイとダイとの比較(DD比較)では、検出回路22は、透過光センサ18に記録されたセンサデータ24及びセンサデータ26、又は反射光センサ20に記録されたセンサデータ24及びセンサデータ26を比較して、センサデータ24(パターン画像)の欠陥の有無を検出する。また、ダイとデータベースとの比較(DB比較)では、検出回路22は、透過光センサ18に記録されたセンサデータ24又は反射光センサ20に記録されたセンサデータ24とLSI設計用CADデータ30に基づいて参照データ発生回路32から発生された設計データ34(基準パターン画像)とを比較して、センサデータ24(パターン画像)の欠陥の有無を検出する。【0013】  図3は、本実施形態の検出回路22の一例を示す構成図である。図3に示すように、検出回路22は、入力部110と、全体アライメント部120と、輝度階調差画像生成部130と、除外領域設定部140と、局所領域設定部150と、局所アライメント部160と、シフト部170と、検出部180とを、備える。【0014】  入力部110は、検査基準の基準パターン画像190及び検査対象のパターン画像191をそれぞれ、図2で説明したサブストライプ単位で入力する。なお本実施形態の基準パターン画像190及びパターン画像191は、センサ分解能以上の微細パターンで構成されており、十分な解像度が得られていないものとする。このため、基準パターン画像190及びパターン画像191の比較にはピクセルオーダ未満でのアライメント(位置合わせ)が要求される。本実施形態では、双三次補間(バイキュービックシフト)を用いたサブピクセルオーダの疑似シフトを行うことで、センサ分解能以上のアライメントを実現するものとする。【0015】  全体アライメント部120は、入力部110により入力された基準パターン画像190及びパターン画像191の有効領域全体(本実施形態では2048×2048ピクセル)を対象としたアライメントである全体アライメントを行う。例えば、全体アライメント部120は、基準パターン画像190及びパターン画像191の各ピクセルの輝度階調差の二乗和が最小となるシフト量(X1,Y1)を探索するSSD(Sum  of  Squared  Difference)法を使用して、アライメント処理を施す。具体的には、全体アライメント部120は、数式(1)〜(3)を用いて、アライメント処理を施す。【0016】【数1】【0017】【数2】【0018】【数3】【0019】  ここで、I(x,y)は画像中の座標(x,y)における輝度階調値を表す。S(X,Y)はシフト量(X,Y)でのバイキュービックシフトを用いた画像変換を表し、Iは画像Iのシフト後の画像を表す。シフト量はアライメント必要精度および探索範囲を満たす離散値で与えられ、ここでは1/16ピクセル単位で−5<X<5、−5<Y<5の範囲を取るものとする。また、M(X,Y)は、各シフト量(X,Y)での輝度階調差の二乗和(SSD値)が格納された80×80成分のマトリクスとなり、これをSSDマップと称する。なお、全体アライメントに使用するアライメント手法は、SSD法に限定されるものではなく、他のアライメントアルゴリズムを用いてもよい。【0020】  輝度階調差画像生成部130は、全体アライメント部120により得られるシフト量(X1,Y1)で基準パターン画像190をシフトさせ、シフト後の基準パターン画像190とパターン画像191とを用いて輝度階調差画像192を生成する。後述の局所領域設定部150は、輝度階調差画像192を用いて局所アライメントの実行対象の局所領域を設定する。なお、輝度階調差画像生成部130は、輝度階調差画像192中の最大階調差が既定の閾値以下に収まっている場合、アライメントが既に成功していると判断して、全体アライメント部120により得られるシフト量を後述のシフト部170に出力して、後述の処理を打ち切るようにしてもよい。【0021】  除外領域設定部140は、アライメント対象領域から除外する除外領域、即ち、後述の局所領域設定部150により局所領域として設定されることが除外(禁止)される除外領域を設定する。除外領域設定部140は、第1除外領域設定部142と第2除外領域設定部144と第3除外領域設定部146とを含む。【0022】  第1除外領域設定部142は、基準パターン画像190の各画素において、当該画素地点から第1所定範囲内での画像輝度変化量の最大値が第1閾値以下である場合に、当該画素地点をアライメント対象領域から除外する除外領域に設定する。例えば、第1除外領域設定部142は、基準パターン画像190の各画素において、当該画素地点から±10ピクセル範囲内にある画像データの最大輝度値と最小輝度値との差が10以下である場合に、当該画素地点を除外領域に設定する。【0023】  図4は、本実施形態の基準パターン画像190の一例を示す図であり、図5は、本実施形態の基準パターン画像190の除外領域の一例を示す図である。図5に示す例では、第1除外領域設定部142は、白色塗潰し部分を除外領域に設定している。これにより、輝度階調的に変化の少ない無特徴な部分が後述の局所領域設定部150により局所領域に設定されてしまうことを回避している。【0024】  第2除外領域設定部144は、輝度階調差画像生成部130により生成された輝度階調差画像192の各画素において、当該画素地点から第2所定範囲内で、第2閾値以上の輝度階調差をもつ画素数の含有率が第3閾値以上である場合に、当該画素地点及び当該画素地点の所定周囲をアライメント対象領域から除外する除外領域に設定する。例えば、第2除外領域設定部144は、輝度階調差画像192の各画素において、当該画素地点から既定のピクセル範囲内で、10以上の値を持つ画素数の含有率が0.2以上である場合に、当該画素地点及びその周囲10ピクセル内を除外領域に設定する。【0025】  図6は、本実施形態の輝度階調差画像192の一例を示す図であり、図7は、本実施形態の輝度階調差画像192の除外領域の一例を示す図である。図7に示す例では、第2除外領域設定部144は、白色塗潰し部分(図6に示す例において円210で示された部分)を除外領域に設定している。これにより、後述の局所領域設定部150により真の欠陥上に局所領域が設定されてしまうことを回避している。【0026】  第3除外領域設定部146は、輝度階調差画像生成部130により生成された輝度階調差画像192を所定サイズのグリッド領域に分割する。そして第3除外領域設定部146は、各画素に応じた重み係数であって分割したグリッド領域内の各画素地点における輝度階調差の値に応じた重み係数をかけたSSDアライメントをグリッド領域内で実行し、重み係数をかけたグリッド領域内の輝度階調差の二乗和が最小となるシフト量をグリッド領域毎に求め、求めたシフト量を用いて基準パターン画像190をシフトする。第3除外領域設定部146は、シフト後の基準パターン画像190とパターン画像191とから得られる第2輝度階調差画像における各画素地点において、輝度階調差画像192の階調差との変化量が第4閾値以上となる地点の割合が第5閾値以上となる場合に、当該グリッド領域内の全ての画素地点をアライメント対象領域から除外する除外領域に設定する。【0027】  例えば第3除外領域設定部146は、輝度階調差画像192を縦横64ピクセルのグリッド領域に分割する。ここで、第3除外領域設定部146は、分割したグリッド領域内の各画素地点(x,y)における輝度階調差d(x,y)に比例した重み係数Dを用意しておくものとする。そして第3除外領域設定部146は、各画素に応じた重み係数をかけたSSDアライメント(以下、加重SSDと称する)をグリッド領域内で実行し、加重輝度階調差二乗和が最小となるシフト量(X,Y)をグリッド毎に求める。第3除外領域設定部146は、求めたシフト量(X,Y)を用いて基準パターン画像190全体をシフトし、シフト後の基準パターン画像190とパターン画像191とから得られる輝度階調差画像dIにおける各画素地点において、輝度階調差画像192の階調差との変化量が10以上となる地点の画像全体に対する割合が0.3を超える場合に、グリッド領域内の全ての画素地点を除外領域に設定する。【0028】  図8は、本実施形態のパターン画像191の一例を示す図であり、図9は、本実施形態の輝度階調差画像192の一例を示す図であり、図10は、本実施形態のグリッド領域に分割された輝度階調差画像192の一例を示す図であり、図11は、本実施形態の輝度階調差画像192の除外領域の一例を示す図である。図11に示す例では、第3除外領域設定部146は、白色塗潰し部分を除外領域に設定している。なお図11に示す例では、図9に示す全体アライメントのエラーによる擬似欠陥220は除外領域に設定されておらず、図9に示す実欠陥222のみが除外領域に設定されている。これにより、後述の局所領域設定部150により真の欠陥上に局所領域が選択されてしまうことを回避しつつ、疑似欠陥上に局所領域が選択されることを許可している。【0029】  局所領域設定部150は、アライメント対象領域の中から、パターン画像のアライメント要求精度以上の精度で行われる局所アライメントの実行対象領域である局所領域を設定する。具体的には、局所領域設定部150は、輝度階調差画像生成部130により生成された輝度階調差画像192の領域のうち除外領域設定部140により設定された除外領域を除く領域の中から輝度階調差の大きな地点から順に既定間隔をあけて複数の局所領域を設定する。例えば、局所領域設定部150は、輝度階調差画像生成部130により生成された輝度階調差画像192の輝度階調差の最も大きな地点を1つ設定し、局所領域地点1とする。同様に、局所領域設定部150は、局所領域地点1より100ピクセル以上離れた地点で、局所領域地点1の次に輝度階調差の大きな地点を1つ設定し、局所領域地点2とする。同様に、局所領域設定部150は、局所領域地点1及び2より100ピクセル以上離れた地点で、局所領域地点2の次に輝度階調差の大きな地点を1つ設定し、局所領域地点3とする。【0030】  本実施形態では、局所領域設定部150は、局所領域地点を3つまで設定するものとするが、これに限定されるものではなく、局所領域地点をいくつ設定してもよい。局所領域地点の設定数まで上述の処理は繰り返される。また本実施形態では、局所領域は、局所領域地点を中心とした正方形領域で表され、ここでは21×21ピクセルサイズとする。但し、除外領域の面積が大きく、局所領域を設定できる範囲が狭い場合には、局所領域設定部150は、局所領域地点間の間隔を100ピクセルより小さくなるよう変更して、局所領域地点を設定する。【0031】  なお局所領域設定部150は、第1局所領域設定部152と、第2局所領域設定部154とを、含む。但し、これに限定されるものではなく、局所領域設定部の数は1つであっても3つ以上であってもよい。第1局所領域選択部152は、1回目の局所領域設定を行い、第2局所領域選択部154は、2回目の局所領域設定を行うものであるが、局所領域設定手法はほぼ同様である。【0032】  局所アライメント部160は、局所領域設定部150により設定された局所領域において、基準パターン画像190とパターン画像191との局所アライメントを行い、局所アライメント結果であるシフト量を得る。具体的には、局所アライメント部160は、局所領域設定部150により設定された複数の局所領域それぞれの局所アライメント特性を定量化して、局所アライメントの実行対象の局所領域を選択し、選択した局所領域において、基準パターン画像190とパターン画像191との局所アライメントを行う。【0033】  例えば、局所アライメント部160は、局所領域設定部150により選択された局所領域それぞれに対して、局所領域内に限定した局所アライメントを実行し、局所アライメントによって得られる仮想シフト時の輝度階調差の二乗和の一覧をシフト方向とシフト量に応じて並べてグラフ化した局所領域それぞれのSSDマップ(以下、局所SSDマップと称する)Mp(X,Y)を作成する。また局所アライメント部160は、作成したそれぞれの局所SSDマップにおいて、当該局所SSDマップ中の最小値で、当該局所SSDマップの全要素を除算した正規化SSDマップMn(X,Y)を作成する。さらに局所アライメント部160は、作成したそれぞれの正規化SSDマップにおいて、当該正規化SSDマップ中の値が3以上の要素を0、3未満の要素を1と二値化したバイナリマップ(以下、二値化SSDマップと称する)Mb(X,Y)を作成する。図12〜図14は、本実施形態の二値化SSDマップの一例を示す図である。具体的には、局所アライメント部160は、数式(4)を用いて局所SSDマップを作成し、数式(5)及び(6)を用いて正規化SSDマップを作成し、数式(7)を用いて二値化SSDマップを作成する。ここで、局所SSDマップ、正規化SSDマップ、及び二値化SSDマップが定量化された局所アライメント特性に該当する。【0034】【数4】【0035】【数5】【0036】【数6】【0037】【数7】【0038】  ここで、(xi,yi)はi番目に選択した局所領域地点を表し、dは局所領域のハーフサイズを表し、Uは二値化のための閾値を表す。本実施形態では、d=10、U=3となる。【0039】  また局所アライメント部160は、二値化SSDマップにより形成される特性領域を指標として、各局所領域が有する特性領域の中から基準となる第1特性領域を有する第1局所領域を選出し、選出した第1局所領域が有する第1特性領域と他の局所領域である第2局所領域が有する第2特性領域との間で形成される論理和面積に対する第1特性領域の隠蔽率が大きくなる組み合わせ上位の局所領域を、局所アライメントの実行対象の局所領域に選択する。ここで、第1局所領域は、局所SSDマップ中の最小値となるシフト量で局所シフトを施したパターン画像191と基準パターン画像190との輝度階調差最大値が第6閾値以下であり、第2局所領域の二値化SSDマップとの論理和面積のいずれかが0でなく、二値化SSDマップの領域面積が最も小さいものである。【0040】  例えば、局所アライメント部160は、Mp(Xmin,Ymin)=minMp(X,Y)を満たす(Xmin,Ymin)を用いて、局所SSDマップに対応する基準パターン画像190の局所領域をシフトさせた局所画像と、パターン画像191との局所輝度階調差画像中の最大値が20以下となる局所画像のうち、自身以外の局所領域の二値化SSDマップと論理和マップ面積Ssumのいずれかが0ではなく、さらに二値化SSDマップの領域面積Sが最も小さくなるものを、第1局所領域として選定する。例えば、局所アライメント部160は、図12〜図14に示す二値化SSDマップが存在する場合、二値化SSDマップの領域面積Sが最も小さくなる図12に示す二値化SSDマップを第1局所領域として選定する。また例えば、局所アライメント部160は、図13〜図14に示す二値化SSDマップが存在する場合、二値化SSDマップの領域面積Sが最も小さくなる図13に示す二値化SSDマップを第1局所領域として選定する。なお、S及びSsumは、それぞれ数式(8)〜(10)で表される。【0041】【数8】【0042】【数9】【0043】【数10】【0044】  ここで、Ssum  ijは、2つの局所領域i,jの領域面積を表し、num(Mb)は二値化SSDマップMb中の1の値の数を表し、Mbi＾Mbjは、2つの二値化SSDマップ各要素の論理和を表している。例えば、MbiとMbjの値が1である場合、Mb＿sum  ijの値も1となり、Mbi,Mbjいずれかの値が少なくとも0の場合には、Mb＿sum  ijの値は0となる。【0045】  また、ここでは、二値化SSDマップにおいてMb(X,Y)=1となる(X,Y)の集合部を「領域」と称する。また図13及び図14に示すように、二値化SSDマップ中の領域において、局所SSDマップ極小地点230、240同位置より最長となる領域端地点までの距離を最長距離とし、同極小地点230、240より最短となる領域端地点までの距離を最短距離とする。局所アライメント部160は、最長距離と最短距離との比が3以上のとき、その領域を「細長領域」と分類し、細長領域の最長距離方向を領域の「姿勢ベクトル」と称する(図13に示す例では、姿勢ベクトル232、図14に示す例では、姿勢ベクトル242)。【0046】  また、局所アライメント部160は、図15に示すように、2つの局所領域が有する特性領域がともに細長領域の場合には、姿勢ベクトルの内角θが10度以上あり、かつ、第1特性領域250の隠蔽率δが最大となる特性領域を第2特性領域254とし、第2特性領域254を有する局所領域を第2局所領域とする。つまり、第2局所領域は、第1特性領域と非平行の第2特性領域を有する。なお、図15に示す例では、第1特性領域250の姿勢ベクトルは第1姿勢ベクトル252であり、第2特性領域254の姿勢ベクトルは第2姿勢ベクトル256である。【0047】  ここで、θ、δは、それぞれ数式(11)〜(12)により表される。なお、数式(11)では、θ>90度の場合、θ−90度の角度を用いる。【0048】【数11】【0049】【数12】【0050】  ここで、δijは、第1特性領域iの第2特性領域jに対する隠蔽率を表す。第2局所領域を複数用いる場合には、第1特性領域の隠蔽率上位から必要数だけ選択する。なお本実施形態では第2局所領域の数は1としている。【0051】  また、局所アライメント部160は、第1局所SSDマップ及び第2局所SSDマップを足し合わせて合成局所SSDマップMp＿sumを作成する。なお、Mp＿sumは、数式(13)により表される。【0052】【数13】【0053】  ここで、Mp1は第1局所領域の局所SSDマップを表し、Mp2は第2局所領域の局所SSDマップを表す。なお、第2局所領域が複数存在する場合は、全て足し合わせる。そして局所アライメント部160は、Mp＿sumに関して、Mp＿sum(Xp,Yp)=min(Mp＿sum(X,Y))なるシフト量(Xp,Yp)を求める。これは、基準パターン画像190中の局所領域内のみを用いてSSDを行っていることに他ならない。【0054】  なお局所アライメント部160は、第1局所アライメント部162と、第2局所アライメント部164とを、含んでいる。但し、これに限定されるものではなく、局所アライメント部の数は1つであっても3つ以上であってもよい。第1局所アライメント部162は、1回目の局所アライメントを行い、第2局所アライメント部164は、2回目の局所アライメントを行うものであるが、局所領域設定手法はほぼ同様である。【0055】  なお、上述の処理を第1局所アライメント部162が行う場合には、求めたシフト量(Xp,Yp)で基準パターン画像190全体をシフト(適用)して、第2局所領域設定部154に出力する。第2局所領域設定部154は、シフト後の基準パターン画像190とパターン画像191との輝度階調差画像を生成して、上述した手法と同様の手順で再び局所領域を設定する。なお、第2局所領域設定部154では、設定する局所領域を先に設定した局所領域と区別するため、設定対象の局所領域を第2次局所領域と称し、先に設定した局所領域を第1次局所領域と称する。同様に、選定対象の第1局所領域を第2次第1局所領域、選定対象の第1特性領域を第2次第1特性領域などと称する。【0056】  なお、第2局所アライメント部164は、第1次局所領域、第2次局所領域を全て足し合わせた合成局所SSDマップMp＿sum2を作成する。Mp＿sum2は数式(14)により表される。Mp1＿1は第1次第1局所領域を表し、Mp2＿1は第1次第2局所領域を表し、Mp1＿2は第2次第1局所領域を表し、Mp2＿2は第2次第2局所領域を表す。また、第2局所アライメント部164でも第2局所領域が複数存在する場合は、全て足し合わせる。第2局所アライメント部164は、このMp＿sum2に関して、Mp＿sum2(Xp2,Yp2)=min(Mp＿sum2(X,Y))なるシフト量(Xp2,Yp2)を求める。【0057】【数14】【0058】  シフト部170は、局所アライメント部160により求められたシフト量(Xp2,Yp2)を用いて、基準パターン画像190全体をシフトして、シフト後の基準パターン画像190を生成する。【0059】  検出部180は、シフト部170によりシフトされたシフト後の基準パターン画像190をアライメント結果画像として出力する。検出部180は、基準パターン画像190とパターン画像191を用いて、例えば差分画像をとり、差分画像中で相対的に輝度階調差の大きな部分を欠陥部分として抽出するような検出を行う。【0060】  図16は、本実施形態の検出回路22で行われるアライメント処理(検出処理)の手順の流れの一例を示すフローチャートである。【0061】  まず、入力部110は、基準パターン画像190及び検査対象のパターン画像191をそれぞれ、図2で説明したサブストライプ単位で入力する(ステップS100)。【0062】  続いて、全体アライメント部120は、入力部110により入力された基準パターン画像190及びパターン画像191の全体アライメントを行う(ステップS102)。【0063】  続いて、輝度階調差画像生成部130は、全体アライメント部120により得られるシフト量(X1,Y1)で基準パターン画像190をシフトさせ、シフト後の基準パターン画像190とパターン画像191とを用いて輝度階調差画像192を生成する(ステップS104)。【0064】  続いて、除外領域設定部140は、アライメント対象領域から除外する除外領域、即ち、後述の局所領域設定部150により局所領域として設定されることが除外(禁止)される除外領域を設定する(ステップS106)。【0065】  続いて、局所領域設定部150は、アライメント対象領域の中から、パターン画像のアライメント要求精度以上の精度で行われる局所アライメントの実行対象領域である局所領域を設定する(ステップS108)。【0066】  続いて、局所アライメント部160は、局所領域設定部150により設定された局所領域において、基準パターン画像190とパターン画像191との局所アライメントを行い、局所アライメント結果であるシフト量を得る(ステップS110)。【0067】  続いて、シフト部170は、局所アライメント部160により求められたシフト量を用いて、基準パターン画像190全体をシフトして、シフト後の基準パターン画像190を生成する(ステップS112)。【0068】  続いて、検出部180は、シフト部170によりシフトされたシフト後の基準パターン画像190とパターン画像191を用いて、例えば差分画像をとり、差分画像中で相対的に輝度階調差の大きな部分を欠陥部分として抽出するような検出を行う(ステップS114)。【0069】  このように本実施形態では、局所領域に限定したアライメントを行うことで、計算量を大幅に低減することができ、それにより負荷のかかる高精度なアライメント計算を探索シフト範囲全域で実行可能とする。更に本実施形態によれば、負荷軽減のために、段階的に探索範囲を絞り込みながらSSD精度を高めていくことでアライメントシフト量を求める必要がないため、Local  Minima的な極小解に陥ってしまうことを回避できる。【0070】  また本実施形態では、局所領域選択の除外処理や選別処理を行うことで、局所領域中に実欠陥部を含めてしまうことを回避し、また、繰り返しパターンや輝度階調変化のない無特徴領域などアライメントのための特徴情報の乏しい部分を局所領域として選定することを回避させることが可能となる。従って本実施形態によれば、特徴情報の埋没を防ぐことが可能となるとともに、従来では対応の難しかったより特殊なラインパターンに対しても、一層ロバストにアライメントを成功させることが可能となる。【0071】  更に本実施形態のように、局所領域を複数回行うことで、一度目の局所アライメントにおいて、ある方向成分にのみ有効に機能する指向性の強い局所領域を選択してしまった場合でも、その結果得られる輝度階調差画像から二度目の局所領域を選ぶことで、一度目には位置合わせできなかったすなわち一度目の局所領域が不得手とする方向成分を抑制するのに適した局所領域を積極的に選択することを可能としている。このとき、二度目のアライメントでは、第二次局所領域だけでなく、第一次局所領域も同時に使用することが重要である。繰り返し計算を複数回実行すれば、その抑制をさらに効かせられる。【0072】  以上のように、本実施形態によればアライメント精度を高めることができる。【0073】  また検出部が、全体アライメント結果と局所アライメント結果との結果を比較し、例えばどちらの結果を適用した画像シフト後の輝度階調差総和が小さいか等、どちらの結果がより確からしいアライメント結果かを判定し、より確からしい方を最終的に出力するようにしてもよい。【0074】  なお、本実施の形態で使用しているパラメータ数値は一例である。数値は検査装置に使用されるセンサ解像度やセンサ感度、光源の強度、また検査対象のパターンサイズや計算機の処理能力によって変化するものであり、値を限定するものではない。【0075】  なお、本発明は、上記実施の形態そのままに限定されるものではなく、実施段階ではその要旨を逸脱しない範囲で構成要素を変形して具体化することができる。また、上記実施の形態に開示されている複数の構成要素の適宜な組み合わせにより、種々の発明を形成することができる。例えば、実施の形態に示される全構成要素からいくつかの構成要素を削除してもよい。さらに、異なる実施の形態にわたる構成要素を適宜組み合わせても良い。【符号の説明】【0076】  1  検査装置  2  レチクル  10  光源  12  ステージ  14  透過光学系  16  反射光学系  18  透過光センサ  20  反射光センサ  22  検出回路  24、26  センサデータ  30  LSI設計用CADデータ  32  参照データ発生回路  34  設計データ  110  入力部  120  全体アライメント部  130  輝度階調差画像生成部  140  除外領域設定部  142  第1除外領域設定部  144  第2除外領域設定部  146  第3除外領域設定部  150  局所領域設定部  152  第1局所領域設定部  154  第2局所領域設定部  160  局所アライメント部  162  第1局所アライメント部  164  第2局所アライメント部  170  シフト部  180  検出部
【特許請求の範囲】【請求項1】  局所領域設定部が、アライメント対象領域の中から、アライメント要求精度以上の精度で行われる局所アライメントの実行対象領域である局所領域を設定する局所領域設定ステップと、  局所アライメント部が、前記局所領域において、検査対象のパターン画像と検査基準の基準パターン画像との前記局所アライメントを行い、局所アライメント結果であるシフト量を得る局所アライメントステップと、  シフト部が、前記シフト量を用いて前記基準パターン画像全体をシフトするシフトステップと、  を含むことを特徴とするアライメント方法。【請求項2】  除外領域設定部が、前記基準パターン画像中の各画素において、当該画素地点から第1所定範囲内での画像輝度変化量の最大値が第1閾値以下である場合に、当該画素地点を前記アライメント対象領域から除外する除外領域に設定する第1除外領域設定ステップを更に含むことを特徴とする請求項1に記載のアライメント方法。【請求項3】  全体アライメント部が、前記パターン画像と前記基準パターン画像との全体アライメントを行う全体アライメントステップと、  輝度階調差画像生成部が、前記全体アライメント後の前記パターン画像と前記基準パターン画像との輝度階調差画像を生成する輝度階調差画像生成ステップと、  前記除外領域設定部が、前記輝度階調差画像中の各画素において、当該画素地点から第2所定範囲内で、第2閾値以上の輝度階調差をもつ画素数の含有率が第3閾値以上である場合に、当該画素地点及び所定周囲を前記アライメント対象領域から除外する除外領域に設定する第2除外領域設定ステップを更に含むことを特徴とする請求項1又は2に記載のアライメント方法。【請求項4】  全体アライメント部が、前記パターン画像と前記基準パターン画像との全体アライメントを行う全体アライメントステップと、  輝度階調差画像生成部が、前記全体アライメント後の前記パターン画像と前記基準パターン画像との輝度階調差画像を生成する輝度階調差画像生成ステップと、  前記除外領域設定部が、前記輝度階調差画像を所定サイズのグリッド領域に分割し、各画素に応じた重み係数であって分割した前記グリッド領域内の各画素地点における輝度階調差の値に応じた重み係数をかけたSSD(Sum  of  Squared  Difference)アライメントを前記グリッド領域内で実行して、前記重み係数をかけた領域内の輝度階調差の二乗和が最小となるシフト量を前記グリッド領域毎に求め、求めた前記シフト量を用いて前記基準パターン画像をシフトし、  シフト後の前記基準パターン画像と前記パターン画像とから得られる第2輝度階調差画像における各画素地点において、前記輝度階調差画像の階調差との変化量が第4閾値以上となる地点の割合が第5閾値以上となる場合に、当該グリッド領域内の全ての画素地点を前記アライメント対象領域から除外する除外領域に設定する第3除外領域設定ステップを更に含むことを特徴とする請求項1〜3のいずれか1つに記載のアライメント方法。【請求項5】  前記アライメント対象領域は、前記輝度階調差画像の領域であり、  前記局所領域設定ステップでは、前記輝度階調差画像の領域のうち前記除外領域を除く領域の中から輝度階調差の最も大きな地点に基づく領域を前記局所領域に設定することを特徴とする請求項3又は4に記載に記載のアライメント方法。【請求項6】  前記局所領域設定ステップでは、前記輝度階調差画像の領域のうち前記除外領域を除く領域の中から輝度階調差の大きな地点から順に既定間隔をあけて複数の局所領域を設定し、  前記局所アライメントステップでは、前記複数の局所領域それぞれの局所アライメント特性を定量化して、局所アライメントの実行対象の局所領域を選択し、選択した前記局所領域において、前記パターン画像と前記基準パターン画像との前記局所アライメントを行うことを特徴とする請求項5に記載に記載のアライメント方法。【請求項7】  定量化された前記局所アライメント特性は、局所アライメントによって得られる仮想シフト時の輝度階調差の二乗和の一覧をシフト方向とシフト量に応じて並べてグラフ化した局所SSDマップ、当該局所SSDマップを正規化した正規化SSDマップ、及び当該正規化SSDマップを二値化した二値化SSDマップであり、  前記局所領域設定ステップでは、前記二値化SSDマップにより形成される特性領域を指標として、各局所領域が有する特性領域の中から基準となる第1特性領域を有する第1局所領域を選出し、選出した前記第1局所領域が有する前記第1特性領域と他の局所領域である第2局所領域が有する第2特性領域との間で形成される論理和面積に対する前記第1特性領域の隠蔽率が大きくなる組み合わせ上位の局所領域を、局所アライメントの実行対象の局所領域に選択することを特徴とする請求項6に記載に記載のアライメント方法。【請求項8】  前記第1局所領域は、前記局所SSDマップ中の最小値となるシフト量で局所シフトを施した前記基準パターン画像と前記パターン画像との輝度階調差最大値が第6閾値以下であり、  前記第2局所領域の前記二値化SSDマップとの論理和面積のいずれかが0でなく、  前記二値化SSDマップの領域面積が最も小さいものであることを特徴とする請求項7に記載に記載のアライメント方法。【請求項9】  前記第2局所領域は、前記第1特性領域と非平行の第2特性領域を有することを特徴とする請求項7又は8に記載に記載のアライメント方法。【請求項10】  アライメント対象領域の中から、アライメント要求精度以上の精度で行われる局所アライメントの実行対象領域である局所領域を設定する局所領域設定部と、  前記局所領域において、検査対象のパターン画像と検査基準の基準パターン画像との前記局所アライメントを行い、局所アライメント結果であるシフト量を得る局所アライメント部と、  前記シフト量を用いて前記基準パターン画像全体をシフトするシフト部と、  を備えることを特徴とする検出装置。
アライメント方法及び検出装置
