Windowsバックアップが正常に作動していない時のチェックポイントなど。自分のPC環境で発生している問題のまとめ。
Windows7,バックアップ,0x80070422,0x8007045Dなどについて。
2014.11.18: サイト内の後日談へのリンクを忘れていたので追加。
未解決だった頃の記録を、解決後の記録として文体を修正。
はじめに
私のPCで、Windowsバックアップが正常に作動してなかった頃の記録です。
色々腑に落ちない点もありますが、とりあえずこのページ内の手法で解決しました。(ページ最下段に解決時の記録へのリンクがあります)
大雑把なチェックポイント
windows バックアップでエラーが出る場合
一部のサービスが停止状態になっている可能性が高い。
古いバックアップファイルにエラーが発生している場合は、それを削除すれば正常に戻る(当然ながらバックアップは消える)
システムイメージファイル作成でエラーが出る場合
バックアップ先のHDDがシステムDiskとして認識されている可能性が高い。
バックアップ先のHDDに、VMwareなど仮想マシンのバックアップフォルダが存在していてもダメな場合がある
「システムの復元」>「影響を受けるプログラムの検出」で、問題になっている箇所を炙り出せる可能性あり?
マイドキュメントなどのユーザーフォルダをCドライブ以外に指定している場合も上手く行かない場合が多い?(事例少なし)
解決策その1
Windowsサービスが、知らないうちに停止になってた。
[管理ツール]>[サービス]で
・Remote Procedure Call (RPCSS) ・・・・ 自動
・Block Level Backup Engine Service ・・・・・自動
にする。
何故かこの2点が無効になってた。
その他チェック項目
・COM+ Event System (eventsystem) ・・・・手動
・System Event Notification Service (sens) ・・・・自動
・Volume Shadow Copy (VSS) ・・・・手動
・Microsoft Software Shadow Copy Provider (SWPRV) ・・・・手動
・Windows Backup – 手動
参考にしたサイト: windows バックアップがエラーコード(0x80070422)により設定の変更ができない。 - マイクロソフト コミュニティ
windows バックアップでエラーが発生すると、自動的にサービスが停止するのかな・・・?
解決策その2
バックアップファイルを削除するだけでも、ある程度解決する。
普通にゴミ箱に捨てて、ゴミ箱を空にすればOK。
ただし管理者権限での操作が必要。
そして今までのバックアップは全部消えるので注意。
この操作を行うと・・・
「バックアップ設定が最新の状態でない可能性があります」の警告は出なくなった。
「ウイルス対策ソフトが最新ではない」の警告も消えた
Windows Defender(もしくはそれに相当する機能)が正常に作動していない旨の警告メッセージも出なくなった
ただしエラー(0x80070422)は解決しなかった
システムイメージの作成が出来ない場合
上記サービスの変更で、バックアップ及びシステムイメージファイルの作成は正常に作動するようになった。
・・・が、システムイメージ作成が最後まで走らない。
終盤でエラーが出てしまい、完走しない。
I/O デバイスエラーが発生したため、要求を実行できませんでした。(0x8007045D)
ってなエラーメッセージが出る。検索してみるとこのトラブルは結構発生している様で、かつ効果的な解決方法もない感じ。
試してみた対処方法
・バックアップ先のドライブを変更・・・エラーが出る
・ウイルス対策ソフトを停止・・・・エラーが出る
・「chkdsk /r X:」を実行・・・・HDDにエラーなし。イメージ作成エラー
(/r は読み取り不能な情報の回復)
・USB機器を全部外す・・・エラーが出る
・オーバークロックの解除・・・・まだ試していない。
クリックで拡大
「chkdsk /r で症状は改善する」てな解説が多いけど、治らないぞ・・・!
(これについてはページ最下段に追記補足しています)
症状としては、以下ページに良く似た感じ。
システムイメージの作成でバックアップに失敗しました。 - マイクロソフト コミュニティ
原因(上リンクを超意訳) ・バックアップ用HDDに何かシステムファイルが紛れ込んでいる ・システムドライブと認識されたHDDにはバックアップできない
て感じでイメージ作成に失敗している感じだけれど、新しく購入した外付けHDDですら同様のエラーが出てしまったので完全にお手上げ。
その他の可能性
従来からある「システムの復元」で「影響を受けるプログラムの検出」を行うと常に「リモートデスクトップ(Printer)」が表示される状態になっている。
クリックで拡大
影響を受けるプログラム: Microsoft リモートデスクトップ(Printer)
手動で変更またはインストールした覚えの無いドライバが必ず表示されている。
これは、バックアップに失敗するようになった頃と同時期から発生してる。
現在使用しているプリンタはエプソン製。ロールバックした以前のシステムではキャノン製プリンタを使っていた。
システムの整合性が取れなくなっている感じかなあ。この辺が原因か・・・?
追記
よく考えたら、バックアップ機能の不具合が発生した頃から「IEで印刷できない」「スキャナ機能がWindows側から操作できない」などの不具合も発生している。ウチのPC環境では「Microsoft リモートデスクトップ(Printer)」が原因で間違い無さそう。
(色々頑張っているけどコレ治せない・・・。)
私のPC環境の場合: いつから、どういう風に?
私のPC環境の場合、以下の経緯でトラブルが発生した。
2012年10月、PCがウイルス感染しMBRが破壊された。
手動でMBRの復帰を行った。
この時点ではバックアップ・イメージファイル作成可能。
2013年3月、何となくPC不調になる。
コントロールパネル[バックアップと復元]で、
最新のバックアップ及びシステムイメージを再作成
システムイメージを(PCの調子が良かった)昨年8月頃に戻す
何故か上記ロールバックが上手く行かず、システムイメージを昨年3月頃に戻す
ここで問題が発生した。
「バックアップ設定が最新の状態でない可能性があります」という警告が出るようになり、それ以降コントロールパネル[バックアップと復元]が正常に作動しなくなった。
どんな症状?
windows バックアップが、エラーコード(0x80070422)などで停止する。
具体的なメッセージ
「内部エラーのため、バックアップアプリケーションを開始できませんでした:指定されたサービスは無効であるか、または有効なデバイスが関連付けられていないため、開始できません。(0x80070422)。」
「最新のバックアップ作成」>「安定時にロールバック」>「さらにロールバック」ってな手順が不味かったのだろうか?
追記
自作PCの道楽さんに、このページの内容について補足して頂きました。
Windows7以降の(イメージ)バックアップがエラー発生/リストアできない場合の対処
バックアップ作成が失敗する場合の(ちょっとトリッキーな)解消方法や、エラーの原因がシステム構成やストレージ構成にある場合のお話などが書いてあります。
主にストレージ構成が不正であると判断された場合にこのような現象が起きるようです。またこの場合のストレージ構成が不正というのは、物理ストレージを変えた場合だけではなく「ディスクボリュームの種別が異なる」「パーティションが異なる」というようなことも含まれており、推測ですがWindowsの再認証がかかる場合のように点数化されているのか、発生する場合は一発で発生します。
私の場合、上記が当てはまっているのかな・・・?
2012年 3月 システムイメージ作成 2012年 5月 OSのクリーンインストールを行っている2012年 8月 システムイメージ作成2012年 8～9月頃 Windows 8のTo Go Disk作成のためBIOSをUEFIへ変更2012年10月 ウイルス感染  同時期  システムイメージからの復元不可(3月8月両方) 同時期  新たにパーティション切ってMBR手動で再作成  同時期  2012年3月のイメージに戻す 同時期  CHKDSK c: /r や sfc /scannow 同時期   3月のシステムイメージから復旧が出来るようになった(8月不可)       上記手順の順序を細かく覚えていない。  同時期  実はこの時、どこかのタイミングでWindowsの再認証がかかった。それ以降  システムイメージの作成不可
5月にOSを再インストールした事や、8月にブート構成を変更した事などを、すっかり忘れていました。
PC構成もブート構成だけでなく、Windows認証すら違うイメージで復旧したために「セキュリティー記述子」が不正な値になっているようですね・・・(^_^;
新しくイメージが作成できないワケです orz
あとがき
あと、昨年ウイルス感染した後の手動復帰でもいろいろとイレギュラーな復帰手段を使っているし、色々とシステムをいじり倒したので、復旧はOS再インストールくらいしか手段が無いなあ・・・って感じ。
ああ、なんかもうシステムイメージのバックアップなんて取らなくてイイジャン?的な所まで来てしまいました(^_^;
さらに追記(解決)
このページを作成した1週間後に「chkdsk C: /r」を行うと、何故かディスクにエラーが発生するようになっていました。
そしてエラーが検出されなくなるまでchkdskを繰り返し、最後に「sfc /scannow」を行うと、無事バックアップ可能になりました。
ただしこれは、かなり危険な行為でした。
その後、(このページの件とは別の問題で)人為的な操作ミスでSSDに不良セクタを作ってしまった際、再び「chkdsk C: /r」を繰り返すと、「SSDの予備領域」が食いつぶされ、SSDの寿命は大幅に縮む事になりました。。。
CドライブがSSDの場合、「chkdsk C: /r」はよく考えた上で使わないとダメなようです。
その後の顛末は以下ページに記述しています。
・Windowsのバックアップ機能を復活させるまでの悪戦苦闘のメモ
・Windowsの「システムイメージの作成」が失敗する場合の対処方法 ・CHKDSKを何度も繰り返すと、HDD/SSDが回復する場合が・・・あるみたい
Windows7のバックアップが正常に作動しない場合のチェックポイント
