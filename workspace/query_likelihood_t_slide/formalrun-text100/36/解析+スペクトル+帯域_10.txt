HOME > データ解析チュートリアル > 時間-周波数スペクトル解析チュートリアル
時間-周波数スペクトル解析チュートリアル
このチュートリアルでは FlexPro の非定常データのスペクトル解析機能を説明します。 ここでは ショートタイムフーリエ変換 (STFT) と 連続ウェーブレット変換 (CWT) スペクトルプロシージャを取り上げています。 これらのプロシージャは従来のフーリエやパラメトリック解析のための定常領域の特定に加えデータの中の特性の変化を学ぶのに役立ちます。
4つのシーケンシャルシヌソイドを持つテストシグナル
このチュートリアルでは、異なった周波数のシヌソイドをそれぞれ持つ4つのデータ領域からなる非定常データセットを使用します。
ファイルメニューからデータベースを開くを選択し、 C:\Program Files\Weisang\FlexPro 6.0\Examples\SpectralAnalysis.fpd ファイルを選択します。 チュートリアルフォルダを開き続いて Time-Frequency Analysis サブフォルダを選択、2D- ダイアグラム Data をダブルクリックして開きます。
これがシグナルのグラフです。1024 の浮動小数点値があります。
X (時間) 値は 0 から 0.2047 まで 0.0002 間隔で増加します。 よってナイキスト周波数は 2500 (サンプリングレート 5000 の半分) です。 4つのシヌソイドは以下の振幅、周波数、位相からなります。
10% ランダム Gaussian (ホワイト) ノイズが加えられ -20dB のノイズフロアが存在します。
フーリエ変換での時間情報の損失
まずはこのデータセットの基本的なフーリエ解析から探求していきます。
グラフウィンドウを閉じ Signal オブジェクトをハイライトします。
メインツールバーから解析ウィザードを選択、または右クリックして解析... オプションを選択します。
スペクトル解析からフーリエ解析を選択し、次いでフーリエスペクトルを選択します。 次へをクリックします。 スペクトルタイプでは振幅を選択します。 ウィンドウタイプでは Rectangular -13dB W=1 を選択します。 FFT 長がデータ長または 1024 に設定されていることを確認してください。 最大ピークカウントオプションを選択し 4 を入力します。 ホワイトノイズ許容限界 % ではなしを選択します。 振幅ラベルがフーリエスペクトルのピーク上に表示されなければトグルラベルボタンをクリックしてください。
フーリエプロットが解析ウィザード上で以下のように表示されます。
フーリエスペクトルは4つのシーケンシャル成分を正確に特定していますが、これらの高調波の開始および終了時間に関する情報はありません。 それぞれの成分は継続時間中無限に存在すると仮定されるので時間ローカライズ情報は全て失われます。
さらに、それぞれの成分は全体のデータの 1/4 に過ぎないので、それぞれの振幅は高調波のほぼ 1/4 になってしまっています。
正確なフーリエスペクトルのためには、シグナルは広義で定常的でなくてはなりません。 これはスペクトル成分がサンプリングの継続時間を通じて周波数およびパワーにおいて一定でなければならないことを意味します。
CWT および STFT 解析は、データの時間-周波数スペクトルを備えているので、非定常データの解析に有用です。
ショートタイムフーリエ変換スペクトル
ショートタイムフーリエ変換 (STFT) は、それぞれのセグメントの中央の時間値がアサインされる外ことを除きピリオドグラムやセグメントオーバーラップ FFT に似ていて、スペクトルピークから振幅またはパワーを直接抽出する必要が無ければ可能な限り最良の時間ローカライゼーションを実行するためにデータテーパリングウィンドウが使用されます。
時間-周波数スペクトルは本質的にファジーです。 時間分解能が高いほど周波数分解能は貧弱です。 周波数での分解能が鋭くなるほど時間分解能は落ちます。 STFT はこの効果に対する最良の方法です。
戻るボタンをクリックして解析ウィザードのステップ 1 に戻ります。 時間-周波数解析 カテゴリを選択し STFT プロシージャを選択します。 次へボタンをクリックしウィザードのステップ 2 に進みます。 ショートタイムフーリエ変換 (STFT) プロシージャが自動的に選択されます。
スペクトルタイプでは dB 正規化 を選択します、 ウィンドウタイプは Cos2 Hanning -31dB W=2 に設定します。 FFT 長がセグメント長、セグメント長がデータ長の 1/4 である 256 に設定されていることを確認します。 オーバーラップ % は 50 に設定します。
一般的に時間-周波数スペクトルでそうされているように、時間を X-軸に置くために周波数を Z にチェックします。最大 dB レンジ を 20、最大 STFT 周波数 を 無制限 のままにしておきます。
これらの設定によりそれぞれ 0.05 秒の7つのスナップショットが生成されます。 129 の周波数が存在します。 周波数 500、1000、1500、2000 で明確な成分の定義がされていますが、4つの高調波のシーケンシャルな特性は時間での乏しい定義により曖昧になっています。 また、スナップショットにアサインされた時間がセグメントでの平均時間なため、スペクトル情報が利用できない2つの時間範囲での相当な範囲が存在します。
時間での密度を増加させる非常にシンプルな方法はオーバーラップ % をあげることです。
オーバーラップ % を 90 にします。
今度はこのスペクトルを構成する 31 の異なる時間スナップショットが現れます。 同じく 129 の周波数が存在します。 このプロシージャは時間分解能でのささやかな改良ですが、それぞれのスナップショットはまだデータの 1/4 での平均です。 時間分解能を向上させるにはセグメント長を縮小することが必要です。
セグメント長を半分にするため、128 に変更します。 オーバーラップ % は 90 のままにしておきます。
今度はそれぞれデータの 1/8 での平均の75の時間セグメントが存在します。時間-周波数トレードオフは明白です。 時間分解能は格段に上がりましたが周波数分解能は明らかに下がっています。
セグメント長を 64 に変更します。 オーバーラップ % は 90 のままにしておきます。
今度はそれぞれデータの 1/16 の平均の 161 の時間セグメントが存在します。 33 の周波数が存在します。 時間での定義は改善されましたが周波数分解能は明らかにファジーになっています。 これをもうワンステップ進めます。
セグメント長を 32 に変更します。 オーバーラップ % は 90 のままです。
今回は 331の時間値が存在しますが、スペクトルグリッドにはわずか 17 の周波数ノードがあるのみです。 時間スナップショットはデータの 1/32 の平均をあらわし、そのため時間の定義は実にシャープです。 周波数領域での分解能はスペクトルピークが隣接する点まで低下しています。
この視覚化は 3D サーフェイスプロットでより明快になることがあります。
スタンダードビューをクリックします。 3D レンダリンググリッドを改良するために FFT 長 を 128 にします。
これは時間分解能に重きを置いた時間-周波数トレードオフの可視化にとって良い方法です。 ここで周波数に注目した最初の設定に戻ります。
セグメント長をデータ長 /4、 FFT 長 をセグメント長、オーバーラップ % を 90 にします。
これは時間での著しい不明瞭さを犠牲にして周波数分解能に重点を置いた時間-周波数トレードオフの優れた視覚化です。
STFT パラメータの最適化は挑戦的です。 STFT は単一分解能テクニークです。 同じ時間-周波数トレードオフがスペクトルのどこにでも周波数にかかわらず存在します。 STFT は注意深い微調整を要求しますが、最適化されたスペクトルはスペクトルのピークの高さから直接スペクトルの振幅とパワーを読み取ることが出来ます。
スペクトルタイプは振幅、ウィンドウタイプは Rectangular -13dB W=1 (ウィンドウなし)、セグメント長は 64、FFT 長は 256、オーバーラップ % は 90 に設定します。
連続ウェーブレット変換スペクトル
STFT は位相を持つサインベースの関数です。 サイン関数の無限の継続時間はデータのウィンドウをかけたセグメントの変換を要求します。 基底関数がそれ自身有限持続時間ならば、スペクトルはこの限定された継続時間のマザーウェーブレットとデータのシフトされたバージョンと引き伸ばし/圧縮されたバージョンの相関から生成できます。 これが 連続ウェーブレット変換 (CWT) の本質です。
ウェーブレット形状の厳密な配列にもかかわらず、時間-周波数スペクトル解析にウェーブレットを使用するのは一般的に STFT を最適化するより容易です。 ほとんどのケースで、幾つかのマザーウェーブレットや設定の違いは時間-周波数スペクトルの結果に大きな影響を与えません。 マザーウェーブレットと調整可能パラメータの選択は一般に時間-周波数トレードオフの選択を含みます。
連続ウェーブレット変換 (CWT) プロシージャを選択します。 スペクトルタイプでは dB 正規化を選択します。 ウェーブレットタイプ には Morlet、 Morlet の調整 (ウェーブ数) を 8 に設定します。 畳み込みゼロパッドは 1024 (1024のデータを2048、次の2の累乗にパッドします)、周波数の数は 40、開始周波数 0、終了周波数 2500 (ナイキストレンジいっぱい) に設定します。 周波数 Z がチェックされ、最大 dB レンジ が 20、最大 CWT 時間値 が1024 (データ長 1024 にフルに対応) に設定されていることを確認してください。
すばらしい CWT 時間-周波数スペクトルです。 事実、マザーウェーブレットやその調整可能なパラメータに関係なくすばらしい結果になっています。 全ての時間-周波数解析にウェーブ数 8 の Morlet ウェーブレットを使用することができ、データの振動ともっとも適合する形状や最適な時間-周波数分解能から得られる振動カウントを持つウェーブレットの選択に由来する精錬を失うことがありません。 これを実際に見るためにFlexPro で提供される機能を探求していきます。
ウェーブレット解析の時間-周波数トレードオフを評価するために、コンタープロットを元に戻します。  プランのビューをクリックします。
Morlet ウェーブレットの調整をウェーブ数 20 に変更します。
調整可能パラメータ (ウェーブ数) 20 のMorlet はより良い周波数ローカライゼーションとより劣る時間ローカライゼーションを生成します。
Morlet ウェーブレットの調整をウェーブ数 50 に変更します。
調整可能パラメータ (ウェーブ数) 20 のMorlet は鋭い周波数定義とより劣る時間ローカライゼーションを生成します。
ウェーブレットタイプを GaussDeriv に変更し、 調整値 (次数) を 2 に設定します。
調整可能パラメータ (次数) 2 の Gaussian Derivative ウェーブレットはもっとも鋭い時間ローカライゼーションと、不明瞭な周波数ローカライゼーションを生成します。
多分解能解析
CWT は多分解能技法です。 先ほどのプロットを仔細に調べれば、もっとも低い周波数ピークがもっとも高い CWT スペクトルマグニチュードを持ち、4つのシグナル成分の周波数を不鮮明にしていることに気がつくでしょう。 もっとも高い周波数のピークは一貫してもっとも低いスペクトルマグニチュードを証言し、4つの成分の周波数を不鮮明にします。
この特性は設計の問題というよりは CWT アルゴリズムの副産物です。 多分解能解析にはその利点と欠点があります。 高周波成分が非常に短い時間で間欠的に存在する場合、最適なポジションはその出現や消失を正確に捉えるためのトレードオフ周波数分解能になるでしょう。 低周波成分が長時間続く場合、最適な状況はより正確な周波数推定を行うためのトレードオフ時間分解能になるでしょう。 これらの状況の時、CWT での多分解能解析は価値があります。
連続性が周波数に依存しない場合、あるいはスペクトルのマグニチュードから直接振幅とパワーを取り出すのが主目的なら、CWT 多分解能の特性は逆に欠点となります。
CWT 周波数の余剰
伝統的にウェーブレット解析で使用された離散ウェーブレット変換 (DWT) と異なり、CWT は要求するどのような周波数のセットでも評価できます。 これらの周波数は剰余の任意の測定を伴ってオーバーラップし得、線形、対数などさまざまなシークエンスでスケールされ得ます。 個々の FFT は評価される個々の周波数のために保存されるため、FlexPro は周波数カウントの合計を 500 に制限しています。 この周波数の余剰のため CWT は DWT に比べ遥かに高い分解能を提供することが出来ます。
再度 Morlet ウェーブレットを選択します。 ウェーブ数は 12 に設定します。 周波数の数は 100 とします。 開始周波数を 400、終了周波数を 1200 に設定します。
CWT スペクトル解析の全ての解析パワーが 400 から 1200 周波数帯域に集中されました。
FFT ゼロパッディングとエッジ効果
変換によりスペクトルが生成される伝統的なフーリエ解析と異なり、CWT で使用されている FFT はデータのスケールされ変形されたウェーブレットの高速な畳み込みです。 CWT では基底関数はスケールされシフトされたウェーブレットで、フーリエの制限もしくは余弦ではありません。 ゼロパッディングは CWT では、高速畳み込みプロシージャのラップアラウンド効果を避けるというただ1つの目的でのみ使用されます。
FFT 長がデータ長の2倍の時、全ての周波数でラップアラウンドが完全に避けられます。 しばしば次の2の累乗の数までゼロパッドを行い目に見える程度のラップアラウンドは避けることが出来、同時にもっとも高速な畳み込みを実行することが出来ます。
exact N FFT が高速畳み込みに使用された場合、低周波でのラップアラウンドは視覚的にはっきり認められます。 このラップアラウンド効果は周波数にしたがって減少します。 これは最も高い周波数でのラップアラウンド効果の欠如を明らかにします。 ごく僅かな低周波数成分が存在する場合、あるいはデータが処理する帯域で周期的な場合、ゼロパッディングを使用する必要はありません。
この効果を避けるためにゼロパッディングを使用すると、ラップアラウンドに関連したパワーは破棄されます。 これはデータレコードの周縁付近の縮小されたパワーに帰着します。 CWT の用語では、このパワーが縮小されるゾーンは円錐状影響圏として知られています。 この円錐状影響圏は特に周波数のスペーシングが対数の場合重要です。
Morlet のウェーブ数を 100、 畳み込みゼロパッドを 0、 周波数の数を 40、 開始周波数を 0、終了周波数を 2500 に設定します。
このケースでは、非常に高いウェーブ数はより大きな円錐状影響圏に帰着します。 最も低い周波数成分は時間スケールの右側を包み込みます。 この円錐状影響圏の情報がプロットされないため、これは FlexPro では見られません。
Morlet のウェーブ数を 12 に設定し次へをクリックします。ステップ 3 のそれぞれのオプションをチェックし Finish をクリックします。
FlexPro のデータベースに合計4つのオブジェクトが生成されます。
"スペクトル" は解析オブジェクトです。 これはスペクトル解析を行うオブジェクトです。 このオブジェクトをダブルクリックするとウィザードによって生成された解析オブジェクトが開きます。
"スペクトル" はウィザードによって生成された時間-周波数スペクトルのプロットです。 スペクトルオブジェクトを使用します。
"データ" はオリジナルの時間領域データのプロットです。
"時間-周波数" はスペクトルとデータのプロットを含むドキュメントです。
参考文献
デジタル信号処理の詳細については下記の文献を参照ください。
Oppenheim, A. V. and Schafer, R. W. (1989). Discrete-Time Signal Processing. Prentice Hall, Englewood Cliffs, NJ. 
FlexPro で使用している FFT アルゴリズムは以下の文献で説明されています。
C. Temperton, "Implementation of a Self-Sorting In-Place Prime Factor FFT Algorithm", Journal of Computational Physics, v. 58, p. 283, 1985 
R. C. Singleton, "An Algorithm for Computing the Mixed Radix Fast Fourier Transform", IEEE Trans. Audio Electroacoust., v. AU-17, p. 93, June 1969 
L. R. Rabiner, R. W. Schafer, C. M. Rader, "The Chirp z-Transform Algorithm and Its Application", BSTJ, 48, p.1249, May-June 1969 
データテーパリングウィンドウの情報は下記の文献を参照下さい。
Albert H. Nuttall, "Some Windows with Very Good Sidelobe Behavior", IEEE Trans. ASSP, v29-1, Feb. 1981. 
ウェーブレットに関する情報はこちらを参照下さい。 http://www.amara.com/current/wavelet.html.
実世界のデータにウェーブレット解析を適用する繊細さを理解したい方には、CWT をカバーした徹底的でかつ入手しやすい文献があります。
Christopher Torrence and Gilbert Compo, "A Practical Guide to Wavelet Analysis", Bulletin of the American Meteorological Society, v.79, no.1, p.61-78. January 1998 
この文献はエルニーニョの時系列データを解析する文脈で CWT を説明しています。 この著者は FORTRAN のパブリックドメインの CWT ウェーブレット解析パッケージ WAVEPACK を公開しています。 FlexPro のリリース時点では、文献と WAVEPACK のコードはともに http://paos.colorado.edu/research/wavelets/ で見ることができました。
FlexPro データ解析チュートリアル関連情報: 
クロススペクトル解析チュートリアル
フーリエスペクトル解析チュートリアル
高調波解析チュートリアル
スペクトル推定チュートリアル
時間-周波数スペクトル解析チュートリアル
非線形カーブフィッティングチュートリアル
前のページに戻る
HULINKS | テクニカルサポート | FlexPro
