virtualdubmodの使用方法と、音ズレが発生した動画の修正方法を紹介しています。基本は動画と音声を別々にエンコード、後からmux(合成)です。
VirtualDubMod,音ズレなどについて。
2014.11.27:古くなった情報を改訂
VirtualDubModの音声部分の処理、エンコードを解説したページです。
同時に音ズレ対策の話も記載しています。
このページで紹介する音ズレ対策は、AVIキャプチャした動画、自作した動画に音ズレが発生した場合などに有効です。「ネットで拾った動画を再エンコしたら音がズレる」場合は別の方法が有効です。
VirtualDubModの音声処理方法
まずは前ページのおさらい
クリックで拡大
VirtualDubModは、[ストリーム]のメニューから、音声ファイルを差し替えたり、チャプタの編集などができます。
音声の項目を右クリックすると、複数のメニューが表示されます
インターリーブ
音声の先読み設定や、音ズレの補正などが行えます。
圧縮
「完全処理モード」を選択した場合に利用できます。音声部分を別形式に圧縮変換が可能になります。
拡散フィルターを使用する
チェックを入れるとフィルターが利用可能になります。
「完全処理モード」を選択する必要があります。
VirtualDubModには、ローパス、ハイパス、ミックス、ストレッチなどのフィルタが搭載されています。
フォーマット変換
音声を圧縮する際、サンプリング周波数を変更したい場合はここでサンプリング周波数を変更しておきましょう。
ただし再生開始位置がズレて音ズレが発生する可能性があります。
上項「インターリーブ」で補正する必要あり。
ストリームの直接コピー
音声を変換したくない場合に選択します。
完全処理モード
これをを選択すると、音声の圧縮やフィルター利用が可能になります。
音声の圧縮
クリックで拡大
音声の圧縮はLame MP3がお勧めです。別途インストールしておきましょう。
Lame MP3を利用すると、最高で320kbpsのビットレートで音声をmp3に変換する事が可能です。
AVI動画に利用するMP3エンコードの設定はCBRが基本です。
また、ソースと同じサンプリング周波数 (例: 48000Hz) を利用するようにしましょう。
ステレオ/モノラルやビットレートは本人のお好みで。
128～256Kbpsあたりが妥当です。
複数音声の登録
VirtualDubModでは、複数の音声を登録可能です。
クリックで拡大
MKVだけなくAVI形式でファイルを出力した際にも、複数の音声トラックが収録されます。
(とは言うものの、複数の音声を収録する場合は、できるだけMKVで出力しましょう)
MPC-HCやVLCのような音声切り替えに対応した再生ソフトを利用すれば、再生中に音声の切り替えが可能になります。
以下、VirtualDubModを利用した動画作成方法の一例です。
音ズレ対策を含めた手順になっています。
手順1: 素材動画の音ズレチェック
変換前の素材となる動画に音ズレが無いか、あらかじめチェックしておきましょう。
音ズレが発生していない場合
そのまま変換すればOK。ただし念のため音声と動画は別々に変換出力しておく。
再生開始からズレている、音ズレの間隔は最初から最後まで変わらない場合
インターリーブで直せばOK
序盤はずれていないが、徐々にずれていく場合
キャプチャ時のドロップフレームが原因である場合が多いので、まずはキャプチャの設定を見直す。
既にキャプチャ済みの動画は、音声のストレッチを行ったり、動画のフレームレートを変更して無理やり修正する
手順2: 動画部分と音声部分は別々にエンコードを行う。
動画と音声を同時に変換すると、音ズレが生じていた場合に直すのが大変です。
変換作業を行う場合は、まず動画部分と音声部分を別々に変換しましょう。
音声のみの出力
クリックで拡大
[wave保存]や[分離]を利用します。
複数の音声を登録している場合は、選択された音声のみを出力します。
[WAVE保存]を選択した場合、拡張子はwavになりますが、mp3へ変換設定をしている場合、中身はmp3になります。
動画部分も別途出力しておきます
音声と動画の出力が終わったらVitrualDubModを起動しなおして、出力した動画と音声を読み込み、音ズレが発生していないかチェックします。
音ズレが確認できなければ、そのまま無変換圧縮を利用して動画と音声を結合して出力します。
手順3: 音ズレが発生していた場合
再生開始からズレている、音ズレの間隔は最初から最後まで変わらない、という場合は、インターリーブを使って音声のオフセット指定を変更します。
矢印の部分にミリ秒単位で音声のズレを入力し補正します。
※この際、音ズレの確認はプレビュー画面ではなく、出力ファイルで行いましょう。
(VirtualDubModのプレビューは結構音がズレます)
※音と映像がピッタリ合わなくても、あまり神経質にならないようにしましょう。
(TV放送などは、結構音がずれています)
余談
光と音の速度の違いにより、例えば30m離れた場合、音は約0.1秒遅れて聞こえます。しかし、その位の距離までは音が遅れて聞こえる気はしないはず。
(普通の人で30m～50mあたりから音の遅れを感じるそうです)
これは、だいたい0.1秒くらいまでの音の遅れは人間の脳が補正してくれるからだそうです。
逆に音が早く聞こえる分には 脳の補正は働かないので、0.01秒早くなっても、敏感な人は違和感を感じてしまいます。
手順4: 動画と音声のズレが徐々に大きくなる場合
本来は動画キャプチャ時や作成時や作成時に気を付けるべきものですが、既に出来上がってしまった動画は、私の場合は以下の様に対処しています。
以下1～2、どちらかの方法で音ズレを解消しています。
方法1: 動画のフレームレートを変更する
クリックで拡大
動画のフレームレートを変更する事で、手軽に音ズレを補正できます。
動画をPCや手持ちの再生デバイスで再生することだけが目的の場合、この方法が便利です。
Youtubeなどの動画共有ファイルにアップする場合は、(中途半端なフレームレートは)サーバー上で再変換がかかった時に音ズレする可能性があるので注意です。
方法2: 音声ファイルのストレッチを行う
クリックで拡大
音声部分を一旦wav形式で出力し、SoundEngine Free などで再生時間のストレッチ処理を行ってみる。
タイムストレッチには色々なツールを試しましたが、SoundEngine Freeが精度が高く、また使いやすいように感じます。
多少手間がかかりますが、ネットに動画をアップしたい場合や、さらに変換したい場合はこちらの手順の方がお勧めです。
※このページの改訂前は音声のサンプリング周波数を変更する方法も記載していましたが、別の問題で音ズレが発生する事も多く、取り下げました。
とりあえず、上記が私が行っている音ズレ修正方法です。
PC環境が変わった場合などは、キャプチャーツールの設定を見直さなければならない事が多く、何度か環境が変わる内にキャプチャのチューニングにすっかり飽きてしまい、今ではあまりシビアに設定せず、上記の方法を併用してお気軽キャプチャを行っています。
サイト内関連ページ
・VirtualDubMod 概要
・VirtualDubMod のインストール方法、日本語化
・VirtualDubMod の使い方
・VirtualDubMod の使い方2(音声処理・音ズレ処理)(このページ)
・VitualDubMod カテゴリーページ
VirtualDubModの使い方2(音声処理・音ズレ処理)
