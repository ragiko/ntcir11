Couchbase Serverへ情報が格納される手順は、どのように、どのタイミングで情報のインデックスが作成されるのかに影響をあたえ、インデックスとデータがクラスタに保存されるタイミングは関連しています。加えて、データのインデクシングはビューシステムとそのビューへアクセスする際の設定が影響します。基本的なデータ保存とインデクシングの順序は以下のようになります:
ドキュメントがクラスタに保存されます。はじめは、RAM上にのみドキュメントが保存されます。ドキュメントは標準のディスク書き込みキューメカニズムを介して、ディスクに永続化されます。ドキュメントがディスクに永続化されると、そのドキュメントはビューメカニズムによってインデクシング可能になります。
このシーケンスは、ドキュメントがディスクに永続化されているかどうかを基準にしており、ビューの結果がメモリに保存されている状態に対して結果整合性であることを意味します。ドキュメントをクラスタに書き込み、新しく書き込まれたドキュメントが生成されたインデックスに反映されていない状態でインデックスにアクセスすることは可能です。逆に、期限切れチェック処理によってデータベースから削除されるまで、有効期限付きのドキュメントがビューインデックス内に存在し続ける場合もあります。
Couchbase Server マニュアル 2.0 - 第9章 ビューとインデックス - 9.3.4. ドキュメントストレージとインデックスの処理順序
